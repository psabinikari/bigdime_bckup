;try {
/* module-key = 'com.gliffy.integration.confluence:gliffy-viewer-resources', location = 'js/PromiseJS.js' */
(function(g){var d={Pending:"Pending",Resolved:"Resolved",Rejected:"Rejected"};if(!Array.prototype.forEach){Array.prototype.forEach=function(l,k){for(var j=0,h=this.length;j<h;++j){if(j in this){l.call(k,this[j],j,this)}}}}function e(){var i=this,j=[],h=[],n=[],m=d.Pending,l;function k(){var o=this;o.success=function(p){if(m===d.Resolved){p.call(o,l)}else{j.push(p)}return o};o.fail=function(p){if(m===d.Rejected){p.call(o,l)}else{h.push(p)}return o};o.progress=function(p){n.push(p);return o};o.always=function(p){return o.success(p).fail(p)};o.then=function(q,p){return o.success(q).fail(p)};o.isPending=function(){return m===d.Pending};o.isResolved=function(){return m===d.Resolved};o.isRejected=function(){return m===d.Rejected};o.value=function(){return l}}i.promise=new k();i.resolve=function(o){if(m===d.Pending){m=d.Resolved;l=o;j.forEach(function(p){p.call(i.promise,l)})}};i.reject=function(o){if(m===d.Pending){m=d.Rejected;l=o;h.forEach(function(p){p.call(i.promise,l)})}};i.notify=function(){if(m===d.Pending){n.forEach(function(o){o.call(i.promise)})}}}function b(h){return Object.prototype.toString.call(h)==="[object Array]"}function a(l){var h=b(l)?l:Array.prototype.slice.call(arguments,0),j=h.length,i=0,k=new e();h.forEach(function(m){m.always(function(){i+=1;if(i===j){k.resolve(h)}})});return k.promise}function c(i,h,j){if(i.length===0){h.resolve(j)}else{var k=i[0].call();k.always(function(){c(Array.prototype.slice.call(i,1),h,j.concat([k]))})}}function f(j){var h=b(j)?j:Array.prototype.slice.call(arguments,0),i=new e();if(h.length===0){i.resolve()}else{c(h,i,[])}return i.promise}g.PromiseJS={Deferred:e,when:a,chain:f};if(typeof exports!=="undefined"){exports.PromiseJS=g.PromiseJS}}((function(){return this}.call())));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}

;
;try {
/* module-key = 'com.gliffy.integration.confluence:gliffy-viewer-resources', location = 'js/gliffy-html5-viewer.min.js' */
(function(){(function(){function n(n,t){if(n!==t){var r=n===n,e=t===t;if(n>t||!r||typeof n=="undefined"&&e){return 1}if(n<t||!e||typeof t=="undefined"&&r){return -1}}return 0}function t(n,t,r){if(t!==t){return h(n,r)}r=(r||0)-1;for(var e=n.length;++r<e;){if(n[r]===t){return r}}return -1}function r(n){return typeof n=="function"||false}function e(n,t){var r=n.length;for(n.sort(t);r--;){n[r]=n[r].c}return n}function u(n){return typeof n=="string"?n:null==n?"":n+""}function o(n){return n.charCodeAt(0)}function i(n,t){for(var r=-1,e=n.length;++r<e&&-1<t.indexOf(n.charAt(r));){}return r}function f(n,t){for(var r=n.length;r--&&-1<t.indexOf(n.charAt(r));){}return r}function a(t,r){return n(t.a,r.a)||t.b-r.b}function c(t,r){for(var e=-1,u=t.a,o=r.a,i=u.length;++e<i;){var f=n(u[e],o[e]);if(f){return f}}return t.b-r.b}function l(n){return Nt[n]}function s(n){return Ut[n]}function p(n){return"\\"+$t[n]}function h(n,t,r){var e=n.length;for(t=r?t||e:(t||0)-1;r?t--:++t<e;){var u=n[t];if(u!==u){return t}}return -1}function _(n){return n&&typeof n=="object"||false}function g(n){return 160>=n&&9<=n&&13>=n||32==n||160==n||5760==n||6158==n||8192<=n&&(8202>=n||8232==n||8233==n||8239==n||8287==n||12288==n||65279==n)}function v(n,t){for(var r=-1,e=n.length,u=-1,o=[];++r<e;){n[r]===t&&(n[r]=z,o[++u]=r)}return o}function y(n){for(var t=-1,r=n.length;++t<r&&g(n.charCodeAt(t));){}return t}function d(n){for(var t=n.length;t--&&g(n.charCodeAt(t));){}return t}function m(n){return Ft[n]}function w(g){function Nt(n){if(_(n)&&!(Wo(n)||n instanceof Lt)){if(n instanceof Ft){return n}if(Fu.call(n,"__chain__")&&Fu.call(n,"__wrapped__")){return ge(n)}}return new Ft(n)}function Ut(){}function Ft(n,t,r){this.__wrapped__=n,this.__actions__=r||[],this.__chain__=!!t}function Lt(n){this.__wrapped__=n,this.__actions__=null,this.__dir__=1,this.__dropCount__=0,this.__filtered__=false,this.__iteratees__=null,this.__takeCount__=po,this.__views__=null}function $t(){this.__data__={}}function zt(n){var t=n?n.length:0;for(this.data={hash:ro(null),set:new Gu};t--;){this.push(n[t])}}function Dt(n,t){var r=n.data;return(typeof t=="string"||He(t)?r.set.has(t):r.hash[t])?0:-1}function qt(n,t){var r=-1,e=n.length;for(t||(t=bu(e));++r<e;){t[r]=n[r]}return t}function Pt(n,t){for(var r=-1,e=n.length;++r<e&&false!==t(n[r],r,n);){}return n}function Kt(n,t){for(var r=-1,e=n.length;++r<e;){if(!t(n[r],r,n)){return false}}return true}function Vt(n,t){for(var r=-1,e=n.length,u=-1,o=[];++r<e;){var i=n[r];t(i,r,n)&&(o[++u]=i)}return o}function Yt(n,t){for(var r=-1,e=n.length,u=bu(e);++r<e;){u[r]=t(n[r],r,n)}return u}function Zt(n){for(var t=-1,r=n.length,e=so;++t<r;){var u=n[t];u>e&&(e=u)}return e}function Gt(n,t,r,e){var u=-1,o=n.length;for(e&&o&&(r=n[++u]);++u<o;){r=t(r,n[u],u,n)}return r}function Jt(n,t,r,e){var u=n.length;for(e&&u&&(r=n[--u]);u--;){r=t(r,n[u],u,n)}return r}function Xt(n,t){for(var r=-1,e=n.length;++r<e;){if(t(n[r],r,n)){return true}}return false}function Ht(n,t){return typeof n=="undefined"?t:n}function Qt(n,t,r,e){return typeof n!="undefined"&&Fu.call(e,r)?n:t}function nr(n,t,r){var e=$o(t);if(!r){return rr(t,n,e)}for(var u=-1,o=e.length;++u<o;){var i=e[u],f=n[i],a=r(f,t[i],i,n,t);(a===a?a===f:f!==f)&&(typeof f!="undefined"||i in n)||(n[i]=a)}return n}function tr(n,t){for(var r=-1,e=n.length,u=fe(e),o=t.length,i=bu(o);++r<o;){var f=t[r];u?(f=parseFloat(f),i[r]=oe(f,e)?n[f]:b):i[r]=n[f]}return i}function rr(n,t,r){r||(r=t,t={});for(var e=-1,u=r.length;++e<u;){var o=r[e];t[o]=n[o]}return t}function er(n,t,r){var e=typeof n;if("function"==e){if(e=typeof t!="undefined"){var e=Nt.support,u=!(e.funcNames?n.name:e.funcDecomp);if(!u){var o=Nu.call(n);e.funcNames||(u=!mt.test(o)),u||(u=Et.test(o)||Qe(n),xo(n,u))}e=u}n=e?Fr(n,t,r):n}else{n=null==n?yu:"object"==e?Ar(n):typeof t=="undefined"?Er(n+""):jr(n+"",t)}return n}function ur(n,t,r,e,u,o,i){var f;if(r&&(f=u?r(n,e,u):r(n)),typeof f!="undefined"){return f}if(!He(n)){return n}if(e=Wo(n)){if(f=re(n),!t){return qt(n,f)}}else{var a=$u.call(n),c=a==V;if(a!=Z&&a!=D&&(!c||u)){return St[a]?ue(n,a,t):u?n:{}}if(f=ee(c?{}:n),!t){return rr(n,f,$o(n))}}for(o||(o=[]),i||(i=[]),u=o.length;u--;){if(o[u]==n){return i[u]}}return o.push(n),i.push(f),(e?Pt:vr)(n,function(e,u){f[u]=ur(e,t,r,u,n,o,i)}),f}function or(n,t,r,e){if(typeof n!="function"){throw new Cu(B)}return Ju(function(){n.apply(b,Or(r,e))},t)}function ir(n,r){var e=n?n.length:0,u=[];if(!e){return u}var o=-1,i=te(),f=i==t,a=f&&200<=r.length?Ao(r):null,c=r.length;a&&(i=Dt,f=false,r=a);n:for(;++o<e;){if(a=n[o],f&&a===a){for(var l=c;l--;){if(r[l]===a){continue n}}u.push(a)}else{0>i(r,a)&&u.push(a)}}return u}function fr(n,t){var r=n?n.length:0;if(!fe(r)){return vr(n,t)}for(var e=-1,u=_e(n);++e<r&&false!==t(u[e],e,u);){}return n}function ar(n,t){var r=n?n.length:0;if(!fe(r)){return yr(n,t)}for(var e=_e(n);r--&&false!==t(e[r],r,e);){}return n}function cr(n,t){var r=true;return fr(n,function(n,e,u){return r=!!t(n,e,u)}),r}function lr(n,t){var r=[];return fr(n,function(n,e,u){t(n,e,u)&&r.push(n)}),r}function sr(n,t,r,e){var u;return r(n,function(n,r,o){return t(n,r,o)?(u=e?r:n,false):void 0}),u}function pr(n,t,r,e){e=(e||0)-1;for(var u=n.length,o=-1,i=[];++e<u;){var f=n[e];if(_(f)&&fe(f.length)&&(Wo(f)||Ge(f))){t&&(f=pr(f,t,r));var a=-1,c=f.length;for(i.length+=c;++a<c;){i[++o]=f[a]}}else{r||(i[++o]=f)}}return i}function hr(n,t,r){var e=-1,u=_e(n);r=r(n);for(var o=r.length;++e<o;){var i=r[e];if(false===t(u[i],i,u)){break}}return n}function _r(n,t,r){var e=_e(n);r=r(n);for(var u=r.length;u--;){var o=r[u];if(false===t(e[o],o,e)){break}}return n}function gr(n,t){hr(n,t,iu)}function vr(n,t){return hr(n,t,$o)}function yr(n,t){return _r(n,t,$o)}function dr(n,t){for(var r=-1,e=t.length,u=-1,o=[];++r<e;){var i=t[r];Uo(n[i])&&(o[++u]=i)}return o}function mr(n,t,r){var e=-1,u=typeof t=="function",o=n?n.length:0,i=fe(o)?bu(o):[];return fr(n,function(n){var o=u?t:null!=n&&n[t];i[++e]=o?o.apply(n,r):b}),i}function wr(n,t,r,e,u,o){if(n===t){return 0!==n||1/n==1/t}var i=typeof n,f=typeof t;if("function"!=i&&"object"!=i&&"function"!=f&&"object"!=f||null==n||null==t){n=n!==n&&t!==t}else{n:{var i=wr,f=Wo(n),a=Wo(t),c=M,l=M;f||(c=$u.call(n),c==D?c=Z:c!=Z&&(f=eu(n))),a||(l=$u.call(t),l==D?l=Z:l!=Z&&eu(t));var s=c==Z,a=l==Z,l=c==l;if(!l||f||s){if(c=s&&Fu.call(n,"__wrapped__"),a=a&&Fu.call(t,"__wrapped__"),c||a){n=i(c?n.value():n,a?t.value():t,r,e,u,o)}else{if(l){for(u||(u=[]),o||(o=[]),c=u.length;c--;){if(u[c]==n){n=o[c]==t;break n}}u.push(n),o.push(t),n=(f?Jr:Hr)(n,t,i,r,e,u,o),u.pop(),o.pop()}else{n=false}}}else{n=Xr(n,t,c)}}}return n}function br(n,t,r,e,u){var o=t.length;if(null==n){return !o}for(var i=-1,f=!u;++i<o;){if(f&&e[i]?r[i]!==n[t[i]]:!Fu.call(n,t[i])){return false}}for(i=-1;++i<o;){var a=t[i];if(f&&e[i]){a=Fu.call(n,a)}else{var c=n[a],l=r[i],a=u?u(c,l,a):b;typeof a=="undefined"&&(a=wr(l,c,u,true))}if(!a){return false}}return true}function xr(n,t){var r=[];return fr(n,function(n,e,u){r.push(t(n,e,u))}),r}function Ar(n){var t=$o(n),r=t.length;if(1==r){var e=t[0],u=n[e];if(ae(u)){return function(n){return null!=n&&n[e]===u&&Fu.call(n,e)}}}for(var o=bu(r),i=bu(r);r--;){u=n[t[r]],o[r]=u,i[r]=ae(u)}return function(n){return br(n,t,o,i)}}function jr(n,t){return ae(t)?function(r){return null!=r&&r[n]===t}:function(r){return null!=r&&wr(t,r[n],null,true)}}function kr(n,t,r,e,u){if(!He(n)){return n}var o=fe(t.length)&&(Wo(t)||eu(t));return(o?Pt:vr)(t,function(t,i,f){if(_(t)){e||(e=[]),u||(u=[]);n:{t=e;for(var a=u,c=t.length,l=f[i];c--;){if(t[c]==l){n[i]=a[c],i=void 0;break n}}c=n[i],f=r?r(c,l,i,n,f):b;var s=typeof f=="undefined";s&&(f=l,fe(l.length)&&(Wo(l)||eu(l))?f=Wo(c)?c:c?qt(c):[]:Fo(l)||Ge(l)?f=Ge(c)?uu(c):Fo(c)?c:{}:s=false),t.push(l),a.push(f),s?n[i]=kr(f,l,r,t,a):(f===f?f!==c:c===c)&&(n[i]=f),i=void 0}return i}a=n[i],f=r?r(a,t,i,n,f):b,(l=typeof f=="undefined")&&(f=t),!o&&typeof f=="undefined"||!l&&(f===f?f===a:a!==a)||(n[i]=f)}),n}function Er(n){return function(t){return null==t?b:t[n]}}function Rr(n,t){return n+Ku(lo()*(t-n+1))}function Ir(n,t,r,e,u){return u(n,function(n,u,o){r=e?(e=false,n):t(r,n,u,o)}),r}function Or(n,t,r){var e=-1,u=n.length;for(t=null==t?0:+t||0,0>t&&(t=-t>u?0:u+t),r=typeof r=="undefined"||r>u?u:+r||0,0>r&&(r+=u),u=t>r?0:r-t>>>0,t>>>=0,r=bu(u);++e<u;){r[e]=n[e+t]}return r}function Cr(n,t){var r;return fr(n,function(n,e,u){return r=t(n,e,u),!r}),!!r}function Tr(n,r){var e=-1,u=te(),o=n.length,i=u==t,f=i&&200<=o,a=f?Ao():null,c=[];a?(u=Dt,i=false):(f=false,a=r?[]:c);n:for(;++e<o;){var l=n[e],s=r?r(l,e,n):l;if(i&&l===l){for(var p=a.length;p--;){if(a[p]===s){continue n}}r&&a.push(s),c.push(l)}else{0>u(a,s)&&((r||f)&&a.push(s),c.push(l))}}return c}function Sr(n,t){for(var r=-1,e=t.length,u=bu(e);++r<e;){u[r]=n[t[r]]}return u}function Wr(n,t){var r=n;r instanceof Lt&&(r=r.value());for(var e=-1,u=t.length;++e<u;){var r=[r],o=t[e];Yu.apply(r,o.args),r=o.func.apply(o.thisArg,r)}return r}function Nr(n,t,r){var e=0,u=n?n.length:e;if(typeof t=="number"&&t===t&&u<=go){for(;e<u;){var o=e+u>>>1,i=n[o];(r?i<=t:i<t)?e=o+1:u=o}return u}return Ur(n,t,yu,r)}function Ur(n,t,r,e){t=r(t);for(var u=0,o=n?n.length:0,i=t!==t,f=typeof t=="undefined";u<o;){var a=Ku((u+o)/2),c=r(n[a]),l=c===c;(i?l||e:f?l&&(e||typeof c!="undefined"):e?c<=t:c<t)?u=a+1:o=a}return io(o,_o)}function Fr(n,t,r){if(typeof n!="function"){return yu}if(typeof t=="undefined"){return n}switch(r){case 1:return function(r){return n.call(t,r)};case 3:return function(r,e,u){return n.call(t,r,e,u)};case 4:return function(r,e,u,o){return n.call(t,r,e,u,o)};case 5:return function(r,e,u,o,i){return n.call(t,r,e,u,o,i)}}return function(){return n.apply(t,arguments)}}function Lr(n){return Mu.call(n,0)}function $r(n,t,r){for(var e=r.length,u=-1,o=oo(n.length-e,0),i=-1,f=t.length,a=bu(o+f);++i<f;){a[i]=t[i]}for(;++u<e;){a[r[u]]=n[u]}for(;o--;){a[i++]=n[u++]}return a}function Br(n,t,r){for(var e=-1,u=r.length,o=-1,i=oo(n.length-u,0),f=-1,a=t.length,c=bu(i+a);++o<i;){c[o]=n[o]}for(i=o;++f<a;){c[i+f]=t[f]}for(;++e<u;){c[i+r[e]]=n[o++]}return c}function zr(n,t){return function(r,e,u){var o=t?t():{};if(e=ne(e,u,3),Wo(r)){u=-1;for(var i=r.length;++u<i;){var f=r[u];n(o,f,e(f,u,r),r)}}else{fr(r,function(t,r,u){n(o,t,e(t,r,u),u)})}return o}}function Dr(n){return function(){var t=arguments.length,r=arguments[0];if(2>t||null==r){return r}if(3<t&&ie(arguments[1],arguments[2],arguments[3])&&(t=2),3<t&&"function"==typeof arguments[t-2]){var e=Fr(arguments[--t-1],arguments[t--],5)}else{2<t&&"function"==typeof arguments[t-1]&&(e=arguments[--t])}for(var u=0;++u<t;){var o=arguments[u];o&&n(r,o,e)}return r}}function Mr(n,t){function r(){return(this instanceof r?e:n).apply(t,arguments)}var e=Pr(n);return r}function qr(n){return function(t){var r=-1;t=hu(au(t));for(var e=t.length,u="";++r<e;){u=n(u,t[r],r)}return u}}function Pr(n){return function(){var t=bo(n.prototype),r=n.apply(t,arguments);return He(r)?r:t}}function Kr(n,t){return function(r,e,u){u&&ie(r,e,u)&&(e=null);var i=ne(),f=null==e;if(i===er&&f||(f=false,e=i(e,u,3)),f){if(e=Wo(r),e||!ru(r)){return n(e?r:he(r))}e=o}return Qr(r,e,t)}}function Vr(n,t,r,e,u,o,i,f,a,c){function l(){for(var w=arguments.length,x=w,k=bu(w);x--;){k[x]=arguments[x]}if(e&&(k=$r(k,e,u)),o&&(k=Br(k,o,i)),_||y){var x=l.placeholder,E=v(k,x),w=w-E.length;if(w<c){var R=f?qt(f):null,w=oo(c-w,0),C=_?E:null,E=_?null:E,T=_?k:null,k=_?null:k;return t|=_?I:O,t&=~(_?O:I),g||(t&=~(A|j)),k=Vr(n,t,r,T,C,k,E,R,a,w),k.placeholder=x,k}}if(x=p?r:this,h&&(n=x[m]),f){for(R=k.length,w=io(f.length,R),C=qt(k);w--;){E=f[w],k[w]=oe(E,R)?C[E]:b}}return s&&a<k.length&&(k.length=a),(this instanceof l?d||Pr(n):n).apply(x,k)}var s=t&T,p=t&A,h=t&j,_=t&E,g=t&k,y=t&R,d=!h&&Pr(n),m=n;return l}function Yr(n,t,r){return n=n.length,t=+t,n<t&&eo(t)?(t-=n,r=null==r?" ":r+"",su(r,qu(t/r.length)).slice(0,t)):""}function Zr(n,t,r,e){function u(){for(var t=-1,f=arguments.length,a=-1,c=e.length,l=bu(f+c);++a<c;){l[a]=e[a]}for(;f--;){l[a++]=arguments[++t]}return(this instanceof u?i:n).apply(o?r:this,l)}var o=t&A,i=Pr(n);return u}function Gr(n,t,r,e,u,o,i,f){var a=t&j;if(!a&&typeof n!="function"){throw new Cu(B)}var c=e?e.length:0;if(c||(t&=~(I|O),e=u=null),c-=u?u.length:0,t&O){var l=e,s=u;e=u=null}var p=!a&&jo(n);if(r=[n,t,r,e,u,l,s,o,i,f],p&&true!==p){e=r[1],t=p[1],f=e|t,o=T|C,u=A|j,i=o|u|k|R;var l=e&T&&!(t&T),s=e&C&&!(t&C),h=(s?r:p)[7],_=(l?r:p)[8];o=f>=o&&f<=i&&(e<C||(s||l)&&h.length<=_),(!(e>=C&&t>u||e>u&&t>=C)||o)&&(t&A&&(r[2]=p[2],f|=e&A?0:k),(e=p[3])&&(u=r[3],r[3]=u?$r(u,e,p[4]):qt(e),r[4]=u?v(r[3],z):qt(p[4])),(e=p[5])&&(u=r[5],r[5]=u?Br(u,e,p[6]):qt(e),r[6]=u?v(r[5],z):qt(p[6])),(e=p[7])&&(r[7]=qt(e)),t&T&&(r[8]=null==r[8]?p[8]:io(r[8],p[8])),null==r[9]&&(r[9]=p[9]),r[0]=p[0],r[1]=f),t=r[1],f=r[9]}return r[9]=null==f?a?0:n.length:oo(f-c,0)||0,(p?xo:ko)(t==A?Mr(r[0],r[2]):t!=I&&t!=(A|I)||r[4].length?Vr.apply(b,r):Zr.apply(b,r),r)}function Jr(n,t,r,e,u,o,i){var f=-1,a=n.length,c=t.length,l=true;if(a!=c&&(!u||c<=a)){return false}for(;l&&++f<a;){var s=n[f],p=t[f],l=b;if(e&&(l=u?e(p,s,f):e(s,p,f)),typeof l=="undefined"){if(u){for(var h=c;h--&&(p=t[h],!(l=s&&s===p||r(s,p,e,u,o,i)));){}}else{l=s&&s===p||r(s,p,e,u,o,i)}}}return !!l}function Xr(n,t,r){switch(r){case q:case P:return +n==+t;case K:return n.name==t.name&&n.message==t.message;case Y:return n!=+n?t!=+t:0==n?1/n==1/t:n==+t;case G:case J:return n==t+""}return false}function Hr(n,t,r,e,u,o,i){var f=$o(n),a=f.length,c=$o(t).length;if(a!=c&&!u){return false}for(var l,c=-1;++c<a;){var s=f[c],p=Fu.call(t,s);if(p){var h=n[s],_=t[s],p=b;e&&(p=u?e(_,h,s):e(h,_,s)),typeof p=="undefined"&&(p=h&&h===_||r(h,_,e,u,o,i))}if(!p){return false}l||(l="constructor"==s)}return l||(r=n.constructor,e=t.constructor,!(r!=e&&"constructor" in n&&"constructor" in t)||typeof r=="function"&&r instanceof r&&typeof e=="function"&&e instanceof e)?true:false}function Qr(n,t,r){var e=r?po:so,u=e,o=u;return fr(n,function(n,i,f){i=t(n,i,f),((r?i<u:i>u)||i===e&&i===o)&&(u=i,o=n)}),o}function ne(n,t,r){var e=Nt.callback||gu,e=e===gu?er:e;return r?e(n,t,r):e}function te(n,r,e){var u=Nt.indexOf||we,u=u===we?t:u;return n?u(n,r,e):u}function re(n){var t=n.length,r=new n.constructor(t);return t&&"string"==typeof n[0]&&Fu.call(n,"index")&&(r.index=n.index,r.input=n.input),r}function ee(n){return n=n.constructor,typeof n=="function"&&n instanceof n||(n=Ru),new n}function ue(n,t,r){var e=n.constructor;switch(t){case X:return Lr(n);case q:case P:return new e(+n);case H:case Q:case nt:case tt:case rt:case et:case ut:case ot:case it:return t=n.buffer,new e(r?Lr(t):t,n.byteOffset,n.length);case Y:case J:return new e(n);case G:var u=new e(n.source,dt.exec(n));u.lastIndex=n.lastIndex}return u}function oe(n,t){return n=+n,t=null==t?yo:t,-1<n&&0==n%1&&n<t}function ie(n,t,r){if(!He(r)){return false}var e=typeof t;return"number"==e?(e=r.length,e=fe(e)&&oe(t,e)):e="string"==e&&t in r,e?(t=r[t],n===n?n===t:t!==t):false}function fe(n){return typeof n=="number"&&-1<n&&0==n%1&&n<=yo}function ae(n){return n===n&&(0===n?0<1/n:!He(n))}function ce(n,t){n=_e(n);for(var r=-1,e=t.length,u={};++r<e;){var o=t[r];o in n&&(u[o]=n[o])}return u}function le(n,t){var r={};return gr(n,function(n,e,u){t(n,e,u)&&(r[e]=n)}),r}function se(n){var t;if(!_(n)||$u.call(n)!=Z||!(Fu.call(n,"constructor")||(t=n.constructor,typeof t!="function"||t instanceof t))){return false}var r;return gr(n,function(n,t){r=t}),typeof r=="undefined"||Fu.call(n,r)}function pe(n){for(var t=iu(n),r=t.length,e=r&&n.length,u=Nt.support,u=e&&fe(e)&&(Wo(n)||u.nonEnumArgs&&Ge(n)),o=-1,i=[];++o<r;){var f=t[o];(u&&oe(f,e)||Fu.call(n,f))&&i.push(f)}return i}function he(n){return null==n?[]:fe(n.length)?He(n)?n:Ru(n):fu(n)}function _e(n){return He(n)?n:Ru(n)}function ge(n){return n instanceof Lt?n.clone():new Ft(n.__wrapped__,n.__chain__,qt(n.__actions__))}function ve(n,t,r){return n&&n.length?((r?ie(n,t,r):null==t)&&(t=1),Or(n,0>t?0:t)):[]}function ye(n,t,r){var e=n?n.length:0;return e?((r?ie(n,t,r):null==t)&&(t=1),t=e-(+t||0),Or(n,0,0>t?0:t)):[]}function de(n,t,r){var e=-1,u=n?n.length:0;for(t=ne(t,r,3);++e<u;){if(t(n[e],e,n)){return e}}return -1}function me(n){return n?n[0]:b}function we(n,r,e){var u=n?n.length:0;if(!u){return -1}if(typeof e=="number"){e=0>e?oo(u+e,0):e||0}else{if(e){return e=Nr(n,r),n=n[e],(r===r?r===n:n!==n)?e:-1}}return t(n,r,e)}function be(n){return ve(n,1)}function xe(n,r,e,u){if(!n||!n.length){return[]}null!=r&&typeof r!="boolean"&&(u=e,e=ie(n,r,u)?null:r,r=false);var o=ne();if((o!==er||null!=e)&&(e=o(e,u,3)),r&&te()==t){r=e;var i;e=-1,u=n.length;for(var o=-1,f=[];++e<u;){var a=n[e],c=r?r(a,e,n):a;e&&i===c||(i=c,f[++o]=a)}n=f}else{n=Tr(n,e)}return n}function Ae(n){for(var t=-1,r=(n&&n.length&&Zt(Yt(n,Uu)))>>>0,e=bu(r);++t<r;){e[t]=Yt(n,Er(t))}return e}function je(n,t){var r=-1,e=n?n.length:0,u={};for(!e||t||Wo(n[0])||(t=[]);++r<e;){var o=n[r];t?u[o]=t[r]:o&&(u[o[0]]=o[1])}return u}function ke(n){return n=Nt(n),n.__chain__=true,n}function Ee(n,t,r){return t.call(r,n)}function Re(n,t,r){var e=Wo(n)?Kt:cr;return(typeof t!="function"||typeof r!="undefined")&&(t=ne(t,r,3)),e(n,t)}function Ie(n,t,r){var e=Wo(n)?Vt:lr;return t=ne(t,r,3),e(n,t)}function Oe(n,t,r){return Wo(n)?(t=de(n,t,r),-1<t?n[t]:b):(t=ne(t,r,3),sr(n,t,fr))}function Ce(n,t,r){return typeof t=="function"&&typeof r=="undefined"&&Wo(n)?Pt(n,t):fr(n,Fr(t,r,3))}function Te(n,t,r){if(typeof t=="function"&&typeof r=="undefined"&&Wo(n)){for(r=n.length;r--&&false!==t(n[r],r,n);){}}else{n=ar(n,Fr(t,r,3))}return n}function Se(n,t,r){var e=n?n.length:0;return fe(e)||(n=fu(n),e=n.length),e?(r=typeof r=="number"?0>r?oo(e+r,0):r||0:0,typeof n=="string"||!Wo(n)&&ru(n)?r<e&&-1<n.indexOf(t,r):-1<te(n,t,r)):false}function We(n,t,r){var e=Wo(n)?Yt:xr;return t=ne(t,r,3),e(n,t)}function Ne(n,t,r,e){return(Wo(n)?Gt:Ir)(n,ne(t,e,4),r,3>arguments.length,fr)}function Ue(n,t,r,e){return(Wo(n)?Jt:Ir)(n,ne(t,e,4),r,3>arguments.length,ar)}function Fe(n,t,r){return(r?ie(n,t,r):null==t)?(n=he(n),t=n.length,0<t?n[Rr(0,t-1)]:b):(n=Le(n),n.length=io(0>t?0:+t||0,n.length),n)}function Le(n){n=he(n);for(var t=-1,r=n.length,e=bu(r);++t<r;){var u=Rr(0,t);t!=u&&(e[t]=e[u]),e[u]=n[t]}return e}function $e(n,t,r){var e=Wo(n)?Xt:Cr;return(typeof t!="function"||typeof r!="undefined")&&(t=ne(t,r,3)),e(n,t)}function Be(n,t){var r;if(typeof t!="function"){if(typeof n!="function"){throw new Cu(B)}var e=n;n=t,t=e}return function(){return 0<--n?r=t.apply(this,arguments):t=null,r}}function ze(n,t){var r=A;if(2<arguments.length){var e=Or(arguments,2),u=v(e,ze.placeholder),r=r|I}return Gr(n,r,t,e,u)}function De(n,t){var r=A|j;if(2<arguments.length){var e=Or(arguments,2),u=v(e,De.placeholder),r=r|I}return Gr(t,r,n,e,u)}function Me(n,t,r){return r&&ie(n,t,r)&&(t=null),n=Gr(n,E,null,null,null,null,null,t),n.placeholder=Me.placeholder,n}function qe(n,t,r){return r&&ie(n,t,r)&&(t=null),n=Gr(n,R,null,null,null,null,null,t),n.placeholder=qe.placeholder,n}function Pe(n,t,r){function e(){var r=t-(So()-c);0>=r||r>t?(f&&Pu(f),r=p,f=s=p=b,r&&(h=So(),a=n.apply(l,i),s||f||(i=l=null))):s=Ju(e,r)}function u(){s&&Pu(s),f=s=p=b,(g||_!==t)&&(h=So(),a=n.apply(l,i),s||f||(i=l=null))}function o(){if(i=arguments,c=So(),l=this,p=g&&(s||!v),false===_){var r=v&&!s}else{f||v||(h=c);var o=_-(c-h),y=0>=o||o>_;y?(f&&(f=Pu(f)),h=c,a=n.apply(l,i)):f||(f=Ju(u,o))}return y&&s?s=Pu(s):s||t===_||(s=Ju(e,t)),r&&(y=true,a=n.apply(l,i)),!y||s||f||(i=l=null),a}var i,f,a,c,l,s,p,h=0,_=false,g=true;if(typeof n!="function"){throw new Cu(B)}if(t=0>t?0:+t||0,true===r){var v=true,g=false}else{He(r)&&(v=r.leading,_="maxWait" in r&&oo(+r.maxWait||0,t),g="trailing" in r?r.trailing:g)}return o.cancel=function(){s&&Pu(s),f&&Pu(f),f=s=p=b},o}function Ke(){var n=arguments,t=n.length-1;if(0>t){return function(n){return n}}if(!Kt(n,r)){throw new Cu(B)}return function(){for(var r=t,e=n[r].apply(this,arguments);r--;){e=n[r].call(this,e)}return e}}function Ve(n,t){function r(){var e=r.cache,u=t?t.apply(this,arguments):arguments[0];if(e.has(u)){return e.get(u)}var o=n.apply(this,arguments);return e.set(u,o),o}if(typeof n!="function"||t&&typeof t!="function"){throw new Cu(B)}return r.cache=new Ve.Cache,r}function Ye(n){var t=Or(arguments,1),r=v(t,Ye.placeholder);return Gr(n,I,null,t,r)}function Ze(n){var t=Or(arguments,1),r=v(t,Ze.placeholder);return Gr(n,O,null,t,r)}function Ge(n){return fe(_(n)?n.length:b)&&$u.call(n)==D||false}function Je(n){return n&&1===n.nodeType&&_(n)&&-1<$u.call(n).indexOf("Element")||false}function Xe(n){return _(n)&&typeof n.message=="string"&&$u.call(n)==K||false}function He(n){var t=typeof n;return"function"==t||n&&"object"==t||false}function Qe(n){return null==n?false:$u.call(n)==V?zu.test(Nu.call(n)):_(n)&&bt.test(n)||false}function nu(n){return typeof n=="number"||_(n)&&$u.call(n)==Y||false}function tu(n){return _(n)&&$u.call(n)==G||false}function ru(n){return typeof n=="string"||_(n)&&$u.call(n)==J||false}function eu(n){return _(n)&&fe(n.length)&&Tt[$u.call(n)]||false}function uu(n){return rr(n,iu(n))}function ou(n){return dr(n,iu(n))}function iu(n){if(null==n){return[]}He(n)||(n=Ru(n));for(var t=n.length,t=t&&fe(t)&&(Wo(n)||wo.nonEnumArgs&&Ge(n))&&t||0,r=n.constructor,e=-1,r=typeof r=="function"&&r.prototype===n,u=bu(t),o=0<t;++e<t;){u[e]=e+""}for(var i in n){o&&oe(i,t)||"constructor"==i&&(r||!Fu.call(n,i))||u.push(i)}return u}function fu(n){return Sr(n,$o(n))}function au(n){return(n=u(n))&&n.replace(xt,l)}function cu(n){return(n=u(n))&&kt.test(n)?n.replace(jt,"\\$&"):n}function lu(n,t,r){return r&&ie(n,t,r)&&(t=0),co(n,t)}function su(n,t){var r="";if(n=u(n),t=+t,1>t||!n||!eo(t)){return r}do{t%2&&(r+=n),t=Ku(t/2),n+=n}while(t);return r}function pu(n,t,r){var e=n;return(n=u(n))?(r?ie(e,t,r):null==t)?n.slice(y(n),d(n)+1):(t+="",n.slice(i(n,t),f(n,t)+1)):n}function hu(n,t,r){return r&&ie(n,t,r)&&(t=null),n=u(n),n.match(t||It)||[]}function _u(){var n=arguments.length,t=arguments[0];try{for(var r=bu(n?n-1:0);0<--n;){r[n-1]=arguments[n]}return t.apply(b,r)}catch(e){return Xe(e)?e:new Au(e)}}function gu(n,t,r){return r&&ie(n,t,r)&&(t=null),_(n)?du(n):er(n,t)}function vu(n){return function(){return n}}function yu(n){return n}function du(n){return Ar(ur(n,true))}function mu(n,t,r){if(null==r){var e=He(t),u=e&&$o(t);((u=u&&u.length&&dr(t,u))?u.length:e)||(u=false,r=t,t=n,n=this)}u||(u=dr(t,$o(t)));var o=true,e=-1,i=Uo(n),f=u.length;false===r?o=false:He(r)&&"chain" in r&&(o=r.chain);for(;++e<f;){r=u[e];var a=t[r];n[r]=a,i&&(n.prototype[r]=function(t){return function(){var r=this.__chain__;if(o||r){var e=n(this.__wrapped__);return(e.__actions__=qt(this.__actions__)).push({func:t,args:arguments,thisArg:n}),e.__chain__=r,e}return r=[this.value()],Yu.apply(r,arguments),t.apply(n,r)}}(a))}return n}function wu(){}g=g?Mt.defaults(Bt.Object(),g,Mt.pick(Bt,Ct)):Bt;var bu=g.Array,xu=g.Date,Au=g.Error,ju=g.Function,ku=g.Math,Eu=g.Number,Ru=g.Object,Iu=g.RegExp,Ou=g.String,Cu=g.TypeError,Tu=bu.prototype,Su=Ru.prototype,Wu=(Wu=g.window)&&Wu.document,Nu=ju.prototype.toString,Uu=Er("length"),Fu=Su.hasOwnProperty,Lu=0,$u=Su.toString,Bu=g._,zu=Iu("^"+cu($u).replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Du=Qe(Du=g.ArrayBuffer)&&Du,Mu=Qe(Mu=Du&&new Du(0).slice)&&Mu,qu=ku.ceil,Pu=g.clearTimeout,Ku=ku.floor,Vu=Qe(Vu=Ru.getPrototypeOf)&&Vu,Yu=Tu.push,Zu=Su.propertyIsEnumerable,Gu=Qe(Gu=g.Set)&&Gu,Ju=g.setTimeout,Xu=Tu.splice,Hu=Qe(Hu=g.Uint8Array)&&Hu,Qu=Qe(Qu=g.WeakMap)&&Qu,no=function(){try{var n=Qe(n=g.Float64Array)&&n,t=new n(new Du(10),0,1)&&n}catch(r){}return t}(),to=Qe(to=bu.isArray)&&to,ro=Qe(ro=Ru.create)&&ro,eo=g.isFinite,uo=Qe(uo=Ru.keys)&&uo,oo=ku.max,io=ku.min,fo=Qe(fo=xu.now)&&fo,ao=Qe(ao=Eu.isFinite)&&ao,co=g.parseInt,lo=ku.random,so=Eu.NEGATIVE_INFINITY,po=Eu.POSITIVE_INFINITY,ho=ku.pow(2,32)-1,_o=ho-1,go=ho>>>1,vo=no?no.BYTES_PER_ELEMENT:0,yo=ku.pow(2,53)-1,mo=Qu&&new Qu,wo=Nt.support={};!function(n){wo.funcDecomp=!Qe(g.WinRTError)&&Et.test(w),wo.funcNames=typeof ju.name=="string";try{wo.dom=11===Wu.createDocumentFragment().nodeType}catch(t){wo.dom=false}try{wo.nonEnumArgs=!Zu.call(arguments,1)}catch(r){wo.nonEnumArgs=true}}(0,0),Nt.templateSettings={escape:_t,evaluate:gt,interpolate:vt,variable:"",imports:{_:Nt}};var bo=function(){function n(){}return function(t){if(He(t)){n.prototype=t;var r=new n;n.prototype=null}return r||g.Object()}}(),xo=mo?function(n,t){return mo.set(n,t),n}:yu;Mu||(Lr=Du&&Hu?function(n){var t=n.byteLength,r=no?Ku(t/vo):0,e=r*vo,u=new Du(t);if(r){var o=new no(u,0,r);o.set(new no(n,0,r))}return t!=e&&(o=new Hu(u,e),o.set(new Hu(n,e))),u}:vu(null));var Ao=ro&&Gu?function(n){return new zt(n)}:vu(null),jo=mo?function(n){return mo.get(n)}:wu,ko=function(){var n=0,t=0;return function(r,e){var u=So(),o=U-(u-t);if(t=u,0<o){if(++n>=N){return r}}else{n=0}return xo(r,e)}}(),Eo=zr(function(n,t,r){Fu.call(n,r)?++n[r]:n[r]=1}),Ro=zr(function(n,t,r){Fu.call(n,r)?n[r].push(t):n[r]=[t]}),Io=zr(function(n,t,r){n[r]=t}),Oo=Kr(Zt),Co=Kr(function(n){for(var t=-1,r=n.length,e=po;++t<r;){var u=n[t];u<e&&(e=u)}return e},true),To=zr(function(n,t,r){n[r?0:1].push(t)},function(){return[[],[]]}),So=fo||function(){return(new xu).getTime()},Wo=to||function(n){return _(n)&&fe(n.length)&&$u.call(n)==M||false};wo.dom||(Je=function(n){return n&&1===n.nodeType&&_(n)&&!Fo(n)||false});var No=ao||function(n){return typeof n=="number"&&eo(n)},Uo=r(/x/)||Hu&&!r(Hu)?function(n){return $u.call(n)==V}:r,Fo=Vu?function(n){if(!n||$u.call(n)!=Z){return false}var t=n.valueOf,r=Qe(t)&&(r=Vu(t))&&Vu(r);return r?n==r||Vu(n)==r:se(n)}:se,Lo=Dr(nr),$o=uo?function(n){if(n){var t=n.constructor,r=n.length}return typeof t=="function"&&t.prototype===n||typeof n!="function"&&r&&fe(r)?pe(n):He(n)?uo(n):[]}:pe,Bo=Dr(kr),zo=qr(function(n,t,r){return t=t.toLowerCase(),n+(r?t.charAt(0).toUpperCase()+t.slice(1):t)}),Do=qr(function(n,t,r){return n+(r?"-":"")+t.toLowerCase()});8!=co(Ot+"08")&&(lu=function(n,t,r){return(r?ie(n,t,r):null==t)?t=0:t&&(t=+t),n=pu(n),co(n,t||(wt.test(n)?16:10))});var Mo=qr(function(n,t,r){return n+(r?"_":"")+t.toLowerCase()}),qo=qr(function(n,t,r){return n+(r?" ":"")+(t.charAt(0).toUpperCase()+t.slice(1))});return Nt.prototype=Ut.prototype,Ft.prototype=bo(Ut.prototype),Ft.prototype.constructor=Ft,Lt.prototype=bo(Ut.prototype),Lt.prototype.constructor=Lt,$t.prototype["delete"]=function(n){return this.has(n)&&delete this.__data__[n]},$t.prototype.get=function(n){return"__proto__"==n?b:this.__data__[n]},$t.prototype.has=function(n){return"__proto__"!=n&&Fu.call(this.__data__,n)},$t.prototype.set=function(n,t){return"__proto__"!=n&&(this.__data__[n]=t),this},zt.prototype.push=function(n){var t=this.data;typeof n=="string"||He(n)?t.set.add(n):t.hash[n]=true},Ve.Cache=$t,Nt.after=function(n,t){if(typeof t!="function"){if(typeof n!="function"){throw new Cu(B)}var r=n;n=t,t=r}return n=eo(n=+n)?n:0,function(){return 1>--n?t.apply(this,arguments):void 0}},Nt.ary=function(n,t,r){return r&&ie(n,t,r)&&(t=null),t=n&&null==t?n.length:oo(+t||0,0),Gr(n,T,null,null,null,null,t)},Nt.assign=Lo,Nt.at=function(n){return fe(n?n.length:0)&&(n=he(n)),tr(n,pr(arguments,false,false,1))},Nt.before=Be,Nt.bind=ze,Nt.bindAll=function(n){for(var t=n,r=1<arguments.length?pr(arguments,false,false,1):ou(n),e=-1,u=r.length;++e<u;){var o=r[e];t[o]=Gr(t[o],A,t)}return t},Nt.bindKey=De,Nt.callback=gu,Nt.chain=ke,Nt.chunk=function(n,t,r){t=(r?ie(n,t,r):null==t)?1:oo(+t||1,1),r=0;for(var e=n?n.length:0,u=-1,o=bu(qu(e/t));r<e;){o[++u]=Or(n,r,r+=t)}return o},Nt.compact=function(n){for(var t=-1,r=n?n.length:0,e=-1,u=[];++t<r;){var o=n[t];o&&(u[++e]=o)}return u},Nt.constant=vu,Nt.countBy=Eo,Nt.create=function(n,t,r){var e=bo(n);return r&&ie(n,t,r)&&(t=null),t?rr(t,e,$o(t)):e},Nt.curry=Me,Nt.curryRight=qe,Nt.debounce=Pe,Nt.defaults=function(n){if(null==n){return n}var t=qt(arguments);return t.push(Ht),Lo.apply(b,t)},Nt.defer=function(n){return or(n,1,arguments,1)},Nt.delay=function(n,t){return or(n,t,arguments,2)},Nt.difference=function(){for(var n=-1,t=arguments.length;++n<t;){var r=arguments[n];if(Wo(r)||Ge(r)){break}}return ir(r,pr(arguments,false,true,++n))},Nt.drop=ve,Nt.dropRight=ye,Nt.dropRightWhile=function(n,t,r){var e=n?n.length:0;if(!e){return[]}for(t=ne(t,r,3);e--&&t(n[e],e,n);){}return Or(n,0,e+1)},Nt.dropWhile=function(n,t,r){var e=n?n.length:0;if(!e){return[]}var u=-1;for(t=ne(t,r,3);++u<e&&t(n[u],u,n);){}return Or(n,u)},Nt.fill=function(n,t,r,e){var u=n?n.length:0;if(!u){return[]}for(r&&typeof r!="number"&&ie(n,t,r)&&(r=0,e=u),u=n.length,r=null==r?0:+r||0,0>r&&(r=-r>u?0:u+r),e=typeof e=="undefined"||e>u?u:+e||0,0>e&&(e+=u),u=r>e?0:e>>>0,r>>>=0;r<u;){n[r++]=t}return n},Nt.filter=Ie,Nt.flatten=function(n,t,r){var e=n?n.length:0;return r&&ie(n,t,r)&&(t=false),e?pr(n,t):[]},Nt.flattenDeep=function(n){return n&&n.length?pr(n,true):[]},Nt.flow=function(){var n=arguments,t=n.length;if(!t){return function(n){return n}}if(!Kt(n,r)){throw new Cu(B)}return function(){for(var r=0,e=n[r].apply(this,arguments);++r<t;){e=n[r].call(this,e)}return e}},Nt.flowRight=Ke,Nt.forEach=Ce,Nt.forEachRight=Te,Nt.forIn=function(n,t,r){return(typeof t!="function"||typeof r!="undefined")&&(t=Fr(t,r,3)),hr(n,t,iu)},Nt.forInRight=function(n,t,r){return t=Fr(t,r,3),_r(n,t,iu)},Nt.forOwn=function(n,t,r){return(typeof t!="function"||typeof r!="undefined")&&(t=Fr(t,r,3)),vr(n,t)},Nt.forOwnRight=function(n,t,r){return t=Fr(t,r,3),_r(n,t,$o)},Nt.functions=ou,Nt.groupBy=Ro,Nt.indexBy=Io,Nt.initial=function(n){return ye(n,1)},Nt.intersection=function(){for(var n=[],r=-1,e=arguments.length,u=[],o=te(),i=o==t;++r<e;){var f=arguments[r];(Wo(f)||Ge(f))&&(n.push(f),u.push(i&&120<=f.length?Ao(r&&f):null))}var e=n.length,i=n[0],a=-1,c=i?i.length:0,l=[],s=u[0];n:for(;++a<c;){if(f=i[a],0>(s?Dt(s,f):o(l,f))){for(r=e;--r;){var p=u[r];if(0>(p?Dt(p,f):o(n[r],f))){continue n}}s&&s.push(f),l.push(f)}}return l},Nt.invert=function(n,t,r){r&&ie(n,t,r)&&(t=null),r=-1;for(var e=$o(n),u=e.length,o={};++r<u;){var i=e[r],f=n[i];t?Fu.call(o,f)?o[f].push(i):o[f]=[i]:o[f]=i}return o},Nt.invoke=function(n,t){return mr(n,t,Or(arguments,2))},Nt.keys=$o,Nt.keysIn=iu,Nt.map=We,Nt.mapValues=function(n,t,r){var e={};return t=ne(t,r,3),vr(n,function(n,r,u){e[r]=t(n,r,u)}),e},Nt.matches=du,Nt.matchesProperty=function(n,t){return jr(n+"",ur(t,true))},Nt.memoize=Ve,Nt.merge=Bo,Nt.mixin=mu,Nt.negate=function(n){if(typeof n!="function"){throw new Cu(B)}return function(){return !n.apply(this,arguments)}},Nt.omit=function(n,t,r){if(null==n){return{}}if(typeof t!="function"){var e=Yt(pr(arguments,false,false,1),Ou);return ce(n,ir(iu(n),e))}return t=Fr(t,r,3),le(n,function(n,r,e){return !t(n,r,e)})},Nt.once=function(n){return Be(n,2)},Nt.pairs=function(n){for(var t=-1,r=$o(n),e=r.length,u=bu(e);++t<e;){var o=r[t];u[t]=[o,n[o]]}return u},Nt.partial=Ye,Nt.partialRight=Ze,Nt.partition=To,Nt.pick=function(n,t,r){return null==n?{}:typeof t=="function"?le(n,Fr(t,r,3)):ce(n,pr(arguments,false,false,1))},Nt.pluck=function(n,t){return We(n,Er(t))},Nt.property=function(n){return Er(n+"")},Nt.propertyOf=function(n){return function(t){return null==n?b:n[t]}},Nt.pull=function(){var n=arguments[0];if(!n||!n.length){return n}for(var t=0,r=te(),e=arguments.length;++t<e;){for(var u=0,o=arguments[t];-1<(u=r(n,o,u));){Xu.call(n,u,1)}}return n},Nt.pullAt=function(t){var r=t||[],e=pr(arguments,false,false,1),u=e.length,o=tr(r,e);for(e.sort(n);u--;){var i=parseFloat(e[u]);if(i!=f&&oe(i)){var f=i;Xu.call(r,i,1)}}return o},Nt.range=function(n,t,r){r&&ie(n,t,r)&&(t=r=null),n=+n||0,r=null==r?1:+r||0,null==t?(t=n,n=0):t=+t||0;var e=-1;t=oo(qu((t-n)/(r||1)),0);for(var u=bu(t);++e<t;){u[e]=n,n+=r}return u},Nt.rearg=function(n){var t=pr(arguments,false,false,1);return Gr(n,C,null,null,null,t)},Nt.reject=function(n,t,r){var e=Wo(n)?Vt:lr;return t=ne(t,r,3),e(n,function(n,r,e){return !t(n,r,e)})},Nt.remove=function(n,t,r){var e=-1,u=n?n.length:0,o=[];for(t=ne(t,r,3);++e<u;){r=n[e],t(r,e,n)&&(o.push(r),Xu.call(n,e--,1),u--)}return o},Nt.rest=be,Nt.shuffle=Le,Nt.slice=function(n,t,r){var e=n?n.length:0;return e?(r&&typeof r!="number"&&ie(n,t,r)&&(t=0,r=e),Or(n,t,r)):[]},Nt.sortBy=function(n,t,r){var u=-1,o=n?n.length:0,i=fe(o)?bu(o):[];return r&&ie(n,t,r)&&(t=null),t=ne(t,r,3),fr(n,function(n,r,e){i[++u]={a:t(n,r,e),b:u,c:n}}),e(i,a)},Nt.sortByAll=function(n){var t=arguments;3<t.length&&ie(t[1],t[2],t[3])&&(t=[n,t[1]]);var r=-1,u=n?n.length:0,o=pr(t,false,false,1),i=fe(u)?bu(u):[];return fr(n,function(n){for(var t=o.length,e=bu(t);t--;){e[t]=null==n?b:n[o[t]]}i[++r]={a:e,b:r,c:n}}),e(i,c)},Nt.spread=function(n){if(typeof n!="function"){throw new Cu(B)}return function(t){return n.apply(this,t)}},Nt.take=function(n,t,r){return n&&n.length?((r?ie(n,t,r):null==t)&&(t=1),Or(n,0,0>t?0:t)):[]},Nt.takeRight=function(n,t,r){var e=n?n.length:0;return e?((r?ie(n,t,r):null==t)&&(t=1),t=e-(+t||0),Or(n,0>t?0:t)):[]},Nt.takeRightWhile=function(n,t,r){var e=n?n.length:0;if(!e){return[]}for(t=ne(t,r,3);e--&&t(n[e],e,n);){}return Or(n,e+1)},Nt.takeWhile=function(n,t,r){var e=n?n.length:0;if(!e){return[]}var u=-1;for(t=ne(t,r,3);++u<e&&t(n[u],u,n);){}return Or(n,0,u)},Nt.tap=function(n,t,r){return t.call(r,n),n},Nt.throttle=function(n,t,r){var e=true,u=true;if(typeof n!="function"){throw new Cu(B)}return false===r?e=false:He(r)&&(e="leading" in r?!!r.leading:e,u="trailing" in r?!!r.trailing:u),Wt.leading=e,Wt.maxWait=+t,Wt.trailing=u,Pe(n,t,Wt)},Nt.thru=Ee,Nt.times=function(n,t,r){if(n=+n,1>n||!eo(n)){return[]}var e=-1,u=bu(io(n,ho));for(t=Fr(t,r,1);++e<n;){e<ho?u[e]=t(e):t(e)}return u},Nt.toArray=function(n){var t=n?n.length:0;return fe(t)?t?qt(n):[]:fu(n)},Nt.toPlainObject=uu,Nt.transform=function(n,t,r,e){var u=Wo(n)||eu(n);return t=ne(t,e,4),null==r&&(u||He(n)?(e=n.constructor,r=u?Wo(n)?new e:[]:bo(Uo(e)&&e.prototype)):r={}),(u?Pt:vr)(n,function(n,e,u){return t(r,n,e,u)}),r},Nt.union=function(){return Tr(pr(arguments,false,true))},Nt.uniq=xe,Nt.unzip=Ae,Nt.values=fu,Nt.valuesIn=function(n){return Sr(n,iu(n))},Nt.where=function(n,t){return Ie(n,Ar(t))},Nt.without=function(n){return ir(n,Or(arguments,1))},Nt.wrap=function(n,t){return t=null==t?yu:t,Gr(t,I,null,[n],[])},Nt.xor=function(){for(var n=-1,t=arguments.length;++n<t;){var r=arguments[n];if(Wo(r)||Ge(r)){var e=e?ir(e,r).concat(ir(r,e)):r}}return e?Tr(e):[]},Nt.zip=function(){for(var n=arguments.length,t=bu(n);n--;){t[n]=arguments[n]}return Ae(t)},Nt.zipObject=je,Nt.backflow=Ke,Nt.collect=We,Nt.compose=Ke,Nt.each=Ce,Nt.eachRight=Te,Nt.extend=Lo,Nt.iteratee=gu,Nt.methods=ou,Nt.object=je,Nt.select=Ie,Nt.tail=be,Nt.unique=xe,mu(Nt,Nt),Nt.attempt=_u,Nt.camelCase=zo,Nt.capitalize=function(n){return(n=u(n))&&n.charAt(0).toUpperCase()+n.slice(1)},Nt.clone=function(n,t,r,e){return t&&typeof t!="boolean"&&ie(n,t,r)?t=false:typeof t=="function"&&(e=r,r=t,t=false),r=typeof r=="function"&&Fr(r,e,1),ur(n,t,r)},Nt.cloneDeep=function(n,t,r){return t=typeof t=="function"&&Fr(t,r,1),ur(n,true,t)},Nt.deburr=au,Nt.endsWith=function(n,t,r){n=u(n),t+="";var e=n.length;return r=(typeof r=="undefined"?e:io(0>r?0:+r||0,e))-t.length,0<=r&&n.indexOf(t,r)==r},Nt.escape=function(n){return(n=u(n))&&ht.test(n)?n.replace(st,s):n},Nt.escapeRegExp=cu,Nt.every=Re,Nt.find=Oe,Nt.findIndex=de,Nt.findKey=function(n,t,r){return t=ne(t,r,3),sr(n,t,vr,true)},Nt.findLast=function(n,t,r){return t=ne(t,r,3),sr(n,t,ar)},Nt.findLastIndex=function(n,t,r){var e=n?n.length:0;for(t=ne(t,r,3);e--;){if(t(n[e],e,n)){return e}}return -1},Nt.findLastKey=function(n,t,r){return t=ne(t,r,3),sr(n,t,yr,true)},Nt.findWhere=function(n,t){return Oe(n,Ar(t))},Nt.first=me,Nt.has=function(n,t){return n?Fu.call(n,t):false},Nt.identity=yu,Nt.includes=Se,Nt.indexOf=we,Nt.inRange=function(n,t,r){return t=+t||0,"undefined"===typeof r?(r=t,t=0):r=+r||0,n>=t&&n<r},Nt.isArguments=Ge,Nt.isArray=Wo,Nt.isBoolean=function(n){return true===n||false===n||_(n)&&$u.call(n)==q||false},Nt.isDate=function(n){return _(n)&&$u.call(n)==P||false},Nt.isElement=Je,Nt.isEmpty=function(n){if(null==n){return true}var t=n.length;return fe(t)&&(Wo(n)||ru(n)||Ge(n)||_(n)&&Uo(n.splice))?!t:!$o(n).length},Nt.isEqual=function(n,t,r,e){return r=typeof r=="function"&&Fr(r,e,3),!r&&ae(n)&&ae(t)?n===t:(e=r?r(n,t):b,typeof e=="undefined"?wr(n,t,r):!!e)},Nt.isError=Xe,Nt.isFinite=No,Nt.isFunction=Uo,Nt.isMatch=function(n,t,r,e){var u=$o(t),o=u.length;if(r=typeof r=="function"&&Fr(r,e,3),!r&&1==o){var i=u[0];if(e=t[i],ae(e)){return null!=n&&e===n[i]&&Fu.call(n,i)}}for(var i=bu(o),f=bu(o);o--;){e=i[o]=t[u[o]],f[o]=ae(e)}return br(n,u,i,f,r)},Nt.isNaN=function(n){return nu(n)&&n!=+n},Nt.isNative=Qe,Nt.isNull=function(n){return null===n},Nt.isNumber=nu,Nt.isObject=He,Nt.isPlainObject=Fo,Nt.isRegExp=tu,Nt.isString=ru,Nt.isTypedArray=eu,Nt.isUndefined=function(n){return typeof n=="undefined"},Nt.kebabCase=Do,Nt.last=function(n){var t=n?n.length:0;return t?n[t-1]:b},Nt.lastIndexOf=function(n,t,r){var e=n?n.length:0;if(!e){return -1}var u=e;if(typeof r=="number"){u=(0>r?oo(e+r,0):io(r||0,e-1))+1}else{if(r){return u=Nr(n,t,true)-1,n=n[u],(t===t?t===n:n!==n)?u:-1}}if(t!==t){return h(n,u,true)}for(;u--;){if(n[u]===t){return u}}return -1},Nt.max=Oo,Nt.min=Co,Nt.noConflict=function(){return g._=Bu,this},Nt.noop=wu,Nt.now=So,Nt.pad=function(n,t,r){n=u(n),t=+t;var e=n.length;return e<t&&eo(t)?(e=(t-e)/2,t=Ku(e),e=qu(e),r=Yr("",e,r),r.slice(0,t)+n+r):n},Nt.padLeft=function(n,t,r){return(n=u(n))&&Yr(n,t,r)+n},Nt.padRight=function(n,t,r){return(n=u(n))&&n+Yr(n,t,r)},Nt.parseInt=lu,Nt.random=function(n,t,r){r&&ie(n,t,r)&&(t=r=null);var e=null==n,u=null==t;return null==r&&(u&&typeof n=="boolean"?(r=n,n=1):typeof t=="boolean"&&(r=t,u=true)),e&&u&&(t=1,u=false),n=+n||0,u?(t=n,n=0):t=+t||0,r||n%1||t%1?(r=lo(),io(n+r*(t-n+parseFloat("1e-"+((r+"").length-1))),t)):Rr(n,t)},Nt.reduce=Ne,Nt.reduceRight=Ue,Nt.repeat=su,Nt.result=function(n,t,r){return t=null==n?b:n[t],typeof t=="undefined"&&(t=r),Uo(t)?t.call(n):t},Nt.runInContext=w,Nt.size=function(n){var t=n?n.length:0;return fe(t)?t:$o(n).length},Nt.snakeCase=Mo,Nt.some=$e,Nt.sortedIndex=function(n,t,r,e){var u=ne(r);return u===er&&null==r?Nr(n,t):Ur(n,t,u(r,e,1))},Nt.sortedLastIndex=function(n,t,r,e){var u=ne(r);return u===er&&null==r?Nr(n,t,true):Ur(n,t,u(r,e,1),true)},Nt.startCase=qo,Nt.startsWith=function(n,t,r){return n=u(n),r=null==r?0:io(0>r?0:+r||0,n.length),n.lastIndexOf(t,r)==r},Nt.template=function(n,t,r){var e=Nt.templateSettings;r&&ie(n,t,r)&&(t=r=null),n=u(n),t=nr(nr({},r||t),e,Qt),r=nr(nr({},t.imports),e.imports,Qt);var o,i,f=$o(r),a=Sr(r,f),c=0;r=t.interpolate||At;var l="__p+='";r=Iu((t.escape||At).source+"|"+r.source+"|"+(r===vt?yt:At).source+"|"+(t.evaluate||At).source+"|$","g");var s="sourceURL" in t?"//# sourceURL="+t.sourceURL+"\n":"";if(n.replace(r,function(t,r,e,u,f,a){return e||(e=u),l+=n.slice(c,a).replace(Rt,p),r&&(o=true,l+="'+__e("+r+")+'"),f&&(i=true,l+="';"+f+";\n__p+='"),e&&(l+="'+((__t=("+e+"))==null?'':__t)+'"),c=a+t.length,t}),l+="';",(t=t.variable)||(l="with(obj){"+l+"}"),l=(i?l.replace(ft,""):l).replace(at,"$1").replace(ct,"$1;"),l="function("+(t||"obj")+"){"+(t?"":"obj||(obj={});")+"var __t,__p=''"+(o?",__e=_.escape":"")+(i?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+l+"return __p}",t=_u(function(){return ju(f,s+"return "+l).apply(b,a)}),t.source=l,Xe(t)){throw t}return t},Nt.trim=pu,Nt.trimLeft=function(n,t,r){var e=n;return(n=u(n))?n.slice((r?ie(e,t,r):null==t)?y(n):i(n,t+"")):n},Nt.trimRight=function(n,t,r){var e=n;return(n=u(n))?(r?ie(e,t,r):null==t)?n.slice(0,d(n)+1):n.slice(0,f(n,t+"")+1):n},Nt.trunc=function(n,t,r){r&&ie(n,t,r)&&(t=null);var e=S;if(r=W,null!=t){if(He(t)){var o="separator" in t?t.separator:o,e="length" in t?+t.length||0:e;r="omission" in t?u(t.omission):r}else{e=+t||0}}if(n=u(n),e>=n.length){return n}if(e-=r.length,1>e){return r}if(t=n.slice(0,e),null==o){return t+r}if(tu(o)){if(n.slice(e).search(o)){var i,f=n.slice(0,e);for(o.global||(o=Iu(o.source,(dt.exec(o)||"")+"g")),o.lastIndex=0;n=o.exec(f);){i=n.index}t=t.slice(0,null==i?e:i)}}else{n.indexOf(o,e)!=e&&(o=t.lastIndexOf(o),-1<o&&(t=t.slice(0,o)))}return t+r},Nt.unescape=function(n){return(n=u(n))&&pt.test(n)?n.replace(lt,m):n},Nt.uniqueId=function(n){var t=++Lu;return u(n)+t},Nt.words=hu,Nt.all=Re,Nt.any=$e,Nt.contains=Se,Nt.detect=Oe,Nt.foldl=Ne,Nt.foldr=Ue,Nt.head=me,Nt.include=Se,Nt.inject=Ne,mu(Nt,function(){var n={};return vr(Nt,function(t,r){Nt.prototype[r]||(n[r]=t)}),n}(),false),Nt.sample=Fe,Nt.prototype.sample=function(n){return this.__chain__||null!=n?this.thru(function(t){return Fe(t,n)}):Fe(this.value())},Nt.VERSION=x,Pt("bind bindKey curry curryRight partial partialRight".split(" "),function(n){Nt[n].placeholder=Nt}),Pt(["filter","map","takeWhile"],function(n,t){var r=t==F||t==$;Lt.prototype[n]=function(n,e){var u=this.clone(),o=u.__iteratees__||(u.__iteratees__=[]);return u.__filtered__=u.__filtered__||r,o.push({iteratee:ne(n,e,3),type:t}),u}}),Pt(["drop","take"],function(n,t){var r="__"+n+"Count__",e=n+"While";Lt.prototype[n]=function(e){e=null==e?1:oo(Ku(e)||0,0);var u=this.clone();if(u.__filtered__){var o=u[r];u[r]=t?io(o,e):o+e}else{(u.__views__||(u.__views__=[])).push({size:e,type:n+(0>u.__dir__?"Right":"")})}return u},Lt.prototype[n+"Right"]=function(t){return this.reverse()[n](t).reverse()},Lt.prototype[n+"RightWhile"]=function(n,t){return this.reverse()[e](n,t).reverse()}}),Pt(["first","last"],function(n,t){var r="take"+(t?"Right":"");Lt.prototype[n]=function(){return this[r](1).value()[0]}}),Pt(["initial","rest"],function(n,t){var r="drop"+(t?"":"Right");Lt.prototype[n]=function(){return this[r](1)}}),Pt(["pluck","where"],function(n,t){var r=t?"filter":"map",e=t?Ar:Er;Lt.prototype[n]=function(n){return this[r](e(n))}}),Lt.prototype.compact=function(){return this.filter(yu)},Lt.prototype.dropWhile=function(n,t){var r,e,u=0>this.__dir__;return n=ne(n,t,3),this.filter(function(t,o,i){return r=r&&(u?o<e:o>e),e=o,r||(r=!n(t,o,i))})},Lt.prototype.reject=function(n,t){return n=ne(n,t,3),this.filter(function(t,r,e){return !n(t,r,e)})},Lt.prototype.slice=function(n,t){n=null==n?0:+n||0;var r=0>n?this.takeRight(-n):this.drop(n);return typeof t!="undefined"&&(t=+t||0,r=0>t?r.dropRight(-t):r.take(t-n)),r},Lt.prototype.toArray=function(){return this.drop(0)},vr(Lt.prototype,function(n,t){var r=Nt[t],e=/^(?:first|last)$/.test(t);Nt.prototype[t]=function(){function t(n){return n=[n],Yu.apply(n,o),r.apply(Nt,n)}var u=this.__wrapped__,o=arguments,i=this.__chain__,f=!!this.__actions__.length,a=u instanceof Lt,c=a&&!f;return e&&!i?c?n.call(u):r.call(Nt,this.value()):a||Wo(u)?(u=n.apply(c?u:new Lt(this),o),e||!f&&!u.__actions__||(u.__actions__||(u.__actions__=[])).push({func:Ee,args:[t],thisArg:Nt}),new Ft(u,i)):this.thru(t)}}),Pt("concat join pop push shift sort splice unshift".split(" "),function(n){var t=Tu[n],r=/^(?:push|sort|unshift)$/.test(n)?"tap":"thru",e=/^(?:join|pop|shift)$/.test(n);Nt.prototype[n]=function(){var n=arguments;return e&&!this.__chain__?t.apply(this.value(),n):this[r](function(r){return t.apply(r,n)})}}),Lt.prototype.clone=function(){var n=this.__actions__,t=this.__iteratees__,r=this.__views__,e=new Lt(this.__wrapped__);return e.__actions__=n?qt(n):null,e.__dir__=this.__dir__,e.__dropCount__=this.__dropCount__,e.__filtered__=this.__filtered__,e.__iteratees__=t?qt(t):null,e.__takeCount__=this.__takeCount__,e.__views__=r?qt(r):null,e},Lt.prototype.reverse=function(){if(this.__filtered__){var n=new Lt(this);n.__dir__=-1,n.__filtered__=true}else{n=this.clone(),n.__dir__*=-1}return n},Lt.prototype.value=function(){var n=this.__wrapped__.value();if(!Wo(n)){return Wr(n,this.__actions__)}var t,r=this.__dir__,e=0>r;t=n.length;for(var u=this.__views__,o=0,i=-1,f=u?u.length:0;++i<f;){var a=u[i],c=a.size;switch(a.type){case"drop":o+=c;break;case"dropRight":t-=c;break;case"take":t=io(t,o+c);break;case"takeRight":o=oo(o,t-c)}}t={start:o,end:t},i=t.start,f=t.end,t=f-i,u=this.__dropCount__,o=io(t,this.__takeCount__),e=e?f:i-1,f=(i=this.__iteratees__)?i.length:0,a=0,c=[];n:for(;t--&&a<o;){for(var e=e+r,l=-1,s=n[e];++l<f;){var p=i[l],h=p.iteratee(s,e,n),p=p.type;if(p==L){s=h}else{if(!h){if(p==F){continue n}break n}}}u?u--:c[a++]=s}return c},Nt.prototype.chain=function(){return ke(this)},Nt.prototype.commit=function(){return new Ft(this.value(),this.__chain__)},Nt.prototype.plant=function(n){for(var t,r=this;r instanceof Ut;){var e=ge(r);t?u.__wrapped__=e:t=e;var u=e,r=r.__wrapped__}return u.__wrapped__=n,t},Nt.prototype.reverse=function(){var n=this.__wrapped__;return n instanceof Lt?(this.__actions__.length&&(n=new Lt(this)),new Ft(n.reverse(),this.__chain__)):this.thru(function(n){return n.reverse()})},Nt.prototype.toString=function(){return this.value()+""},Nt.prototype.run=Nt.prototype.toJSON=Nt.prototype.valueOf=Nt.prototype.value=function(){return Wr(this.__wrapped__,this.__actions__)},Nt.prototype.collect=Nt.prototype.map,Nt.prototype.head=Nt.prototype.first,Nt.prototype.select=Nt.prototype.filter,Nt.prototype.tail=Nt.prototype.rest,Nt}var b,x="3.3.1",A=1,j=2,k=4,E=8,R=16,I=32,O=64,C=128,T=256,S=30,W="...",N=150,U=16,F=0,L=1,$=2,B="Expected a function",z="__lodash_placeholder__",D="[object Arguments]",M="[object Array]",q="[object Boolean]",P="[object Date]",K="[object Error]",V="[object Function]",Y="[object Number]",Z="[object Object]",G="[object RegExp]",J="[object String]",X="[object ArrayBuffer]",H="[object Float32Array]",Q="[object Float64Array]",nt="[object Int8Array]",tt="[object Int16Array]",rt="[object Int32Array]",et="[object Uint8Array]",ut="[object Uint8ClampedArray]",ot="[object Uint16Array]",it="[object Uint32Array]",ft=/\b__p\+='';/g,at=/\b(__p\+=)''\+/g,ct=/(__e\(.*?\)|\b__t\))\+'';/g,lt=/&(?:amp|lt|gt|quot|#39|#96);/g,st=/[&<>"'`]/g,pt=RegExp(lt.source),ht=RegExp(st.source),_t=/<%-([\s\S]+?)%>/g,gt=/<%([\s\S]+?)%>/g,vt=/<%=([\s\S]+?)%>/g,yt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,dt=/\w*$/,mt=/^\s*function[ \n\r\t]+\w/,wt=/^0[xX]/,bt=/^\[object .+?Constructor\]$/,xt=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,At=/($^)/,jt=/[.*+?^${}()|[\]\/\\]/g,kt=RegExp(jt.source),Et=/\bthis\b/,Rt=/['\n\r\u2028\u2029\\]/g,It=RegExp("[A-Z\\xc0-\\xd6\\xd8-\\xde]{2,}(?=[A-Z\\xc0-\\xd6\\xd8-\\xde][a-z\\xdf-\\xf6\\xf8-\\xff]+)|[A-Z\\xc0-\\xd6\\xd8-\\xde]?[a-z\\xdf-\\xf6\\xf8-\\xff]+|[A-Z\\xc0-\\xd6\\xd8-\\xde]+|[0-9]+","g"),Ot=" \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000",Ct="Array ArrayBuffer Date Error Float32Array Float64Array Function Int8Array Int16Array Int32Array Math Number Object RegExp Set String _ clearTimeout document isFinite parseInt setTimeout TypeError Uint8Array Uint8ClampedArray Uint16Array Uint32Array WeakMap window WinRTError".split(" "),Tt={};Tt[H]=Tt[Q]=Tt[nt]=Tt[tt]=Tt[rt]=Tt[et]=Tt[ut]=Tt[ot]=Tt[it]=true,Tt[D]=Tt[M]=Tt[X]=Tt[q]=Tt[P]=Tt[K]=Tt[V]=Tt["[object Map]"]=Tt[Y]=Tt[Z]=Tt[G]=Tt["[object Set]"]=Tt[J]=Tt["[object WeakMap]"]=false;var St={};St[D]=St[M]=St[X]=St[q]=St[P]=St[H]=St[Q]=St[nt]=St[tt]=St[rt]=St[Y]=St[Z]=St[G]=St[J]=St[et]=St[ut]=St[ot]=St[it]=true,St[K]=St[V]=St["[object Map]"]=St["[object Set]"]=St["[object WeakMap]"]=false;var Wt={leading:false,maxWait:0,trailing:false},Nt={"\xc0":"A","\xc1":"A","\xc2":"A","\xc3":"A","\xc4":"A","\xc5":"A","\xe0":"a","\xe1":"a","\xe2":"a","\xe3":"a","\xe4":"a","\xe5":"a","\xc7":"C","\xe7":"c","\xd0":"D","\xf0":"d","\xc8":"E","\xc9":"E","\xca":"E","\xcb":"E","\xe8":"e","\xe9":"e","\xea":"e","\xeb":"e","\xcc":"I","\xcd":"I","\xce":"I","\xcf":"I","\xec":"i","\xed":"i","\xee":"i","\xef":"i","\xd1":"N","\xf1":"n","\xd2":"O","\xd3":"O","\xd4":"O","\xd5":"O","\xd6":"O","\xd8":"O","\xf2":"o","\xf3":"o","\xf4":"o","\xf5":"o","\xf6":"o","\xf8":"o","\xd9":"U","\xda":"U","\xdb":"U","\xdc":"U","\xf9":"u","\xfa":"u","\xfb":"u","\xfc":"u","\xdd":"Y","\xfd":"y","\xff":"y","\xc6":"Ae","\xe6":"ae","\xde":"Th","\xfe":"th","\xdf":"ss"},Ut={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},Ft={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},Lt={"function":true,object:true},$t={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Bt=Lt[typeof window]&&window!==(this&&this.window)?window:this,zt=Lt[typeof exports]&&exports&&!exports.nodeType&&exports,Lt=Lt[typeof module]&&module&&!module.nodeType&&module,Dt=zt&&Lt&&typeof global=="object"&&global;!Dt||Dt.global!==Dt&&Dt.window!==Dt&&Dt.self!==Dt||(Bt=Dt);var Dt=Lt&&Lt.exports===zt&&zt,Mt=w();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(Bt._=Mt,define(function(){return Mt})):zt&&Lt?Dt?(Lt.exports=Mt)._=Mt:zt._=Mt:Bt._=Mt}).call(this);
/*! jQuery v2.1.1 | (c) 2005, 2014 jQuery Foundation, Inc. | jquery.org/license */
!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document){throw new Error("jQuery requires a window with a document")}return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){var c=[],d=c.slice,e=c.concat,f=c.push,g=c.indexOf,h={},i=h.toString,j=h.hasOwnProperty,k={},l=a.document,m="2.1.1",n=function(a,b){return new n.fn.init(a,b)},o=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,p=/^-ms-/,q=/-([\da-z])/gi,r=function(a,b){return b.toUpperCase()};n.fn=n.prototype={jquery:m,constructor:n,selector:"",length:0,toArray:function(){return d.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:d.call(this)},pushStack:function(a){var b=n.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return n.each(this,a,b)},map:function(a){return this.pushStack(n.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:c.sort,splice:c.splice},n.extend=n.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||n.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++){if(null!=(a=arguments[h])){for(b in a){c=g[b],d=a[b],g!==d&&(j&&d&&(n.isPlainObject(d)||(e=n.isArray(d)))?(e?(e=!1,f=c&&n.isArray(c)?c:[]):f=c&&n.isPlainObject(c)?c:{},g[b]=n.extend(j,f,d)):void 0!==d&&(g[b]=d))}}}return g},n.extend({expando:"jQuery"+(m+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===n.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){return !n.isArray(a)&&a-parseFloat(a)>=0},isPlainObject:function(a){return"object"!==n.type(a)||a.nodeType||n.isWindow(a)?!1:a.constructor&&!j.call(a.constructor.prototype,"isPrototypeOf")?!1:!0},isEmptyObject:function(a){var b;for(b in a){return !1}return !0},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?h[i.call(a)]||"object":typeof a},globalEval:function(a){var b,c=eval;a=n.trim(a),a&&(1===a.indexOf("use strict")?(b=l.createElement("script"),b.text=a,l.head.appendChild(b).parentNode.removeChild(b)):c(a))},camelCase:function(a){return a.replace(p,"ms-").replace(q,r)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,c){var d,e=0,f=a.length,g=s(a);if(c){if(g){for(;f>e;e++){if(d=b.apply(a[e],c),d===!1){break}}}else{for(e in a){if(d=b.apply(a[e],c),d===!1){break}}}}else{if(g){for(;f>e;e++){if(d=b.call(a[e],e,a[e]),d===!1){break}}}else{for(e in a){if(d=b.call(a[e],e,a[e]),d===!1){break}}}}return a},trim:function(a){return null==a?"":(a+"").replace(o,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(s(Object(a))?n.merge(c,"string"==typeof a?[a]:a):f.call(c,a)),c},inArray:function(a,b,c){return null==b?-1:g.call(b,a,c)},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;c>d;d++){a[e++]=b[d]}return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++){d=!b(a[f],f),d!==h&&e.push(a[f])}return e},map:function(a,b,c){var d,f=0,g=a.length,h=s(a),i=[];if(h){for(;g>f;f++){d=b(a[f],f,c),null!=d&&i.push(d)}}else{for(f in a){d=b(a[f],f,c),null!=d&&i.push(d)}}return e.apply([],i)},guid:1,proxy:function(a,b){var c,e,f;return"string"==typeof b&&(c=a[b],b=a,a=c),n.isFunction(a)?(e=d.call(arguments,2),f=function(){return a.apply(b||this,e.concat(d.call(arguments)))},f.guid=a.guid=a.guid||n.guid++,f):void 0},now:Date.now,support:k}),n.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){h["[object "+b+"]"]=b.toLowerCase()});function s(a){var b=a.length,c=n.type(a);return"function"===c||n.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}var t=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u="sizzle"+-new Date,v=a.document,w=0,x=0,y=gb(),z=gb(),A=gb(),B=function(a,b){return a===b&&(l=!0),0},C="undefined",D=1<<31,E={}.hasOwnProperty,F=[],G=F.pop,H=F.push,I=F.push,J=F.slice,K=F.indexOf||function(a){for(var b=0,c=this.length;c>b;b++){if(this[b]===a){return b}}return -1},L="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",N="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",O=N.replace("w","w#"),P="\\["+M+"*("+N+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+O+"))|)"+M+"*\\]",Q=":("+N+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+P+")*)|.*)\\)|)",R=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),S=new RegExp("^"+M+"*,"+M+"*"),T=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),U=new RegExp("="+M+"*([^\\]'\"]*?)"+M+"*\\]","g"),V=new RegExp(Q),W=new RegExp("^"+O+"$"),X={ID:new RegExp("^#("+N+")"),CLASS:new RegExp("^\\.("+N+")"),TAG:new RegExp("^("+N.replace("w","w*")+")"),ATTR:new RegExp("^"+P),PSEUDO:new RegExp("^"+Q),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+L+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},Y=/^(?:input|select|textarea|button)$/i,Z=/^h\d$/i,$=/^[^{]+\{\s*\[native \w/,_=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ab=/[+~]/,bb=/'|\\/g,cb=new RegExp("\\\\([\\da-f]{1,6}"+M+"?|("+M+")|.)","ig"),db=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)};try{I.apply(F=J.call(v.childNodes),v.childNodes),F[v.childNodes.length].nodeType}catch(eb){I={apply:F.length?function(a,b){H.apply(a,J.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]){}a.length=c-1}}}function fb(a,b,d,e){var f,h,j,k,l,o,r,s,w,x;if((b?b.ownerDocument||b:v)!==n&&m(b),b=b||n,d=d||[],!a||"string"!=typeof a){return d}if(1!==(k=b.nodeType)&&9!==k){return[]}if(p&&!e){if(f=_.exec(a)){if(j=f[1]){if(9===k){if(h=b.getElementById(j),!h||!h.parentNode){return d}if(h.id===j){return d.push(h),d}}else{if(b.ownerDocument&&(h=b.ownerDocument.getElementById(j))&&t(b,h)&&h.id===j){return d.push(h),d}}}else{if(f[2]){return I.apply(d,b.getElementsByTagName(a)),d}if((j=f[3])&&c.getElementsByClassName&&b.getElementsByClassName){return I.apply(d,b.getElementsByClassName(j)),d}}}if(c.qsa&&(!q||!q.test(a))){if(s=r=u,w=b,x=9===k&&a,1===k&&"object"!==b.nodeName.toLowerCase()){o=g(a),(r=b.getAttribute("id"))?s=r.replace(bb,"\\$&"):b.setAttribute("id",s),s="[id='"+s+"'] ",l=o.length;while(l--){o[l]=s+qb(o[l])}w=ab.test(a)&&ob(b.parentNode)||b,x=o.join(",")}if(x){try{return I.apply(d,w.querySelectorAll(x)),d}catch(y){}finally{r||b.removeAttribute("id")}}}}return i(a.replace(R,"$1"),b,d,e)}function gb(){var a=[];function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}return b}function hb(a){return a[u]=!0,a}function ib(a){var b=n.createElement("div");try{return !!a(b)}catch(c){return !1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function jb(a,b){var c=a.split("|"),e=a.length;while(e--){d.attrHandle[c[e]]=b}}function kb(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||D)-(~a.sourceIndex||D);if(d){return d}if(c){while(c=c.nextSibling){if(c===b){return -1}}}return a?1:-1}function lb(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function mb(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function nb(a){return hb(function(b){return b=+b,hb(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--){c[e=f[g]]&&(c[e]=!(d[e]=c[e]))}})})}function ob(a){return a&&typeof a.getElementsByTagName!==C&&a}c=fb.support={},f=fb.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},m=fb.setDocument=function(a){var b,e=a?a.ownerDocument||a:v,g=e.defaultView;return e!==n&&9===e.nodeType&&e.documentElement?(n=e,o=e.documentElement,p=!f(e),g&&g!==g.top&&(g.addEventListener?g.addEventListener("unload",function(){m()},!1):g.attachEvent&&g.attachEvent("onunload",function(){m()})),c.attributes=ib(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=ib(function(a){return a.appendChild(e.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=$.test(e.getElementsByClassName)&&ib(function(a){return a.innerHTML="<div class='a'></div><div class='a i'></div>",a.firstChild.className="i",2===a.getElementsByClassName("i").length}),c.getById=ib(function(a){return o.appendChild(a).id=u,!e.getElementsByName||!e.getElementsByName(u).length}),c.getById?(d.find.ID=function(a,b){if(typeof b.getElementById!==C&&p){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},d.filter.ID=function(a){var b=a.replace(cb,db);return function(a){return a.getAttribute("id")===b}}):(delete d.find.ID,d.filter.ID=function(a){var b=a.replace(cb,db);return function(a){var c=typeof a.getAttributeNode!==C&&a.getAttributeNode("id");return c&&c.value===b}}),d.find.TAG=c.getElementsByTagName?function(a,b){return typeof b.getElementsByTagName!==C?b.getElementsByTagName(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){while(c=f[e++]){1===c.nodeType&&d.push(c)}return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){return typeof b.getElementsByClassName!==C&&p?b.getElementsByClassName(a):void 0},r=[],q=[],(c.qsa=$.test(e.querySelectorAll))&&(ib(function(a){a.innerHTML="<select msallowclip=''><option selected=''></option></select>",a.querySelectorAll("[msallowclip^='']").length&&q.push("[*^$]="+M+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||q.push("\\["+M+"*(?:value|"+L+")"),a.querySelectorAll(":checked").length||q.push(":checked")}),ib(function(a){var b=e.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&q.push("name"+M+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||q.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),q.push(",.*:")})),(c.matchesSelector=$.test(s=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&ib(function(a){c.disconnectedMatch=s.call(a,"div"),s.call(a,"[s!='']:x"),r.push("!=",Q)}),q=q.length&&new RegExp(q.join("|")),r=r.length&&new RegExp(r.join("|")),b=$.test(o.compareDocumentPosition),t=b||$.test(o.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b){while(b=b.parentNode){if(b===a){return !0}}}return !1},B=b?function(a,b){if(a===b){return l=!0,0}var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===e||a.ownerDocument===v&&t(v,a)?-1:b===e||b.ownerDocument===v&&t(v,b)?1:k?K.call(k,a)-K.call(k,b):0:4&d?-1:1)}:function(a,b){if(a===b){return l=!0,0}var c,d=0,f=a.parentNode,g=b.parentNode,h=[a],i=[b];if(!f||!g){return a===e?-1:b===e?1:f?-1:g?1:k?K.call(k,a)-K.call(k,b):0}if(f===g){return kb(a,b)}c=a;while(c=c.parentNode){h.unshift(c)}c=b;while(c=c.parentNode){i.unshift(c)}while(h[d]===i[d]){d++}return d?kb(h[d],i[d]):h[d]===v?-1:i[d]===v?1:0},e):n},fb.matches=function(a,b){return fb(a,null,null,b)},fb.matchesSelector=function(a,b){if((a.ownerDocument||a)!==n&&m(a),b=b.replace(U,"='$1']"),!(!c.matchesSelector||!p||r&&r.test(b)||q&&q.test(b))){try{var d=s.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType){return d}}catch(e){}}return fb(b,n,null,[a]).length>0},fb.contains=function(a,b){return(a.ownerDocument||a)!==n&&m(a),t(a,b)},fb.attr=function(a,b){(a.ownerDocument||a)!==n&&m(a);var e=d.attrHandle[b.toLowerCase()],f=e&&E.call(d.attrHandle,b.toLowerCase())?e(a,b,!p):void 0;return void 0!==f?f:c.attributes||!p?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},fb.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},fb.uniqueSort=function(a){var b,d=[],e=0,f=0;if(l=!c.detectDuplicates,k=!c.sortStable&&a.slice(0),a.sort(B),l){while(b=a[f++]){b===a[f]&&(e=d.push(f))}while(e--){a.splice(d[e],1)}}return k=null,a},e=fb.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent){return a.textContent}for(a=a.firstChild;a;a=a.nextSibling){c+=e(a)}}else{if(3===f||4===f){return a.nodeValue}}}else{while(b=a[d++]){c+=e(b)}}return c},d=fb.selectors={cacheLength:50,createPseudo:hb,match:X,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(cb,db),a[3]=(a[3]||a[4]||a[5]||"").replace(cb,db),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||fb.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&fb.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return X.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&V.test(c)&&(b=g(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(cb,db).toLowerCase();return"*"===a?function(){return !0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+M+")"+a+"("+M+"|$)"))&&y(a,function(a){return b.test("string"==typeof a.className&&a.className||typeof a.getAttribute!==C&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=fb.attr(d,a);return null==e?"!="===b:b?(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e+" ").indexOf(c)>-1:"|="===b?e===c||e.slice(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return !!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h;if(q){if(f){while(p){l=b;while(l=l[p]){if(h?l.nodeName.toLowerCase()===r:1===l.nodeType){return !1}}o=p="only"===a&&!o&&"nextSibling"}return !0}if(o=[g?q.firstChild:q.lastChild],g&&s){k=q[u]||(q[u]={}),j=k[a]||[],n=j[0]===w&&j[1],m=j[0]===w&&j[2],l=n&&q.childNodes[n];while(l=++n&&l&&l[p]||(m=n=0)||o.pop()){if(1===l.nodeType&&++m&&l===b){k[a]=[w,n,m];break}}}else{if(s&&(j=(b[u]||(b[u]={}))[a])&&j[0]===w){m=j[1]}else{while(l=++n&&l&&l[p]||(m=n=0)||o.pop()){if((h?l.nodeName.toLowerCase()===r:1===l.nodeType)&&++m&&(s&&((l[u]||(l[u]={}))[a]=[w,m]),l===b)){break}}}}return m-=e,m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||fb.error("unsupported pseudo: "+a);return e[u]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?hb(function(a,c){var d,f=e(a,b),g=f.length;while(g--){d=K.call(a,f[g]),a[d]=!(c[d]=f[g])}}):function(a){return e(a,0,c)}):e}},pseudos:{not:hb(function(a){var b=[],c=[],d=h(a.replace(R,"$1"));return d[u]?hb(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--){(f=g[h])&&(a[h]=!(b[h]=f))}}):function(a,e,f){return b[0]=a,d(b,null,f,c),!c.pop()}}),has:hb(function(a){return function(b){return fb(a,b).length>0}}),contains:hb(function(a){return function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:hb(function(a){return W.test(a||"")||fb.error("unsupported lang: "+a),a=a.replace(cb,db).toLowerCase(),function(b){var c;do{if(c=p?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang")){return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-")}}while((b=b.parentNode)&&1===b.nodeType);return !1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===o},focus:function(a){return a===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling){if(a.nodeType<6){return !1}}return !0},parent:function(a){return !d.pseudos.empty(a)},header:function(a){return Z.test(a.nodeName)},input:function(a){return Y.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:nb(function(){return[0]}),last:nb(function(a,b){return[b-1]}),eq:nb(function(a,b,c){return[0>c?c+b:c]}),even:nb(function(a,b){for(var c=0;b>c;c+=2){a.push(c)}return a}),odd:nb(function(a,b){for(var c=1;b>c;c+=2){a.push(c)}return a}),lt:nb(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;){a.push(d)}return a}),gt:nb(function(a,b,c){for(var d=0>c?c+b:c;++d<b;){a.push(d)}return a})}},d.pseudos.nth=d.pseudos.eq;for(b in {radio:!0,checkbox:!0,file:!0,password:!0,image:!0}){d.pseudos[b]=lb(b)}for(b in {submit:!0,reset:!0}){d.pseudos[b]=mb(b)}function pb(){}pb.prototype=d.filters=d.pseudos,d.setFilters=new pb,g=fb.tokenize=function(a,b){var c,e,f,g,h,i,j,k=z[a+" "];if(k){return b?0:k.slice(0)}h=a,i=[],j=d.preFilter;while(h){(!c||(e=S.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=T.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(R," ")}),h=h.slice(c.length));for(g in d.filter){!(e=X[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length))}if(!c){break}}return b?h.length:h?fb.error(a):z(a,i).slice(0)};function qb(a){for(var b=0,c=a.length,d="";c>b;b++){d+=a[b].value}return d}function rb(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=x++;return b.first?function(b,c,f){while(b=b[d]){if(1===b.nodeType||e){return a(b,c,f)}}}:function(b,c,g){var h,i,j=[w,f];if(g){while(b=b[d]){if((1===b.nodeType||e)&&a(b,c,g)){return !0}}}else{while(b=b[d]){if(1===b.nodeType||e){if(i=b[u]||(b[u]={}),(h=i[d])&&h[0]===w&&h[1]===f){return j[2]=h[2]}if(i[d]=j,j[2]=a(b,c,g)){return !0}}}}}}function sb(a){return a.length>1?function(b,c,d){var e=a.length;while(e--){if(!a[e](b,c,d)){return !1}}return !0}:a[0]}function tb(a,b,c){for(var d=0,e=b.length;e>d;d++){fb(a,b[d],c)}return c}function ub(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++){(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h))}return g}function vb(a,b,c,d,e,f){return d&&!d[u]&&(d=vb(d)),e&&!e[u]&&(e=vb(e,f)),hb(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||tb(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:ub(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d){j=ub(r,n),d(j,[],h,i),k=j.length;while(k--){(l=j[k])&&(r[n[k]]=!(q[n[k]]=l))}}if(f){if(e||a){if(e){j=[],k=r.length;while(k--){(l=r[k])&&j.push(q[k]=l)}e(null,r=[],j,i)}k=r.length;while(k--){(l=r[k])&&(j=e?K.call(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}}else{r=ub(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):I.apply(g,r)}})}function wb(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],h=g||d.relative[" "],i=g?1:0,k=rb(function(a){return a===b},h,!0),l=rb(function(a){return K.call(b,a)>-1},h,!0),m=[function(a,c,d){return !g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d))}];f>i;i++){if(c=d.relative[a[i].type]){m=[rb(sb(m),c)]}else{if(c=d.filter[a[i].type].apply(null,a[i].matches),c[u]){for(e=++i;f>e;e++){if(d.relative[a[e].type]){break}}return vb(i>1&&sb(m),i>1&&qb(a.slice(0,i-1).concat({value:" "===a[i-2].type?"*":""})).replace(R,"$1"),c,e>i&&wb(a.slice(i,e)),f>e&&wb(a=a.slice(e)),f>e&&qb(a))}m.push(c)}}return sb(m)}function xb(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,h,i,k){var l,m,o,p=0,q="0",r=f&&[],s=[],t=j,u=f||e&&d.find.TAG("*",k),v=w+=null==t?1:Math.random()||0.1,x=u.length;for(k&&(j=g!==n&&g);q!==x&&null!=(l=u[q]);q++){if(e&&l){m=0;while(o=a[m++]){if(o(l,g,h)){i.push(l);break}}k&&(w=v)}c&&((l=!o&&l)&&p--,f&&r.push(l))}if(p+=q,c&&q!==p){m=0;while(o=b[m++]){o(r,s,g,h)}if(f){if(p>0){while(q--){r[q]||s[q]||(s[q]=G.call(i))}}s=ub(s)}I.apply(i,s),k&&!f&&s.length>0&&p+b.length>1&&fb.uniqueSort(i)}return k&&(w=v,j=t),r};return c?hb(f):f}return h=fb.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){b||(b=g(a)),c=b.length;while(c--){f=wb(b[c]),f[u]?d.push(f):e.push(f)}f=A(a,xb(e,d)),f.selector=a}return f},i=fb.select=function(a,b,e,f){var i,j,k,l,m,n="function"==typeof a&&a,o=!f&&g(a=n.selector||a);if(e=e||[],1===o.length){if(j=o[0]=o[0].slice(0),j.length>2&&"ID"===(k=j[0]).type&&c.getById&&9===b.nodeType&&p&&d.relative[j[1].type]){if(b=(d.find.ID(k.matches[0].replace(cb,db),b)||[])[0],!b){return e}n&&(b=b.parentNode),a=a.slice(j.shift().value.length)}i=X.needsContext.test(a)?0:j.length;while(i--){if(k=j[i],d.relative[l=k.type]){break}if((m=d.find[l])&&(f=m(k.matches[0].replace(cb,db),ab.test(j[0].type)&&ob(b.parentNode)||b))){if(j.splice(i,1),a=f.length&&qb(j),!a){return I.apply(e,f),e}break}}}return(n||h(a,o))(f,b,!p,e,ab.test(a)&&ob(b.parentNode)||b),e},c.sortStable=u.split("").sort(B).join("")===u,c.detectDuplicates=!!l,m(),c.sortDetached=ib(function(a){return 1&a.compareDocumentPosition(n.createElement("div"))}),ib(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||jb("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&ib(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||jb("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),ib(function(a){return null==a.getAttribute("disabled")})||jb(L,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),fb}(a);n.find=t,n.expr=t.selectors,n.expr[":"]=n.expr.pseudos,n.unique=t.uniqueSort,n.text=t.getText,n.isXMLDoc=t.isXML,n.contains=t.contains;var u=n.expr.match.needsContext,v=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,w=/^.[^:#\[\.,]*$/;function x(a,b,c){if(n.isFunction(b)){return n.grep(a,function(a,d){return !!b.call(a,d,a)!==c})}if(b.nodeType){return n.grep(a,function(a){return a===b!==c})}if("string"==typeof b){if(w.test(b)){return n.filter(b,a,c)}b=n.filter(b,a)}return n.grep(a,function(a){return g.call(b,a)>=0!==c})}n.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?n.find.matchesSelector(d,a)?[d]:[]:n.find.matches(a,n.grep(b,function(a){return 1===a.nodeType}))},n.fn.extend({find:function(a){var b,c=this.length,d=[],e=this;if("string"!=typeof a){return this.pushStack(n(a).filter(function(){for(b=0;c>b;b++){if(n.contains(e[b],this)){return !0}}}))}for(b=0;c>b;b++){n.find(a,e[b],d)}return d=this.pushStack(c>1?n.unique(d):d),d.selector=this.selector?this.selector+" "+a:a,d},filter:function(a){return this.pushStack(x(this,a||[],!1))},not:function(a){return this.pushStack(x(this,a||[],!0))},is:function(a){return !!x(this,"string"==typeof a&&u.test(a)?n(a):a||[],!1).length}});var y,z=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,A=n.fn.init=function(a,b){var c,d;if(!a){return this}if("string"==typeof a){if(c="<"===a[0]&&">"===a[a.length-1]&&a.length>=3?[null,a,null]:z.exec(a),!c||!c[1]&&b){return !b||b.jquery?(b||y).find(a):this.constructor(b).find(a)}if(c[1]){if(b=b instanceof n?b[0]:b,n.merge(this,n.parseHTML(c[1],b&&b.nodeType?b.ownerDocument||b:l,!0)),v.test(c[1])&&n.isPlainObject(b)){for(c in b){n.isFunction(this[c])?this[c](b[c]):this.attr(c,b[c])}}return this}return d=l.getElementById(c[2]),d&&d.parentNode&&(this.length=1,this[0]=d),this.context=l,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):n.isFunction(a)?"undefined"!=typeof y.ready?y.ready(a):a(n):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),n.makeArray(a,this))};A.prototype=n.fn,y=n(l);var B=/^(?:parents|prev(?:Until|All))/,C={children:!0,contents:!0,next:!0,prev:!0};n.extend({dir:function(a,b,c){var d=[],e=void 0!==c;while((a=a[b])&&9!==a.nodeType){if(1===a.nodeType){if(e&&n(a).is(c)){break}d.push(a)}}return d},sibling:function(a,b){for(var c=[];a;a=a.nextSibling){1===a.nodeType&&a!==b&&c.push(a)}return c}}),n.fn.extend({has:function(a){var b=n(a,this),c=b.length;return this.filter(function(){for(var a=0;c>a;a++){if(n.contains(this,b[a])){return !0}}})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=u.test(a)||"string"!=typeof a?n(a,b||this.context):0;e>d;d++){for(c=this[d];c&&c!==b;c=c.parentNode){if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&n.find.matchesSelector(c,a))){f.push(c);break}}}return this.pushStack(f.length>1?n.unique(f):f)},index:function(a){return a?"string"==typeof a?g.call(n(a),this[0]):g.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(n.unique(n.merge(this.get(),n(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});function D(a,b){while((a=a[b])&&1!==a.nodeType){}return a}n.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return n.dir(a,"parentNode")},parentsUntil:function(a,b,c){return n.dir(a,"parentNode",c)},next:function(a){return D(a,"nextSibling")},prev:function(a){return D(a,"previousSibling")},nextAll:function(a){return n.dir(a,"nextSibling")},prevAll:function(a){return n.dir(a,"previousSibling")},nextUntil:function(a,b,c){return n.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return n.dir(a,"previousSibling",c)},siblings:function(a){return n.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return n.sibling(a.firstChild)},contents:function(a){return a.contentDocument||n.merge([],a.childNodes)}},function(a,b){n.fn[a]=function(c,d){var e=n.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=n.filter(d,e)),this.length>1&&(C[a]||n.unique(e),B.test(a)&&e.reverse()),this.pushStack(e)}});var E=/\S+/g,F={};function G(a){var b=F[a]={};return n.each(a.match(E)||[],function(a,c){b[c]=!0}),b}n.Callbacks=function(a){a="string"==typeof a?F[a]||G(a):n.extend({},a);var b,c,d,e,f,g,h=[],i=!a.once&&[],j=function(l){for(b=a.memory&&l,c=!0,g=e||0,e=0,f=h.length,d=!0;h&&f>g;g++){if(h[g].apply(l[0],l[1])===!1&&a.stopOnFalse){b=!1;break}}d=!1,h&&(i?i.length&&j(i.shift()):b?h=[]:k.disable())},k={add:function(){if(h){var c=h.length;!function g(b){n.each(b,function(b,c){var d=n.type(c);"function"===d?a.unique&&k.has(c)||h.push(c):c&&c.length&&"string"!==d&&g(c)})}(arguments),d?f=h.length:b&&(e=c,j(b))}return this},remove:function(){return h&&n.each(arguments,function(a,b){var c;while((c=n.inArray(b,h,c))>-1){h.splice(c,1),d&&(f>=c&&f--,g>=c&&g--)}}),this},has:function(a){return a?n.inArray(a,h)>-1:!(!h||!h.length)},empty:function(){return h=[],f=0,this},disable:function(){return h=i=b=void 0,this},disabled:function(){return !h},lock:function(){return i=void 0,b||k.disable(),this},locked:function(){return !i},fireWith:function(a,b){return !h||c&&!i||(b=b||[],b=[a,b.slice?b.slice():b],d?i.push(b):j(b)),this},fire:function(){return k.fireWith(this,arguments),this},fired:function(){return !!c}};return k},n.extend({Deferred:function(a){var b=[["resolve","done",n.Callbacks("once memory"),"resolved"],["reject","fail",n.Callbacks("once memory"),"rejected"],["notify","progress",n.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return n.Deferred(function(c){n.each(b,function(b,f){var g=n.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&n.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?n.extend(a,d):d}},e={};return d.pipe=d.then,n.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=d.call(arguments),e=c.length,f=1!==e||a&&n.isFunction(a.promise)?e:0,g=1===f?a:n.Deferred(),h=function(a,b,c){return function(e){b[a]=this,c[a]=arguments.length>1?d.call(arguments):e,c===i?g.notifyWith(b,c):--f||g.resolveWith(b,c)}},i,j,k;if(e>1){for(i=new Array(e),j=new Array(e),k=new Array(e);e>b;b++){c[b]&&n.isFunction(c[b].promise)?c[b].promise().done(h(b,k,c)).fail(g.reject).progress(h(b,j,i)):--f}}return f||g.resolveWith(k,c),g.promise()}});var H;n.fn.ready=function(a){return n.ready.promise().done(a),this},n.extend({isReady:!1,readyWait:1,holdReady:function(a){a?n.readyWait++:n.ready(!0)},ready:function(a){(a===!0?--n.readyWait:n.isReady)||(n.isReady=!0,a!==!0&&--n.readyWait>0||(H.resolveWith(l,[n]),n.fn.triggerHandler&&(n(l).triggerHandler("ready"),n(l).off("ready"))))}});function I(){l.removeEventListener("DOMContentLoaded",I,!1),a.removeEventListener("load",I,!1),n.ready()}n.ready.promise=function(b){return H||(H=n.Deferred(),"complete"===l.readyState?setTimeout(n.ready):(l.addEventListener("DOMContentLoaded",I,!1),a.addEventListener("load",I,!1))),H.promise(b)},n.ready.promise();var J=n.access=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===n.type(c)){e=!0;for(h in c){n.access(a,b,h,c[h],!0,f,g)}}else{if(void 0!==d&&(e=!0,n.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(n(a),c)})),b)){for(;i>h;h++){b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)))}}}return e?a:j?b.call(a):i?b(a[0],c):f};n.acceptData=function(a){return 1===a.nodeType||9===a.nodeType||!+a.nodeType};function K(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=n.expando+Math.random()}K.uid=1,K.accepts=n.acceptData,K.prototype={key:function(a){if(!K.accepts(a)){return 0}var b={},c=a[this.expando];if(!c){c=K.uid++;try{b[this.expando]={value:c},Object.defineProperties(a,b)}catch(d){b[this.expando]=c,n.extend(a,b)}}return this.cache[c]||(this.cache[c]={}),c},set:function(a,b,c){var d,e=this.key(a),f=this.cache[e];if("string"==typeof b){f[b]=c}else{if(n.isEmptyObject(f)){n.extend(this.cache[e],b)}else{for(d in b){f[d]=b[d]}}}return f},get:function(a,b){var c=this.cache[this.key(a)];return void 0===b?c:c[b]},access:function(a,b,c){var d;return void 0===b||b&&"string"==typeof b&&void 0===c?(d=this.get(a,b),void 0!==d?d:this.get(a,n.camelCase(b))):(this.set(a,b,c),void 0!==c?c:b)},remove:function(a,b){var c,d,e,f=this.key(a),g=this.cache[f];if(void 0===b){this.cache[f]={}}else{n.isArray(b)?d=b.concat(b.map(n.camelCase)):(e=n.camelCase(b),b in g?d=[b,e]:(d=e,d=d in g?[d]:d.match(E)||[])),c=d.length;while(c--){delete g[d[c]]}}},hasData:function(a){return !n.isEmptyObject(this.cache[a[this.expando]]||{})},discard:function(a){a[this.expando]&&delete this.cache[a[this.expando]]}};var L=new K,M=new K,N=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,O=/([A-Z])/g;function P(a,b,c){var d;if(void 0===c&&1===a.nodeType){if(d="data-"+b.replace(O,"-$1").toLowerCase(),c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:N.test(c)?n.parseJSON(c):c}catch(e){}M.set(a,b,c)}else{c=void 0}}return c}n.extend({hasData:function(a){return M.hasData(a)||L.hasData(a)},data:function(a,b,c){return M.access(a,b,c)},removeData:function(a,b){M.remove(a,b)},_data:function(a,b,c){return L.access(a,b,c)},_removeData:function(a,b){L.remove(a,b)}}),n.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=M.get(f),1===f.nodeType&&!L.get(f,"hasDataAttrs"))){c=g.length;while(c--){g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=n.camelCase(d.slice(5)),P(f,d,e[d])))}L.set(f,"hasDataAttrs",!0)}return e}return"object"==typeof a?this.each(function(){M.set(this,a)}):J(this,function(b){var c,d=n.camelCase(a);if(f&&void 0===b){if(c=M.get(f,a),void 0!==c){return c}if(c=M.get(f,d),void 0!==c){return c}if(c=P(f,d,void 0),void 0!==c){return c}}else{this.each(function(){var c=M.get(this,d);M.set(this,d,b),-1!==a.indexOf("-")&&void 0!==c&&M.set(this,a,b)})}},null,b,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){M.remove(this,a)})}}),n.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=L.get(a,b),c&&(!d||n.isArray(c)?d=L.access(a,b,n.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=n.queue(a,b),d=c.length,e=c.shift(),f=n._queueHooks(a,b),g=function(){n.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return L.get(a,c)||L.access(a,c,{empty:n.Callbacks("once memory").add(function(){L.remove(a,[b+"queue",c])})})}}),n.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?n.queue(this[0],a):void 0===b?this:this.each(function(){var c=n.queue(this,a,b);n._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&n.dequeue(this,a)})},dequeue:function(a){return this.each(function(){n.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=n.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};"string"!=typeof a&&(b=a,a=void 0),a=a||"fx";while(g--){c=L.get(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h))}return h(),e.promise(b)}});var Q=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,R=["Top","Right","Bottom","Left"],S=function(a,b){return a=b||a,"none"===n.css(a,"display")||!n.contains(a.ownerDocument,a)},T=/^(?:checkbox|radio)$/i;!function(){var a=l.createDocumentFragment(),b=a.appendChild(l.createElement("div")),c=l.createElement("input");c.setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),b.appendChild(c),k.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,b.innerHTML="<textarea>x</textarea>",k.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue}();var U="undefined";k.focusinBubbles="onfocusin" in a;var V=/^key/,W=/^(?:mouse|pointer|contextmenu)|click/,X=/^(?:focusinfocus|focusoutblur)$/,Y=/^([^.]*)(?:\.(.+)|)$/;function Z(){return !0}function $(){return !1}function _(){try{return l.activeElement}catch(a){}}n.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=L.get(a);if(r){c.handler&&(f=c,c=f.handler,e=f.selector),c.guid||(c.guid=n.guid++),(i=r.events)||(i=r.events={}),(g=r.handle)||(g=r.handle=function(b){return typeof n!==U&&n.event.triggered!==b.type?n.event.dispatch.apply(a,arguments):void 0}),b=(b||"").match(E)||[""],j=b.length;while(j--){h=Y.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o&&(l=n.event.special[o]||{},o=(e?l.delegateType:l.bindType)||o,l=n.event.special[o]||{},k=n.extend({type:o,origType:q,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&n.expr.match.needsContext.test(e),namespace:p.join(".")},f),(m=i[o])||(m=i[o]=[],m.delegateCount=0,l.setup&&l.setup.call(a,d,p,g)!==!1||a.addEventListener&&a.addEventListener(o,g,!1)),l.add&&(l.add.call(a,k),k.handler.guid||(k.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,k):m.push(k),n.event.global[o]=!0)}}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=L.hasData(a)&&L.get(a);if(r&&(i=r.events)){b=(b||"").match(E)||[""],j=b.length;while(j--){if(h=Y.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o){l=n.event.special[o]||{},o=(d?l.delegateType:l.bindType)||o,m=i[o]||[],h=h[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=f=m.length;while(f--){k=m[f],!e&&q!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&("**"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k))}g&&!m.length&&(l.teardown&&l.teardown.call(a,p,r.handle)!==!1||n.removeEvent(a,o,r.handle),delete i[o])}else{for(o in i){n.event.remove(a,o+b[j],c,d,!0)}}}n.isEmptyObject(i)&&(delete r.handle,L.remove(a,"events"))}},trigger:function(b,c,d,e){var f,g,h,i,k,m,o,p=[d||l],q=j.call(b,"type")?b.type:b,r=j.call(b,"namespace")?b.namespace.split("."):[];if(g=h=d=d||l,3!==d.nodeType&&8!==d.nodeType&&!X.test(q+n.event.triggered)&&(q.indexOf(".")>=0&&(r=q.split("."),q=r.shift(),r.sort()),k=q.indexOf(":")<0&&"on"+q,b=b[n.expando]?b:new n.Event(q,"object"==typeof b&&b),b.isTrigger=e?2:3,b.namespace=r.join("."),b.namespace_re=b.namespace?new RegExp("(^|\\.)"+r.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=d),c=null==c?[b]:n.makeArray(c,[b]),o=n.event.special[q]||{},e||!o.trigger||o.trigger.apply(d,c)!==!1)){if(!e&&!o.noBubble&&!n.isWindow(d)){for(i=o.delegateType||q,X.test(i+q)||(g=g.parentNode);g;g=g.parentNode){p.push(g),h=g}h===(d.ownerDocument||l)&&p.push(h.defaultView||h.parentWindow||a)}f=0;while((g=p[f++])&&!b.isPropagationStopped()){b.type=f>1?i:o.bindType||q,m=(L.get(g,"events")||{})[b.type]&&L.get(g,"handle"),m&&m.apply(g,c),m=k&&g[k],m&&m.apply&&n.acceptData(g)&&(b.result=m.apply(g,c),b.result===!1&&b.preventDefault())}return b.type=q,e||b.isDefaultPrevented()||o._default&&o._default.apply(p.pop(),c)!==!1||!n.acceptData(d)||k&&n.isFunction(d[q])&&!n.isWindow(d)&&(h=d[k],h&&(d[k]=null),n.event.triggered=q,d[q](),n.event.triggered=void 0,h&&(d[k]=h)),b.result}},dispatch:function(a){a=n.event.fix(a);var b,c,e,f,g,h=[],i=d.call(arguments),j=(L.get(this,"events")||{})[a.type]||[],k=n.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){h=n.event.handlers.call(this,a,j),b=0;while((f=h[b++])&&!a.isPropagationStopped()){a.currentTarget=f.elem,c=0;while((g=f.handlers[c++])&&!a.isImmediatePropagationStopped()){(!a.namespace_re||a.namespace_re.test(g.namespace))&&(a.handleObj=g,a.data=g.data,e=((n.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,i),void 0!==e&&(a.result=e)===!1&&(a.preventDefault(),a.stopPropagation()))}}return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&(!a.button||"click"!==a.type)){for(;i!==this;i=i.parentNode||this){if(i.disabled!==!0||"click"!==a.type){for(d=[],c=0;h>c;c++){f=b[c],e=f.selector+" ",void 0===d[e]&&(d[e]=f.needsContext?n(e,this).index(i)>=0:n.find(e,this,null,[i]).length),d[e]&&d.push(f)}d.length&&g.push({elem:i,handlers:d})}}}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,d,e,f=b.button;return null==a.pageX&&null!=b.clientX&&(c=a.target.ownerDocument||l,d=c.documentElement,e=c.body,a.pageX=b.clientX+(d&&d.scrollLeft||e&&e.scrollLeft||0)-(d&&d.clientLeft||e&&e.clientLeft||0),a.pageY=b.clientY+(d&&d.scrollTop||e&&e.scrollTop||0)-(d&&d.clientTop||e&&e.clientTop||0)),a.which||void 0===f||(a.which=1&f?1:2&f?3:4&f?2:0),a}},fix:function(a){if(a[n.expando]){return a}var b,c,d,e=a.type,f=a,g=this.fixHooks[e];g||(this.fixHooks[e]=g=W.test(e)?this.mouseHooks:V.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new n.Event(f),b=d.length;while(b--){c=d[b],a[c]=f[c]}return a.target||(a.target=l),3===a.target.nodeType&&(a.target=a.target.parentNode),g.filter?g.filter(a,f):a},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==_()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===_()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&n.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(a){return n.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=n.extend(new n.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?n.event.trigger(e,null,b):n.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},n.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)},n.Event=function(a,b){return this instanceof n.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?Z:$):this.type=a,b&&n.extend(this,b),this.timeStamp=a&&a.timeStamp||n.now(),void (this[n.expando]=!0)):new n.Event(a,b)},n.Event.prototype={isDefaultPrevented:$,isPropagationStopped:$,isImmediatePropagationStopped:$,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=Z,a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=Z,a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=Z,a&&a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},n.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){n.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!n.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),k.focusinBubbles||n.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){n.event.simulate(b,a.target,n.event.fix(a),!0)};n.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=L.access(d,b);e||d.addEventListener(a,c,!0),L.access(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=L.access(d,b)-1;e?L.access(d,b,e):(d.removeEventListener(a,c,!0),L.remove(d,b))}}}),n.fn.extend({on:function(a,b,c,d,e){var f,g;if("object"==typeof a){"string"!=typeof b&&(c=c||b,b=void 0);for(g in a){this.on(g,b,c,a[g],e)}return this}if(null==c&&null==d?(d=b,c=b=void 0):null==d&&("string"==typeof b?(d=c,c=void 0):(d=c,c=b,b=void 0)),d===!1){d=$}else{if(!d){return this}}return 1===e&&(f=d,d=function(a){return n().off(a),f.apply(this,arguments)},d.guid=f.guid||(f.guid=n.guid++)),this.each(function(){n.event.add(this,a,d,c,b)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj){return d=a.handleObj,n(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this}if("object"==typeof a){for(e in a){this.off(e,b,a[e])}return this}return(b===!1||"function"==typeof b)&&(c=b,b=void 0),c===!1&&(c=$),this.each(function(){n.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){n.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?n.event.trigger(a,b,c,!0):void 0}});var ab=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bb=/<([\w:]+)/,cb=/<|&#?\w+;/,db=/<(?:script|style|link)/i,eb=/checked\s*(?:[^=]|=\s*.checked.)/i,fb=/^$|\/(?:java|ecma)script/i,gb=/^true\/(.*)/,hb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,ib={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ib.optgroup=ib.option,ib.tbody=ib.tfoot=ib.colgroup=ib.caption=ib.thead,ib.th=ib.td;function jb(a,b){return n.nodeName(a,"table")&&n.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function kb(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function lb(a){var b=gb.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function mb(a,b){for(var c=0,d=a.length;d>c;c++){L.set(a[c],"globalEval",!b||L.get(b[c],"globalEval"))}}function nb(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(L.hasData(a)&&(f=L.access(a),g=L.set(b,f),j=f.events)){delete g.handle,g.events={};for(e in j){for(c=0,d=j[e].length;d>c;c++){n.event.add(b,e,j[e][c])}}}M.hasData(a)&&(h=M.access(a),i=n.extend({},h),M.set(b,i))}}function ob(a,b){var c=a.getElementsByTagName?a.getElementsByTagName(b||"*"):a.querySelectorAll?a.querySelectorAll(b||"*"):[];return void 0===b||b&&n.nodeName(a,b)?n.merge([a],c):c}function pb(a,b){var c=b.nodeName.toLowerCase();"input"===c&&T.test(a.type)?b.checked=a.checked:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}n.extend({clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=n.contains(a.ownerDocument,a);if(!(k.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||n.isXMLDoc(a))){for(g=ob(h),f=ob(a),d=0,e=f.length;e>d;d++){pb(f[d],g[d])}}if(b){if(c){for(f=f||ob(a),g=g||ob(h),d=0,e=f.length;e>d;d++){nb(f[d],g[d])}}else{nb(a,h)}}return g=ob(h,"script"),g.length>0&&mb(g,!i&&ob(a,"script")),h},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,k=b.createDocumentFragment(),l=[],m=0,o=a.length;o>m;m++){if(e=a[m],e||0===e){if("object"===n.type(e)){n.merge(l,e.nodeType?[e]:e)}else{if(cb.test(e)){f=f||k.appendChild(b.createElement("div")),g=(bb.exec(e)||["",""])[1].toLowerCase(),h=ib[g]||ib._default,f.innerHTML=h[1]+e.replace(ab,"<$1></$2>")+h[2],j=h[0];while(j--){f=f.lastChild}n.merge(l,f.childNodes),f=k.firstChild,f.textContent=""}else{l.push(b.createTextNode(e))}}}}k.textContent="",m=0;while(e=l[m++]){if((!d||-1===n.inArray(e,d))&&(i=n.contains(e.ownerDocument,e),f=ob(k.appendChild(e),"script"),i&&mb(f),c)){j=0;while(e=f[j++]){fb.test(e.type||"")&&c.push(e)}}}return k},cleanData:function(a){for(var b,c,d,e,f=n.event.special,g=0;void 0!==(c=a[g]);g++){if(n.acceptData(c)&&(e=c[L.expando],e&&(b=L.cache[e]))){if(b.events){for(d in b.events){f[d]?n.event.remove(c,d):n.removeEvent(c,d,b.handle)}}L.cache[e]&&delete L.cache[e]}delete M.cache[c[M.expando]]}}}),n.fn.extend({text:function(a){return J(this,function(a){return void 0===a?n.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=a)})},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=jb(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=jb(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?n.filter(a,this):this,e=0;null!=(c=d[e]);e++){b||1!==c.nodeType||n.cleanData(ob(c)),c.parentNode&&(b&&n.contains(c.ownerDocument,c)&&mb(ob(c,"script")),c.parentNode.removeChild(c))}return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++){1===a.nodeType&&(n.cleanData(ob(a,!1)),a.textContent="")}return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return n.clone(this,a,b)})},html:function(a){return J(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a&&1===b.nodeType){return b.innerHTML}if("string"==typeof a&&!db.test(a)&&!ib[(bb.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(ab,"<$1></$2>");try{for(;d>c;c++){b=this[c]||{},1===b.nodeType&&(n.cleanData(ob(b,!1)),b.innerHTML=a)}b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=arguments[0];return this.domManip(arguments,function(b){a=this.parentNode,n.cleanData(ob(this)),a&&a.replaceChild(b,this)}),a&&(a.length||a.nodeType)?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b){a=e.apply([],a);var c,d,f,g,h,i,j=0,l=this.length,m=this,o=l-1,p=a[0],q=n.isFunction(p);if(q||l>1&&"string"==typeof p&&!k.checkClone&&eb.test(p)){return this.each(function(c){var d=m.eq(c);q&&(a[0]=p.call(this,c,d.html())),d.domManip(a,b)})}if(l&&(c=n.buildFragment(a,this[0].ownerDocument,!1,this),d=c.firstChild,1===c.childNodes.length&&(c=d),d)){for(f=n.map(ob(c,"script"),kb),g=f.length;l>j;j++){h=c,j!==o&&(h=n.clone(h,!0,!0),g&&n.merge(f,ob(h,"script"))),b.call(this[j],h,j)}if(g){for(i=f[f.length-1].ownerDocument,n.map(f,lb),j=0;g>j;j++){h=f[j],fb.test(h.type||"")&&!L.access(h,"globalEval")&&n.contains(i,h)&&(h.src?n._evalUrl&&n._evalUrl(h.src):n.globalEval(h.textContent.replace(hb,"")))}}}return this}}),n.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){n.fn[a]=function(a){for(var c,d=[],e=n(a),g=e.length-1,h=0;g>=h;h++){c=h===g?this:this.clone(!0),n(e[h])[b](c),f.apply(d,c.get())}return this.pushStack(d)}});var qb,rb={};function sb(b,c){var d,e=n(c.createElement(b)).appendTo(c.body),f=a.getDefaultComputedStyle&&(d=a.getDefaultComputedStyle(e[0]))?d.display:n.css(e[0],"display");return e.detach(),f}function tb(a){var b=l,c=rb[a];return c||(c=sb(a,b),"none"!==c&&c||(qb=(qb||n("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=qb[0].contentDocument,b.write(),b.close(),c=sb(a,b),qb.detach()),rb[a]=c),c}var ub=/^margin/,vb=new RegExp("^("+Q+")(?!px)[a-z%]+$","i"),wb=function(a){return a.ownerDocument.defaultView.getComputedStyle(a,null)};function xb(a,b,c){var d,e,f,g,h=a.style;return c=c||wb(a),c&&(g=c.getPropertyValue(b)||c[b]),c&&(""!==g||n.contains(a.ownerDocument,a)||(g=n.style(a,b)),vb.test(g)&&ub.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0!==g?g+"":g}function yb(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}!function(){var b,c,d=l.documentElement,e=l.createElement("div"),f=l.createElement("div");if(f.style){f.style.backgroundClip="content-box",f.cloneNode(!0).style.backgroundClip="",k.clearCloneStyle="content-box"===f.style.backgroundClip,e.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",e.appendChild(f);function g(){f.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",f.innerHTML="",d.appendChild(e);var g=a.getComputedStyle(f,null);b="1%"!==g.top,c="4px"===g.width,d.removeChild(e)}a.getComputedStyle&&n.extend(k,{pixelPosition:function(){return g(),b},boxSizingReliable:function(){return null==c&&g(),c},reliableMarginRight:function(){var b,c=f.appendChild(l.createElement("div"));return c.style.cssText=f.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",c.style.marginRight=c.style.width="0",f.style.width="1px",d.appendChild(e),b=!parseFloat(a.getComputedStyle(c,null).marginRight),d.removeChild(e),b}})}}(),n.swap=function(a,b,c,d){var e,f,g={};for(f in b){g[f]=a.style[f],a.style[f]=b[f]}e=c.apply(a,d||[]);for(f in b){a.style[f]=g[f]}return e};var zb=/^(none|table(?!-c[ea]).+)/,Ab=new RegExp("^("+Q+")(.*)$","i"),Bb=new RegExp("^([+-])=("+Q+")","i"),Cb={position:"absolute",visibility:"hidden",display:"block"},Db={letterSpacing:"0",fontWeight:"400"},Eb=["Webkit","O","Moz","ms"];function Fb(a,b){if(b in a){return b}var c=b[0].toUpperCase()+b.slice(1),d=b,e=Eb.length;while(e--){if(b=Eb[e]+c,b in a){return b}}return d}function Gb(a,b,c){var d=Ab.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function Hb(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2){"margin"===c&&(g+=n.css(a,c+R[f],!0,e)),d?("content"===c&&(g-=n.css(a,"padding"+R[f],!0,e)),"margin"!==c&&(g-=n.css(a,"border"+R[f]+"Width",!0,e))):(g+=n.css(a,"padding"+R[f],!0,e),"padding"!==c&&(g+=n.css(a,"border"+R[f]+"Width",!0,e)))}return g}function Ib(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=wb(a),g="border-box"===n.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=xb(a,b,f),(0>e||null==e)&&(e=a.style[b]),vb.test(e)){return e}d=g&&(k.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+Hb(a,b,c||(g?"border":"content"),d,f)+"px"}function Jb(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++){d=a[g],d.style&&(f[g]=L.get(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&S(d)&&(f[g]=L.access(d,"olddisplay",tb(d.nodeName)))):(e=S(d),"none"===c&&e||L.set(d,"olddisplay",e?c:n.css(d,"display"))))}for(g=0;h>g;g++){d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"))}return a}n.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=xb(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=n.camelCase(b),i=a.style;return b=n.cssProps[h]||(n.cssProps[h]=Fb(i,h)),g=n.cssHooks[b]||n.cssHooks[h],void 0===c?g&&"get" in g&&void 0!==(e=g.get(a,!1,d))?e:i[b]:(f=typeof c,"string"===f&&(e=Bb.exec(c))&&(c=(e[1]+1)*e[2]+parseFloat(n.css(a,b)),f="number"),null!=c&&c===c&&("number"!==f||n.cssNumber[h]||(c+="px"),k.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),g&&"set" in g&&void 0===(c=g.set(a,c,d))||(i[b]=c)),void 0)}},css:function(a,b,c,d){var e,f,g,h=n.camelCase(b);return b=n.cssProps[h]||(n.cssProps[h]=Fb(a.style,h)),g=n.cssHooks[b]||n.cssHooks[h],g&&"get" in g&&(e=g.get(a,!0,c)),void 0===e&&(e=xb(a,b,d)),"normal"===e&&b in Db&&(e=Db[b]),""===c||c?(f=parseFloat(e),c===!0||n.isNumeric(f)?f||0:e):e}}),n.each(["height","width"],function(a,b){n.cssHooks[b]={get:function(a,c,d){return c?zb.test(n.css(a,"display"))&&0===a.offsetWidth?n.swap(a,Cb,function(){return Ib(a,b,d)}):Ib(a,b,d):void 0},set:function(a,c,d){var e=d&&wb(a);return Gb(a,c,d?Hb(a,b,d,"border-box"===n.css(a,"boxSizing",!1,e),e):0)}}}),n.cssHooks.marginRight=yb(k.reliableMarginRight,function(a,b){return b?n.swap(a,{display:"inline-block"},xb,[a,"marginRight"]):void 0}),n.each({margin:"",padding:"",border:"Width"},function(a,b){n.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++){e[a+R[d]+b]=f[d]||f[d-2]||f[0]}return e}},ub.test(a)||(n.cssHooks[a+b].set=Gb)}),n.fn.extend({css:function(a,b){return J(this,function(a,b,c){var d,e,f={},g=0;if(n.isArray(b)){for(d=wb(a),e=b.length;e>g;g++){f[b[g]]=n.css(a,b[g],!1,d)}return f}return void 0!==c?n.style(a,b,c):n.css(a,b)},a,b,arguments.length>1)},show:function(){return Jb(this,!0)},hide:function(){return Jb(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){S(this)?n(this).show():n(this).hide()})}});function Kb(a,b,c,d,e){return new Kb.prototype.init(a,b,c,d,e)}n.Tween=Kb,Kb.prototype={constructor:Kb,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(n.cssNumber[c]?"":"px")},cur:function(){var a=Kb.propHooks[this.prop];return a&&a.get?a.get(this):Kb.propHooks._default.get(this)},run:function(a){var b,c=Kb.propHooks[this.prop];return this.pos=b=this.options.duration?n.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):Kb.propHooks._default.set(this),this}},Kb.prototype.init.prototype=Kb.prototype,Kb.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=n.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){n.fx.step[a.prop]?n.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[n.cssProps[a.prop]]||n.cssHooks[a.prop])?n.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},Kb.propHooks.scrollTop=Kb.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},n.easing={linear:function(a){return a},swing:function(a){return 0.5-Math.cos(a*Math.PI)/2}},n.fx=Kb.prototype.init,n.fx.step={};var Lb,Mb,Nb=/^(?:toggle|show|hide)$/,Ob=new RegExp("^(?:([+-])=|)("+Q+")([a-z%]*)$","i"),Pb=/queueHooks$/,Qb=[Vb],Rb={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=Ob.exec(b),f=e&&e[3]||(n.cssNumber[a]?"":"px"),g=(n.cssNumber[a]||"px"!==f&&+d)&&Ob.exec(n.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do{h=h||".5",g/=h,n.style(c.elem,a,g+f)}while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(g=c.start=+g||+d||0,c.unit=f,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};function Sb(){return setTimeout(function(){Lb=void 0}),Lb=n.now()}function Tb(a,b){var c,d=0,e={height:a};for(b=b?1:0;4>d;d+=2-b){c=R[d],e["margin"+c]=e["padding"+c]=a}return b&&(e.opacity=e.width=a),e}function Ub(a,b,c){for(var d,e=(Rb[b]||[]).concat(Rb["*"]),f=0,g=e.length;g>f;f++){if(d=e[f].call(c,b,a)){return d}}}function Vb(a,b,c){var d,e,f,g,h,i,j,k,l=this,m={},o=a.style,p=a.nodeType&&S(a),q=L.get(a,"fxshow");c.queue||(h=n._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,l.always(function(){l.always(function(){h.unqueued--,n.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height" in b||"width" in b)&&(c.overflow=[o.overflow,o.overflowX,o.overflowY],j=n.css(a,"display"),k="none"===j?L.get(a,"olddisplay")||tb(a.nodeName):j,"inline"===k&&"none"===n.css(a,"float")&&(o.display="inline-block")),c.overflow&&(o.overflow="hidden",l.always(function(){o.overflow=c.overflow[0],o.overflowX=c.overflow[1],o.overflowY=c.overflow[2]}));for(d in b){if(e=b[d],Nb.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(p?"hide":"show")){if("show"!==e||!q||void 0===q[d]){continue}p=!0}m[d]=q&&q[d]||n.style(a,d)}else{j=void 0}}if(n.isEmptyObject(m)){"inline"===("none"===j?tb(a.nodeName):j)&&(o.display=j)}else{q?"hidden" in q&&(p=q.hidden):q=L.access(a,"fxshow",{}),f&&(q.hidden=!p),p?n(a).show():l.done(function(){n(a).hide()}),l.done(function(){var b;L.remove(a,"fxshow");for(b in m){n.style(a,b,m[b])}});for(d in m){g=Ub(p?q[d]:0,d,l),d in q||(q[d]=g.start,p&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}}function Wb(a,b){var c,d,e,f,g;for(c in a){if(d=n.camelCase(c),e=b[d],f=a[c],n.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=n.cssHooks[d],g&&"expand" in g){f=g.expand(f),delete a[d];for(c in f){c in a||(a[c]=f[c],b[c]=e)}}else{b[d]=e}}}function Xb(a,b,c){var d,e,f=0,g=Qb.length,h=n.Deferred().always(function(){delete i.elem}),i=function(){if(e){return !1}for(var b=Lb||Sb(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++){j.tweens[g].run(f)}return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:n.extend({},b),opts:n.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:Lb||Sb(),duration:c.duration,tweens:[],createTween:function(b,c){var d=n.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e){return this}for(e=!0;d>c;c++){j.tweens[c].run(1)}return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(Wb(k,j.opts.specialEasing);g>f;f++){if(d=Qb[f].call(j,a,k,j.opts)){return d}}return n.map(k,Ub,j),n.isFunction(j.opts.start)&&j.opts.start.call(a,j),n.fx.timer(n.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}n.Animation=n.extend(Xb,{tweener:function(a,b){n.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++){c=a[d],Rb[c]=Rb[c]||[],Rb[c].unshift(b)}},prefilter:function(a,b){b?Qb.unshift(a):Qb.push(a)}}),n.speed=function(a,b,c){var d=a&&"object"==typeof a?n.extend({},a):{complete:c||!c&&b||n.isFunction(a)&&a,duration:a,easing:c&&b||b&&!n.isFunction(b)&&b};return d.duration=n.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in n.fx.speeds?n.fx.speeds[d.duration]:n.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){n.isFunction(d.old)&&d.old.call(this),d.queue&&n.dequeue(this,d.queue)},d},n.fn.extend({fadeTo:function(a,b,c,d){return this.filter(S).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=n.isEmptyObject(a),f=n.speed(b,c,d),g=function(){var b=Xb(this,n.extend({},a),f);(e||L.get(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=n.timers,g=L.get(this);if(e){g[e]&&g[e].stop&&d(g[e])}else{for(e in g){g[e]&&g[e].stop&&Pb.test(e)&&d(g[e])}}for(e=f.length;e--;){f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1))}(b||!c)&&n.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=L.get(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=n.timers,g=d?d.length:0;for(c.finish=!0,n.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;){f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1))}for(b=0;g>b;b++){d[b]&&d[b].finish&&d[b].finish.call(this)}delete c.finish})}}),n.each(["toggle","show","hide"],function(a,b){var c=n.fn[b];n.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(Tb(b,!0),a,d,e)}}),n.each({slideDown:Tb("show"),slideUp:Tb("hide"),slideToggle:Tb("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){n.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),n.timers=[],n.fx.tick=function(){var a,b=0,c=n.timers;for(Lb=n.now();b<c.length;b++){a=c[b],a()||c[b]!==a||c.splice(b--,1)}c.length||n.fx.stop(),Lb=void 0},n.fx.timer=function(a){n.timers.push(a),a()?n.fx.start():n.timers.pop()},n.fx.interval=13,n.fx.start=function(){Mb||(Mb=setInterval(n.fx.tick,n.fx.interval))},n.fx.stop=function(){clearInterval(Mb),Mb=null},n.fx.speeds={slow:600,fast:200,_default:400},n.fn.delay=function(a,b){return a=n.fx?n.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},function(){var a=l.createElement("input"),b=l.createElement("select"),c=b.appendChild(l.createElement("option"));a.type="checkbox",k.checkOn=""!==a.value,k.optSelected=c.selected,b.disabled=!0,k.optDisabled=!c.disabled,a=l.createElement("input"),a.value="t",a.type="radio",k.radioValue="t"===a.value}();var Yb,Zb,$b=n.expr.attrHandle;n.fn.extend({attr:function(a,b){return J(this,n.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){n.removeAttr(this,a)})}}),n.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(a&&3!==f&&8!==f&&2!==f){return typeof a.getAttribute===U?n.prop(a,b,c):(1===f&&n.isXMLDoc(a)||(b=b.toLowerCase(),d=n.attrHooks[b]||(n.expr.match.bool.test(b)?Zb:Yb)),void 0===c?d&&"get" in d&&null!==(e=d.get(a,b))?e:(e=n.find.attr(a,b),null==e?void 0:e):null!==c?d&&"set" in d&&void 0!==(e=d.set(a,c,b))?e:(a.setAttribute(b,c+""),c):void n.removeAttr(a,b))}},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(E);if(f&&1===a.nodeType){while(c=f[e++]){d=n.propFix[c]||c,n.expr.match.bool.test(c)&&(a[d]=!1),a.removeAttribute(c)}}},attrHooks:{type:{set:function(a,b){if(!k.radioValue&&"radio"===b&&n.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}}}),Zb={set:function(a,b,c){return b===!1?n.removeAttr(a,c):a.setAttribute(c,c),c}},n.each(n.expr.match.bool.source.match(/\w+/g),function(a,b){var c=$b[b]||n.find.attr;$b[b]=function(a,b,d){var e,f;return d||(f=$b[b],$b[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,$b[b]=f),e}});var _b=/^(?:input|select|textarea|button)$/i;n.fn.extend({prop:function(a,b){return J(this,n.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[n.propFix[a]||a]})}}),n.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(a,b,c){var d,e,f,g=a.nodeType;if(a&&3!==g&&8!==g&&2!==g){return f=1!==g||!n.isXMLDoc(a),f&&(b=n.propFix[b]||b,e=n.propHooks[b]),void 0!==c?e&&"set" in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get" in e&&null!==(d=e.get(a,b))?d:a[b]}},propHooks:{tabIndex:{get:function(a){return a.hasAttribute("tabindex")||_b.test(a.nodeName)||a.href?a.tabIndex:-1}}}}),k.optSelected||(n.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null}}),n.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){n.propFix[this.toLowerCase()]=this});var ac=/[\t\r\n\f]/g;n.fn.extend({addClass:function(a){var b,c,d,e,f,g,h="string"==typeof a&&a,i=0,j=this.length;if(n.isFunction(a)){return this.each(function(b){n(this).addClass(a.call(this,b,this.className))})}if(h){for(b=(a||"").match(E)||[];j>i;i++){if(c=this[i],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(ac," "):" ")){f=0;while(e=b[f++]){d.indexOf(" "+e+" ")<0&&(d+=e+" ")}g=n.trim(d),c.className!==g&&(c.className=g)}}}return this},removeClass:function(a){var b,c,d,e,f,g,h=0===arguments.length||"string"==typeof a&&a,i=0,j=this.length;if(n.isFunction(a)){return this.each(function(b){n(this).removeClass(a.call(this,b,this.className))})}if(h){for(b=(a||"").match(E)||[];j>i;i++){if(c=this[i],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(ac," "):"")){f=0;while(e=b[f++]){while(d.indexOf(" "+e+" ")>=0){d=d.replace(" "+e+" "," ")}}g=a?n.trim(d):"",c.className!==g&&(c.className=g)}}}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):this.each(n.isFunction(a)?function(c){n(this).toggleClass(a.call(this,c,this.className,b),b)}:function(){if("string"===c){var b,d=0,e=n(this),f=a.match(E)||[];while(b=f[d++]){e.hasClass(b)?e.removeClass(b):e.addClass(b)}}else{(c===U||"boolean"===c)&&(this.className&&L.set(this,"__className__",this.className),this.className=this.className||a===!1?"":L.get(this,"__className__")||"")}})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++){if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(ac," ").indexOf(b)>=0){return !0}}return !1}});var bc=/\r/g;n.fn.extend({val:function(a){var b,c,d,e=this[0];if(arguments.length){return d=n.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,n(this).val()):a,null==e?e="":"number"==typeof e?e+="":n.isArray(e)&&(e=n.map(e,function(a){return null==a?"":a+""})),b=n.valHooks[this.type]||n.valHooks[this.nodeName.toLowerCase()],b&&"set" in b&&void 0!==b.set(this,e,"value")||(this.value=e))})}if(e){return b=n.valHooks[e.type]||n.valHooks[e.nodeName.toLowerCase()],b&&"get" in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(bc,""):null==c?"":c)}}}),n.extend({valHooks:{option:{get:function(a){var b=n.find.attr(a,"value");return null!=b?b:n.trim(n.text(a))}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++){if(c=d[i],!(!c.selected&&i!==e||(k.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&n.nodeName(c.parentNode,"optgroup"))){if(b=n(c).val(),f){return b}g.push(b)}}return g},set:function(a,b){var c,d,e=a.options,f=n.makeArray(b),g=e.length;while(g--){d=e[g],(d.selected=n.inArray(d.value,f)>=0)&&(c=!0)}return c||(a.selectedIndex=-1),f}}}}),n.each(["radio","checkbox"],function(){n.valHooks[this]={set:function(a,b){return n.isArray(b)?a.checked=n.inArray(n(a).val(),b)>=0:void 0}},k.checkOn||(n.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})}),n.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){n.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),n.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var cc=n.now(),dc=/\?/;n.parseJSON=function(a){return JSON.parse(a+"")},n.parseXML=function(a){var b,c;if(!a||"string"!=typeof a){return null}try{c=new DOMParser,b=c.parseFromString(a,"text/xml")}catch(d){b=void 0}return(!b||b.getElementsByTagName("parsererror").length)&&n.error("Invalid XML: "+a),b};var ec,fc,gc=/#.*$/,hc=/([?&])_=[^&]*/,ic=/^(.*?):[ \t]*([^\r\n]*)$/gm,jc=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,kc=/^(?:GET|HEAD)$/,lc=/^\/\//,mc=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,nc={},oc={},pc="*/".concat("*");try{fc=location.href}catch(qc){fc=l.createElement("a"),fc.href="",fc=fc.href}ec=mc.exec(fc.toLowerCase())||[];function rc(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(E)||[];if(n.isFunction(c)){while(d=f[e++]){"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}}}function sc(a,b,c,d){var e={},f=a===oc;function g(h){var i;return e[h]=!0,n.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function tc(a,b){var c,d,e=n.ajaxSettings.flatOptions||{};for(c in b){void 0!==b[c]&&((e[c]?a:d||(d={}))[c]=b[c])}return d&&n.extend(!0,a,d),a}function uc(a,b,c){var d,e,f,g,h=a.contents,i=a.dataTypes;while("*"===i[0]){i.shift(),void 0===d&&(d=a.mimeType||b.getResponseHeader("Content-Type"))}if(d){for(e in h){if(h[e]&&h[e].test(d)){i.unshift(e);break}}}if(i[0] in c){f=i[0]}else{for(e in c){if(!i[0]||a.converters[e+" "+i[0]]){f=e;break}g||(g=e)}f=f||g}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function vc(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1]){for(g in a.converters){j[g.toLowerCase()]=a.converters[g]}}f=k.shift();while(f){if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift()){if("*"===f){f=i}else{if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g){for(e in j){if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}}}if(g!==!0){if(g&&a["throws"]){b=g(b)}else{try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}}}}}}return{state:"success",data:b}}n.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:fc,type:"GET",isLocal:jc.test(ec[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":pc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":n.parseJSON,"text xml":n.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?tc(tc(a,n.ajaxSettings),b):tc(n.ajaxSettings,a)},ajaxPrefilter:rc(nc),ajaxTransport:rc(oc),ajax:function(a,b){"object"==typeof a&&(b=a,a=void 0),b=b||{};var c,d,e,f,g,h,i,j,k=n.ajaxSetup({},b),l=k.context||k,m=k.context&&(l.nodeType||l.jquery)?n(l):n.event,o=n.Deferred(),p=n.Callbacks("once memory"),q=k.statusCode||{},r={},s={},t=0,u="canceled",v={readyState:0,getResponseHeader:function(a){var b;if(2===t){if(!f){f={};while(b=ic.exec(e)){f[b[1].toLowerCase()]=b[2]}}b=f[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===t?e:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return t||(a=s[c]=s[c]||a,r[a]=b),this},overrideMimeType:function(a){return t||(k.mimeType=a),this},statusCode:function(a){var b;if(a){if(2>t){for(b in a){q[b]=[q[b],a[b]]}}else{v.always(a[v.status])}}return this},abort:function(a){var b=a||u;return c&&c.abort(b),x(0,b),this}};if(o.promise(v).complete=p.add,v.success=v.done,v.error=v.fail,k.url=((a||k.url||fc)+"").replace(gc,"").replace(lc,ec[1]+"//"),k.type=b.method||b.type||k.method||k.type,k.dataTypes=n.trim(k.dataType||"*").toLowerCase().match(E)||[""],null==k.crossDomain&&(h=mc.exec(k.url.toLowerCase()),k.crossDomain=!(!h||h[1]===ec[1]&&h[2]===ec[2]&&(h[3]||("http:"===h[1]?"80":"443"))===(ec[3]||("http:"===ec[1]?"80":"443")))),k.data&&k.processData&&"string"!=typeof k.data&&(k.data=n.param(k.data,k.traditional)),sc(nc,k,b,v),2===t){return v}i=k.global,i&&0===n.active++&&n.event.trigger("ajaxStart"),k.type=k.type.toUpperCase(),k.hasContent=!kc.test(k.type),d=k.url,k.hasContent||(k.data&&(d=k.url+=(dc.test(d)?"&":"?")+k.data,delete k.data),k.cache===!1&&(k.url=hc.test(d)?d.replace(hc,"$1_="+cc++):d+(dc.test(d)?"&":"?")+"_="+cc++)),k.ifModified&&(n.lastModified[d]&&v.setRequestHeader("If-Modified-Since",n.lastModified[d]),n.etag[d]&&v.setRequestHeader("If-None-Match",n.etag[d])),(k.data&&k.hasContent&&k.contentType!==!1||b.contentType)&&v.setRequestHeader("Content-Type",k.contentType),v.setRequestHeader("Accept",k.dataTypes[0]&&k.accepts[k.dataTypes[0]]?k.accepts[k.dataTypes[0]]+("*"!==k.dataTypes[0]?", "+pc+"; q=0.01":""):k.accepts["*"]);for(j in k.headers){v.setRequestHeader(j,k.headers[j])}if(k.beforeSend&&(k.beforeSend.call(l,v,k)===!1||2===t)){return v.abort()}u="abort";for(j in {success:1,error:1,complete:1}){v[j](k[j])}if(c=sc(oc,k,b,v)){v.readyState=1,i&&m.trigger("ajaxSend",[v,k]),k.async&&k.timeout>0&&(g=setTimeout(function(){v.abort("timeout")},k.timeout));try{t=1,c.send(r,x)}catch(w){if(!(2>t)){throw w}x(-1,w)}}else{x(-1,"No Transport")}function x(a,b,f,h){var j,r,s,u,w,x=b;2!==t&&(t=2,g&&clearTimeout(g),c=void 0,e=h||"",v.readyState=a>0?4:0,j=a>=200&&300>a||304===a,f&&(u=uc(k,v,f)),u=vc(k,u,v,j),j?(k.ifModified&&(w=v.getResponseHeader("Last-Modified"),w&&(n.lastModified[d]=w),w=v.getResponseHeader("etag"),w&&(n.etag[d]=w)),204===a||"HEAD"===k.type?x="nocontent":304===a?x="notmodified":(x=u.state,r=u.data,s=u.error,j=!s)):(s=x,(a||!x)&&(x="error",0>a&&(a=0))),v.status=a,v.statusText=(b||x)+"",j?o.resolveWith(l,[r,x,v]):o.rejectWith(l,[v,x,s]),v.statusCode(q),q=void 0,i&&m.trigger(j?"ajaxSuccess":"ajaxError",[v,k,j?r:s]),p.fireWith(l,[v,x]),i&&(m.trigger("ajaxComplete",[v,k]),--n.active||n.event.trigger("ajaxStop")))}return v},getJSON:function(a,b,c){return n.get(a,b,c,"json")},getScript:function(a,b){return n.get(a,void 0,b,"script")}}),n.each(["get","post"],function(a,b){n[b]=function(a,c,d,e){return n.isFunction(c)&&(e=e||d,d=c,c=void 0),n.ajax({url:a,type:b,dataType:e,data:c,success:d})}}),n.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){n.fn[b]=function(a){return this.on(b,a)}}),n._evalUrl=function(a){return n.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},n.fn.extend({wrapAll:function(a){var b;return n.isFunction(a)?this.each(function(b){n(this).wrapAll(a.call(this,b))}):(this[0]&&(b=n(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstElementChild){a=a.firstElementChild}return a}).append(this)),this)},wrapInner:function(a){return this.each(n.isFunction(a)?function(b){n(this).wrapInner(a.call(this,b))}:function(){var b=n(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=n.isFunction(a);return this.each(function(c){n(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){n.nodeName(this,"body")||n(this).replaceWith(this.childNodes)}).end()}}),n.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0},n.expr.filters.visible=function(a){return !n.expr.filters.hidden(a)};var wc=/%20/g,xc=/\[\]$/,yc=/\r?\n/g,zc=/^(?:submit|button|image|reset|file)$/i,Ac=/^(?:input|select|textarea|keygen)/i;function Bc(a,b,c,d){var e;if(n.isArray(b)){n.each(b,function(b,e){c||xc.test(a)?d(a,e):Bc(a+"["+("object"==typeof e?b:"")+"]",e,c,d)})}else{if(c||"object"!==n.type(b)){d(a,b)}else{for(e in b){Bc(a+"["+e+"]",b[e],c,d)}}}}n.param=function(a,b){var c,d=[],e=function(a,b){b=n.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=n.ajaxSettings&&n.ajaxSettings.traditional),n.isArray(a)||a.jquery&&!n.isPlainObject(a)){n.each(a,function(){e(this.name,this.value)})}else{for(c in a){Bc(c,a[c],b,e)}}return d.join("&").replace(wc,"+")},n.fn.extend({serialize:function(){return n.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=n.prop(this,"elements");return a?n.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!n(this).is(":disabled")&&Ac.test(this.nodeName)&&!zc.test(a)&&(this.checked||!T.test(a))}).map(function(a,b){var c=n(this).val();return null==c?null:n.isArray(c)?n.map(c,function(a){return{name:b.name,value:a.replace(yc,"\r\n")}}):{name:b.name,value:c.replace(yc,"\r\n")}}).get()}}),n.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(a){}};var Cc=0,Dc={},Ec={0:200,1223:204},Fc=n.ajaxSettings.xhr();a.ActiveXObject&&n(a).on("unload",function(){for(var a in Dc){Dc[a]()}}),k.cors=!!Fc&&"withCredentials" in Fc,k.ajax=Fc=!!Fc,n.ajaxTransport(function(a){var b;return k.cors||Fc&&!a.crossDomain?{send:function(c,d){var e,f=a.xhr(),g=++Cc;if(f.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields){for(e in a.xhrFields){f[e]=a.xhrFields[e]}}a.mimeType&&f.overrideMimeType&&f.overrideMimeType(a.mimeType),a.crossDomain||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest");for(e in c){f.setRequestHeader(e,c[e])}b=function(a){return function(){b&&(delete Dc[g],b=f.onload=f.onerror=null,"abort"===a?f.abort():"error"===a?d(f.status,f.statusText):d(Ec[f.status]||f.status,f.statusText,"string"==typeof f.responseText?{text:f.responseText}:void 0,f.getAllResponseHeaders()))}},f.onload=b(),f.onerror=b("error"),b=Dc[g]=b("abort");try{f.send(a.hasContent&&a.data||null)}catch(h){if(b){throw h}}},abort:function(){b&&b()}}:void 0}),n.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return n.globalEval(a),a}}}),n.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),n.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(d,e){b=n("<script>").prop({async:!0,charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove(),c=null,a&&e("error"===a.type?404:200,a.type)}),l.head.appendChild(b[0])},abort:function(){c&&c()}}}});var Gc=[],Hc=/(=)\?(?=&|$)|\?\?/;n.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Gc.pop()||n.expando+"_"+cc++;return this[a]=!0,a}}),n.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(Hc.test(b.url)?"url":"string"==typeof b.data&&!(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&Hc.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=n.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(Hc,"$1"+e):b.jsonp!==!1&&(b.url+=(dc.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||n.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,Gc.push(e)),g&&n.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),n.parseHTML=function(a,b,c){if(!a||"string"!=typeof a){return null}"boolean"==typeof b&&(c=b,b=!1),b=b||l;var d=v.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=n.buildFragment([a],b,e),e&&e.length&&n(e).remove(),n.merge([],d.childNodes))};var Ic=n.fn.load;n.fn.load=function(a,b,c){if("string"!=typeof a&&Ic){return Ic.apply(this,arguments)}var d,e,f,g=this,h=a.indexOf(" ");return h>=0&&(d=n.trim(a.slice(h)),a=a.slice(0,h)),n.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&n.ajax({url:a,type:e,dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?n("<div>").append(n.parseHTML(a)).find(d):a)}).complete(c&&function(a,b){g.each(c,f||[a.responseText,b,a])}),this},n.expr.filters.animated=function(a){return n.grep(n.timers,function(b){return a===b.elem}).length};var Jc=a.document.documentElement;function Kc(a){return n.isWindow(a)?a:9===a.nodeType&&a.defaultView}n.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=n.css(a,"position"),l=n(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=n.css(a,"top"),i=n.css(a,"left"),j=("absolute"===k||"fixed"===k)&&(f+i).indexOf("auto")>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),n.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using" in b?b.using.call(a,m):l.css(m)}},n.fn.extend({offset:function(a){if(arguments.length){return void 0===a?this:this.each(function(b){n.offset.setOffset(this,a,b)})}var b,c,d=this[0],e={top:0,left:0},f=d&&d.ownerDocument;if(f){return b=f.documentElement,n.contains(b,d)?(typeof d.getBoundingClientRect!==U&&(e=d.getBoundingClientRect()),c=Kc(f),{top:e.top+c.pageYOffset-b.clientTop,left:e.left+c.pageXOffset-b.clientLeft}):e}},position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return"fixed"===n.css(c,"position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),n.nodeName(a[0],"html")||(d=a.offset()),d.top+=n.css(a[0],"borderTopWidth",!0),d.left+=n.css(a[0],"borderLeftWidth",!0)),{top:b.top-d.top-n.css(c,"marginTop",!0),left:b.left-d.left-n.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||Jc;while(a&&!n.nodeName(a,"html")&&"static"===n.css(a,"position")){a=a.offsetParent}return a||Jc})}}),n.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(b,c){var d="pageYOffset"===c;n.fn[b]=function(e){return J(this,function(b,e,f){var g=Kc(b);return void 0===f?g?g[c]:b[e]:void (g?g.scrollTo(d?a.pageXOffset:f,d?f:a.pageYOffset):b[e]=f)},b,e,arguments.length,null)}}),n.each(["top","left"],function(a,b){n.cssHooks[b]=yb(k.pixelPosition,function(a,c){return c?(c=xb(a,b),vb.test(c)?n(a).position()[b]+"px":c):void 0})}),n.each({Height:"height",Width:"width"},function(a,b){n.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){n.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return J(this,function(b,c,d){var e;return n.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?n.css(b,c,g):n.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),n.fn.size=function(){return this.length},n.fn.andSelf=n.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return n});var Lc=a.jQuery,Mc=a.$;return n.noConflict=function(b){return a.$===n&&(a.$=Mc),b&&a.jQuery===n&&(a.jQuery=Lc),n},typeof b===U&&(a.jQuery=a.$=n),n});
/*! jQuery Migrate v1.2.1 | (c) 2005, 2013 jQuery Foundation, Inc. and other contributors | jquery.org/license */
jQuery.migrateMute===void 0&&(jQuery.migrateMute=!0),function(e,t,n){function r(n){var r=t.console;i[n]||(i[n]=!0,e.migrateWarnings.push(n),r&&r.warn&&!e.migrateMute&&(r.warn("JQMIGRATE: "+n),e.migrateTrace&&r.trace&&r.trace()))}function a(t,a,i,o){if(Object.defineProperty){try{return Object.defineProperty(t,a,{configurable:!0,enumerable:!0,get:function(){return r(o),i},set:function(e){r(o),i=e}}),n}catch(s){}}e._definePropertyBroken=!0,t[a]=i}var i={};e.migrateWarnings=[],!e.migrateMute&&t.console&&t.console.log&&t.console.log("JQMIGRATE: Logging is active"),e.migrateTrace===n&&(e.migrateTrace=!0),e.migrateReset=function(){i={},e.migrateWarnings.length=0},"BackCompat"===document.compatMode&&r("jQuery is not compatible with Quirks Mode");var o=e("<input/>",{size:1}).attr("size")&&e.attrFn,s=e.attr,u=e.attrHooks.value&&e.attrHooks.value.get||function(){return null},c=e.attrHooks.value&&e.attrHooks.value.set||function(){return n},l=/^(?:input|button)$/i,d=/^[238]$/,p=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,f=/^(?:checked|selected)$/i;a(e,"attrFn",o||{},"jQuery.attrFn is deprecated"),e.attr=function(t,a,i,u){var c=a.toLowerCase(),g=t&&t.nodeType;return u&&(4>s.length&&r("jQuery.fn.attr( props, pass ) is deprecated"),t&&!d.test(g)&&(o?a in o:e.isFunction(e.fn[a])))?e(t)[a](i):("type"===a&&i!==n&&l.test(t.nodeName)&&t.parentNode&&r("Can't change the 'type' of an input or button in IE 6/7/8"),!e.attrHooks[c]&&p.test(c)&&(e.attrHooks[c]={get:function(t,r){var a,i=e.prop(t,r);return i===!0||"boolean"!=typeof i&&(a=t.getAttributeNode(r))&&a.nodeValue!==!1?r.toLowerCase():n},set:function(t,n,r){var a;return n===!1?e.removeAttr(t,r):(a=e.propFix[r]||r,a in t&&(t[a]=!0),t.setAttribute(r,r.toLowerCase())),r}},f.test(c)&&r("jQuery.fn.attr('"+c+"') may use property instead of attribute")),s.call(e,t,a,i))},e.attrHooks.value={get:function(e,t){var n=(e.nodeName||"").toLowerCase();return"button"===n?u.apply(this,arguments):("input"!==n&&"option"!==n&&r("jQuery.fn.attr('value') no longer gets properties"),t in e?e.value:null)},set:function(e,t){var a=(e.nodeName||"").toLowerCase();return"button"===a?c.apply(this,arguments):("input"!==a&&"option"!==a&&r("jQuery.fn.attr('value', val) no longer sets properties"),e.value=t,n)}};var g,h,v=e.fn.init,m=e.parseJSON,y=/^([^<]*)(<[\w\W]+>)([^>]*)$/;e.fn.init=function(t,n,a){var i;return t&&"string"==typeof t&&!e.isPlainObject(n)&&(i=y.exec(e.trim(t)))&&i[0]&&("<"!==t.charAt(0)&&r("$(html) HTML strings must start with '<' character"),i[3]&&r("$(html) HTML text after last tag is ignored"),"#"===i[0].charAt(0)&&(r("HTML string cannot start with a '#' character"),e.error("JQMIGRATE: Invalid selector string (XSS)")),n&&n.context&&(n=n.context),e.parseHTML)?v.call(this,e.parseHTML(i[2],n,!0),n,a):v.apply(this,arguments)},e.fn.init.prototype=e.fn,e.parseJSON=function(e){return e||null===e?m.apply(this,arguments):(r("jQuery.parseJSON requires a valid JSON string"),null)},e.uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||0>e.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},e.browser||(g=e.uaMatch(navigator.userAgent),h={},g.browser&&(h[g.browser]=!0,h.version=g.version),h.chrome?h.webkit=!0:h.webkit&&(h.safari=!0),e.browser=h),a(e,"browser",e.browser,"jQuery.browser is deprecated"),e.sub=function(){function t(e,n){return new t.fn.init(e,n)}e.extend(!0,t,this),t.superclass=this,t.fn=t.prototype=this(),t.fn.constructor=t,t.sub=this.sub,t.fn.init=function(r,a){return a&&a instanceof e&&!(a instanceof t)&&(a=t(a)),e.fn.init.call(this,r,a,n)},t.fn.init.prototype=t.fn;var n=t(document);return r("jQuery.sub() is deprecated"),t},e.ajaxSetup({converters:{"text json":e.parseJSON}});var b=e.fn.data;e.fn.data=function(t){var a,i,o=this[0];return !o||"events"!==t||1!==arguments.length||(a=e.data(o,t),i=e._data(o,t),a!==n&&a!==i||i===n)?b.apply(this,arguments):(r("Use of jQuery.fn.data('events') is deprecated"),i)};var j=/\/(java|ecma)script/i,w=e.fn.andSelf||e.fn.addBack;e.fn.andSelf=function(){return r("jQuery.fn.andSelf() replaced by jQuery.fn.addBack()"),w.apply(this,arguments)},e.clean||(e.clean=function(t,a,i,o){a=a||document,a=!a.nodeType&&a[0]||a,a=a.ownerDocument||a,r("jQuery.clean() is deprecated");var s,u,c,l,d=[];if(e.merge(d,e.buildFragment(t,a).childNodes),i){for(c=function(e){return !e.type||j.test(e.type)?o?o.push(e.parentNode?e.parentNode.removeChild(e):e):i.appendChild(e):n},s=0;null!=(u=d[s]);s++){e.nodeName(u,"script")&&c(u)||(i.appendChild(u),u.getElementsByTagName!==n&&(l=e.grep(e.merge([],u.getElementsByTagName("script")),c),d.splice.apply(d,[s+1,0].concat(l)),s+=l.length))}}return d});var Q=e.event.add,x=e.event.remove,k=e.event.trigger,N=e.fn.toggle,T=e.fn.live,M=e.fn.die,S="ajaxStart|ajaxStop|ajaxSend|ajaxComplete|ajaxError|ajaxSuccess",C=RegExp("\\b(?:"+S+")\\b"),H=/(?:^|\s)hover(\.\S+|)\b/,A=function(t){return"string"!=typeof t||e.event.special.hover?t:(H.test(t)&&r("'hover' pseudo-event is deprecated, use 'mouseenter mouseleave'"),t&&t.replace(H,"mouseenter$1 mouseleave$1"))};e.event.props&&"attrChange"!==e.event.props[0]&&e.event.props.unshift("attrChange","attrName","relatedNode","srcElement"),e.event.dispatch&&a(e.event,"handle",e.event.dispatch,"jQuery.event.handle is undocumented and deprecated"),e.event.add=function(e,t,n,a,i){e!==document&&C.test(t)&&r("AJAX events should be attached to document: "+t),Q.call(this,e,A(t||""),n,a,i)},e.event.remove=function(e,t,n,r,a){x.call(this,e,A(t)||"",n,r,a)},e.fn.error=function(){var e=Array.prototype.slice.call(arguments,0);return r("jQuery.fn.error() is deprecated"),e.splice(0,0,"error"),arguments.length?this.bind.apply(this,e):(this.triggerHandler.apply(this,e),this)},e.fn.toggle=function(t,n){if(!e.isFunction(t)||!e.isFunction(n)){return N.apply(this,arguments)}r("jQuery.fn.toggle(handler, handler...) is deprecated");var a=arguments,i=t.guid||e.guid++,o=0,s=function(n){var r=(e._data(this,"lastToggle"+t.guid)||0)%o;return e._data(this,"lastToggle"+t.guid,r+1),n.preventDefault(),a[r].apply(this,arguments)||!1};for(s.guid=i;a.length>o;){a[o++].guid=i}return this.click(s)},e.fn.live=function(t,n,a){return r("jQuery.fn.live() is deprecated"),T?T.apply(this,arguments):(e(this.context).on(t,this.selector,n,a),this)},e.fn.die=function(t,n){return r("jQuery.fn.die() is deprecated"),M?M.apply(this,arguments):(e(this.context).off(t,this.selector||"**",n),this)},e.event.trigger=function(e,t,n,a){return n||C.test(e)||r("Global events are undocumented and deprecated"),k.call(this,e,t,n||document,a)},e.each(S.split("|"),function(t,n){e.event.special[n]={setup:function(){var t=this;return t!==document&&(e.event.add(document,n+"."+e.guid,function(){e.event.trigger(n,null,t,!0)}),e._data(this,n,e.guid++)),!1},teardown:function(){return this!==document&&e.event.remove(document,n+"."+e._data(this,n)),!1}}})}(jQuery,window);
/*!

 handlebars v1.3.0

Copyright (C) 2011 by Yehuda Katz

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

@license
*/
var Handlebars=function(){var a=function(){function a(a){this.string=a}var b;return a.prototype.toString=function(){return""+this.string},b=a}(),b=function(a){function b(a){return h[a]||"&amp;"}function c(a,b){for(var c in b){Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])}}function d(a){return a instanceof g?a.toString():a||0===a?(a=""+a,j.test(a)?a.replace(i,b):a):""}function e(a){return a||0===a?m(a)&&0===a.length?!0:!1:!0}var f={},g=a,h={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},i=/[&<>"'`]/g,j=/[&<>"'`]/;f.extend=c;var k=Object.prototype.toString;f.toString=k;var l=function(a){return"function"==typeof a};l(/x/)&&(l=function(a){return"function"==typeof a&&"[object Function]"===k.call(a)});var l;f.isFunction=l;var m=Array.isArray||function(a){return a&&"object"==typeof a?"[object Array]"===k.call(a):!1};return f.isArray=m,f.escapeExpression=d,f.isEmpty=e,f}(a),c=function(){function a(a,b){var d;b&&b.firstLine&&(d=b.firstLine,a+=" - "+d+":"+b.firstColumn);for(var e=Error.prototype.constructor.call(this,a),f=0;f<c.length;f++){this[c[f]]=e[c[f]]}d&&(this.lineNumber=d,this.column=b.firstColumn)}var b,c=["description","fileName","lineNumber","message","name","number","stack"];return a.prototype=new Error,b=a}(),d=function(a,b){function c(a,b){this.helpers=a||{},this.partials=b||{},d(this)}function d(a){a.registerHelper("helperMissing",function(a){if(2===arguments.length){return void 0}throw new h("Missing helper: '"+a+"'")}),a.registerHelper("blockHelperMissing",function(b,c){var d=c.inverse||function(){},e=c.fn;return m(b)&&(b=b.call(this)),b===!0?e(this):b===!1||null==b?d(this):l(b)?b.length>0?a.helpers.each(b,c):d(this):e(b)}),a.registerHelper("each",function(a,b){var c,d=b.fn,e=b.inverse,f=0,g="";if(m(a)&&(a=a.call(this)),b.data&&(c=q(b.data)),a&&"object"==typeof a){if(l(a)){for(var h=a.length;h>f;f++){c&&(c.index=f,c.first=0===f,c.last=f===a.length-1),g+=d(a[f],{data:c})}}else{for(var i in a){a.hasOwnProperty(i)&&(c&&(c.key=i,c.index=f,c.first=0===f),g+=d(a[i],{data:c}),f++)}}}return 0===f&&(g=e(this)),g}),a.registerHelper("if",function(a,b){return m(a)&&(a=a.call(this)),!b.hash.includeZero&&!a||g.isEmpty(a)?b.inverse(this):b.fn(this)}),a.registerHelper("unless",function(b,c){return a.helpers["if"].call(this,b,{fn:c.inverse,inverse:c.fn,hash:c.hash})}),a.registerHelper("with",function(a,b){return m(a)&&(a=a.call(this)),g.isEmpty(a)?void 0:b.fn(a)}),a.registerHelper("log",function(b,c){var d=c.data&&null!=c.data.level?parseInt(c.data.level,10):1;a.log(d,b)})}function e(a,b){p.log(a,b)}var f={},g=a,h=b,i="1.3.0";f.VERSION=i;var j=4;f.COMPILER_REVISION=j;var k={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"};f.REVISION_CHANGES=k;var l=g.isArray,m=g.isFunction,n=g.toString,o="[object Object]";f.HandlebarsEnvironment=c,c.prototype={constructor:c,logger:p,log:e,registerHelper:function(a,b,c){if(n.call(a)===o){if(c||b){throw new h("Arg not supported with multiple helpers")}g.extend(this.helpers,a)}else{c&&(b.not=c),this.helpers[a]=b}},registerPartial:function(a,b){n.call(a)===o?g.extend(this.partials,a):this.partials[a]=b}};var p={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(a,b){if(p.level<=a){var c=p.methodMap[a];"undefined"!=typeof console&&console[c]&&console[c].call(console,b)}}};f.logger=p,f.log=e;var q=function(a){var b={};return g.extend(b,a),b};return f.createFrame=q,f}(b,c),e=function(a,b,c){function d(a){var b=a&&a[0]||1,c=m;if(b!==c){if(c>b){var d=n[c],e=n[b];throw new l("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+d+") or downgrade your runtime to an older version ("+e+").")}throw new l("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+a[1]+").")}}function e(a,b){if(!b){throw new l("No environment passed to template")}var c=function(a,c,d,e,f,g){var h=b.VM.invokePartial.apply(this,arguments);if(null!=h){return h}if(b.compile){var i={helpers:e,partials:f,data:g};return f[c]=b.compile(a,{data:void 0!==g},b),f[c](d,i)}throw new l("The partial "+c+" could not be compiled when running in runtime-only mode")},d={escapeExpression:k.escapeExpression,invokePartial:c,programs:[],program:function(a,b,c){var d=this.programs[a];return c?d=g(a,b,c):d||(d=this.programs[a]=g(a,b)),d},merge:function(a,b){var c=a||b;return a&&b&&a!==b&&(c={},k.extend(c,b),k.extend(c,a)),c},programWithDepth:b.VM.programWithDepth,noop:b.VM.noop,compilerInfo:null};return function(c,e){e=e||{};var f,g,h=e.partial?e:b;e.partial||(f=e.helpers,g=e.partials);var i=a.call(d,h,c,f,g,e.data);return e.partial||b.VM.checkRevision(d.compilerInfo),i}}function f(a,b,c){var d=Array.prototype.slice.call(arguments,3),e=function(a,e){return e=e||{},b.apply(this,[a,e.data||c].concat(d))};return e.program=a,e.depth=d.length,e}function g(a,b,c){var d=function(a,d){return d=d||{},b(a,d.data||c)};return d.program=a,d.depth=0,d}function h(a,b,c,d,e,f){var g={partial:!0,helpers:d,partials:e,data:f};if(void 0===a){throw new l("The partial "+b+" could not be found")}return a instanceof Function?a(c,g):void 0}function i(){return""}var j={},k=a,l=b,m=c.COMPILER_REVISION,n=c.REVISION_CHANGES;return j.checkRevision=d,j.template=e,j.programWithDepth=f,j.program=g,j.invokePartial=h,j.noop=i,j}(b,c,d),f=function(a,b,c,d,e){var f,g=a,h=b,i=c,j=d,k=e,l=function(){var a=new g.HandlebarsEnvironment;return j.extend(a,g),a.SafeString=h,a.Exception=i,a.Utils=j,a.VM=k,a.template=function(b){return k.template(b,a)},a},m=l();return m.create=l,f=m}(d,a,c,b,e),g=function(a){function b(a){a=a||{},this.firstLine=a.first_line,this.firstColumn=a.first_column,this.lastColumn=a.last_column,this.lastLine=a.last_line}var c,d=a,e={ProgramNode:function(a,c,d,f){var g,h;3===arguments.length?(f=d,d=null):2===arguments.length&&(f=c,c=null),b.call(this,f),this.type="program",this.statements=a,this.strip={},d?(h=d[0],h?(g={first_line:h.firstLine,last_line:h.lastLine,last_column:h.lastColumn,first_column:h.firstColumn},this.inverse=new e.ProgramNode(d,c,g)):this.inverse=new e.ProgramNode(d,c),this.strip.right=c.left):c&&(this.strip.left=c.right)},MustacheNode:function(a,c,d,f,g){if(b.call(this,g),this.type="mustache",this.strip=f,null!=d&&d.charAt){var h=d.charAt(3)||d.charAt(2);this.escaped="{"!==h&&"&"!==h}else{this.escaped=!!d}this.sexpr=a instanceof e.SexprNode?a:new e.SexprNode(a,c),this.sexpr.isRoot=!0,this.id=this.sexpr.id,this.params=this.sexpr.params,this.hash=this.sexpr.hash,this.eligibleHelper=this.sexpr.eligibleHelper,this.isHelper=this.sexpr.isHelper},SexprNode:function(a,c,d){b.call(this,d),this.type="sexpr",this.hash=c;var e=this.id=a[0],f=this.params=a.slice(1),g=this.eligibleHelper=e.isSimple;this.isHelper=g&&(f.length||c)},PartialNode:function(a,c,d,e){b.call(this,e),this.type="partial",this.partialName=a,this.context=c,this.strip=d},BlockNode:function(a,c,e,f,g){if(b.call(this,g),a.sexpr.id.original!==f.path.original){throw new d(a.sexpr.id.original+" doesn't match "+f.path.original,this)}this.type="block",this.mustache=a,this.program=c,this.inverse=e,this.strip={left:a.strip.left,right:f.strip.right},(c||e).strip.left=a.strip.right,(e||c).strip.right=f.strip.left,e&&!c&&(this.isInverse=!0)},ContentNode:function(a,c){b.call(this,c),this.type="content",this.string=a},HashNode:function(a,c){b.call(this,c),this.type="hash",this.pairs=a},IdNode:function(a,c){b.call(this,c),this.type="ID";for(var e="",f=[],g=0,h=0,i=a.length;i>h;h++){var j=a[h].part;if(e+=(a[h].separator||"")+j,".."===j||"."===j||"this"===j){if(f.length>0){throw new d("Invalid path: "+e,this)}".."===j?g++:this.isScoped=!0}else{f.push(j)}}this.original=e,this.parts=f,this.string=f.join("."),this.depth=g,this.isSimple=1===a.length&&!this.isScoped&&0===g,this.stringModeValue=this.string},PartialNameNode:function(a,c){b.call(this,c),this.type="PARTIAL_NAME",this.name=a.original},DataNode:function(a,c){b.call(this,c),this.type="DATA",this.id=a},StringNode:function(a,c){b.call(this,c),this.type="STRING",this.original=this.string=this.stringModeValue=a},IntegerNode:function(a,c){b.call(this,c),this.type="INTEGER",this.original=this.integer=a,this.stringModeValue=Number(a)},BooleanNode:function(a,c){b.call(this,c),this.type="BOOLEAN",this.bool=a,this.stringModeValue="true"===a},CommentNode:function(a,c){b.call(this,c),this.type="comment",this.comment=a}};return c=e}(c),h=function(){var a,b=function(){function a(a,b){return{left:"~"===a.charAt(2),right:"~"===b.charAt(0)||"~"===b.charAt(1)}}function b(){this.yy={}}var c={trace:function(){},yy:{},symbols_:{error:2,root:3,statements:4,EOF:5,program:6,simpleInverse:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,sexpr:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,CLOSE_UNESCAPED:24,OPEN_PARTIAL:25,partialName:26,partial_option0:27,sexpr_repetition0:28,sexpr_option0:29,dataName:30,param:31,STRING:32,INTEGER:33,BOOLEAN:34,OPEN_SEXPR:35,CLOSE_SEXPR:36,hash:37,hash_repetition_plus0:38,hashSegment:39,ID:40,EQUALS:41,DATA:42,pathSegments:43,SEP:44,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"CLOSE_UNESCAPED",25:"OPEN_PARTIAL",32:"STRING",33:"INTEGER",34:"BOOLEAN",35:"OPEN_SEXPR",36:"CLOSE_SEXPR",40:"ID",41:"EQUALS",42:"DATA",44:"SEP"},productions_:[0,[3,2],[3,1],[6,2],[6,3],[6,2],[6,1],[6,1],[6,0],[4,1],[4,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,4],[7,2],[17,3],[17,1],[31,1],[31,1],[31,1],[31,1],[31,1],[31,3],[37,1],[39,3],[26,1],[26,1],[26,1],[30,2],[21,1],[43,3],[43,1],[27,0],[27,1],[28,0],[28,2],[29,0],[29,1],[38,1],[38,2]],performAction:function(b,c,d,e,f,g){var h=g.length-1;switch(f){case 1:return new e.ProgramNode(g[h-1],this._$);case 2:return new e.ProgramNode([],this._$);case 3:this.$=new e.ProgramNode([],g[h-1],g[h],this._$);break;case 4:this.$=new e.ProgramNode(g[h-2],g[h-1],g[h],this._$);break;case 5:this.$=new e.ProgramNode(g[h-1],g[h],[],this._$);break;case 6:this.$=new e.ProgramNode(g[h],this._$);break;case 7:this.$=new e.ProgramNode([],this._$);break;case 8:this.$=new e.ProgramNode([],this._$);break;case 9:this.$=[g[h]];break;case 10:g[h-1].push(g[h]),this.$=g[h-1];break;case 11:this.$=new e.BlockNode(g[h-2],g[h-1].inverse,g[h-1],g[h],this._$);break;case 12:this.$=new e.BlockNode(g[h-2],g[h-1],g[h-1].inverse,g[h],this._$);break;case 13:this.$=g[h];break;case 14:this.$=g[h];break;case 15:this.$=new e.ContentNode(g[h],this._$);break;case 16:this.$=new e.CommentNode(g[h],this._$);break;case 17:this.$=new e.MustacheNode(g[h-1],null,g[h-2],a(g[h-2],g[h]),this._$);break;case 18:this.$=new e.MustacheNode(g[h-1],null,g[h-2],a(g[h-2],g[h]),this._$);break;case 19:this.$={path:g[h-1],strip:a(g[h-2],g[h])};break;case 20:this.$=new e.MustacheNode(g[h-1],null,g[h-2],a(g[h-2],g[h]),this._$);break;case 21:this.$=new e.MustacheNode(g[h-1],null,g[h-2],a(g[h-2],g[h]),this._$);break;case 22:this.$=new e.PartialNode(g[h-2],g[h-1],a(g[h-3],g[h]),this._$);break;case 23:this.$=a(g[h-1],g[h]);break;case 24:this.$=new e.SexprNode([g[h-2]].concat(g[h-1]),g[h],this._$);break;case 25:this.$=new e.SexprNode([g[h]],null,this._$);break;case 26:this.$=g[h];break;case 27:this.$=new e.StringNode(g[h],this._$);break;case 28:this.$=new e.IntegerNode(g[h],this._$);break;case 29:this.$=new e.BooleanNode(g[h],this._$);break;case 30:this.$=g[h];break;case 31:g[h-1].isHelper=!0,this.$=g[h-1];break;case 32:this.$=new e.HashNode(g[h],this._$);break;case 33:this.$=[g[h-2],g[h]];break;case 34:this.$=new e.PartialNameNode(g[h],this._$);break;case 35:this.$=new e.PartialNameNode(new e.StringNode(g[h],this._$),this._$);break;case 36:this.$=new e.PartialNameNode(new e.IntegerNode(g[h],this._$));break;case 37:this.$=new e.DataNode(g[h],this._$);break;case 38:this.$=new e.IdNode(g[h],this._$);break;case 39:g[h-2].push({part:g[h],separator:g[h-1]}),this.$=g[h-2];break;case 40:this.$=[{part:g[h]}];break;case 43:this.$=[];break;case 44:g[h-1].push(g[h]);break;case 47:this.$=[g[h]];break;case 48:g[h-1].push(g[h])}},table:[{3:1,4:2,5:[1,3],8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],25:[1,15]},{1:[3]},{5:[1,16],8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],25:[1,15]},{1:[2,2]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],25:[2,9]},{4:20,6:18,7:19,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,8],22:[1,13],23:[1,14],25:[1,15]},{4:20,6:22,7:19,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,8],22:[1,13],23:[1,14],25:[1,15]},{5:[2,13],14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],25:[2,13]},{5:[2,14],14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],25:[2,14]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],25:[2,15]},{5:[2,16],14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],25:[2,16]},{17:23,21:24,30:25,40:[1,28],42:[1,27],43:26},{17:29,21:24,30:25,40:[1,28],42:[1,27],43:26},{17:30,21:24,30:25,40:[1,28],42:[1,27],43:26},{17:31,21:24,30:25,40:[1,28],42:[1,27],43:26},{21:33,26:32,32:[1,34],33:[1,35],40:[1,28],43:26},{1:[2,1]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],25:[2,10]},{10:36,20:[1,37]},{4:38,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,7],22:[1,13],23:[1,14],25:[1,15]},{7:39,8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,6],22:[1,13],23:[1,14],25:[1,15]},{17:23,18:[1,40],21:24,30:25,40:[1,28],42:[1,27],43:26},{10:41,20:[1,37]},{18:[1,42]},{18:[2,43],24:[2,43],28:43,32:[2,43],33:[2,43],34:[2,43],35:[2,43],36:[2,43],40:[2,43],42:[2,43]},{18:[2,25],24:[2,25],36:[2,25]},{18:[2,38],24:[2,38],32:[2,38],33:[2,38],34:[2,38],35:[2,38],36:[2,38],40:[2,38],42:[2,38],44:[1,44]},{21:45,40:[1,28],43:26},{18:[2,40],24:[2,40],32:[2,40],33:[2,40],34:[2,40],35:[2,40],36:[2,40],40:[2,40],42:[2,40],44:[2,40]},{18:[1,46]},{18:[1,47]},{24:[1,48]},{18:[2,41],21:50,27:49,40:[1,28],43:26},{18:[2,34],40:[2,34]},{18:[2,35],40:[2,35]},{18:[2,36],40:[2,36]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],25:[2,11]},{21:51,40:[1,28],43:26},{8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,3],22:[1,13],23:[1,14],25:[1,15]},{4:52,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,5],22:[1,13],23:[1,14],25:[1,15]},{14:[2,23],15:[2,23],16:[2,23],19:[2,23],20:[2,23],22:[2,23],23:[2,23],25:[2,23]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],25:[2,12]},{14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],25:[2,18]},{18:[2,45],21:56,24:[2,45],29:53,30:60,31:54,32:[1,57],33:[1,58],34:[1,59],35:[1,61],36:[2,45],37:55,38:62,39:63,40:[1,64],42:[1,27],43:26},{40:[1,65]},{18:[2,37],24:[2,37],32:[2,37],33:[2,37],34:[2,37],35:[2,37],36:[2,37],40:[2,37],42:[2,37]},{14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],25:[2,17]},{5:[2,20],14:[2,20],15:[2,20],16:[2,20],19:[2,20],20:[2,20],22:[2,20],23:[2,20],25:[2,20]},{5:[2,21],14:[2,21],15:[2,21],16:[2,21],19:[2,21],20:[2,21],22:[2,21],23:[2,21],25:[2,21]},{18:[1,66]},{18:[2,42]},{18:[1,67]},{8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],25:[1,15]},{18:[2,24],24:[2,24],36:[2,24]},{18:[2,44],24:[2,44],32:[2,44],33:[2,44],34:[2,44],35:[2,44],36:[2,44],40:[2,44],42:[2,44]},{18:[2,46],24:[2,46],36:[2,46]},{18:[2,26],24:[2,26],32:[2,26],33:[2,26],34:[2,26],35:[2,26],36:[2,26],40:[2,26],42:[2,26]},{18:[2,27],24:[2,27],32:[2,27],33:[2,27],34:[2,27],35:[2,27],36:[2,27],40:[2,27],42:[2,27]},{18:[2,28],24:[2,28],32:[2,28],33:[2,28],34:[2,28],35:[2,28],36:[2,28],40:[2,28],42:[2,28]},{18:[2,29],24:[2,29],32:[2,29],33:[2,29],34:[2,29],35:[2,29],36:[2,29],40:[2,29],42:[2,29]},{18:[2,30],24:[2,30],32:[2,30],33:[2,30],34:[2,30],35:[2,30],36:[2,30],40:[2,30],42:[2,30]},{17:68,21:24,30:25,40:[1,28],42:[1,27],43:26},{18:[2,32],24:[2,32],36:[2,32],39:69,40:[1,70]},{18:[2,47],24:[2,47],36:[2,47],40:[2,47]},{18:[2,40],24:[2,40],32:[2,40],33:[2,40],34:[2,40],35:[2,40],36:[2,40],40:[2,40],41:[1,71],42:[2,40],44:[2,40]},{18:[2,39],24:[2,39],32:[2,39],33:[2,39],34:[2,39],35:[2,39],36:[2,39],40:[2,39],42:[2,39],44:[2,39]},{5:[2,22],14:[2,22],15:[2,22],16:[2,22],19:[2,22],20:[2,22],22:[2,22],23:[2,22],25:[2,22]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],25:[2,19]},{36:[1,72]},{18:[2,48],24:[2,48],36:[2,48],40:[2,48]},{41:[1,71]},{21:56,30:60,31:73,32:[1,57],33:[1,58],34:[1,59],35:[1,61],40:[1,28],42:[1,27],43:26},{18:[2,31],24:[2,31],32:[2,31],33:[2,31],34:[2,31],35:[2,31],36:[2,31],40:[2,31],42:[2,31]},{18:[2,33],24:[2,33],36:[2,33],40:[2,33]}],defaultActions:{3:[2,2],16:[2,1],50:[2,42]},parseError:function(a){throw new Error(a)},parse:function(a){function b(){var a;return a=c.lexer.lex()||1,"number"!=typeof a&&(a=c.symbols_[a]||a),a}var c=this,d=[0],e=[null],f=[],g=this.table,h="",i=0,j=0,k=0;this.lexer.setInput(a),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var l=this.lexer.yylloc;f.push(l);var m=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var n,o,p,q,r,s,t,u,v,w={};;){if(p=d[d.length-1],this.defaultActions[p]?q=this.defaultActions[p]:((null===n||"undefined"==typeof n)&&(n=b()),q=g[p]&&g[p][n]),"undefined"==typeof q||!q.length||!q[0]){var x="";if(!k){v=[];for(s in g[p]){this.terminals_[s]&&s>2&&v.push("'"+this.terminals_[s]+"'")}x=this.lexer.showPosition?"Parse error on line "+(i+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+v.join(", ")+", got '"+(this.terminals_[n]||n)+"'":"Parse error on line "+(i+1)+": Unexpected "+(1==n?"end of input":"'"+(this.terminals_[n]||n)+"'"),this.parseError(x,{text:this.lexer.match,token:this.terminals_[n]||n,line:this.lexer.yylineno,loc:l,expected:v})}}if(q[0] instanceof Array&&q.length>1){throw new Error("Parse Error: multiple actions possible at state: "+p+", token: "+n)}switch(q[0]){case 1:d.push(n),e.push(this.lexer.yytext),f.push(this.lexer.yylloc),d.push(q[1]),n=null,o?(n=o,o=null):(j=this.lexer.yyleng,h=this.lexer.yytext,i=this.lexer.yylineno,l=this.lexer.yylloc,k>0&&k--);break;case 2:if(t=this.productions_[q[1]][1],w.$=e[e.length-t],w._$={first_line:f[f.length-(t||1)].first_line,last_line:f[f.length-1].last_line,first_column:f[f.length-(t||1)].first_column,last_column:f[f.length-1].last_column},m&&(w._$.range=[f[f.length-(t||1)].range[0],f[f.length-1].range[1]]),r=this.performAction.call(w,h,j,i,this.yy,q[1],e,f),"undefined"!=typeof r){return r}t&&(d=d.slice(0,-1*t*2),e=e.slice(0,-1*t),f=f.slice(0,-1*t)),d.push(this.productions_[q[1]][0]),e.push(w.$),f.push(w._$),u=g[d[d.length-2]][d[d.length-1]],d.push(u);break;case 3:return !0}}return !0}},d=function(){var a={EOF:1,parseError:function(a,b){if(!this.yy.parser){throw new Error(a)}this.yy.parser.parseError(a,b)},setInput:function(a){return this._input=a,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var a=this._input[0];this.yytext+=a,this.yyleng++,this.offset++,this.match+=a,this.matched+=a;var b=a.match(/(?:\r\n?|\n).*/g);return b?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),a},unput:function(a){var b=a.length,c=a.split(/(?:\r\n?|\n)/g);this._input=a+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-b-1),this.offset-=b;var d=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),c.length-1&&(this.yylineno-=c.length-1);var e=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===d.length?this.yylloc.first_column:0)+d[d.length-c.length].length-c[0].length:this.yylloc.first_column-b},this.options.ranges&&(this.yylloc.range=[e[0],e[0]+this.yyleng-b]),this},more:function(){return this._more=!0,this},less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(a.length>20?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;return a.length<20&&(a+=this._input.substr(0,20-a.length)),(a.substr(0,20)+(a.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=new Array(a.length+1).join("-");return a+this.upcomingInput()+"\n"+b+"^"},next:function(){if(this.done){return this.EOF}this._input||(this.done=!0);var a,b,c,d,e;this._more||(this.yytext="",this.match="");for(var f=this._currentRules(),g=0;g<f.length&&(c=this._input.match(this.rules[f[g]]),!c||b&&!(c[0].length>b[0].length)||(b=c,d=g,this.options.flex));g++){}return b?(e=b[0].match(/(?:\r\n?|\n).*/g),e&&(this.yylineno+=e.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:e?e[e.length-1].length-e[e.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+b[0].length},this.yytext+=b[0],this.match+=b[0],this.matches=b,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(b[0].length),this.matched+=b[0],a=this.performAction.call(this,this.yy,this,f[d],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),a?a:void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return"undefined"!=typeof a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(a){this.begin(a)}};return a.options={},a.performAction=function(a,b,c,d){function e(a,c){return b.yytext=b.yytext.substr(a,b.yyleng-c)}switch(c){case 0:if("\\\\"===b.yytext.slice(-2)?(e(0,1),this.begin("mu")):"\\"===b.yytext.slice(-1)?(e(0,1),this.begin("emu")):this.begin("mu"),b.yytext){return 14}break;case 1:return 14;case 2:return this.popState(),14;case 3:return e(0,4),this.popState(),15;case 4:return 35;case 5:return 36;case 6:return 25;case 7:return 16;case 8:return 20;case 9:return 19;case 10:return 19;case 11:return 23;case 12:return 22;case 13:this.popState(),this.begin("com");break;case 14:return e(3,5),this.popState(),15;case 15:return 22;case 16:return 41;case 17:return 40;case 18:return 40;case 19:return 44;case 20:break;case 21:return this.popState(),24;case 22:return this.popState(),18;case 23:return b.yytext=e(1,2).replace(/\\"/g,'"'),32;case 24:return b.yytext=e(1,2).replace(/\\'/g,"'"),32;case 25:return 42;case 26:return 34;case 27:return 34;case 28:return 33;case 29:return 40;case 30:return b.yytext=e(1,2),40;case 31:return"INVALID";case 32:return 5}},a.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{(~)?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:-?[0-9]+(?=([~}\s)])))/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)]))))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/],a.conditions={mu:{rules:[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[3],inclusive:!1},INITIAL:{rules:[0,1,32],inclusive:!0}},a}();return c.lexer=d,b.prototype=c,c.Parser=b,new b}();return a=b}(),i=function(a,b){function c(a){return a.constructor===f.ProgramNode?a:(e.yy=f,e.parse(a))}var d={},e=a,f=b;return d.parser=e,d.parse=c,d}(h,g),j=function(a){function b(){}function c(a,b,c){if(null==a||"string"!=typeof a&&a.constructor!==c.AST.ProgramNode){throw new f("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+a)}b=b||{},"data" in b||(b.data=!0);var d=c.parse(a),e=(new c.Compiler).compile(d,b);return(new c.JavaScriptCompiler).compile(e,b)}function d(a,b,c){function d(){var d=c.parse(a),e=(new c.Compiler).compile(d,b),f=(new c.JavaScriptCompiler).compile(e,b,void 0,!0);return c.template(f)}if(null==a||"string"!=typeof a&&a.constructor!==c.AST.ProgramNode){throw new f("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+a)}b=b||{},"data" in b||(b.data=!0);var e;return function(a,b){return e||(e=d()),e.call(this,a,b)}}var e={},f=a;return e.Compiler=b,b.prototype={compiler:b,disassemble:function(){for(var a,b,c,d=this.opcodes,e=[],f=0,g=d.length;g>f;f++){if(a=d[f],"DECLARE"===a.opcode){e.push("DECLARE "+a.name+"="+a.value)}else{b=[];for(var h=0;h<a.args.length;h++){c=a.args[h],"string"==typeof c&&(c='"'+c.replace("\n","\\n")+'"'),b.push(c)}e.push(a.opcode+" "+b.join(" "))}}return e.join("\n")},equals:function(a){var b=this.opcodes.length;if(a.opcodes.length!==b){return !1}for(var c=0;b>c;c++){var d=this.opcodes[c],e=a.opcodes[c];if(d.opcode!==e.opcode||d.args.length!==e.args.length){return !1}for(var f=0;f<d.args.length;f++){if(d.args[f]!==e.args[f]){return !1}}}if(b=this.children.length,a.children.length!==b){return !1}for(c=0;b>c;c++){if(!this.children[c].equals(a.children[c])){return !1}}return !0},guid:0,compile:function(a,b){this.opcodes=[],this.children=[],this.depths={list:[]},this.options=b;var c=this.options.knownHelpers;if(this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0},c){for(var d in c){this.options.knownHelpers[d]=c[d]}}return this.accept(a)},accept:function(a){var b,c=a.strip||{};return c.left&&this.opcode("strip"),b=this[a.type](a),c.right&&this.opcode("strip"),b},program:function(a){for(var b=a.statements,c=0,d=b.length;d>c;c++){this.accept(b[c])}return this.isSimple=1===d,this.depths.list=this.depths.list.sort(function(a,b){return a-b}),this},compileProgram:function(a){var b,c=(new this.compiler).compile(a,this.options),d=this.guid++;this.usePartial=this.usePartial||c.usePartial,this.children[d]=c;for(var e=0,f=c.depths.list.length;f>e;e++){b=c.depths.list[e],2>b||this.addDepth(b-1)}return d},block:function(a){var b=a.mustache,c=a.program,d=a.inverse;c&&(c=this.compileProgram(c)),d&&(d=this.compileProgram(d));var e=b.sexpr,f=this.classifySexpr(e);"helper"===f?this.helperSexpr(e,c,d):"simple"===f?(this.simpleSexpr(e),this.opcode("pushProgram",c),this.opcode("pushProgram",d),this.opcode("emptyHash"),this.opcode("blockValue")):(this.ambiguousSexpr(e,c,d),this.opcode("pushProgram",c),this.opcode("pushProgram",d),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},hash:function(a){var b,c,d=a.pairs;this.opcode("pushHash");for(var e=0,f=d.length;f>e;e++){b=d[e],c=b[1],this.options.stringParams?(c.depth&&this.addDepth(c.depth),this.opcode("getContext",c.depth||0),this.opcode("pushStringParam",c.stringModeValue,c.type),"sexpr"===c.type&&this.sexpr(c)):this.accept(c),this.opcode("assignToHash",b[0])}this.opcode("popHash")},partial:function(a){var b=a.partialName;this.usePartial=!0,a.context?this.ID(a.context):this.opcode("push","depth0"),this.opcode("invokePartial",b.name),this.opcode("append")},content:function(a){this.opcode("appendContent",a.string)},mustache:function(a){this.sexpr(a.sexpr),a.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ambiguousSexpr:function(a,b,c){var d=a.id,e=d.parts[0],f=null!=b||null!=c;this.opcode("getContext",d.depth),this.opcode("pushProgram",b),this.opcode("pushProgram",c),this.opcode("invokeAmbiguous",e,f)},simpleSexpr:function(a){var b=a.id;"DATA"===b.type?this.DATA(b):b.parts.length?this.ID(b):(this.addDepth(b.depth),this.opcode("getContext",b.depth),this.opcode("pushContext")),this.opcode("resolvePossibleLambda")},helperSexpr:function(a,b,c){var d=this.setupFullMustacheParams(a,b,c),e=a.id.parts[0];if(this.options.knownHelpers[e]){this.opcode("invokeKnownHelper",d.length,e)}else{if(this.options.knownHelpersOnly){throw new f("You specified knownHelpersOnly, but used the unknown helper "+e,a)}this.opcode("invokeHelper",d.length,e,a.isRoot)}},sexpr:function(a){var b=this.classifySexpr(a);"simple"===b?this.simpleSexpr(a):"helper"===b?this.helperSexpr(a):this.ambiguousSexpr(a)},ID:function(a){this.addDepth(a.depth),this.opcode("getContext",a.depth);var b=a.parts[0];b?this.opcode("lookupOnContext",a.parts[0]):this.opcode("pushContext");for(var c=1,d=a.parts.length;d>c;c++){this.opcode("lookup",a.parts[c])}},DATA:function(a){if(this.options.data=!0,a.id.isScoped||a.id.depth){throw new f("Scoped data references are not supported: "+a.original,a)}this.opcode("lookupData");for(var b=a.id.parts,c=0,d=b.length;d>c;c++){this.opcode("lookup",b[c])}},STRING:function(a){this.opcode("pushString",a.string)},INTEGER:function(a){this.opcode("pushLiteral",a.integer)},BOOLEAN:function(a){this.opcode("pushLiteral",a.bool)},comment:function(){},opcode:function(a){this.opcodes.push({opcode:a,args:[].slice.call(arguments,1)})},declare:function(a,b){this.opcodes.push({opcode:"DECLARE",name:a,value:b})},addDepth:function(a){0!==a&&(this.depths[a]||(this.depths[a]=!0,this.depths.list.push(a)))},classifySexpr:function(a){var b=a.isHelper,c=a.eligibleHelper,d=this.options;if(c&&!b){var e=a.id.parts[0];d.knownHelpers[e]?b=!0:d.knownHelpersOnly&&(c=!1)}return b?"helper":c?"ambiguous":"simple"},pushParams:function(a){for(var b,c=a.length;c--;){b=a[c],this.options.stringParams?(b.depth&&this.addDepth(b.depth),this.opcode("getContext",b.depth||0),this.opcode("pushStringParam",b.stringModeValue,b.type),"sexpr"===b.type&&this.sexpr(b)):this[b.type](b)}},setupFullMustacheParams:function(a,b,c){var d=a.params;return this.pushParams(d),this.opcode("pushProgram",b),this.opcode("pushProgram",c),a.hash?this.hash(a.hash):this.opcode("emptyHash"),d}},e.precompile=c,e.compile=d,e}(c),k=function(a,b){function c(a){this.value=a}function d(){}var e,f=a.COMPILER_REVISION,g=a.REVISION_CHANGES,h=a.log,i=b;d.prototype={nameLookup:function(a,b){var c,e;return 0===a.indexOf("depth")&&(c=!0),e=/^[0-9]+$/.test(b)?a+"["+b+"]":d.isValidJavaScriptVariableName(b)?a+"."+b:a+"['"+b+"']",c?"("+a+" && "+e+")":e},compilerInfo:function(){var a=f,b=g[a];return"this.compilerInfo = ["+a+",'"+b+"'];\n"},appendToBuffer:function(a){return this.environment.isSimple?"return "+a+";":{appendToBuffer:!0,content:a,toString:function(){return"buffer += "+a+";"}}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(a,b,c,d){this.environment=a,this.options=b||{},h("debug",this.environment.disassemble()+"\n\n"),this.name=this.environment.name,this.isChild=!!c,this.context=c||{programs:[],environments:[],aliases:{}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.compileChildren(a,b);var e,f=a.opcodes;this.i=0;for(var g=f.length;this.i<g;this.i++){e=f[this.i],"DECLARE"===e.opcode?this[e.name]=e.value:this[e.opcode].apply(this,e.args),e.opcode!==this.stripNext&&(this.stripNext=!1)}if(this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length){throw new i("Compile completed with content left on stack")}return this.createFunctionContext(d)},preamble:function(){var a=[];if(this.isChild){a.push("")}else{var b=this.namespace,c="helpers = this.merge(helpers, "+b+".helpers);";this.environment.usePartial&&(c=c+" partials = this.merge(partials, "+b+".partials);"),this.options.data&&(c+=" data = data || {};"),a.push(c)}this.environment.isSimple?a.push(""):a.push(", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=a},createFunctionContext:function(a){var b=this.stackVars.concat(this.registers.list);if(b.length>0&&(this.source[1]=this.source[1]+", "+b.join(", ")),!this.isChild){for(var c in this.context.aliases){this.context.aliases.hasOwnProperty(c)&&(this.source[1]=this.source[1]+", "+c+"="+this.context.aliases[c])}}this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.environment.isSimple||this.pushSource("return buffer;");for(var d=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"],e=0,f=this.environment.depths.list.length;f>e;e++){d.push("depth"+this.environment.depths.list[e])}var g=this.mergeSource();if(this.isChild||(g=this.compilerInfo()+g),a){return d.push(g),Function.apply(this,d)}var i="function "+(this.name||"")+"("+d.join(",")+") {\n  "+g+"}";return h("debug",i+"\n\n"),i},mergeSource:function(){for(var a,b="",c=0,d=this.source.length;d>c;c++){var e=this.source[c];e.appendToBuffer?a=a?a+"\n    + "+e.content:e.content:(a&&(b+="buffer += "+a+";\n  ",a=void 0),b+=e+"\n  ")}return b},blockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var a=["depth0"];this.setupParams(0,a),this.replaceStack(function(b){return a.splice(1,0,b),"blockHelperMissing.call("+a.join(", ")+")"})},ambiguousBlockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var a=["depth0"];this.setupParams(0,a);var b=this.topStack();a.splice(1,0,b),this.pushSource("if (!"+this.lastHelper+") { "+b+" = blockHelperMissing.call("+a.join(", ")+"); }")},appendContent:function(a){this.pendingContent&&(a=this.pendingContent+a),this.stripNext&&(a=a.replace(/^\s+/,"")),this.pendingContent=a},strip:function(){this.pendingContent&&(this.pendingContent=this.pendingContent.replace(/\s+$/,"")),this.stripNext="strip"},append:function(){this.flushInline();var a=this.popStack();this.pushSource("if("+a+" || "+a+" === 0) { "+this.appendToBuffer(a)+" }"),this.environment.isSimple&&this.pushSource("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){this.context.aliases.escapeExpression="this.escapeExpression",this.pushSource(this.appendToBuffer("escapeExpression("+this.popStack()+")"))},getContext:function(a){this.lastContext!==a&&(this.lastContext=a)},lookupOnContext:function(a){this.push(this.nameLookup("depth"+this.lastContext,a,"context"))},pushContext:function(){this.pushStackLiteral("depth"+this.lastContext)},resolvePossibleLambda:function(){this.context.aliases.functionType='"function"',this.replaceStack(function(a){return"typeof "+a+" === functionType ? "+a+".apply(depth0) : "+a})},lookup:function(a){this.replaceStack(function(b){return b+" == null || "+b+" === false ? "+b+" : "+this.nameLookup(b,a,"context")})},lookupData:function(){this.pushStackLiteral("data")},pushStringParam:function(a,b){this.pushStackLiteral("depth"+this.lastContext),this.pushString(b),"sexpr"!==b&&("string"==typeof a?this.pushString(a):this.pushStackLiteral(a))},emptyHash:function(){this.pushStackLiteral("{}"),this.options.stringParams&&(this.push("{}"),this.push("{}"))},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:[],types:[],contexts:[]}},popHash:function(){var a=this.hash;this.hash=this.hashes.pop(),this.options.stringParams&&(this.push("{"+a.contexts.join(",")+"}"),this.push("{"+a.types.join(",")+"}")),this.push("{\n    "+a.values.join(",\n    ")+"\n  }")},pushString:function(a){this.pushStackLiteral(this.quotedString(a))},push:function(a){return this.inlineStack.push(a),a},pushLiteral:function(a){this.pushStackLiteral(a)},pushProgram:function(a){null!=a?this.pushStackLiteral(this.programExpression(a)):this.pushStackLiteral(null)},invokeHelper:function(a,b,c){this.context.aliases.helperMissing="helpers.helperMissing",this.useRegister("helper");var d=this.lastHelper=this.setupHelper(a,b,!0),e=this.nameLookup("depth"+this.lastContext,b,"context"),f="helper = "+d.name+" || "+e;d.paramsInit&&(f+=","+d.paramsInit),this.push("("+f+",helper ? helper.call("+d.callParams+") : helperMissing.call("+d.helperMissingParams+"))"),c||this.flushInline()},invokeKnownHelper:function(a,b){var c=this.setupHelper(a,b);this.push(c.name+".call("+c.callParams+")")},invokeAmbiguous:function(a,b){this.context.aliases.functionType='"function"',this.useRegister("helper"),this.emptyHash();var c=this.setupHelper(0,a,b),d=this.lastHelper=this.nameLookup("helpers",a,"helper"),e=this.nameLookup("depth"+this.lastContext,a,"context"),f=this.nextStack();c.paramsInit&&this.pushSource(c.paramsInit),this.pushSource("if (helper = "+d+") { "+f+" = helper.call("+c.callParams+"); }"),this.pushSource("else { helper = "+e+"; "+f+" = typeof helper === functionType ? helper.call("+c.callParams+") : helper; }")},invokePartial:function(a){var b=[this.nameLookup("partials",a,"partial"),"'"+a+"'",this.popStack(),"helpers","partials"];this.options.data&&b.push("data"),this.context.aliases.self="this",this.push("self.invokePartial("+b.join(", ")+")")},assignToHash:function(a){var b,c,d=this.popStack();this.options.stringParams&&(c=this.popStack(),b=this.popStack());var e=this.hash;b&&e.contexts.push("'"+a+"': "+b),c&&e.types.push("'"+a+"': "+c),e.values.push("'"+a+"': ("+d+")")},compiler:d,compileChildren:function(a,b){for(var c,d,e=a.children,f=0,g=e.length;g>f;f++){c=e[f],d=new this.compiler;var h=this.matchExistingProgram(c);null==h?(this.context.programs.push(""),h=this.context.programs.length,c.index=h,c.name="program"+h,this.context.programs[h]=d.compile(c,b,this.context),this.context.environments[h]=c):(c.index=h,c.name="program"+h)}},matchExistingProgram:function(a){for(var b=0,c=this.context.environments.length;c>b;b++){var d=this.context.environments[b];if(d&&d.equals(a)){return b}}},programExpression:function(a){if(this.context.aliases.self="this",null==a){return"self.noop"}for(var b,c=this.environment.children[a],d=c.depths.list,e=[c.index,c.name,"data"],f=0,g=d.length;g>f;f++){b=d[f],1===b?e.push("depth0"):e.push("depth"+(b-1))}return(0===d.length?"self.program(":"self.programWithDepth(")+e.join(", ")+")"},register:function(a,b){this.useRegister(a),this.pushSource(a+" = "+b+";")},useRegister:function(a){this.registers[a]||(this.registers[a]=!0,this.registers.list.push(a))},pushStackLiteral:function(a){return this.push(new c(a))},pushSource:function(a){this.pendingContent&&(this.source.push(this.appendToBuffer(this.quotedString(this.pendingContent))),this.pendingContent=void 0),a&&this.source.push(a)},pushStack:function(a){this.flushInline();var b=this.incrStack();return a&&this.pushSource(b+" = "+a+";"),this.compileStack.push(b),b},replaceStack:function(a){var b,d,e,f="",g=this.isInline();if(g){var h=this.popStack(!0);if(h instanceof c){b=h.value,e=!0}else{d=!this.stackSlot;var i=d?this.incrStack():this.topStackName();f="("+this.push(i)+" = "+h+"),",b=this.topStack()}}else{b=this.topStack()}var j=a.call(this,b);return g?(e||this.popStack(),d&&this.stackSlot--,this.push("("+f+j+")")):(/^stack/.test(b)||(b=this.nextStack()),this.pushSource(b+" = ("+f+j+");")),b},nextStack:function(){return this.pushStack()},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var a=this.inlineStack;if(a.length){this.inlineStack=[];for(var b=0,d=a.length;d>b;b++){var e=a[b];e instanceof c?this.compileStack.push(e):this.pushStack(e)}}},isInline:function(){return this.inlineStack.length},popStack:function(a){var b=this.isInline(),d=(b?this.inlineStack:this.compileStack).pop();if(!a&&d instanceof c){return d.value}if(!b){if(!this.stackSlot){throw new i("Invalid stack pop")}this.stackSlot--}return d},topStack:function(a){var b=this.isInline()?this.inlineStack:this.compileStack,d=b[b.length-1];return !a&&d instanceof c?d.value:d},quotedString:function(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},setupHelper:function(a,b,c){var d=[],e=this.setupParams(a,d,c),f=this.nameLookup("helpers",b,"helper");return{params:d,paramsInit:e,name:f,callParams:["depth0"].concat(d).join(", "),helperMissingParams:c&&["depth0",this.quotedString(b)].concat(d).join(", ")}},setupOptions:function(a,b){var c,d,e,f=[],g=[],h=[];f.push("hash:"+this.popStack()),this.options.stringParams&&(f.push("hashTypes:"+this.popStack()),f.push("hashContexts:"+this.popStack())),d=this.popStack(),e=this.popStack(),(e||d)&&(e||(this.context.aliases.self="this",e="self.noop"),d||(this.context.aliases.self="this",d="self.noop"),f.push("inverse:"+d),f.push("fn:"+e));for(var i=0;a>i;i++){c=this.popStack(),b.push(c),this.options.stringParams&&(h.push(this.popStack()),g.push(this.popStack()))}return this.options.stringParams&&(f.push("contexts:["+g.join(",")+"]"),f.push("types:["+h.join(",")+"]")),this.options.data&&f.push("data:data"),f},setupParams:function(a,b,c){var d="{"+this.setupOptions(a,b).join(",")+"}";return c?(this.useRegister("options"),b.push("options"),"options="+d):(b.push(d),"")}};for(var j="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),k=d.RESERVED_WORDS={},l=0,m=j.length;m>l;l++){k[j[l]]=!0}return d.isValidJavaScriptVariableName=function(a){return !d.RESERVED_WORDS[a]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(a)?!0:!1},e=d}(d,c),l=function(a,b,c,d,e){var f,g=a,h=b,i=c.parser,j=c.parse,k=d.Compiler,l=d.compile,m=d.precompile,n=e,o=g.create,p=function(){var a=o();return a.compile=function(b,c){return l(b,c,a)},a.precompile=function(b,c){return m(b,c,a)},a.AST=h,a.Compiler=k,a.JavaScriptCompiler=n,a.Parser=i,a.parse=j,a};return g=p(),g.create=p,f=g}(f,g,i,j,k);return l}();
/*!!
 *  Canvas 2 Svg v1.0.4
 *  A low level canvas to SVG converter. Uses a mock canvas context to build an SVG document.
 *
 *  Licensed under the MIT license:
 *  http://www.opensource.org/licenses/mit-license.php
 *
 *  Author:
 *  Kerry Liu
 *
 *  Copyright (c) 2014 Gliffy Inc.
 */
(function(){var STYLES,ctx,CanvasGradient,CanvasPattern,namedEntities;function format(str,args){var keys=Object.keys(args),i;for(i=0;i<keys.length;i++){str=str.replace(new RegExp("\\{"+keys[i]+"\\}","gi"),args[keys[i]])}return str}function randomString(holder){var chars,randomstring,i;if(!holder){throw new Error("cannot create a random attribute name for an undefined object")}chars="ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";randomstring="";do{randomstring="";for(i=0;i<12;i++){randomstring+=chars[Math.floor(Math.random()*chars.length)]}}while(holder[randomstring]);return randomstring}function createNamedToNumberedLookup(items,radix){var i,entity,lookup={},base10,base16;items=items.split(",");radix=radix||10;for(i=0;i<items.length;i+=2){entity="&"+items[i+1]+";";base10=parseInt(items[i],radix);lookup[entity]="&#"+base10+";"}lookup["\\xa0"]="&#160;";return lookup}namedEntities=createNamedToNumberedLookup("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32);STYLES={strokeStyle:{svgAttr:"stroke",canvas:"#000000",svg:"none",apply:"stroke"},fillStyle:{svgAttr:"fill",canvas:"#000000",svg:null,apply:"fill"},lineCap:{svgAttr:"stroke-linecap",canvas:"butt",svg:"butt",apply:"stroke"},lineJoin:{svgAttr:"stroke-linejoin",canvas:"miter",svg:"miter",apply:"stroke"},miterLimit:{svgAttr:"stroke-miterlimit",canvas:10,svg:4,apply:"stroke"},lineWidth:{svgAttr:"stroke-width",canvas:1,svg:1,apply:"stroke"},globalAlpha:{svgAttr:"opacity",canvas:1,svg:1,apply:"fill stroke"},font:{canvas:"10px sans-serif"},shadowColor:{canvas:"#000000"},shadowOffsetX:{canvas:0},shadowOffsetY:{canvas:0},shadowBlur:{canvas:0},textAlign:{canvas:"start"},textBaseline:{canvas:"alphabetic"}};CanvasGradient=function(gradientNode){this.__root=gradientNode};CanvasGradient.prototype.addColorStop=function(offset,color){var stop=document.createElementNS("http://www.w3.org/2000/svg","stop"),regex,matches;stop.setAttribute("offset",offset);if(color.indexOf("rgba")!==-1){regex=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi;matches=regex.exec(color);stop.setAttribute("stop-color",format("rgb({r},{g},{b})",{r:matches[1],g:matches[2],b:matches[3]}));stop.setAttribute("stop-opacity",matches[4])}else{stop.setAttribute("stop-color",color)}this.__root.appendChild(stop)};CanvasPattern=function(pattern,ctx){this.__root=pattern;this.__ctx=ctx};ctx=function(o){var defaultOptions={width:500,height:500,enableMirroring:false},options;if(arguments.length>1){options=defaultOptions;options.width=arguments[0];options.height=arguments[1]}else{if(!o){options=defaultOptions}else{options=o}}if(!(this instanceof ctx)){return new ctx(options)}this.width=options.width||defaultOptions.width;this.height=options.height||defaultOptions.height;this.enableMirroring=options.enableMirroring!==undefined?options.enableMirroring:defaultOptions.enableMirroring;this.canvas=this;this.__canvas=document.createElement("canvas");this.__ctx=this.__canvas.getContext("2d");this.__setDefaultStyles();this.__stack=[this.__getStyleState()];this.__groupStack=[];this.__root=document.createElementNS("http://www.w3.org/2000/svg","svg");this.__root.setAttribute("version",1.1);this.__root.setAttribute("xmlns","http://www.w3.org/2000/svg");this.__root.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink");this.__root.setAttribute("width",this.width);this.__root.setAttribute("height",this.height);this.__ids={};this.__defs=document.createElementNS("http://www.w3.org/2000/svg","defs");this.__root.appendChild(this.__defs);this.__currentElement=document.createElementNS("http://www.w3.org/2000/svg","g");this.__root.appendChild(this.__currentElement)};ctx.prototype.__createElement=function(elementName,properties,resetFill){var element=document.createElementNS("http://www.w3.org/2000/svg",elementName),keys=Object.keys(properties),i,key;if(resetFill){element.setAttribute("fill","none");element.setAttribute("stroke","none")}for(i=0;i<keys.length;i++){key=keys[i];element.setAttribute(key,properties[key])}return element};ctx.prototype.__setDefaultStyles=function(){var keys=Object.keys(STYLES),i,key;for(i=0;i<keys.length;i++){key=keys[i];this[key]=STYLES[key].canvas}};ctx.prototype.__applyStyleState=function(styleState){var keys=Object.keys(styleState),i,key;for(i=0;i<keys.length;i++){key=keys[i];this[key]=styleState[key]}};ctx.prototype.__getStyleState=function(){var i,styleState={},keys=Object.keys(STYLES),key;for(i=0;i<keys.length;i++){key=keys[i];styleState[key]=this[key]}return styleState};ctx.prototype.__applyStyleToCurrentElement=function(type){var keys=Object.keys(STYLES),i,j,element,style,value,id,regex,matches;for(i=0;i<keys.length;i++){style=STYLES[keys[i]];value=this[keys[i]];if(style.apply){if(style.apply.indexOf("fill")!==-1&&value instanceof CanvasPattern){if(value.__ctx){for(j=0;j<value.__ctx.__defs.childNodes.length;j++){id=value.__ctx.__defs.childNodes[0].getAttribute("id");this.__ids[id]=id;element=value.__ctx.__defs.childNodes[j];element.setAttribute("patternUnits","userSpaceOnUse");this.__defs.appendChild(element)}}this.__currentElement.setAttribute("fill",format("url(#{id})",{id:value.__root.getAttribute("id")}))}else{if(style.apply.indexOf("fill")!==-1&&value instanceof CanvasGradient){this.__currentElement.setAttribute("fill",format("url(#{id})",{id:value.__root.getAttribute("id")}))}else{if(style.apply.indexOf(type)!==-1&&style.svg!==value){if((style.svgAttr==="stroke"||style.svgAttr==="fill")&&value.indexOf("rgba")!==-1){regex=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi;matches=regex.exec(value);this.__currentElement.setAttribute(style.svgAttr,format("rgb({r},{g},{b})",{r:matches[1],g:matches[2],b:matches[3]}));this.__currentElement.setAttribute(style.svgAttr+"-opacity",matches[4])}else{this.__currentElement.setAttribute(style.svgAttr,value)}}}}}}};ctx.prototype.__closestGroupOrSvg=function(node){node=node||this.__currentElement;if(node.nodeName==="g"||node.nodeName==="svg"){return node}else{return this.__closestGroupOrSvg(node.parentNode)}};ctx.prototype.getSerializedSvg=function(fixNamedEntities){var serialized=new XMLSerializer().serializeToString(this.__root),keys,i,key,value,regexp,xmlns;xmlns=/xmlns="http:\/\/www\.w3\.org\/2000\/svg".+xmlns="http:\/\/www\.w3\.org\/2000\/svg/gi;if(xmlns.test(serialized)){serialized=serialized.replace('xmlns="http://www.w3.org/2000/svg','xmlns:xlink="http://www.w3.org/1999/xlink')}if(fixNamedEntities){keys=Object.keys(namedEntities);for(i=0;i<keys.length;i++){key=keys[i];value=namedEntities[key];regexp=new RegExp(key,"gi");if(regexp.test(serialized)){serialized=serialized.replace(regexp,value)}}}return serialized};ctx.prototype.getSvg=function(){return this.__root};ctx.prototype.save=function(){var group=document.createElementNS("http://www.w3.org/2000/svg","g"),parent=this.__closestGroupOrSvg();this.__groupStack.push(parent);parent.appendChild(group);this.__currentElement=group;this.__stack.push(this.__getStyleState())};ctx.prototype.restore=function(){this.__currentElement=this.__groupStack.pop();var state=this.__stack.pop();this.__applyStyleState(state)};ctx.prototype.__addTransform=function(t){var transform=this.__currentElement.getAttribute("transform");if(transform){transform+=" "}else{transform=""}transform+=t;this.__currentElement.setAttribute("transform",transform)};ctx.prototype.scale=function(x,y){if(y===undefined){y=x}this.__addTransform(format("scale({x},{y})",{x:x,y:y}))};ctx.prototype.rotate=function(angle){var degrees=(angle*180/Math.PI);this.__addTransform(format("rotate({angle},{cx},{cy})",{angle:degrees,cx:0,cy:0}))};ctx.prototype.translate=function(x,y){this.__addTransform(format("translate({x},{y})",{x:x,y:y}))};ctx.prototype.transform=function(a,b,c,d,e,f){this.__addTransform(format("matrix({a},{b},{c},{d},{e},{f})",{a:a,b:b,c:c,d:d,e:e,f:f}))};ctx.prototype.beginPath=function(){var path,parent,a;path=this.__createElement("path",{},true);parent=this.__closestGroupOrSvg();if(this.__pathHref){a=this.__createElement("a",{"xlink:href":this.__pathHref,target:"_blank"});parent.appendChild(a);a.appendChild(path)}else{parent.appendChild(path)}this.__currentElement=path};ctx.prototype.__addPathCommand=function(command){if(this.__currentElement.nodeName==="path"){var d=this.__currentElement.getAttribute("d");if(d){d+=" "}else{d=""}d+=command;this.__currentElement.setAttribute("d",d)}else{throw new Error("Attempted to add path command to node "+this.__currentElement.nodeName)}};ctx.prototype.moveTo=function(x,y){this.__addPathCommand(format("M {x} {y}",{x:x,y:y}))};ctx.prototype.closePath=function(){this.__addPathCommand("Z")};ctx.prototype.lineTo=function(x,y){this.__addPathCommand(format("L {x} {y}",{x:x,y:y}))};ctx.prototype.bezierCurveTo=function(cp1x,cp1y,cp2x,cp2y,x,y){this.__addPathCommand(format("C {cp1x} {cp1y} {cp2x} {cp2y} {x} {y}",{cp1x:cp1x,cp1y:cp1y,cp2x:cp2x,cp2y:cp2y,x:x,y:y}))};ctx.prototype.quadraticCurveTo=function(cpx,cpy,x,y){this.__addPathCommand(format("Q {cpx} {cpy} {x} {y}",{cpx:cpx,cpy:cpy,x:x,y:y}))};ctx.prototype.stroke=function(){this.__applyStyleToCurrentElement("stroke")};ctx.prototype.fill=function(){this.__applyStyleToCurrentElement("fill")};ctx.prototype.rect=function(x,y,width,height){if(this.__currentElement.nodeName!=="path"){this.beginPath()}this.moveTo(x,y);this.lineTo(x+width,y);this.lineTo(x+width,y+height);this.lineTo(x,y+height);this.lineTo(x,y);this.closePath()};ctx.prototype.fillRect=function(x,y,width,height){var rect,parent;rect=this.__createElement("rect",{x:x,y:y,width:width,height:height},true);parent=this.__closestGroupOrSvg();parent.appendChild(rect);this.__currentElement=rect;this.__applyStyleToCurrentElement("fill")};ctx.prototype.strokeRect=function(x,y,width,height){var rect,parent;rect=this.__createElement("rect",{x:x,y:y,width:width,height:height},true);parent=this.__closestGroupOrSvg();parent.appendChild(rect);this.__currentElement=rect;this.__applyStyleToCurrentElement("stroke")};ctx.prototype.clearRect=function(x,y,width,height){var rect,parent=this.__closestGroupOrSvg();rect=this.__createElement("rect",{x:x,y:y,width:width,height:height,fill:"#FFFFFF"},true);parent.appendChild(rect)};ctx.prototype.createLinearGradient=function(x1,y1,x2,y2){var grad=this.__createElement("linearGradient",{id:randomString(this.__ids),x1:x1+"px",x2:x2+"px",y1:y1+"px",y2:y2+"px",gradientUnits:"userSpaceOnUse"},false);this.__defs.appendChild(grad);return new CanvasGradient(grad)};ctx.prototype.createRadialGradient=function(x0,y0,r0,x1,y1,r1){var grad=this.__createElement("radialGradient",{id:randomString(this.__ids),cx:x1+"px",cy:y1+"px",r:r1+"px",fx:x0+"px",fy:y0+"px",gradientUnits:"userSpaceOnUse"},false);this.__defs.appendChild(grad);return new CanvasGradient(grad)};ctx.prototype.__parseFont=function(){var font=this.font,parts,token,index=0,data={style:"normal",size:"10px",height:"normal",family:"sans-serif",weight:"normal",decoration:"none",href:null};var test=document.createElement("span");test.style.font=font;data.style=test.style.fontStyle;data.size=test.style.fontSize;data.family=test.style.fontFamily;data.weight=test.style.fontWeight;data.decoration=test.style.textDecoration;data.height=test.style.lineHeight;if(this.__fontUnderline==="underline"){data.decoration="underline"}if(this.__fontHref){data.href=this.__fontHref}if(this.__fontHrefTarget){data.hrefTarget=this.__fontHrefTarget}return data};ctx.prototype.__wrapTextLink=function(font,element){if(font.href){var a=document.createElementNS("http://www.w3.org/2000/svg","a");a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",font.href);if(font.hrefTarget){a.setAttribute("target",font.hrefTarget)}a.appendChild(element);return a}return element};ctx.prototype.__applyText=function(text,x,y,action){var font=this.__parseFont(),parent=this.__closestGroupOrSvg(),textElement=this.__createElement("text",{"font-family":font.family,"font-size":font.size,"font-style":font.style,"font-weight":font.weight,"text-decoration":font.decoration,"line-height":font.height,x:x,y:y},true);textElement.appendChild(document.createTextNode(text));this.__currentElement=textElement;this.__applyStyleToCurrentElement(action);parent.appendChild(this.__wrapTextLink(font,textElement))};ctx.prototype.fillText=function(text,x,y){this.__applyText(text,x,y,"fill")};ctx.prototype.strokeText=function(text,x,y){this.__applyText(text,x,y,"stroke")};ctx.prototype.measureText=function(text){return this.__ctx.measureText(text)};ctx.prototype.arc=function(x,y,radius,startAngle,endAngle,counterClockwise){startAngle=startAngle%(2*Math.PI);endAngle=endAngle%(2*Math.PI);if(startAngle===endAngle){endAngle=((endAngle+(2*Math.PI))-0.001*(counterClockwise?-1:1))%(2*Math.PI)}var endX=x+radius*Math.cos(endAngle),endY=y+radius*Math.sin(endAngle),startX=x+radius*Math.cos(startAngle),startY=y+radius*Math.sin(startAngle),sweepFlag=counterClockwise?0:1,largeArcFlag=0,diff=endAngle-startAngle;if(diff<0){diff+=2*Math.PI}if(counterClockwise){largeArcFlag=diff>Math.PI?0:1}else{largeArcFlag=diff>Math.PI?1:0}this.moveTo(startX,startY);this.__addPathCommand(format("A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}",{rx:radius,ry:radius,xAxisRotation:0,largeArcFlag:largeArcFlag,sweepFlag:sweepFlag,endX:endX,endY:endY}))};ctx.prototype.clip=function(){var group=this.__closestGroupOrSvg(),clipPath=document.createElementNS("http://www.w3.org/2000/svg","clipPath"),id=randomString(this.__ids),newGroup=document.createElementNS("http://www.w3.org/2000/svg","g");try{group.removeChild(this.__currentElement)}catch(err){}clipPath.setAttribute("id",id);clipPath.appendChild(this.__currentElement);this.__defs.appendChild(clipPath);group.setAttribute("clip-path",format("url(#{id})",{id:id}));group.appendChild(newGroup);this.__currentElement=newGroup};ctx.prototype.drawImage=function(){var args=Array.prototype.slice.call(arguments),image=args[0],dx,dy,dw,dh,sx=0,sy=0,sw,sh,parent,svg,defs,group,currentElement,svgImage,canvas,context,id;if(args.length===3){dx=args[1];dy=args[2];sw=image.width;sh=image.height;dw=sw;dh=sh}else{if(args.length===5){dx=args[1];dy=args[2];dw=args[3];dh=args[4];sw=image.width;sh=image.height}else{if(args.length===9){sx=args[1];sy=args[2];sw=args[3];sh=args[4];dx=args[5];dy=args[6];dw=args[7];dh=args[8]}else{throw new Error("Inavlid number of arguments passed to drawImage: "+arguments.length)}}}parent=this.__closestGroupOrSvg();currentElement=this.__currentElement;if(image instanceof ctx){svg=image.getSvg();defs=svg.childNodes[0];while(defs.childNodes.length){id=defs.childNodes[0].getAttribute("id");this.__ids[id]=id;this.__defs.appendChild(defs.childNodes[0])}group=svg.childNodes[1];parent.appendChild(group);this.__currentElement=group;this.translate(dx,dy);this.__currentElement=currentElement}else{if(image.nodeName==="CANVAS"||image.nodeName==="IMG"){svgImage=document.createElementNS("http://www.w3.org/2000/svg","image");svgImage.setAttribute("width",dw);svgImage.setAttribute("height",dh);svgImage.setAttribute("preserveAspectRatio","none");if(sx||sy||sw!==image.width||sh!==image.height){canvas=document.createElement("canvas");canvas.width=dw;canvas.height=dh;context=canvas.getContext("2d");context.drawImage(image,sx,sy,sw,sh,0,0,dw,dh);image=canvas}svgImage.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",image.nodeName==="CANVAS"?image.toDataURL():image.getAttribute("src"));parent.appendChild(svgImage);if(this.__pathHref){var a=this.__createElement("a",{"xlink:href":this.__pathHref,target:"_blank"});parent.appendChild(a);a.appendChild(svgImage)}else{parent.appendChild(svgImage)}this.__currentElement=svgImage;this.translate(dx,dy);this.__currentElement=currentElement}}};ctx.prototype.createPattern=function(image,repetition){var pattern=document.createElementNS("http://www.w3.org/2000/svg","pattern"),id=randomString(this.__ids),img;pattern.setAttribute("id",id);pattern.setAttribute("width",image.width);pattern.setAttribute("height",image.height);if(image.nodeName==="CANVAS"||image.nodeName==="IMG"){img=document.createElementNS("http://www.w3.org/2000/svg","image");img.setAttribute("width",image.width);img.setAttribute("height",image.height);img.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",image.nodeName==="CANVAS"?image.toDataURL():image.getAttribute("src"));pattern.appendChild(img);this.__defs.appendChild(pattern)}else{if(image instanceof ctx){pattern.appendChild(image.__root.childNodes[1]);this.__defs.appendChild(pattern)}}return new CanvasPattern(pattern,this)};ctx.prototype.drawFocusRing=function(){};ctx.prototype.createImageData=function(){};ctx.prototype.getImageData=function(){};ctx.prototype.putImageData=function(){};ctx.prototype.globalCompositeOperation=function(){};ctx.prototype.arcTo=function(){};ctx.prototype.setTransform=function(){};window.C2S=ctx}());(function(window,document,undefined){var _html2canvas={},previousElement,computedCSS,html2canvas,cachedRectElements=[];_html2canvas.Util={};_html2canvas.Util.log=function(a){if(_html2canvas.logging&&window.console&&window.console.log){window.console.log(a)}};_html2canvas.Util.trimText=(function(isNative){return function(input){return isNative?isNative.apply(input):((input||"")+"").replace(/^\s+|\s+$/g,"")}})(String.prototype.trim);_html2canvas.Util.asFloat=function(v){return parseFloat(v)};(function(){var TEXT_SHADOW_PROPERTY=/((rgba|rgb)\([^\)]+\)(\s-?\d+px){0,})/g;var TEXT_SHADOW_VALUES=/(-?\d+px)|(#.+)|(rgb\(.+\))|(rgba\(.+\))/g;_html2canvas.Util.parseTextShadows=function(value){if(!value||value==="none"){return[]}var shadows=value.match(TEXT_SHADOW_PROPERTY),results=[];for(var i=0;shadows&&(i<shadows.length);i++){var s=shadows[i].match(TEXT_SHADOW_VALUES);results.push({color:s[0],offsetX:s[1]?s[1].replace("px",""):0,offsetY:s[2]?s[2].replace("px",""):0,blur:s[3]?s[3].replace("px",""):0})}return results}})();_html2canvas.Util.parseBackgroundImage=function(value){var whitespace=" \r\n\t",method,definition,prefix,prefix_i,block,results=[],c,mode=0,numParen=0,quote,args;var appendResult=function(){if(method){if(definition.substr(0,1)==='"'){definition=definition.substr(1,definition.length-2)}if(definition){args.push(definition)}if(method.substr(0,1)==="-"&&(prefix_i=method.indexOf("-",1)+1)>0){prefix=method.substr(0,prefix_i);method=method.substr(prefix_i)}results.push({prefix:prefix,method:method.toLowerCase(),value:block,args:args})}args=[];method=prefix=definition=block=""};appendResult();for(var i=0,ii=value.length;i<ii;i++){c=value[i];if(mode===0&&whitespace.indexOf(c)>-1){continue}switch(c){case'"':if(!quote){quote=c}else{if(quote===c){quote=null}}break;case"(":if(quote){break}else{if(mode===0){mode=1;block+=c;continue}else{numParen++}}break;case")":if(quote){break}else{if(mode===1){if(numParen===0){mode=0;block+=c;appendResult();continue}else{numParen--}}}break;case",":if(quote){break}else{if(mode===0){appendResult();continue}else{if(mode===1){if(numParen===0&&!method.match(/^url$/i)){args.push(definition);definition="";block+=c;continue}}}}break}block+=c;if(mode===0){method+=c}else{definition+=c}}appendResult();return results};_html2canvas.Util.Bounds=function(element){var clientRect,bounds={};if(element.getBoundingClientRect){if(!element.clientRect){element.clientRect=element.getBoundingClientRect();cachedRectElements.push(element)}clientRect=element.clientRect;bounds.top=clientRect.top;bounds.bottom=clientRect.bottom||(clientRect.top+clientRect.height);bounds.left=clientRect.left;bounds.width=element.offsetWidth;bounds.height=element.offsetHeight}return bounds};_html2canvas.Util.OffsetBounds=function(element){var parent=element.offsetParent?_html2canvas.Util.OffsetBounds(element.offsetParent):{top:0,left:0};return{top:element.offsetTop+parent.top,bottom:element.offsetTop+element.offsetHeight+parent.top,left:element.offsetLeft+parent.left,width:element.offsetWidth,height:element.offsetHeight}};function toPX(element,attribute,value){var rsLeft=element.runtimeStyle&&element.runtimeStyle[attribute],left,style=element.style;if(!/^-?[0-9]+\.?[0-9]*(?:px)?$/i.test(value)&&/^-?\d/.test(value)){left=style.left;if(rsLeft){element.runtimeStyle.left=element.currentStyle.left}style.left=attribute==="fontSize"?"1em":(value||0);value=style.pixelLeft+"px";style.left=left;if(rsLeft){element.runtimeStyle.left=rsLeft}}if(!/^(thin|medium|thick)$/i.test(value)){return Math.round(parseFloat(value))+"px"}return value}function asInt(val){return parseInt(val,10)}function parseBackgroundSizePosition(value,element,attribute,index){value=(value||"").split(",");value=value[index||0]||value[0]||"auto";value=_html2canvas.Util.trimText(value).split(" ");if(attribute==="backgroundSize"&&(!value[0]||value[0].match(/cover|contain|auto/))){}else{value[0]=(value[0].indexOf("%")===-1)?toPX(element,attribute+"X",value[0]):value[0];if(value[1]===undefined){if(attribute==="backgroundSize"){value[1]="auto";return value}else{value[1]=value[0]}}value[1]=(value[1].indexOf("%")===-1)?toPX(element,attribute+"Y",value[1]):value[1]}return value}_html2canvas.Util.getCSSGliffy=function(element,attribute,index){var computed=$(element).data("gliffy-computed-css"),$gmc,value;if(computed){return computed[attribute]}$gmc=$(".gliffy-mock-stage");if(previousElement!==element){computedCSS=document.defaultView.getComputedStyle(element,null);if(element.tagName.toLowerCase()==="html"||element.tagName.toLowerCase()==="body"||element===($gmc.length>0?$gmc[0]:null)||element===($gmc.parent().length>0?$gmc.parent()[0]:null)){($(element).data("gliffy-computed-css",computedCSS))}}value=computedCSS[attribute];previousElement=element;return value};_html2canvas.Util.getCSSH2C=function(element,attribute,index){if(previousElement!==element){computedCSS=document.defaultView.getComputedStyle(element,null)}var value=computedCSS[attribute];if(/^background(Size|Position)$/.test(attribute)){return parseBackgroundSizePosition(value,element,attribute,index)}else{if(/border(Top|Bottom)(Left|Right)Radius/.test(attribute)){var arr=value.split(" ");if(arr.length<=1){arr[1]=arr[0]}return arr.map(asInt)}}return value};_html2canvas.Util.resizeBounds=function(current_width,current_height,target_width,target_height,stretch_mode){var target_ratio=target_width/target_height,current_ratio=current_width/current_height,output_width,output_height;if(!stretch_mode||stretch_mode==="auto"){output_width=target_width;output_height=target_height}else{if(target_ratio<current_ratio^stretch_mode==="contain"){output_height=target_height;output_width=target_height*current_ratio}else{output_width=target_width;output_height=target_width/current_ratio}}return{width:output_width,height:output_height}};function backgroundBoundsFactory(prop,el,bounds,image,imageIndex,backgroundSize){var bgposition=_html2canvas.Util.getCSS(el,prop,imageIndex),topPos,left,percentage,val;if(bgposition.length===1){val=bgposition[0];bgposition=[];bgposition[0]=val;bgposition[1]=val}if(bgposition[0].toString().indexOf("%")!==-1){percentage=(parseFloat(bgposition[0])/100);left=bounds.width*percentage;if(prop!=="backgroundSize"){left-=(backgroundSize||image).width*percentage}}else{if(prop==="backgroundSize"){if(bgposition[0]==="auto"){left=image.width}else{if(/contain|cover/.test(bgposition[0])){var resized=_html2canvas.Util.resizeBounds(image.width,image.height,bounds.width,bounds.height,bgposition[0]);left=resized.width;topPos=resized.height}else{left=parseInt(bgposition[0],10)}}}else{left=parseInt(bgposition[0],10)}}if(bgposition[1]==="auto"){topPos=left/image.width*image.height}else{if(bgposition[1].toString().indexOf("%")!==-1){percentage=(parseFloat(bgposition[1])/100);topPos=bounds.height*percentage;if(prop!=="backgroundSize"){topPos-=(backgroundSize||image).height*percentage}}else{topPos=parseInt(bgposition[1],10)}}return[left,topPos]}_html2canvas.Util.BackgroundPosition=function(el,bounds,image,imageIndex,backgroundSize){var result=backgroundBoundsFactory("backgroundPosition",el,bounds,image,imageIndex,backgroundSize);return{left:result[0],top:result[1]}};_html2canvas.Util.BackgroundSize=function(el,bounds,image,imageIndex){var result=backgroundBoundsFactory("backgroundSize",el,bounds,image,imageIndex);return{width:result[0],height:result[1]}};_html2canvas.Util.Extend=function(options,defaults){for(var key in options){if(options.hasOwnProperty(key)){defaults[key]=options[key]}}return defaults};_html2canvas.Util.Children=function(elem){var children;try{children=(elem.nodeName&&elem.nodeName.toUpperCase()==="IFRAME")?elem.contentDocument||elem.contentWindow.document:(function(array){var ret=[];if(array!==null){(function(first,second){var i=first.length,j=0;if(typeof second.length==="number"){for(var l=second.length;j<l;j++){first[i++]=second[j]}}else{while(second[j]!==undefined){first[i++]=second[j++]}}first.length=i;return first})(ret,array)}return ret})(elem.childNodes)}catch(ex){_html2canvas.Util.log("html2canvas.Util.Children failed with exception: "+ex.message);children=[]}return children};_html2canvas.Util.isTransparent=function(backgroundColor){return(backgroundColor==="transparent"||backgroundColor==="rgba(0, 0, 0, 0)")};_html2canvas.Util.Font=(function(){var fontData={};return function(font,fontSize,doc){if(fontData[font+"-"+fontSize]!==undefined){return fontData[font+"-"+fontSize]}var container=doc.createElement("div"),img=doc.createElement("img"),span=doc.createElement("span"),sampleText="Hidden Text",baseline,middle,metricsObj;container.style.visibility="hidden";container.style.fontFamily=font;container.style.fontSize=fontSize;container.style.margin=0;container.style.padding=0;doc.body.appendChild(container);img.src="data:image/gif;base64,R0lGODlhAQABAIABAP///wAAACwAAAAAAQABAAACAkQBADs=";img.width=1;img.height=1;img.style.margin=0;img.style.padding=0;img.style.verticalAlign="baseline";span.style.fontFamily=font;span.style.fontSize=fontSize;span.style.margin=0;span.style.padding=0;span.appendChild(doc.createTextNode(sampleText));container.appendChild(span);container.appendChild(img);baseline=(img.offsetTop-span.offsetTop)+1;container.removeChild(span);container.appendChild(doc.createTextNode(sampleText));container.style.lineHeight="normal";img.style.verticalAlign="super";middle=(img.offsetTop-container.offsetTop)+1;metricsObj={baseline:baseline,lineWidth:1,middle:middle};fontData[font+"-"+fontSize]=metricsObj;doc.body.removeChild(container);return metricsObj}})();(function(){var Util=_html2canvas.Util,Generate={};_html2canvas.Generate=Generate;var reGradients=[/^(-webkit-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-gradient)\((linear|radial),\s((?:\d{1,3}%?)\s(?:\d{1,3}%?),\s(?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)\-]+)\)$/,/^(-moz-linear-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-moz-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s?([a-z\-]*)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/];Generate.parseGradient=function(css,bounds){var gradient,i,len=reGradients.length,m1,stop,m2,m2Len,step,m3,tl,tr,br,bl;for(i=0;i<len;i+=1){m1=css.match(reGradients[i]);if(m1){break}}if(m1){switch(m1[1]){case"-webkit-linear-gradient":case"-o-linear-gradient":gradient={type:"linear",x0:null,y0:null,x1:null,y1:null,colorStops:[]};m2=m1[2].match(/\w+/g);if(m2){m2Len=m2.length;for(i=0;i<m2Len;i+=1){switch(m2[i]){case"top":gradient.y0=0;gradient.y1=bounds.height;break;case"right":gradient.x0=bounds.width;gradient.x1=0;break;case"bottom":gradient.y0=bounds.height;gradient.y1=0;break;case"left":gradient.x0=0;gradient.x1=bounds.width;break}}}if(gradient.x0===null&&gradient.x1===null){gradient.x0=gradient.x1=bounds.width/2}if(gradient.y0===null&&gradient.y1===null){gradient.y0=gradient.y1=bounds.height/2}m2=m1[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g);if(m2){m2Len=m2.length;step=1/Math.max(m2Len-1,1);for(i=0;i<m2Len;i+=1){m3=m2[i].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/);if(m3[2]){stop=parseFloat(m3[2]);if(m3[3]==="%"){stop/=100}else{stop/=bounds.width}}else{stop=i*step}gradient.colorStops.push({color:m3[1],stop:stop})}}break;case"-webkit-gradient":gradient={type:m1[2]==="radial"?"circle":m1[2],x0:0,y0:0,x1:0,y1:0,colorStops:[]};m2=m1[3].match(/(\d{1,3})%?\s(\d{1,3})%?,\s(\d{1,3})%?\s(\d{1,3})%?/);if(m2){gradient.x0=(m2[1]*bounds.width)/100;gradient.y0=(m2[2]*bounds.height)/100;gradient.x1=(m2[3]*bounds.width)/100;gradient.y1=(m2[4]*bounds.height)/100}m2=m1[4].match(/((?:from|to|color-stop)\((?:[0-9\.]+,\s)?(?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)\))+/g);if(m2){m2Len=m2.length;for(i=0;i<m2Len;i+=1){m3=m2[i].match(/(from|to|color-stop)\(([0-9\.]+)?(?:,\s)?((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\)/);stop=parseFloat(m3[2]);if(m3[1]==="from"){stop=0}if(m3[1]==="to"){stop=1}gradient.colorStops.push({color:m3[3],stop:stop})}}break;case"-moz-linear-gradient":gradient={type:"linear",x0:0,y0:0,x1:0,y1:0,colorStops:[]};m2=m1[2].match(/(\d{1,3})%?\s(\d{1,3})%?/);if(m2){gradient.x0=(m2[1]*bounds.width)/100;gradient.y0=(m2[2]*bounds.height)/100;gradient.x1=bounds.width-gradient.x0;gradient.y1=bounds.height-gradient.y0}m2=m1[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}%)?)+/g);if(m2){m2Len=m2.length;step=1/Math.max(m2Len-1,1);for(i=0;i<m2Len;i+=1){m3=m2[i].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%)?/);if(m3[2]){stop=parseFloat(m3[2]);if(m3[3]){stop/=100}}else{stop=i*step}gradient.colorStops.push({color:m3[1],stop:stop})}}break;case"-webkit-radial-gradient":case"-moz-radial-gradient":case"-o-radial-gradient":gradient={type:"circle",x0:0,y0:0,x1:bounds.width,y1:bounds.height,cx:0,cy:0,rx:0,ry:0,colorStops:[]};m2=m1[2].match(/(\d{1,3})%?\s(\d{1,3})%?/);if(m2){gradient.cx=(m2[1]*bounds.width)/100;gradient.cy=(m2[2]*bounds.height)/100}m2=m1[3].match(/\w+/);m3=m1[4].match(/[a-z\-]*/);if(m2&&m3){switch(m3[0]){case"farthest-corner":case"cover":case"":tl=Math.sqrt(Math.pow(gradient.cx,2)+Math.pow(gradient.cy,2));tr=Math.sqrt(Math.pow(gradient.cx,2)+Math.pow(gradient.y1-gradient.cy,2));br=Math.sqrt(Math.pow(gradient.x1-gradient.cx,2)+Math.pow(gradient.y1-gradient.cy,2));bl=Math.sqrt(Math.pow(gradient.x1-gradient.cx,2)+Math.pow(gradient.cy,2));gradient.rx=gradient.ry=Math.max(tl,tr,br,bl);break;case"closest-corner":tl=Math.sqrt(Math.pow(gradient.cx,2)+Math.pow(gradient.cy,2));tr=Math.sqrt(Math.pow(gradient.cx,2)+Math.pow(gradient.y1-gradient.cy,2));br=Math.sqrt(Math.pow(gradient.x1-gradient.cx,2)+Math.pow(gradient.y1-gradient.cy,2));bl=Math.sqrt(Math.pow(gradient.x1-gradient.cx,2)+Math.pow(gradient.cy,2));gradient.rx=gradient.ry=Math.min(tl,tr,br,bl);break;case"farthest-side":if(m2[0]==="circle"){gradient.rx=gradient.ry=Math.max(gradient.cx,gradient.cy,gradient.x1-gradient.cx,gradient.y1-gradient.cy)}else{gradient.type=m2[0];gradient.rx=Math.max(gradient.cx,gradient.x1-gradient.cx);gradient.ry=Math.max(gradient.cy,gradient.y1-gradient.cy)}break;case"closest-side":case"contain":if(m2[0]==="circle"){gradient.rx=gradient.ry=Math.min(gradient.cx,gradient.cy,gradient.x1-gradient.cx,gradient.y1-gradient.cy)}else{gradient.type=m2[0];gradient.rx=Math.min(gradient.cx,gradient.x1-gradient.cx);gradient.ry=Math.min(gradient.cy,gradient.y1-gradient.cy)}break}}m2=m1[5].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g);if(m2){m2Len=m2.length;step=1/Math.max(m2Len-1,1);for(i=0;i<m2Len;i+=1){m3=m2[i].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/);if(m3[2]){stop=parseFloat(m3[2]);if(m3[3]==="%"){stop/=100}else{stop/=bounds.width}}else{stop=i*step}gradient.colorStops.push({color:m3[1],stop:stop})}}break}}return gradient};function addScrollStops(grad){return function(colorStop){try{grad.addColorStop(colorStop.stop,colorStop.color)}catch(e){Util.log(["failed to add color stop: ",e,"; tried to add: ",colorStop])}}}Generate.Gradient=function(src,bounds){if(bounds.width===0||bounds.height===0){return}var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),gradient,grad;canvas.width=bounds.width;canvas.height=bounds.height;gradient=_html2canvas.Generate.parseGradient(src,bounds);if(gradient){switch(gradient.type){case"linear":grad=ctx.createLinearGradient(gradient.x0,gradient.y0,gradient.x1,gradient.y1);gradient.colorStops.forEach(addScrollStops(grad));ctx.fillStyle=grad;ctx.fillRect(0,0,bounds.width,bounds.height);break;case"circle":grad=ctx.createRadialGradient(gradient.cx,gradient.cy,0,gradient.cx,gradient.cy,gradient.rx);gradient.colorStops.forEach(addScrollStops(grad));ctx.fillStyle=grad;ctx.fillRect(0,0,bounds.width,bounds.height);break;case"ellipse":var canvasRadial=document.createElement("canvas"),ctxRadial=canvasRadial.getContext("2d"),ri=Math.max(gradient.rx,gradient.ry),di=ri*2;canvasRadial.width=canvasRadial.height=di;grad=ctxRadial.createRadialGradient(gradient.rx,gradient.ry,0,gradient.rx,gradient.ry,ri);gradient.colorStops.forEach(addScrollStops(grad));ctxRadial.fillStyle=grad;ctxRadial.fillRect(0,0,di,di);ctx.fillStyle=gradient.colorStops[gradient.colorStops.length-1].color;ctx.fillRect(0,0,canvas.width,canvas.height);ctx.drawImage(canvasRadial,gradient.cx-gradient.rx,gradient.cy-gradient.ry,2*gradient.rx,2*gradient.ry);break}}return canvas};Generate.ListAlpha=function(number){var tmp="",modulus;do{modulus=number%26;tmp=String.fromCharCode((modulus)+64)+tmp;number=number/26}while((number*26)>26);return tmp};Generate.ListRoman=function(number){var romanArray=["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"],decimal=[1000,900,500,400,100,90,50,40,10,9,5,4,1],roman="",v,len=romanArray.length;if(number<=0||number>=4000){return number}for(v=0;v<len;v+=1){while(number>=decimal[v]){number-=decimal[v];roman+=romanArray[v]}}return roman}})();function h2cRenderContext(width,height){var storage=[];return{storage:storage,width:width,height:height,clip:function(){storage.push({type:"function",name:"clip","arguments":arguments})},translate:function(){storage.push({type:"function",name:"translate","arguments":arguments})},fill:function(){storage.push({type:"function",name:"fill","arguments":arguments})},save:function(){storage.push({type:"function",name:"save","arguments":arguments})},restore:function(){storage.push({type:"function",name:"restore","arguments":arguments})},fillRect:function(){storage.push({type:"function",name:"fillRect","arguments":arguments})},createPattern:function(){storage.push({type:"function",name:"createPattern","arguments":arguments})},drawShape:function(){var shape=[];storage.push({type:"function",name:"drawShape","arguments":shape});return{moveTo:function(){shape.push({name:"moveTo","arguments":arguments})},lineTo:function(){shape.push({name:"lineTo","arguments":arguments})},arcTo:function(){shape.push({name:"arcTo","arguments":arguments})},bezierCurveTo:function(){shape.push({name:"bezierCurveTo","arguments":arguments})},quadraticCurveTo:function(){shape.push({name:"quadraticCurveTo","arguments":arguments})}}},drawImage:function(){storage.push({type:"function",name:"drawImage","arguments":arguments})},fillText:function(){storage.push({type:"function",name:"fillText","arguments":arguments})},setVariable:function(variable,value){storage.push({type:"variable",name:variable,"arguments":value});return value}}}_html2canvas.cachedWidth=null,_html2canvas.cachedHeight=null;_html2canvas.Parse=function(images,options){if(!_html2canvas.options.gliffyOpt){window.scroll(0,0)}var element=((options.elements===undefined)?document.body:options.elements[0]),numDraws=0,doc=element.ownerDocument,Util=_html2canvas.Util,support=Util.Support(options,doc),ignoreElementsRegExp=new RegExp("("+options.ignoreElements+")"),body=doc.body,getCSS=Util.getCSS,pseudoHide="___html2canvas___pseudoelement",hidePseudoElements=doc.createElement("style");hidePseudoElements.innerHTML="."+pseudoHide+'-before:before { content: "" !important; display: none !important; }.'+pseudoHide+'-after:after { content: "" !important; display: none !important; }';body.appendChild(hidePseudoElements);images=images||{};var documentWidthH2C=function(){return Math.max(Math.max(doc.body.scrollWidth,doc.documentElement.scrollWidth),Math.max(doc.body.offsetWidth,doc.documentElement.offsetWidth),Math.max(doc.body.clientWidth,doc.documentElement.clientWidth))};var documentHeightH2C=function(){return Math.max(Math.max(doc.body.scrollHeight,doc.documentElement.scrollHeight),Math.max(doc.body.offsetHeight,doc.documentElement.offsetHeight),Math.max(doc.body.clientHeight,doc.documentElement.clientHeight))};var documentWidthGliffy=function(){if(_html2canvas.cachedWidth!==null){return _html2canvas.cachedWidth}var docWidth=Math.max(Math.max(doc.body.scrollWidth,doc.documentElement.scrollWidth),Math.max(doc.body.offsetWidth,doc.documentElement.offsetWidth),Math.max(doc.body.clientWidth,doc.documentElement.clientWidth));_html2canvas.cachedWidth=docWidth;return docWidth};var documentHeightGliffy=function(){if(_html2canvas.cachedHeight!==null){return _html2canvas.cachedHeight}var docHeight=Math.max(Math.max(doc.body.scrollHeight,doc.documentElement.scrollHeight),Math.max(doc.body.offsetHeight,doc.documentElement.offsetHeight),Math.max(doc.body.clientHeight,doc.documentElement.clientHeight));_html2canvas.cachedHeight=docHeight;return docHeight};var documentWidth,documentHeight;if(_html2canvas.options.gliffyOpt){documentWidth=documentWidthGliffy;documentHeight=documentHeightGliffy}else{documentWidth=documentWidthH2C;documentHeight=documentHeightH2C}function getCSSInt(element,attribute){var val=parseInt(getCSS(element,attribute),10);return(isNaN(val))?0:val}function renderRect(ctx,x,y,w,h,bgcolor){if(bgcolor!=="transparent"){ctx.setVariable("fillStyle",bgcolor);ctx.fillRect(x,y,w,h);numDraws+=1}}function capitalize(m,p1,p2){if(m.length>0){return p1+p2.toUpperCase()}}function textTransform(text,transform){switch(transform){case"lowercase":return text.toLowerCase();case"capitalize":return text.replace(/(^|\s|:|-|\(|\))([a-z])/g,capitalize);case"uppercase":return text.toUpperCase();default:return text}}function noLetterSpacing(letter_spacing){return(/^(normal|none|0px)$/.test(letter_spacing))}function drawText(currentText,x,y,ctx){if(currentText!==null&&Util.trimText(currentText).length>0){ctx.fillText(currentText,x,y);numDraws+=1}}function getLink(el){if(el.nodeName==="A"&&el.getAttribute("href")){return el.getAttribute("href")}if(el.parentElement){return getLink(el.parentElement)}return null}function setTextVariables(ctx,el,text_decoration,color){var align=false,bold=getCSS(el,"fontWeight"),family=getCSS(el,"fontFamily"),size=getCSS(el,"fontSize"),lineHeight=getCSS(el,"lineHeight"),shadows=Util.parseTextShadows(getCSS(el,"textShadow")),link=getLink(el);switch(parseInt(bold,10)){case 401:bold="bold";break;case 400:bold="normal";break}if(link){ctx.setVariable("__fontHref",link);ctx.setVariable("__fontHrefTarget","_blank")}else{ctx.setVariable("__fontHref",null);ctx.setVariable("__fontHrefTarget",null)}ctx.setVariable("fillStyle",color);family=family.replace(/\"/g,"'");if(family.indexOf("'")===-1){family="'"+family+"'"}ctx.setVariable("font",[getCSS(el,"fontStyle"),getCSS(el,"fontVariant"),bold,size+"/"+lineHeight,family].join(" "));ctx.setVariable("textAlign",(align)?"right":"left");if(shadows.length){ctx.setVariable("shadowColor",shadows[0].color);ctx.setVariable("shadowOffsetX",shadows[0].offsetX);ctx.setVariable("shadowOffsetY",shadows[0].offsetY);ctx.setVariable("shadowBlur",shadows[0].blur)}if(text_decoration!=="none"||options.useSVGTextBaseline){return Util.Font(family,size,doc)}}function renderTextDecoration(ctx,text_decoration,bounds,metrics,color){switch(text_decoration){case"underline":renderRect(ctx,bounds.left,Math.round(bounds.top+metrics.baseline+metrics.lineWidth),bounds.width,1,color);break;case"overline":renderRect(ctx,bounds.left,Math.round(bounds.top),bounds.width,1,color);break;case"line-through":renderRect(ctx,bounds.left,Math.ceil(bounds.top+metrics.middle+metrics.lineWidth),bounds.width,1,color);break}}function getTextBounds(state,text,textDecoration,isLast,transform){var bounds;if(support.rangeBounds&&!transform){if(textDecoration!=="none"||Util.trimText(text).length!==0){bounds=textRangeBounds(text,state.node,state.textOffset)}state.textOffset+=text.length}else{if(state.node&&typeof state.node.nodeValue==="string"){var newTextNode=(isLast)?state.node.splitText(text.length):null;bounds=textWrapperBounds(state.node,transform);state.node=newTextNode}}return bounds}function textRangeBounds(text,textNode,textOffset){var range=doc.createRange(),clientRectangle=null;if(range){range.setStart(textNode,textOffset);range.setEnd(textNode,textOffset+text.length);clientRectangle=range.getBoundingClientRect()}return clientRectangle}function textWrapperBounds(oldTextNode,transform){var parent=oldTextNode.parentNode,wrapElement=doc.createElement("wrapper"),backupText=oldTextNode.cloneNode(true);wrapElement.appendChild(oldTextNode.cloneNode(true));parent.replaceChild(wrapElement,oldTextNode);var bounds=transform?Util.OffsetBounds(wrapElement):Util.Bounds(wrapElement);parent.replaceChild(backupText,wrapElement);return bounds}function getTextDecoration(el){var textDecoration=getCSS(el,"textDecoration"),split;if(textDecoration.indexOf("none")===0){var condition;if(_html2canvas.options.gliffyOpt){condition=el.parentElement&&el.parentElement!=$(".gliffy-mock-stage")[0]}else{condition=el.parentElement}if(condition){return getTextDecoration(el.parentElement)}}return textDecoration.split(" ")[0]}function renderText(el,textNode,stack){var ctx=stack.ctx,color=getCSS(el,"color"),textDecoration=getTextDecoration(el),textAlign=getCSS(el,"textAlign"),metrics,textList,wordRendering=false,oldWidth,oldWordWrap,newWidth,forcedWordWrapOccurs=false,state={node:textNode,textOffset:0};if(Util.trimText(textNode.nodeValue).length>0){textNode.nodeValue=textTransform(textNode.nodeValue,getCSS(el,"textTransform"));textAlign=textAlign.replace(["-webkit-auto"],["auto"]);oldWidth=$(el).width();oldWordWrap=$(el).css("word-wrap");$(el).css("word-wrap","initial");newWidth=$(el).width();$(el).css("word-wrap",oldWordWrap);forcedWordWrapOccurs=oldWidth!==newWidth;wordRendering=(options.useSVGTextBaseline&&!forcedWordWrapOccurs||!options.letterRendering&&/^(left|right|justify|auto)$/.test(textAlign)&&noLetterSpacing(getCSS(el,"letterSpacing")));textList=wordRendering?textNode.nodeValue.split(/(\b| )/):textNode.nodeValue.split("");metrics=setTextVariables(ctx,el,textDecoration,color);if(options.chinese){textList.forEach(function(word,index){if(/.*[\u4E00-\u9FA5].*$/.test(word)){word=word.split("");word.unshift(index,1);textList.splice.apply(textList,word)}})}textList.forEach(function(text,index){var bounds=getTextBounds(state,text,textDecoration,(index<textList.length-1),stack.transform.matrix);if(bounds){var x=bounds.left,y=bounds.bottom;if(options.useSVGTextBaseline){y=bounds.top+metrics.baseline}drawText(text,x,y,ctx);renderTextDecoration(ctx,textDecoration,bounds,metrics,color)}})}}function listPosition(element,val){var boundElement=doc.createElement("boundelement"),originalType,bounds;boundElement.style.display="inline";originalType=element.style.listStyleType;element.style.listStyleType="none";boundElement.appendChild(doc.createTextNode(val));element.insertBefore(boundElement,element.firstChild);bounds=Util.Bounds(boundElement);element.removeChild(boundElement);element.style.listStyleType=originalType;return bounds}function elementIndex(el){var i=-1,count=1,childs=el.parentNode.childNodes;if(el.parentNode){while(childs[++i]!==el){if(childs[i].nodeType===1){count++}}return count}else{return -1}}function listItemText(element,type){var currentIndex=elementIndex(element),text;switch(type){case"decimal":text=currentIndex;break;case"decimal-leading-zero":text=(currentIndex.toString().length===1)?currentIndex="0"+currentIndex.toString():currentIndex.toString();break;case"upper-roman":text=_html2canvas.Generate.ListRoman(currentIndex);break;case"lower-roman":text=_html2canvas.Generate.ListRoman(currentIndex).toLowerCase();break;case"lower-alpha":text=_html2canvas.Generate.ListAlpha(currentIndex).toLowerCase();break;case"upper-alpha":text=_html2canvas.Generate.ListAlpha(currentIndex);break}return text+". "}function renderListItem(element,stack,elBounds){var x,text,ctx=stack.ctx,type=getCSS(element,"listStyleType"),listBounds;if(/^(decimal|decimal-leading-zero|upper-alpha|upper-latin|upper-roman|lower-alpha|lower-greek|lower-latin|lower-roman)$/i.test(type)){text=listItemText(element,type);listBounds=listPosition(element,text);setTextVariables(ctx,element,"none",getCSS(element,"color"));if(getCSS(element,"listStylePosition")==="inside"){ctx.setVariable("textAlign","left");x=elBounds.left}else{return}drawText(text,x,listBounds.bottom,ctx)}}function loadImage(src){var img=images[src];return(img&&img.succeeded===true)?img.img:false}function clipBounds(src,dst){var x=Math.max(src.left,dst.left),y=Math.max(src.top,dst.top),x2=Math.min((src.left+src.width),(dst.left+dst.width)),y2=Math.min((src.top+src.height),(dst.top+dst.height));return{left:x,top:y,width:x2-x,height:y2-y}}function setZ(element,stack,parentStack){var newContext,isPositioned=stack.cssPosition!=="static",zIndex=isPositioned?getCSS(element,"zIndex"):"auto",opacity=getCSS(element,"opacity"),isFloated=getCSS(element,"cssFloat")!=="none";stack.zIndex=newContext=h2czContext(zIndex);newContext.isPositioned=isPositioned;newContext.isFloated=isFloated;newContext.opacity=opacity;newContext.ownStacking=(zIndex!=="auto"||opacity<1);if(parentStack){parentStack.zIndex.children.push(stack)}}function renderImage(ctx,element,image,bounds,borders){var paddingLeft=getCSSInt(element,"paddingLeft"),paddingTop=getCSSInt(element,"paddingTop"),paddingRight=getCSSInt(element,"paddingRight"),paddingBottom=getCSSInt(element,"paddingBottom");drawImage(ctx,image,0,0,image.width,image.height,bounds.left+paddingLeft+borders[3].width,bounds.top+paddingTop+borders[0].width,bounds.width-(borders[1].width+borders[3].width+paddingLeft+paddingRight),bounds.height-(borders[0].width+borders[2].width+paddingTop+paddingBottom))}function getBorderData(element){return["Top","Right","Bottom","Left"].map(function(side){return{width:getCSSInt(element,"border"+side+"Width"),color:getCSS(element,"border"+side+"Color")}})}function getBorderRadiusData(element){return["TopLeft","TopRight","BottomRight","BottomLeft"].map(function(side){return getCSS(element,"border"+side+"Radius")})}var getCurvePoints=(function(kappa){return function(x,y,r1,r2){var ox=(r1)*kappa,oy=(r2)*kappa,xm=x+r1,ym=y+r2;return{topLeft:bezierCurve({x:x,y:ym},{x:x,y:ym-oy},{x:xm-ox,y:y},{x:xm,y:y}),topRight:bezierCurve({x:x,y:y},{x:x+ox,y:y},{x:xm,y:ym-oy},{x:xm,y:ym}),bottomRight:bezierCurve({x:xm,y:y},{x:xm,y:y+oy},{x:x+ox,y:ym},{x:x,y:ym}),bottomLeft:bezierCurve({x:xm,y:ym},{x:xm-ox,y:ym},{x:x,y:y+oy},{x:x,y:y})}}})(4*((Math.sqrt(2)-1)/3));function bezierCurve(start,startControl,endControl,end){var lerp=function(a,b,t){return{x:a.x+(b.x-a.x)*t,y:a.y+(b.y-a.y)*t}};return{start:start,startControl:startControl,endControl:endControl,end:end,subdivide:function(t){var ab=lerp(start,startControl,t),bc=lerp(startControl,endControl,t),cd=lerp(endControl,end,t),abbc=lerp(ab,bc,t),bccd=lerp(bc,cd,t),dest=lerp(abbc,bccd,t);return[bezierCurve(start,ab,abbc,dest),bezierCurve(dest,bccd,cd,end)]},curveTo:function(borderArgs){borderArgs.push(["bezierCurve",startControl.x,startControl.y,endControl.x,endControl.y,end.x,end.y])},curveToReversed:function(borderArgs){borderArgs.push(["bezierCurve",endControl.x,endControl.y,startControl.x,startControl.y,start.x,start.y])}}}function parseCorner(borderArgs,radius1,radius2,corner1,corner2,x,y){if(radius1[0]>0||radius1[1]>0){borderArgs.push(["line",corner1[0].start.x,corner1[0].start.y]);corner1[0].curveTo(borderArgs);corner1[1].curveTo(borderArgs)}else{borderArgs.push(["line",x,y])}if(radius2[0]>0||radius2[1]>0){borderArgs.push(["line",corner2[0].start.x,corner2[0].start.y])}}function drawSide(borderData,radius1,radius2,outer1,inner1,outer2,inner2){var borderArgs=[];if(radius1[0]>0||radius1[1]>0){borderArgs.push(["line",outer1[1].start.x,outer1[1].start.y]);outer1[1].curveTo(borderArgs)}else{borderArgs.push(["line",borderData.c1[0],borderData.c1[1]])}if(radius2[0]>0||radius2[1]>0){borderArgs.push(["line",outer2[0].start.x,outer2[0].start.y]);outer2[0].curveTo(borderArgs);borderArgs.push(["line",inner2[0].end.x,inner2[0].end.y]);inner2[0].curveToReversed(borderArgs)}else{borderArgs.push(["line",borderData.c2[0],borderData.c2[1]]);borderArgs.push(["line",borderData.c3[0],borderData.c3[1]])}if(radius1[0]>0||radius1[1]>0){borderArgs.push(["line",inner1[1].end.x,inner1[1].end.y]);inner1[1].curveToReversed(borderArgs)}else{borderArgs.push(["line",borderData.c4[0],borderData.c4[1]])}return borderArgs}function calculateCurvePoints(bounds,borderRadius,borders){var x=bounds.left,y=bounds.top,width=bounds.width,height=bounds.height,tlh=borderRadius[0][0],tlv=borderRadius[0][1],trh=borderRadius[1][0],trv=borderRadius[1][1],brh=borderRadius[2][0],brv=borderRadius[2][1],blh=borderRadius[3][0],blv=borderRadius[3][1],topWidth=width-trh,rightHeight=height-brv,bottomWidth=width-brh,leftHeight=height-blv;return{topLeftOuter:getCurvePoints(x,y,tlh,tlv).topLeft.subdivide(0.5),topLeftInner:getCurvePoints(x+borders[3].width,y+borders[0].width,Math.max(0,tlh-borders[3].width),Math.max(0,tlv-borders[0].width)).topLeft.subdivide(0.5),topRightOuter:getCurvePoints(x+topWidth,y,trh,trv).topRight.subdivide(0.5),topRightInner:getCurvePoints(x+Math.min(topWidth,width+borders[3].width),y+borders[0].width,(topWidth>width+borders[3].width)?0:trh-borders[3].width,trv-borders[0].width).topRight.subdivide(0.5),bottomRightOuter:getCurvePoints(x+bottomWidth,y+rightHeight,brh,brv).bottomRight.subdivide(0.5),bottomRightInner:getCurvePoints(x+Math.min(bottomWidth,width+borders[3].width),y+Math.min(rightHeight,height+borders[0].width),Math.max(0,brh-borders[1].width),Math.max(0,brv-borders[2].width)).bottomRight.subdivide(0.5),bottomLeftOuter:getCurvePoints(x,y+leftHeight,blh,blv).bottomLeft.subdivide(0.5),bottomLeftInner:getCurvePoints(x+borders[3].width,y+leftHeight,Math.max(0,blh-borders[3].width),Math.max(0,blv-borders[2].width)).bottomLeft.subdivide(0.5)}}function getBorderClip(element,borderPoints,borders,radius,bounds){var backgroundClip=getCSS(element,"backgroundClip"),borderArgs=[];switch(backgroundClip){case"content-box":case"padding-box":parseCorner(borderArgs,radius[0],radius[1],borderPoints.topLeftInner,borderPoints.topRightInner,bounds.left+borders[3].width,bounds.top+borders[0].width);parseCorner(borderArgs,radius[1],radius[2],borderPoints.topRightInner,borderPoints.bottomRightInner,bounds.left+bounds.width-borders[1].width,bounds.top+borders[0].width);parseCorner(borderArgs,radius[2],radius[3],borderPoints.bottomRightInner,borderPoints.bottomLeftInner,bounds.left+bounds.width-borders[1].width,bounds.top+bounds.height-borders[2].width);parseCorner(borderArgs,radius[3],radius[0],borderPoints.bottomLeftInner,borderPoints.topLeftInner,bounds.left+borders[3].width,bounds.top+bounds.height-borders[2].width);break;default:parseCorner(borderArgs,radius[0],radius[1],borderPoints.topLeftOuter,borderPoints.topRightOuter,bounds.left,bounds.top);parseCorner(borderArgs,radius[1],radius[2],borderPoints.topRightOuter,borderPoints.bottomRightOuter,bounds.left+bounds.width,bounds.top);parseCorner(borderArgs,radius[2],radius[3],borderPoints.bottomRightOuter,borderPoints.bottomLeftOuter,bounds.left+bounds.width,bounds.top+bounds.height);parseCorner(borderArgs,radius[3],radius[0],borderPoints.bottomLeftOuter,borderPoints.topLeftOuter,bounds.left,bounds.top+bounds.height);break}return borderArgs}function parseBorders(element,bounds,borders){if(_html2canvas.options.gliffyOpt&&_html2canvas.options.doShapeOpt){return}var x=bounds.left,y=bounds.top,width=bounds.width,height=bounds.height,borderSide,bx,by,bw,bh,borderArgs,borderRadius=getBorderRadiusData(element),borderPoints=calculateCurvePoints(bounds,borderRadius,borders),borderData={clip:getBorderClip(element,borderPoints,borders,borderRadius,bounds),borders:[]};for(borderSide=0;borderSide<4;borderSide++){if(borders[borderSide].width>0){bx=x;by=y;bw=width;bh=height-(borders[2].width);switch(borderSide){case 0:bh=borders[0].width;borderArgs=drawSide({c1:[bx,by],c2:[bx+bw,by],c3:[bx+bw-borders[1].width,by+bh],c4:[bx+borders[3].width,by+bh]},borderRadius[0],borderRadius[1],borderPoints.topLeftOuter,borderPoints.topLeftInner,borderPoints.topRightOuter,borderPoints.topRightInner);break;case 1:bx=x+width-(borders[1].width);bw=borders[1].width;borderArgs=drawSide({c1:[bx+bw,by],c2:[bx+bw,by+bh+borders[2].width],c3:[bx,by+bh],c4:[bx,by+borders[0].width]},borderRadius[1],borderRadius[2],borderPoints.topRightOuter,borderPoints.topRightInner,borderPoints.bottomRightOuter,borderPoints.bottomRightInner);break;case 2:by=(by+height)-(borders[2].width);bh=borders[2].width;borderArgs=drawSide({c1:[bx+bw,by+bh],c2:[bx,by+bh],c3:[bx+borders[3].width,by],c4:[bx+bw-borders[3].width,by]},borderRadius[2],borderRadius[3],borderPoints.bottomRightOuter,borderPoints.bottomRightInner,borderPoints.bottomLeftOuter,borderPoints.bottomLeftInner);break;case 3:bw=borders[3].width;borderArgs=drawSide({c1:[bx,by+bh+borders[2].width],c2:[bx,by],c3:[bx+bw,by+borders[0].width],c4:[bx+bw,by+bh]},borderRadius[3],borderRadius[0],borderPoints.bottomLeftOuter,borderPoints.bottomLeftInner,borderPoints.topLeftOuter,borderPoints.topLeftInner);break}borderData.borders.push({args:borderArgs,color:borders[borderSide].color})}}return borderData}function createShape(ctx,args){var shape=ctx.drawShape();args.forEach(function(border,index){shape[(index===0)?"moveTo":border[0]+"To"].apply(null,border.slice(1))});return shape}function renderBorders(ctx,borderArgs,color){if(color!=="transparent"){ctx.setVariable("fillStyle",color);createShape(ctx,borderArgs);ctx.fill();numDraws+=1}}function renderFormValue(el,bounds,stack){var valueWrap=doc.createElement("valuewrap"),cssPropertyArray=["lineHeight","textAlign","fontFamily","color","fontSize","paddingLeft","paddingTop","width","height","border","borderLeftWidth","borderTopWidth"],textValue,textNode;cssPropertyArray.forEach(function(property){try{valueWrap.style[property]=getCSS(el,property)}catch(e){Util.log("html2canvas: Parse: Exception caught in renderFormValue: "+e.message)}});valueWrap.style.borderColor="black";valueWrap.style.borderStyle="solid";valueWrap.style.display="block";valueWrap.style.position="absolute";if(/^(submit|reset|button|text|password)$/.test(el.type)||el.nodeName==="SELECT"){valueWrap.style.lineHeight=getCSS(el,"height")}valueWrap.style.top=bounds.top+"px";valueWrap.style.left=bounds.left+"px";textValue=(el.nodeName==="SELECT")?(el.options[el.selectedIndex]||0).text:el.value;if(!textValue){textValue=el.placeholder}textNode=doc.createTextNode(textValue);valueWrap.appendChild(textNode);body.appendChild(valueWrap);renderText(el,textNode,stack);body.removeChild(valueWrap)}function drawImage(ctx){ctx.drawImage.apply(ctx,Array.prototype.slice.call(arguments,1));numDraws+=1}function getPseudoElement(el,which){var elStyle=window.getComputedStyle(el,which);if(!elStyle||!elStyle.content||elStyle.content==="none"||elStyle.content==="-moz-alt-content"||elStyle.display==="none"){return}var content=elStyle.content+"",first=content.substr(0,1);if(first===content.substr(content.length-1)&&first.match(/'|"/)){content=content.substr(1,content.length-2)}var isImage=content.substr(0,3)==="url",elps=document.createElement(isImage?"img":"span");elps.className=pseudoHide+"-before "+pseudoHide+"-after";Object.keys(elStyle).filter(indexedProperty).forEach(function(prop){try{elps.style[prop]=elStyle[prop]}catch(e){Util.log(["Tried to assign readonly property ",prop,"Error:",e])}});if(isImage){elps.src=Util.parseBackgroundImage(content)[0].args[0]}else{elps.innerHTML=content}return elps}function indexedProperty(property){return(isNaN(window.parseInt(property,10)))}function injectPseudoElements(el,stack){var before=getPseudoElement(el,":before"),after=getPseudoElement(el,":after");if(!before&&!after){return}if(before){el.className+=" "+pseudoHide+"-before";el.parentNode.insertBefore(before,el);parseElement(before,stack,true);el.parentNode.removeChild(before);el.className=el.className.replace(pseudoHide+"-before","").trim()}if(after){el.className+=" "+pseudoHide+"-after";el.appendChild(after);parseElement(after,stack,true);el.removeChild(after);el.className=el.className.replace(pseudoHide+"-after","").trim()}}function renderBackgroundRepeat(ctx,image,backgroundPosition,bounds){var offsetX=Math.round(bounds.left+backgroundPosition.left),offsetY=Math.round(bounds.top+backgroundPosition.top);ctx.createPattern(image);ctx.translate(offsetX,offsetY);ctx.fill();ctx.translate(-offsetX,-offsetY)}function backgroundRepeatShape(ctx,image,backgroundPosition,bounds,left,top,width,height){var args=[];args.push(["line",Math.round(left),Math.round(top)]);args.push(["line",Math.round(left+width),Math.round(top)]);args.push(["line",Math.round(left+width),Math.round(height+top)]);args.push(["line",Math.round(left),Math.round(height+top)]);createShape(ctx,args);ctx.save();ctx.clip();renderBackgroundRepeat(ctx,image,backgroundPosition,bounds);ctx.restore()}function renderBackgroundColor(ctx,backgroundBounds,bgcolor){renderRect(ctx,backgroundBounds.left,backgroundBounds.top,backgroundBounds.width,backgroundBounds.height,bgcolor)}function renderBackgroundRepeating(el,bounds,ctx,image,imageIndex){var backgroundSize=Util.BackgroundSize(el,bounds,image,imageIndex),backgroundPosition=Util.BackgroundPosition(el,bounds,image,imageIndex,backgroundSize),backgroundRepeat=getCSS(el,"backgroundRepeat").split(",").map(Util.trimText);image=resizeImage(image,backgroundSize);backgroundRepeat=backgroundRepeat[imageIndex]||backgroundRepeat[0];switch(backgroundRepeat){case"repeat-x":backgroundRepeatShape(ctx,image,backgroundPosition,bounds,bounds.left,bounds.top+backgroundPosition.top,99999,image.height);break;case"repeat-y":backgroundRepeatShape(ctx,image,backgroundPosition,bounds,bounds.left+backgroundPosition.left,bounds.top,image.width,99999);break;case"no-repeat":backgroundRepeatShape(ctx,image,backgroundPosition,bounds,bounds.left+backgroundPosition.left,bounds.top+backgroundPosition.top,image.width,image.height);break;default:renderBackgroundRepeat(ctx,image,backgroundPosition,{top:bounds.top,left:bounds.left,width:image.width,height:image.height});break}}function renderBackgroundImage(element,bounds,ctx){var backgroundImage=getCSS(element,"backgroundImage"),backgroundImages=Util.parseBackgroundImage(backgroundImage),image,imageIndex=backgroundImages.length;while(imageIndex--){backgroundImage=backgroundImages[imageIndex];if(!backgroundImage.args||backgroundImage.args.length===0){continue}var key=backgroundImage.method==="url"?backgroundImage.args[0]:backgroundImage.value;image=loadImage(key);if(image){renderBackgroundRepeating(element,bounds,ctx,image,imageIndex)}else{Util.log("html2canvas: Error loading background:",backgroundImage)}}}function resizeImage(image,bounds){if(image.width===bounds.width&&image.height===bounds.height){return image}var ctx,canvas=doc.createElement("canvas");canvas.width=bounds.width;canvas.height=bounds.height;ctx=canvas.getContext("2d");drawImage(ctx,image,0,0,image.width,image.height,0,0,bounds.width,bounds.height);return canvas}function setOpacity(ctx,element,parentStack){if(_html2canvas.options.gliffyOpt){return 1}return ctx.setVariable("globalAlpha",getCSS(element,"opacity")*((parentStack)?parentStack.opacity:1))}function removePx(str){return str.replace("px","")}var transformRegExp=/(matrix)\((.+)\)/;function concatMatrices(matrix1,matrix2){var matrixA={m00_:matrix1[0],m10_:matrix1[1],m01_:matrix1[2],m11_:matrix1[3],m02_:matrix1[4],m12_:matrix1[5]};var matrixB={m00_:matrix2[0],m10_:matrix2[1],m01_:matrix2[2],m11_:matrix2[3],m02_:matrix2[4],m12_:matrix2[5]};var m0=matrixA.m00_;var m1=matrixA.m01_;matrixA.m00_=matrixB.m00_*m0+matrixB.m10_*m1;matrixA.m01_=matrixB.m01_*m0+matrixB.m11_*m1;matrixA.m02_+=matrixB.m02_*m0+matrixB.m12_*m1;m0=matrixA.m10_;m1=matrixA.m11_;matrixA.m10_=matrixB.m00_*m0+matrixB.m10_*m1;matrixA.m11_=matrixB.m01_*m0+matrixB.m11_*m1;matrixA.m12_+=matrixB.m02_*m0+matrixB.m12_*m1;return[matrixA.m00_,matrixA.m10_,matrixA.m01_,matrixA.m11_,matrixA.m02_,matrixA.m12_]}function getTransform(element,parentStack){var transform=getCSS(element,"transform")||getCSS(element,"-webkit-transform")||getCSS(element,"-moz-transform")||getCSS(element,"-ms-transform")||getCSS(element,"-o-transform");var transformOrigin=getCSS(element,"transform-origin")||getCSS(element,"-webkit-transform-origin")||getCSS(element,"-moz-transform-origin")||getCSS(element,"-ms-transform-origin")||getCSS(element,"-o-transform-origin")||"0px 0px";transformOrigin=transformOrigin.split(" ").map(removePx).map(Util.asFloat);var matrix;if(transform&&transform!=="none"){var match=transform.match(transformRegExp);if(match){switch(match[1]){case"matrix":matrix=match[2].split(",").map(Util.trimText).map(Util.asFloat);break}}}if(parentStack&&parentStack.transform){if(matrix){matrix=concatMatrices(matrix,parentStack.transform.matrix)}else{matrix=parentStack.transform.matrix}if(transformOrigin){transformOrigin=parentStack.transform.origin}else{transformOrigin=parentStack.transform.origin}}return{origin:transformOrigin,matrix:matrix}}function createStack(element,parentStack,bounds,transform){var ctx=h2cRenderContext((!parentStack)?documentWidth():bounds.width,(!parentStack)?documentHeight():bounds.height),stack={ctx:ctx,opacity:setOpacity(ctx,element,parentStack),cssPosition:getCSS(element,"position"),borders:getBorderData(element),transform:transform,clip:(parentStack&&parentStack.clip)?Util.Extend({},parentStack.clip):null};setZ(element,stack,parentStack);if(options.useOverflow===true&&/(hidden|scroll|auto)/.test(getCSS(element,"overflow"))===true&&/(BODY)/i.test(element.nodeName)===false){stack.clip=(stack.clip)?clipBounds(stack.clip,bounds):bounds}return stack}function getBackgroundBounds(borders,bounds,clip){var backgroundBounds={left:bounds.left+borders[3].width,top:bounds.top+borders[0].width,width:bounds.width-(borders[1].width+borders[3].width),height:bounds.height-(borders[0].width+borders[2].width)};if(clip){backgroundBounds=clipBounds(backgroundBounds,clip)}return backgroundBounds}function getBounds(element,transform){var bounds=(transform.matrix)?Util.OffsetBounds(element):Util.Bounds(element);transform.origin[0]+=bounds.left;transform.origin[1]+=bounds.top;return bounds}function renderElement(element,parentStack,pseudoElement,ignoreBackground){var transform={matrix:null,origin:[0,0]},bounds=getBounds(element,transform),image,stack=createStack(element,parentStack,bounds,transform),borders=stack.borders,ctx=stack.ctx,backgroundBounds=getBackgroundBounds(borders,bounds,stack.clip),borderData=parseBorders(element,bounds,borders),backgroundColor=(ignoreElementsRegExp.test(element.nodeName))?"#efefef":getCSS(element,"backgroundColor");if(!_html2canvas.options.gliffyOpt||!_html2canvas.options.doShapeOpt){createShape(ctx,borderData.clip)}ctx.save();if(_html2canvas.options.clipBackgroundColor){ctx.clip()}if(backgroundBounds.height>0&&backgroundBounds.width>0&&!ignoreBackground){renderBackgroundColor(ctx,bounds,backgroundColor);renderBackgroundImage(element,backgroundBounds,ctx)}else{if(ignoreBackground){stack.backgroundColor=backgroundColor}}ctx.restore();if(!_html2canvas.options.gliffyOpt){borderData.borders.forEach(function(border){renderBorders(ctx,border.args,border.color)})}if(!pseudoElement){injectPseudoElements(element,stack)}switch(element.nodeName){case"IMG":if((image=loadImage(element.getAttribute("src")))){renderImage(ctx,element,image,bounds,borders)}else{Util.log("html2canvas: Error loading <img>:"+element.getAttribute("src"))}break;case"INPUT":if(/^(text|url|email|submit|button|reset)$/.test(element.type)&&(element.value||element.placeholder||"").length>0){renderFormValue(element,bounds,stack)}break;case"TEXTAREA":if((element.value||element.placeholder||"").length>0){renderFormValue(element,bounds,stack)}break;case"SELECT":if((element.options||element.placeholder||"").length>0){renderFormValue(element,bounds,stack)}break;case"LI":renderListItem(element,stack,backgroundBounds);break;case"CANVAS":renderImage(ctx,element,element,bounds,borders);break}return stack}function isElementVisible(element){return(getCSS(element,"display")!=="none"&&getCSS(element,"visibility")!=="hidden"&&!element.hasAttribute("data-html2canvas-ignore"))}function parseElement(element,stack,pseudoElement){if(isElementVisible(element)){stack=renderElement(element,stack,pseudoElement,false)||stack;if(!ignoreElementsRegExp.test(element.nodeName)){parseChildren(element,stack,pseudoElement)}}}function parseChildren(element,stack,pseudoElement){Util.Children(element).forEach(function(node){if(node.nodeType===node.ELEMENT_NODE){parseElement(node,stack,pseudoElement)}else{if(node.nodeType===node.TEXT_NODE){renderText(element,node,stack)}}})}function init(){var background=getCSS(document.documentElement,"backgroundColor"),transparentBackground=(Util.isTransparent(background)&&element===document.body),stack=renderElement(element,null,false,transparentBackground);parseChildren(element,stack);if(transparentBackground){background=stack.backgroundColor}body.removeChild(hidePseudoElements);return{backgroundColor:background,stack:stack}}return init()};function h2czContext(zindex){return{zindex:zindex,children:[]}}_html2canvas.Preload=function(options){var images={numLoaded:0,numFailed:0,numTotal:0,cleanupDone:false},pageOrigin,Util=_html2canvas.Util,methods,i,count=0,element=options.elements[0]||document.body,doc=element.ownerDocument,domImages=element.getElementsByTagName("img"),imgLen=domImages.length,link=doc.createElement("a"),supportCORS=(function(img){return(img.crossOrigin!==undefined)})(new Image()),timeoutTimer;link.href=window.location.href;pageOrigin=link.protocol+link.host;function isSameOrigin(url){link.href=url;link.href=link.href;var origin=link.protocol+link.host;return(origin===pageOrigin)}function start(){Util.log("html2canvas: start: images: "+images.numLoaded+" / "+images.numTotal+" (failed: "+images.numFailed+")");if(!images.firstRun&&images.numLoaded>=images.numTotal){Util.log("Finished loading images: # "+images.numTotal+" (failed: "+images.numFailed+")");if(typeof options.complete==="function"){options.complete(images)}}}function proxyGetImage(url,img,imageObj){var callback_name,scriptUrl=options.proxy,script;link.href=url;url=link.href;callback_name="html2canvas_"+(count++);imageObj.callbackname=callback_name;if(scriptUrl.indexOf("?")>-1){scriptUrl+="&"}else{scriptUrl+="?"}scriptUrl+="url="+encodeURIComponent(url)+"&callback="+callback_name;script=doc.createElement("script");window[callback_name]=function(a){if(a.substring(0,6)==="error:"){imageObj.succeeded=false;images.numLoaded++;images.numFailed++;start()}else{setImageLoadHandlers(img,imageObj);img.src=a}window[callback_name]=undefined;try{delete window[callback_name]}catch(ex){}script.parentNode.removeChild(script);script=null;delete imageObj.script;delete imageObj.callbackname};script.setAttribute("type","text/javascript");script.setAttribute("src",scriptUrl);imageObj.script=script;window.document.body.appendChild(script)}function loadPseudoElement(element,type){var style=window.getComputedStyle(element,type),content=style.content;if(content.substr(0,3)==="url"){methods.loadImage(_html2canvas.Util.parseBackgroundImage(content)[0].args[0])}loadBackgroundImages(style.backgroundImage,element)}function loadPseudoElementImages(element){loadPseudoElement(element,":before");loadPseudoElement(element,":after")}function loadGradientImage(backgroundImage,bounds){var img=_html2canvas.Generate.Gradient(backgroundImage,bounds);if(img!==undefined){images[backgroundImage]={img:img,succeeded:true};images.numTotal++;images.numLoaded++;start()}}function invalidBackgrounds(background_image){return(background_image&&background_image.method&&background_image.args&&background_image.args.length>0)}function loadBackgroundImages(background_image,el){var bounds;_html2canvas.Util.parseBackgroundImage(background_image).filter(invalidBackgrounds).forEach(function(background_image){if(background_image.method==="url"){methods.loadImage(background_image.args[0])}else{if(background_image.method.match(/\-?gradient$/)){if(bounds===undefined){bounds=_html2canvas.Util.Bounds(el)}loadGradientImage(background_image.value,bounds)}}})}function getImages(el){var elNodeType=false;if(_html2canvas.options.gliffyOpt){return}try{Util.Children(el).forEach(getImages)}catch(e){}try{elNodeType=el.nodeType}catch(ex){elNodeType=false;Util.log("html2canvas: failed to access some element's nodeType - Exception: "+ex.message)}if(elNodeType===1||elNodeType===undefined){loadPseudoElementImages(el);try{loadBackgroundImages(Util.getCSS(el,"backgroundImage"),el)}catch(e){Util.log("html2canvas: failed to get background-image - Exception: "+e.message)}loadBackgroundImages(el)}}function setImageLoadHandlers(img,imageObj){img.onload=function(){if(imageObj.timer!==undefined){window.clearTimeout(imageObj.timer)}images.numLoaded++;imageObj.succeeded=true;img.onerror=img.onload=null;start()};img.onerror=function(){if(img.crossOrigin==="anonymous"){window.clearTimeout(imageObj.timer);if(options.proxy){var src=img.src;img=new Image();imageObj.img=img;img.src=src;proxyGetImage(img.src,img,imageObj);return}}images.numLoaded++;images.numFailed++;imageObj.succeeded=false;img.onerror=img.onload=null;start()}}methods={loadImage:function(src){var img,imageObj;if(src&&images[src]===undefined){img=new Image();if(src.match(/data:image\/.*;base64,/i)){img.src=src.replace(/url\(['"]{0,}|['"]{0,}\)$/ig,"");imageObj=images[src]={img:img};images.numTotal++;setImageLoadHandlers(img,imageObj)}else{if(isSameOrigin(src)||options.allowTaint===true){imageObj=images[src]={img:img};images.numTotal++;setImageLoadHandlers(img,imageObj);img.src=src}else{if(supportCORS&&!options.allowTaint&&options.useCORS){img.crossOrigin="anonymous";imageObj=images[src]={img:img};images.numTotal++;setImageLoadHandlers(img,imageObj);img.src=src}else{if(options.proxy){imageObj=images[src]={img:img};images.numTotal++;proxyGetImage(src,img,imageObj)}}}}}},cleanupDOM:function(cause){var img,src;if(!images.cleanupDone){if(cause&&typeof cause==="string"){Util.log("html2canvas: Cleanup because: "+cause)}else{Util.log("html2canvas: Cleanup after timeout: "+options.timeout+" ms.")}for(src in images){if(images.hasOwnProperty(src)){img=images[src];if(typeof img==="object"&&img.callbackname&&img.succeeded===undefined){window[img.callbackname]=undefined;try{delete window[img.callbackname]}catch(ex){}if(img.script&&img.script.parentNode){img.script.setAttribute("src","about:blank");img.script.parentNode.removeChild(img.script)}images.numLoaded++;images.numFailed++;Util.log("html2canvas: Cleaned up failed img: '"+src+"' Steps: "+images.numLoaded+" / "+images.numTotal)}}}if(window.stop!==undefined){window.stop()}else{if(document.execCommand!==undefined){document.execCommand("Stop",false)}}if(document.close!==undefined){document.close()}images.cleanupDone=true;if(!(cause&&typeof cause==="string")){start()}}},renderingDone:function(){if(timeoutTimer){window.clearTimeout(timeoutTimer)}}};if(options.timeout>0){timeoutTimer=window.setTimeout(methods.cleanupDOM,options.timeout)}Util.log("html2canvas: Preload starts: finding background-images");images.firstRun=true;getImages(element);Util.log("html2canvas: Preload: Finding images");for(i=0;i<imgLen;i+=1){methods.loadImage(domImages[i].getAttribute("src"))}images.firstRun=false;Util.log("html2canvas: Preload: Done.");if(images.numTotal===images.numLoaded){start()}return methods};_html2canvas.Renderer=function(parseQueue,options){function createRenderQueue(parseQueue){var queue=[],rootContext;rootContext=(function buildStackingContext(rootNode){var rootContext={};function insert(context,node,specialParent){var zi=(node.zIndex.zindex==="auto")?0:Number(node.zIndex.zindex),contextForChildren=context,isPositioned=node.zIndex.isPositioned,isFloated=node.zIndex.isFloated,stub={node:node},childrenDest=specialParent;if(node.zIndex.ownStacking){contextForChildren=stub.context={"!":[{node:node,children:[]}]};childrenDest=undefined}else{if(isPositioned||isFloated){childrenDest=stub.children=[]}}if(zi===0&&specialParent){specialParent.push(stub)}else{if(!context[zi]){context[zi]=[]}context[zi].push(stub)}node.zIndex.children.forEach(function(childNode){insert(contextForChildren,childNode,childrenDest)})}insert(rootContext,rootNode);return rootContext})(parseQueue);function sortZ(context){Object.keys(context).sort().forEach(function(zi){var nonPositioned=[],floated=[],positioned=[],list=[];context[zi].forEach(function(v){if(v.node.zIndex.isPositioned||v.node.zIndex.opacity<1){positioned.push(v)}else{if(v.node.zIndex.isFloated){floated.push(v)}else{nonPositioned.push(v)}}});(function walk(arr){arr.forEach(function(v){list.push(v);if(v.children){walk(v.children)}})})(nonPositioned.concat(floated,positioned));list.forEach(function(v){if(v.context){sortZ(v.context)}else{queue.push(v.node)}})})}sortZ(rootContext);return queue}function getRenderer(rendererName){var renderer;if(typeof options.renderer==="string"&&_html2canvas.Renderer[rendererName]!==undefined){renderer=_html2canvas.Renderer[rendererName](options)}else{if(typeof rendererName==="function"){renderer=rendererName(options)}else{throw new Error("Unknown renderer")}}if(typeof renderer!=="function"){throw new Error("Invalid renderer defined")}return renderer}return getRenderer(options.renderer)(parseQueue,options,document,createRenderQueue(parseQueue.stack),_html2canvas)};_html2canvas.Util.Support=function(options,doc){function supportSVGRendering(){var img=new Image(),canvas=doc.createElement("canvas"),ctx=(canvas.getContext===undefined)?false:canvas.getContext("2d");if(ctx===false){return false}canvas.width=canvas.height=10;img.src=["data:image/svg+xml,","<svg xmlns='http://www.w3.org/2000/svg' width='10' height='10'>","<foreignObject width='10' height='10'>","<div xmlns='http://www.w3.org/1999/xhtml' style='width:10;height:10;'>","sup","</div>","</foreignObject>","</svg>"].join("");try{ctx.drawImage(img,0,0);canvas.toDataURL()}catch(e){return false}_html2canvas.Util.log("html2canvas: Parse: SVG powered rendering available");return true}function supportRangeBounds(){var r,testElement,rangeBounds,rangeHeight,support=false;if(_html2canvas.options.gliffyOpt){return true}if(doc.createRange){r=doc.createRange();if(r.getBoundingClientRect){testElement=doc.createElement("boundtest");testElement.style.height="123px";testElement.style.display="block";doc.body.appendChild(testElement);r.selectNode(testElement);rangeBounds=r.getBoundingClientRect();rangeHeight=rangeBounds.height;if(rangeHeight===123){support=true}doc.body.removeChild(testElement)}}return support}return{rangeBounds:supportRangeBounds(),svgRendering:options.svgRendering&&supportSVGRendering()}};window.html2canvasClearCache=function(){_html2canvas.cachedWidth=null,_html2canvas.cachedHeight=null};window.html2canvas=function(elements,opts){elements=(elements.length)?elements:[elements];var queue,canvas,options={logging:false,elements:elements,background:"#fff",proxy:null,timeout:0,useCORS:false,allowTaint:false,gliffyOpt:false,doShapeOpt:false,svgRendering:false,ignoreElements:"IFRAME|OBJECT|PARAM",useOverflow:true,letterRendering:false,chinese:false,clipBackgroundColor:true,async:true,width:null,height:null,resizeCanvas:true,taintTest:true,renderer:"Canvas"};options=_html2canvas.Util.Extend(opts,options);if(options.gliffyOpt){_html2canvas.Util.getCSS=_html2canvas.Util.getCSSGliffy}else{_html2canvas.Util.getCSS=_html2canvas.Util.getCSSH2C}_html2canvas.options=options;_html2canvas.logging=options.logging;options.complete=function(images){if(typeof options.onpreloaded==="function"){if(options.onpreloaded(images)===false){return}}queue=_html2canvas.Parse(images,options);if(typeof options.onparsed==="function"){if(options.onparsed(queue)===false){return}}canvas=_html2canvas.Renderer(queue,options);if(typeof options.onrendered==="function"){options.onrendered(canvas)}};if(options.async){window.setTimeout(function(){_html2canvas.Preload(options)},0)}else{_html2canvas.Preload(options)}return{render:function(queue,opts){return _html2canvas.Renderer(queue,_html2canvas.Util.Extend(opts,options))},parse:function(images,opts){return _html2canvas.Parse(images,_html2canvas.Util.Extend(opts,options))},preload:function(opts){return _html2canvas.Preload(_html2canvas.Util.Extend(opts,options))},log:_html2canvas.Util.log}};window.html2canvas.log=_html2canvas.Util.log;window.html2canvas.Renderer={Canvas:undefined};_html2canvas.Renderer.Canvas=function(options){options=options||{};var doc=document,safeImages=[],testCanvas=document.createElement("canvas"),testctx=testCanvas.getContext("2d"),Util=_html2canvas.Util,canvas=options.canvas||doc.createElement("canvas");function createShape(ctx,args){ctx.beginPath();args.forEach(function(arg){ctx[arg.name].apply(ctx,arg["arguments"])});ctx.closePath()}function safeImage(item){if(safeImages.indexOf(item["arguments"][0].src)===-1){testctx.drawImage(item["arguments"][0],0,0);try{testctx.getImageData(0,0,1,1)}catch(e){testCanvas=doc.createElement("canvas");testctx=testCanvas.getContext("2d");return false}safeImages.push(item["arguments"][0].src)}return true}function renderItem(ctx,item){switch(item.type){case"variable":ctx[item.name]=item["arguments"];break;case"function":switch(item.name){case"createPattern":if(item["arguments"][0].width>0&&item["arguments"][0].height>0){try{ctx.fillStyle=ctx.createPattern(item["arguments"][0],"repeat")}catch(e){Util.log("html2canvas: Renderer: Error creating pattern",e.message)}}break;case"drawShape":createShape(ctx,item["arguments"]);break;case"drawImage":if(item["arguments"][8]>0&&item["arguments"][7]>0){if(!options.taintTest||(options.taintTest&&safeImage(item))){ctx.drawImage.apply(ctx,item["arguments"])}}break;default:ctx[item.name].apply(ctx,item["arguments"])}break}}return function(parsedData,options,document,queue,_html2canvas){var ctx=canvas.getContext?canvas.getContext("2d"):canvas,newCanvas,bounds,fstyle,zStack=parsedData.stack,imgData,i;if(!options.resizeCanvas&&canvas.getContext){canvas.width=canvas.style.width=options.width||zStack.ctx.width;canvas.height=canvas.style.height=options.height||zStack.ctx.height}fstyle=ctx.fillStyle;ctx.fillStyle=(Util.isTransparent(zStack.backgroundColor)&&options.background!==undefined)?options.background:parsedData.backgroundColor;if(!options.resizeCanvas&&canvas.getContext){ctx.fillRect(0,0,canvas.width,canvas.height)}ctx.fillStyle=fstyle;queue.forEach(function(storageContext){ctx.textBaseline="bottom";ctx.save();if(storageContext.transform.matrix){ctx.translate(storageContext.transform.origin[0],storageContext.transform.origin[1]);ctx.transform.apply(ctx,storageContext.transform.matrix);ctx.translate(-storageContext.transform.origin[0],-storageContext.transform.origin[1])}if(storageContext.clip){ctx.beginPath();ctx.rect(storageContext.clip.left,storageContext.clip.top,storageContext.clip.width,storageContext.clip.height);ctx.clip()}if(storageContext.ctx.storage){storageContext.ctx.storage.forEach(function(item){renderItem(ctx,item)})}ctx.restore()});for(i=0;i<cachedRectElements.length;i++){delete cachedRectElements[i].clientRect}Util.log("html2canvas: Renderer: Canvas renderer done - returning canvas obj");return canvas}}})(window,document);var _gliffy={};_gliffy.renderers={};_gliffy.stages={};_gliffy.Debug={SKIP_CATCH_ERRORS:false,SKIP_RENDER_LOOP:false,DISPLAY_GUIDES:false,NO_CONTEXT_MENU:false,NO_ERROR_DIALOG:false,FINITE_NUMBER_CHECKS:false,NO_TIPS:false,NO_NAVIGATE_WARNING:false,STARTUP_FILE:null,LOG_TO_CONSOLE:false,LOG_ANALYTICS:false,USE_ANALYTICS_DEBUG_JS:false,SHOW_MOUSE_COORDS:false,I18N_UNDERSCORES:false,SHOW_RTREE:false};_gliffy.FEATURES={charts:false,tables:false,tables_v2:true,searchOn:true,showPremiumShapesLocked:false,umlV1:false,umlV2:true,uiV2:true,uiV3:true,allowDisableAutosave:false,mindmaps:true,mindmapsAutoLayout:true,browserTabs:false,tabs:true,showPremiumShapes:true,alwaysUseStaticShapeStyleDefaults:true};_gliffy.versionString="unavailable";_gliffy.confluenceVersion="unavailable";_gliffy.analyticsProduct="none";_gliffy.workQueue=$({});_gliffy.textDimensionMap={width:{},height:{}};_gliffy.textDimensionMapSize={width:0,height:0};_gliffy.MIN_OPACITY=0.008;_gliffy.MIN_VISIBLE_VALUE=2;_gliffy.clipboard=null;_gliffy.camelMap={};_gliffy.camelSize=0;$.camelCase=function(string){var getCamel=function(string){return string.replace(/^-ms-/,"ms-").replace(/-([a-z]|[0-9])/ig,function(all,letter){return(letter+"").toUpperCase()})};if(_gliffy.camelMap[string]===undefined){_gliffy.camelMap[string]=getCamel(string);if(++_gliffy.camelSize>1000){_gliffy.camelSize=0;_gliffy.camelMap={}}}return _gliffy.camelMap[string]};(function(factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory)}else{factory(jQuery)}})(function($,undefined){var tag2attr={a:"href",img:"src",form:"action",base:"href",script:"src",iframe:"src",link:"href"},key=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","fragment"],aliases={anchor:"fragment"},parser={strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},querystring_parser=/(?:^|&|;)([^&=;]*)=?([^&;]*)/g,fragment_parser=/(?:^|&|;)([^&=;]*)=?([^&;]*)/g;function parseUri(url,strictMode){var str=decodeURI(unescape(url)),res=parser[strictMode||false?"strict":"loose"].exec(str),uri={attr:{},param:{},seg:{}},i=14;while(i--){uri.attr[key[i]]=res[i]||""}uri.param.query={};uri.param.fragment={};uri.attr.query.replace(querystring_parser,function($0,$1,$2){if($1){uri.param.query[$1]=$2}});uri.attr.fragment.replace(fragment_parser,function($0,$1,$2){if($1){uri.param.fragment[$1]=$2}});uri.seg.path=uri.attr.path.replace(/^\/+|\/+$/g,"").split("/");uri.seg.fragment=uri.attr.fragment.replace(/^\/+|\/+$/g,"").split("/");uri.attr.base=uri.attr.host?(uri.attr.protocol?uri.attr.protocol+"://"+uri.attr.host:uri.attr.host)+(uri.attr.port?":"+uri.attr.port:""):"";return uri}function getAttrName(elm){var tn=elm.tagName;if(tn!==undefined){return tag2attr[tn.toLowerCase()]}return tn}$.fn.url=function(strictMode){var url="";if(this.length){url=$(this).attr(getAttrName(this[0]))||""}return $.url(url,strictMode)};$.url=function(url,strictMode){if(arguments.length===1&&url===true){strictMode=true;url=undefined}strictMode=strictMode||false;url=url||window.location.toString();return{data:parseUri(url,strictMode),attr:function(attr){attr=aliases[attr]||attr;return attr!==undefined?this.data.attr[attr]:this.data.attr},param:function(param){return param!==undefined?this.data.param.query[param]:this.data.param.query},fparam:function(param){return param!==undefined?this.data.param.fragment[param]:this.data.param.fragment},segment:function(seg){if(seg===undefined){return this.data.seg.path}else{seg=seg<0?this.data.seg.path.length+seg:seg-1;return this.data.seg.path[seg]}},fsegment:function(seg){if(seg===undefined){return this.data.seg.fragment}else{seg=seg<0?this.data.seg.fragment.length+seg:seg-1;return this.data.seg.fragment[seg]}}}}});(function(){if(typeof Function.empty!="function"){Function.empty=function(){}}if(typeof console=="undefined"){console={}}if(typeof console.log=="undefined"){console.log=Function.empty}if(typeof console.debug=="undefined"){console.debug=log}if(typeof console.info=="undefined"){console.info=log}if(typeof console.warn=="undefined"){console.warn=log}if(typeof console.error=="undefined"){console.error=log}if(typeof console.assert=="undefined"){console.assert=function(){var args=Array.prototype.slice.call(arguments);var parm=args.shift();if(!parm){console.error(arguments);throw new Error("Assert failed.")}}}if(typeof console.dir=="undefined"){console.dir=function(input){if(typeof JSON!="undefined"&&typeof JSON.stringify=="function"){console.log(JSON.stringify(input))}else{console.log(input.toString())}}}if(typeof console.dirxml=="undefined"){console.dirxml=console.dir}if(typeof console.trace=="undefined"){console.trace=Function.empty}if(typeof console.group=="undefined"){console.group=Function.empty}if(typeof console.groupCollapsed=="undefined"){console.groupCollapsed=Function.empty}if(typeof console.groupEnd=="undefined"){console.groupEnd=Function.empty}if(typeof console.time=="undefined"){console.time=Function.empty}if(typeof console.timeEnd=="undefined"){console.timeEnd=Function.empty}if(typeof console.profile=="undefined"){console.profile=Function.empty}if(typeof console.profileEnd=="undefined"){console.profileEnd=Function.empty}if(typeof console.count=="undefined"){console.count=Function.empty}function log(){if(typeof JSON!="undefined"&&typeof JSON.stringify=="function"){return console.log(JSON.stringify(arguments))}return console.log(arguments.toString())}})();(function(){_gliffy.BrowserDetect={init:function(){var isIE11=!!navigator.userAgent.match(/Trident\/7.0/);if(isIE11){this.browser="Explorer";this.version=11}else{this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version"}this.OS=this.searchString(this.dataOS)||"an unknown OS"},dump:function(){return"OS: "+this.OS+", Browser: "+this.browser+", Version: "+this.version},searchString:function(data){for(var i=0;i<data.length;i++){var dataString=data[i].string;var dataProp=data[i].prop;this.versionSearchString=data[i].versionSearch||data[i].identity;if(dataString){if(dataString.indexOf(data[i].subString)!=-1){return data[i].identity}}else{if(dataProp){return data[i].identity}}}},searchVersion:function(dataString){var index=dataString.indexOf(this.versionSearchString);if(index==-1){return}return parseFloat(dataString.substring(index+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};_gliffy.BrowserDetect.init()}());
/*!! Simple JavaScript Inheritance
 * By John Resig http://ejohn.org/
 * MIT Licensed.
 * http://ejohn.org/blog/simple-javascript-inheritance
 *
 */
(function(){var initializing=false,fnTest=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;var Class=function(){};Class.extend=function(prop){var _super=this.prototype;initializing=true;var prototype=new this();initializing=false;for(var name in prop){prototype[name]=typeof prop[name]=="function"&&typeof _super[name]=="function"&&fnTest.test(prop[name])?(function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);this._super=tmp;return ret}})(name,prop[name]):prop[name]}function Class(){if(!(this instanceof Class)){return new Class(arguments)}if(!initializing&&this.init){this.init.apply(this,arguments)}}Class.prototype=prototype;Class.prototype.constructor=Class;Class.extend=arguments.callee;return Class};_gliffy.Class=Class})();
/*!!
 * jqModal - Minimalist Modaling with jQuery
 *   (http://dev.iceburg.net/jquery/jqModal/)
 *
 * Copyright (c) 2007,2008 Brice Burgess <bhb@iceburg.net>
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 * 
 * $Version: 03/01/2009 +r14
 */
(function($){$.fn.jqm=function(o){var p={overlay:50,overlayClass:"jqmOverlay",closeClass:"jqmClose",trigger:".jqModal",ajax:F,ajaxText:"",target:F,modal:F,toTop:F,onShow:F,onHide:F,onLoad:F};return this.each(function(){if(this._jqm){return H[this._jqm].c=$.extend({},H[this._jqm].c,o)}s++;this._jqm=s;H[s]={c:$.extend(p,$.jqm.params,o),a:F,w:$(this).addClass("jqmID"+s),s:s};if(p.trigger){$(this).jqmAddTrigger(p.trigger)}})};$.fn.jqmAddClose=function(e){return hs(this,e,"jqmHide")};$.fn.jqmAddTrigger=function(e){return hs(this,e,"jqmShow")};$.fn.jqmShow=function(t){return this.each(function(){t=t||window.event;$.jqm.open(this._jqm,t)})};$.fn.jqmHide=function(t){return this.each(function(){t=t||window.event;$.jqm.close(this._jqm,t)})};$.jqm={hash:{},open:function(s,t){var h=H[s],c=h.c,cc="."+c.closeClass,z=(parseInt(h.w.css("z-index"))),z=(z>0)?z:3000,o=$("<div></div>").css({height:"100%",width:"100%",position:"fixed",left:0,top:0,"z-index":z-1,opacity:c.overlay/100});if(h.a){return F}h.t=t;h.a=true;h.w.css("z-index",z);if(c.modal){if(!A[0]){L("bind")}A.push(s)}else{if(c.overlay>0){h.w.jqmAddClose(o)}else{o=F}}h.o=(o)?o.addClass(c.overlayClass).prependTo("body"):F;if(ie6){$("html,body").css({height:"100%",width:"100%"});if(o){o=o.css({position:"absolute"})[0];for(var y in {Top:1,Left:1}){o.style.setExpression(y.toLowerCase(),"(_=(document.documentElement.scroll"+y+" || document.body.scroll"+y+"))+'px'")}}}if(c.ajax){var r=c.target||h.w,u=c.ajax,r=(typeof r=="string")?$(r,h.w):$(r),u=(u.substr(0,1)=="@")?$(t).attr(u.substring(1)):u;r.html(c.ajaxText).load(u,function(){if(c.onLoad){c.onLoad.call(this,h)}if(cc){h.w.jqmAddClose($(cc,h.w))}e(h)})}else{if(cc){h.w.jqmAddClose($(cc,h.w))}}if(c.toTop&&h.o){h.w.before('<span id="jqmP'+h.w[0]._jqm+'"></span>').insertAfter(h.o)}(c.onShow)?c.onShow(h):h.w.show();return F},close:function(s){var h=H[s];if(!h.a){return F}h.a=F;if(A[0]){A.pop();if(!A[0]){L("unbind")}}if(h.c.toTop&&h.o){$("#jqmP"+h.w[0]._jqm).after(h.w).remove()}if(h.c.onHide){h.c.onHide(h)}else{h.w.hide();if(h.o){h.o.remove()}}return F},params:{}};var s=0,H=$.jqm.hash,A=[],ie6=$.browser.msie&&($.browser.version=="6.0"),F=false,i=$('<iframe src="javascript:false;document.write(\'\');" class="jqm"></iframe>').css({opacity:0}),e=function(h){if(ie6){if(h.o){h.o.html('<p style="width:100%;height:100%"/>').prepend(i)}else{if(!$("iframe.jqm",h.w)[0]){h.w.prepend(i)}}}f(h)},f=function(h){try{if($(":input:visible",h.w).length>0){$(":input:visible",h.w)[0].focus()}}catch(_){}},L=function(t){$()[t]("keypress",m)[t]("keydown",m)[t]("mousedown",m)},m=function(e){var h=H[A[A.length-1]],r=(!$(e.target).parents(".jqmID"+h.s)[0]);if(r){f(h)}return !r},hs=function(w,t,c){return w.each(function(){var s=this._jqm;$(t).each(function(){if(!this[c]){this[c]=[];$(this).click(function(){for(var i in {jqmShow:1,jqmHide:1}){for(var s in this[i]){if(H[this[i][s]]){H[this[i][s]].w[i](this)}}}return F})}this[c].push(s)})})}})(jQuery);
/*!!
 * jquery.event.drag - v 2.0.0 
 * Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 * Open Source MIT License - http://threedubmedia.com/code/license
 */
(function($){$.fn.drag=function(str,arg,opts){var type=typeof str=="string"?str:"",fn=$.isFunction(str)?str:$.isFunction(arg)?arg:null;if(type.indexOf("drag")!==0){type="drag"+type}opts=(str==fn?arg:opts)||{};return fn?this.bind(type,opts,fn):this.trigger(type)};var $event=$.event,$special=$event.special,drag=$special.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:false,drop:true,click:false},datakey:"dragdata",livekey:"livedrag",add:function(obj){var data=$.data(this,drag.datakey),opts=obj.data||{};data.related+=1;if(!data.live&&obj.selector){data.live=true;$event.add(this,"draginit."+drag.livekey,drag.delegate)}$.each(drag.defaults,function(key,def){if(opts[key]!==undefined){data[key]=opts[key]}})},remove:function(){$.data(this,drag.datakey).related-=1},setup:function(){if($.data(this,drag.datakey)){return}var data=$.extend({related:0},drag.defaults);$.data(this,drag.datakey,data);$event.add(this,"mousedown",drag.init,data);if(this.attachEvent){this.attachEvent("ondragstart",drag.dontstart)}},teardown:function(){if($.data(this,drag.datakey).related){return}$.removeData(this,drag.datakey);$event.remove(this,"mousedown",drag.init);$event.remove(this,"draginit",drag.delegate);drag.textselect(true,$(this).closest("html").parent().get(0));if(this.detachEvent){this.detachEvent("ondragstart",drag.dontstart)}},init:function(event){var dd=event.data,results;if(dd.which>0&&event.which!=dd.which){return}if($(event.target).is(dd.not)){return}if(dd.handle&&!$(event.target).closest(dd.handle,event.currentTarget).length){return}dd.propagates=1;dd.document=this.ownerDocument;dd.interactions=[drag.interaction(this,dd)];dd.target=event.target;dd.pageX=event.pageX;dd.pageY=event.pageY;dd.dragging=null;results=drag.hijack(event,"draginit",dd);if(!dd.propagates){return}results=drag.flatten(results);if(results&&results.length){dd.interactions=[];$.each(results,function(){dd.interactions.push(drag.interaction(this,dd))})}dd.propagates=dd.interactions.length;if(dd.drop!==false&&$special.drop){$special.drop.handler(event,dd)}drag.textselect(false,dd.document);$event.add($(this).closest("html").parent().get(0),"mousemove mouseup",drag.handler,dd);return false},interaction:function(elem,dd){return{drag:elem,callback:new drag.callback(),droppable:[],offset:$(elem)[dd.relative?"position":"offset"]()||{top:0,left:0}}},handler:function(event){var dd=event.data;switch(event.type){case !dd.dragging&&"mousemove":if(Math.pow(event.pageX-dd.pageX,2)+Math.pow(event.pageY-dd.pageY,2)<Math.pow(dd.distance,2)){break}event.target=dd.target;drag.hijack(event,"dragstart",dd);if(dd.propagates){dd.dragging=true}case"mousemove":if(dd.dragging){drag.hijack(event,"drag",dd);if(dd.propagates){if(dd.drop!==false&&$special.drop){$special.drop.handler(event,dd)}break}event.type="mouseup"}case"mouseup":$event.remove(dd.document,"mousemove mouseup",drag.handler);if(dd.dragging){if(dd.drop!==false&&$special.drop){$special.drop.handler(event,dd)}drag.hijack(event,"dragend",dd)}drag.textselect(true,dd.document);if(dd.click===false&&dd.dragging){jQuery.event.triggered=true;setTimeout(function(){jQuery.event.triggered=false},20);dd.dragging=false}break}},delegate:function(event){var elems=[],target,events=$.data(this,"events")||{};$.each(events.live||[],function(i,obj){if(obj.preType.indexOf("drag")!==0){return}target=$(event.target).closest(obj.selector,event.currentTarget)[0];if(!target){return}$event.add(target,obj.origType+"."+drag.livekey,obj.origHandler,obj.data);if($.inArray(target,elems)<0){elems.push(target)}});if(!elems.length){return false}return $(elems).bind("dragend."+drag.livekey,function(){$event.remove(this,"."+drag.livekey)})},hijack:function(event,type,dd,x,elem){if(!dd){return}var orig={event:event.originalEvent,type:event.type},mode=type.indexOf("drop")?"drag":"drop",result,i=x||0,ia,$elems,callback,len=!isNaN(x)?x:dd.interactions.length;event.type=type;event.originalEvent=null;dd.results=[];do{if(ia=dd.interactions[i]){if(type!=="dragend"&&ia.cancelled){continue}callback=drag.properties(event,dd,ia);ia.results=[];$(elem||ia[mode]||dd.droppable).each(function(p,subject){callback.target=subject;result=subject?$event.handle.call(subject,event,callback):null;if(result===false){if(mode=="drag"){ia.cancelled=true;dd.propagates-=1}if(type=="drop"){ia[mode][p]=null}}else{if(type=="dropinit"){ia.droppable.push(drag.element(result)||subject)}}if(type=="dragstart"){ia.proxy=$(drag.element(result)||ia.drag)[0]}ia.results.push(result);delete event.result;if(type!=="dropinit"){return result}});dd.results[i]=drag.flatten(ia.results);if(type=="dropinit"){ia.droppable=drag.flatten(ia.droppable)}if(type=="dragstart"&&!ia.cancelled){callback.update()}}}while(++i<len);event.type=orig.type;event.originalEvent=orig.event;return drag.flatten(dd.results)},properties:function(event,dd,ia){var obj=ia.callback;obj.drag=ia.drag;obj.proxy=ia.proxy||ia.drag;obj.startX=dd.pageX;obj.startY=dd.pageY;obj.deltaX=event.pageX-dd.pageX;obj.deltaY=event.pageY-dd.pageY;obj.originalX=ia.offset.left;obj.originalY=ia.offset.top;obj.offsetX=event.pageX-(dd.pageX-obj.originalX);obj.offsetY=event.pageY-(dd.pageY-obj.originalY);obj.drop=drag.flatten((ia.drop||[]).slice());obj.available=drag.flatten((ia.droppable||[]).slice());return obj},element:function(arg){if(arg&&(arg.jquery||arg.nodeType==1)){return arg}},flatten:function(arr){return $.map(arr,function(member){return member&&member.jquery?$.makeArray(member):member&&member.length?drag.flatten(member):member})},textselect:function(bool,doc){$(doc)[bool?"unbind":"bind"]("selectstart",drag.dontstart).attr("unselectable",bool?"off":"on").css("MozUserSelect",bool?"":"none")},dontstart:function(){return false},callback:function(){}};drag.callback.prototype={update:function(){if($special.drop&&this.available.length){$.each(this.available,function(i){$special.drop.locate(this,i)})}}};$special.draginit=$special.dragstart=$special.dragend=drag})(jQuery);
/*!
 * jQuery throttle / debounce - v1.1 - 3/7/2010
 * http://benalman.com/projects/jquery-throttle-debounce-plugin/
 *
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
(function(window,undefined){var $=window.jQuery||window.Cowboy||(window.Cowboy={}),jq_throttle;$.throttle=jq_throttle=function(delay,no_trailing,callback,debounce_mode){var timeout_id,last_exec=0;if(typeof no_trailing!=="boolean"){debounce_mode=callback;callback=no_trailing;no_trailing=undefined}function wrapper(){var that=this,elapsed=+new Date()-last_exec,args=arguments;function exec(){last_exec=+new Date();callback.apply(that,args)}function clear(){timeout_id=undefined}if(debounce_mode&&!timeout_id){exec()}timeout_id&&clearTimeout(timeout_id);if(debounce_mode===undefined&&elapsed>delay){exec()}else{if(no_trailing!==true){timeout_id=setTimeout(debounce_mode?clear:exec,debounce_mode===undefined?delay-elapsed:delay)}}}if($.guid){wrapper.guid=callback.guid=callback.guid||$.guid++}return wrapper};$.debounce=function(delay,at_begin,callback){return callback===undefined?jq_throttle(delay,at_begin,false):jq_throttle(delay,callback,at_begin!==false)}})(this);(function(jQuery){jQuery.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"numpadplus",109:"numpadminus",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta",187:"plus",189:"minus",61:"ffplus",173:"ffminus"},shiftNums:{"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}};function keyHandler(handleObj){if(typeof handleObj.data!=="string"){return}var origHandler=handleObj.handler,keys=handleObj.data.toLowerCase().split(" ");handleObj.handler=function(event){if(this!==event.target&&(/textarea|select/i.test(event.target.nodeName)||event.target.type==="text")){return}var special=event.type!=="keypress"&&jQuery.hotkeys.specialKeys[event.which],character=String.fromCharCode(event.which).toLowerCase(),key,modif="",possible={};if(event.altKey&&special!=="alt"){modif+="alt+"}if(event.ctrlKey&&special!=="ctrl"){modif+="ctrl+"}if(event.metaKey&&!event.ctrlKey&&special!=="meta"){modif+="meta+"}if(event.shiftKey&&special!=="shift"){modif+="shift+"}if(special){possible[modif+special]=true}else{possible[modif+character]=true;possible[modif+jQuery.hotkeys.shiftNums[character]]=true;if(modif==="shift+"){possible[jQuery.hotkeys.shiftNums[character]]=true}}for(var i=0,l=keys.length;i<l;i++){if(possible[keys[i]]){return origHandler.apply(this,arguments)}}}}jQuery.each(["keydown","keyup","keypress"],function(){jQuery.event.special[this]={add:keyHandler}})})(jQuery);
/*! Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 *
 * Version: 3.0.6
 *
 * Requires: 1.2.2+
 */
(function($){var types=["DOMMouseScroll","mousewheel"];if($.event.fixHooks){for(var i=types.length;i;){$.event.fixHooks[types[--i]]=$.event.mouseHooks}}$.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var i=types.length;i;){this.addEventListener(types[--i],handler,false)}}else{this.onmousewheel=handler}},teardown:function(){if(this.removeEventListener){for(var i=types.length;i;){this.removeEventListener(types[--i],handler,false)}}else{this.onmousewheel=null}}};$.fn.extend({mousewheel:function(fn){return fn?this.bind("mousewheel",fn):this.trigger("mousewheel")},unmousewheel:function(fn){return this.unbind("mousewheel",fn)}});function handler(event){var orgEvent=event||window.event,args=[].slice.call(arguments,1),delta=0,returnValue=true,deltaX=0,deltaY=0;event=$.event.fix(orgEvent);event.type="mousewheel";if(orgEvent.wheelDelta){delta=orgEvent.wheelDelta/120}if(orgEvent.detail){delta=-orgEvent.detail/3}deltaY=delta;if(orgEvent.axis!==undefined&&orgEvent.axis===orgEvent.HORIZONTAL_AXIS){deltaY=0;deltaX=-1*delta}if(orgEvent.wheelDeltaY!==undefined){deltaY=orgEvent.wheelDeltaY/120}if(orgEvent.wheelDeltaX!==undefined){deltaX=-1*orgEvent.wheelDeltaX/120}args.unshift(event,delta,deltaX,deltaY);return($.event.dispatch||$.event.handle).apply(this,args)}})(jQuery);(function($){$.i18n={dict:null,setDictionary:function(i18n_dict){this.dict=i18n_dict},_:function(str,params){var result=str;if(this.dict&&this.dict[str]){result=this.dict[str]}return this.printf(result,params)},printf:function(str,args){if(!args){return str}var result="";var search=/%(\d+)\$s/g;var matches=search.exec(str);while(matches){var index=parseInt(matches[1],10)-1;str=str.replace("%"+matches[1]+"$s",(args[index]));matches=search.exec(str)}var parts=str.split("%s");if(parts.length>1){for(var i=0;i<args.length;i++){if(parts[i].length>0&&parts[i].lastIndexOf("%")==(parts[i].length-1)){parts[i]+="s"+parts.splice(i+1,1)[0]}result+=parts[i]+args[i]}}return result+parts[parts.length-1]}};$.fn._t=function(str,params){return $(this).text($.i18n._(str,params))}})(jQuery);(function($,undefined){var hidden="hidden",copy='<textarea style="position:absolute; top:-9999px; left:-9999px; right:auto; bottom:auto; word-wrap:break-word; height:0 !important; min-height:0 !important; overflow:hidden">',copyStyle=["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing"],oninput="oninput",onpropertychange="onpropertychange",test=$(copy)[0];test.setAttribute(oninput,"return");if($.isFunction(test[oninput])||onpropertychange in test){$.fn.autosize=function(o){var options=$.extend({className:null,heightCallback:function(){}},o);var className=options.className;var heightCallback=options.heightCallback;return this.each(function(){var ta=this,$ta=$(ta).css({overflow:hidden,overflowY:hidden,wordWrap:"break-word"}),mirror=$(copy).addClass(className||"autosizejs")[0],minHeight=$ta.height(),maxHeight=parseInt($ta.css("maxHeight"),10),active,i=copyStyle.length;maxHeight=maxHeight&&maxHeight>0?maxHeight:90000;function adjust(){var height,overflow;if(!active){active=true;mirror.value=ta.value;mirror.style.overflowY=ta.style.overflowY;mirror.style.width=$ta.css("width");mirror.scrollTop=0;mirror.scrollTop=90000;height=mirror.scrollTop;if(heightCallback){heightCallback(height)}overflow=hidden;if(height>maxHeight){height=maxHeight;overflow="scroll"}else{if(height<minHeight){height=minHeight}}ta.style.overflowY=overflow;ta.style.height=ta.style.minHeight=ta.style.maxHeight=height+"px";setTimeout(function(){active=false},1)}}while(i--){mirror.style[copyStyle[i]]=$ta.css(copyStyle[i])}$("body").append(mirror);if(onpropertychange in ta){if(oninput in ta){ta[oninput]=ta.onkeyup=adjust}else{ta[onpropertychange]=adjust}}else{ta[oninput]=adjust}$(window).resize(adjust);$ta.bind("autosize",adjust);adjust()})}}else{$.fn.autosize=function(){return this}}}(jQuery));
/*!!
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * @link   http://www.phpied.com/rgb-color-parser-in-javascript/
 * @license Use it if you like it
 */
(function(){var RGBColor=function(color_string){this.ok=false;if(color_string.charAt(0)=="#"){color_string=color_string.substr(1,6)}color_string=color_string.replace(/ /g,"");color_string=color_string.toLowerCase();var simple_colors={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var key in simple_colors){if(color_string==key){color_string=simple_colors[key]}}var color_defs=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(bits){return[parseInt(bits[1]),parseInt(bits[2]),parseInt(bits[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(bits){return[parseInt(bits[1],16),parseInt(bits[2],16),parseInt(bits[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(bits){return[parseInt(bits[1]+bits[1],16),parseInt(bits[2]+bits[2],16),parseInt(bits[3]+bits[3],16)]}}];for(var i=0;i<color_defs.length;i++){var re=color_defs[i].re;var processor=color_defs[i].process;var bits=re.exec(color_string);if(bits){channels=processor(bits);this.r=channels[0];this.g=channels[1];this.b=channels[2];this.ok=true}}this.r=(this.r<0||isNaN(this.r))?0:((this.r>255)?255:this.r);this.g=(this.g<0||isNaN(this.g))?0:((this.g>255)?255:this.g);this.b=(this.b<0||isNaN(this.b))?0:((this.b>255)?255:this.b);this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"};this.toRGBA=function(a){return"rgba("+this.r+", "+this.g+", "+this.b+", "+a+")"};this.toHex=function(){var r=this.r.toString(16);var g=this.g.toString(16);var b=this.b.toString(16);if(r.length==1){r="0"+r}if(g.length==1){g="0"+g}if(b.length==1){b="0"+b}return"#"+r+g+b};this.getHelpXML=function(){var examples=new Array();for(var i=0;i<color_defs.length;i++){var example=color_defs[i].example;for(var j=0;j<example.length;j++){examples[examples.length]=example[j]}}for(var sc in simple_colors){examples[examples.length]=sc}var xml=document.createElement("ul");xml.setAttribute("id","rgbcolor-examples");for(var i=0;i<examples.length;i++){try{var list_item=document.createElement("li");var list_color=new RGBColor(examples[i]);var example_div=document.createElement("div");example_div.style.cssText="margin: 3px; border: 1px solid black; background:"+list_color.toHex()+"; color:"+list_color.toHex();example_div.appendChild(document.createTextNode("test"));var list_item_value=document.createTextNode(" "+examples[i]+" -> "+list_color.toRGB()+" -> "+list_color.toHex());list_item.appendChild(example_div);list_item.appendChild(list_item_value);xml.appendChild(list_item)}catch(e){}}return xml}};_gliffy.RGBColor=RGBColor})();(function(){var isFiniteNumber=function(num){return isFinite(num)&&!isNaN(num)};var isNumber=function(val){return typeof val=="number"};var checkFiniteNumbers=function(args){if(_gliffy.Debug.FINITE_NUMBER_CHECKS){var len=args.length;for(var i=0;i<len;i++){if(!isFiniteNumber(args[i])){throw Error("Invalid transform parameters")}}}};var AffineTransform=function(opt_m00,opt_m10,opt_m01,opt_m11,opt_m02,opt_m12){checkFiniteNumbers(arguments);if(arguments.length==6){this.setTransform((opt_m00),(opt_m10),(opt_m01),(opt_m11),(opt_m02),(opt_m12))}else{if(arguments.length!=0){throw Error("Insufficient matrix parameters")}else{this.m00_=this.m11_=1;this.m10_=this.m01_=this.m02_=this.m12_=0}}};AffineTransform.prototype.isIdentity=function(){return this.m00_==1&&this.m10_==0&&this.m01_==0&&this.m11_==1&&this.m02_==0&&this.m12_==0};AffineTransform.prototype.clone=function(){return new AffineTransform(this.m00_,this.m10_,this.m01_,this.m11_,this.m02_,this.m12_)};AffineTransform.prototype.setTransform=function(m00,m10,m01,m11,m02,m12){checkFiniteNumbers(arguments);this.m00_=m00;this.m10_=m10;this.m01_=m01;this.m11_=m11;this.m02_=m02;this.m12_=m12;return this};AffineTransform.prototype.copyFrom=function(tx){checkFiniteNumbers([tx.m00_,tx.m01_,tx.m02_,tx.m10_,tx.m11_,tx.m12_]);this.m00_=tx.m00_;this.m10_=tx.m10_;this.m01_=tx.m01_;this.m11_=tx.m11_;this.m02_=tx.m02_;this.m12_=tx.m12_;return this};AffineTransform.prototype.scale=function(sx,sy){checkFiniteNumbers(arguments);this.m00_*=sx;this.m10_*=sx;this.m01_*=sy;this.m11_*=sy;return this};AffineTransform.prototype.preScale=function(sx,sy){checkFiniteNumbers(arguments);this.m00_*=sx;this.m01_*=sx;this.m02_*=sx;this.m10_*=sy;this.m11_*=sy;this.m12_*=sy;return this};AffineTransform.prototype.translate=function(dx,dy){checkFiniteNumbers(arguments);this.m02_+=dx*this.m00_+dy*this.m01_;this.m12_+=dx*this.m10_+dy*this.m11_;return this};AffineTransform.prototype.preTranslate=function(dx,dy){checkFiniteNumbers(arguments);this.m02_+=dx;this.m12_+=dy;return this};AffineTransform.prototype.rotate=function(theta,x,y){checkFiniteNumbers(arguments);return this.concatenate(AffineTransform.getRotateInstance(theta,x,y))};AffineTransform.prototype.preRotate=function(theta,x,y){checkFiniteNumbers(arguments);return this.preConcatenate(AffineTransform.getRotateInstance(theta,x,y))};AffineTransform.prototype.shear=function(shx,shy){checkFiniteNumbers(arguments);var m00=this.m00_;var m10=this.m10_;this.m00_+=shy*this.m01_;this.m10_+=shy*this.m11_;this.m01_+=shx*m00;this.m11_+=shx*m10;return this};AffineTransform.prototype.preShear=function(shx,shy){checkFiniteNumbers(arguments);var m00=this.m00_;var m01=this.m01_;var m02=this.m02_;this.m00_+=shx*this.m10_;this.m01_+=shx*this.m11_;this.m02_+=shx*this.m12_;this.m10_+=shy*m00;this.m11_+=shy*m01;this.m12_+=shy*m02;return this};AffineTransform.prototype.toString=function(){return"matrix("+[this.m00_,this.m10_,this.m01_,this.m11_,this.m02_,this.m12_].join(",")+")"};AffineTransform.prototype.getValue=function(i){var arr=[this.m00_,this.m10_,this.m01_,this.m11_,this.m02_,this.m12_];return arr[i]};AffineTransform.prototype.getValues=function(){return[this.m00_,this.m10_,this.m01_,this.m11_,this.m02_,this.m12_]};AffineTransform.prototype.getScaleX=function(){return this.m00_};AffineTransform.prototype.getScaleY=function(){return this.m11_};AffineTransform.prototype.getTranslateX=function(){return this.m02_};AffineTransform.prototype.getTranslateY=function(){return this.m12_};AffineTransform.prototype.getShearX=function(){return this.m01_};AffineTransform.prototype.getShearY=function(){return this.m10_};AffineTransform.prototype.concatenate=function(tx){checkFiniteNumbers([tx.m00_,tx.m01_,tx.m02_,tx.m10_,tx.m11_,tx.m12_]);var m0=this.m00_;var m1=this.m01_;this.m00_=tx.m00_*m0+tx.m10_*m1;this.m01_=tx.m01_*m0+tx.m11_*m1;this.m02_+=tx.m02_*m0+tx.m12_*m1;m0=this.m10_;m1=this.m11_;this.m10_=tx.m00_*m0+tx.m10_*m1;this.m11_=tx.m01_*m0+tx.m11_*m1;this.m12_+=tx.m02_*m0+tx.m12_*m1;return this};AffineTransform.prototype.preConcatenate=function(tx){checkFiniteNumbers([tx.m00_,tx.m01_,tx.m02_,tx.m10_,tx.m11_,tx.m12_]);var m0=this.m00_;var m1=this.m10_;this.m00_=tx.m00_*m0+tx.m01_*m1;this.m10_=tx.m10_*m0+tx.m11_*m1;m0=this.m01_;m1=this.m11_;this.m01_=tx.m00_*m0+tx.m01_*m1;this.m11_=tx.m10_*m0+tx.m11_*m1;m0=this.m02_;m1=this.m12_;this.m02_=tx.m00_*m0+tx.m01_*m1+tx.m02_;this.m12_=tx.m10_*m0+tx.m11_*m1+tx.m12_;return this};AffineTransform.prototype.transform=function(src,srcOff,dst,dstOff,numPts){var i=srcOff;var j=dstOff;var srcEnd=srcOff+2*numPts;while(i<srcEnd){var x=src[i++];var y=src[i++];dst[j++]=x*this.m00_+y*this.m01_+this.m02_;dst[j++]=x*this.m10_+y*this.m11_+this.m12_}};AffineTransform.prototype.transformPoint=function(x,y){checkFiniteNumbers(arguments);return{x:x*this.m00_+y*this.m01_+this.m02_,y:x*this.m10_+y*this.m11_+this.m12_}};AffineTransform.prototype.getDeterminant=function(){return this.m00_*this.m11_-this.m01_*this.m10_};AffineTransform.prototype.isInvertible=function(){var det=this.getDeterminant();return isFiniteNumber(det)&&isFiniteNumber(this.m02_)&&isFiniteNumber(this.m12_)&&det!=0};AffineTransform.prototype.createInverse=function(){var det=this.getDeterminant();return new AffineTransform(this.m11_/det,-this.m10_/det,-this.m01_/det,this.m00_/det,(this.m01_*this.m12_-this.m11_*this.m02_)/det,(this.m10_*this.m02_-this.m00_*this.m12_)/det)};AffineTransform.getScaleInstance=function(sx,sy){checkFiniteNumbers(arguments);return new AffineTransform().setToScale(sx,sy)};AffineTransform.getTranslateInstance=function(dx,dy){checkFiniteNumbers(arguments);return new AffineTransform().setToTranslation(dx,dy)};AffineTransform.getShearInstance=function(shx,shy){checkFiniteNumbers(arguments);return new AffineTransform().setToShear(shx,shy)};AffineTransform.getRotateInstance=function(theta,x,y){checkFiniteNumbers(arguments);return new AffineTransform().setToRotation(theta,x,y)};AffineTransform.prototype.setToScale=function(sx,sy){checkFiniteNumbers(arguments);return this.setTransform(sx,0,0,sy,0,0)};AffineTransform.prototype.setToTranslation=function(dx,dy){checkFiniteNumbers(arguments);return this.setTransform(1,0,0,1,dx,dy)};AffineTransform.prototype.setToShear=function(shx,shy){checkFiniteNumbers(arguments);return this.setTransform(1,shy,shx,1,0,0)};AffineTransform.prototype.setToRotation=function(theta,x,y){checkFiniteNumbers(arguments);var cos=Math.cos(theta);var sin=Math.sin(theta);return this.setTransform(cos,sin,-sin,cos,x-x*cos+y*sin,y-x*sin-y*cos)};AffineTransform.prototype.equals=function(tx){checkFiniteNumbers(arguments);if(this==tx){return true}if(!tx){return false}return this.m00_==tx.m00_&&this.m01_==tx.m01_&&this.m02_==tx.m02_&&this.m10_==tx.m10_&&this.m11_==tx.m11_&&this.m12_==tx.m12_};AffineTransform.prototype.toCssNoTranslate=function(o){var options=$.extend({isMoz:false,roundTranslate:false},o);if(options.isMoz){return"matrix("+this.m00_.toFixed(8)+","+this.m10_.toFixed(8)+","+this.m01_.toFixed(8)+","+this.m11_.toFixed(8)+",0,0)"}else{return"matrix("+this.m00_.toFixed(8)+","+this.m10_.toFixed(8)+","+this.m01_.toFixed(8)+","+this.m11_.toFixed(8)+",0,0)"}};AffineTransform.prototype.toCss=function(o){var options=$.extend({isMoz:false,roundTranslate:false},o);var translateX=options.roundTranslate?Math.round(this.m02_):this.m02_;var translateY=options.roundTranslate?Math.round(this.m12_):this.m12_;if(options.isMoz){return"matrix("+this.m00_.toFixed(8)+","+this.m10_.toFixed(8)+","+this.m01_.toFixed(8)+","+this.m11_.toFixed(8)+","+translateX+"px,"+translateY+"px)"}else{return"matrix("+this.m00_.toFixed(8)+","+this.m10_.toFixed(8)+","+this.m01_.toFixed(8)+","+this.m11_.toFixed(8)+","+translateX+","+translateY+")"}};_gliffy.AffineTransform=AffineTransform})();(function(){var candash=function(){var MAX_POINTS=24;var __abscissa=[[],[],[-0.5773502691896257,0.5773502691896257],[0,-0.7745966692414834,0.7745966692414834],[-0.33998104358485626,0.33998104358485626,-0.8611363115940526,0.8611363115940526],[0,-0.5384693101056831,0.5384693101056831,-0.906179845938664,0.906179845938664],[0.6612093864662645,-0.6612093864662645,-0.2386191860831969,0.2386191860831969,-0.932469514203152,0.932469514203152],[0,0.4058451513773972,-0.4058451513773972,-0.7415311855993945,0.7415311855993945,-0.9491079123427585,0.9491079123427585],[-0.1834346424956498,0.1834346424956498,-0.525532409916329,0.525532409916329,-0.7966664774136267,0.7966664774136267,-0.9602898564975363,0.9602898564975363],[0,-0.8360311073266358,0.8360311073266358,-0.9681602395076261,0.9681602395076261,-0.3242534234038089,0.3242534234038089,-0.6133714327005904,0.6133714327005904],[-0.14887433898163122,0.14887433898163122,-0.4333953941292472,0.4333953941292472,-0.6794095682990244,0.6794095682990244,-0.8650633666889845,0.8650633666889845,-0.9739065285171717,0.9739065285171717],[0,-0.26954315595234496,0.26954315595234496,-0.5190961292068118,0.5190961292068118,-0.7301520055740494,0.7301520055740494,-0.8870625997680953,0.8870625997680953,-0.978228658146057,0.978228658146057],[-0.1252334085114689,0.1252334085114689,-0.3678314989981802,0.3678314989981802,-0.5873179542866175,0.5873179542866175,-0.7699026741943047,0.7699026741943047,-0.9041172563704749,0.9041172563704749,-0.9815606342467192,0.9815606342467192],[0,-0.2304583159551348,0.2304583159551348,-0.44849275103644687,0.44849275103644687,-0.6423493394403402,0.6423493394403402,-0.8015780907333099,0.8015780907333099,-0.9175983992229779,0.9175983992229779,-0.9841830547185881,0.9841830547185881],[-0.10805494870734367,0.10805494870734367,-0.31911236892788974,0.31911236892788974,-0.5152486363581541,0.5152486363581541,-0.6872929048116855,0.6872929048116855,-0.827201315069765,0.827201315069765,-0.9284348836635735,0.9284348836635735,-0.9862838086968123,0.9862838086968123],[0,-0.20119409399743451,0.20119409399743451,-0.3941513470775634,0.3941513470775634,-0.5709721726085388,0.5709721726085388,-0.7244177313601701,0.7244177313601701,-0.8482065834104272,0.8482065834104272,-0.937273392400706,0.937273392400706,-0.9879925180204854,0.9879925180204854],[-0.09501250983763744,0.09501250983763744,-0.2816035507792589,0.2816035507792589,-0.45801677765722737,0.45801677765722737,-0.6178762444026438,0.6178762444026438,-0.755404408355003,0.755404408355003,-0.8656312023878318,0.8656312023878318,-0.9445750230732326,0.9445750230732326,-0.9894009349916499,0.9894009349916499],[0,-0.17848418149584785,0.17848418149584785,-0.3512317634538763,0.3512317634538763,-0.5126905370864769,0.5126905370864769,-0.6576711592166907,0.6576711592166907,-0.7815140038968014,0.7815140038968014,-0.8802391537269859,0.8802391537269859,-0.9506755217687678,0.9506755217687678,-0.9905754753144174,0.9905754753144174],[-0.0847750130417353,0.0847750130417353,-0.2518862256915055,0.2518862256915055,-0.41175116146284263,0.41175116146284263,-0.5597708310739475,0.5597708310739475,-0.6916870430603532,0.6916870430603532,-0.8037049589725231,0.8037049589725231,-0.8926024664975557,0.8926024664975557,-0.9558239495713977,0.9558239495713977,-0.9915651684209309,0.9915651684209309],[0,-0.16035864564022537,0.16035864564022537,-0.31656409996362983,0.31656409996362983,-0.46457074137596094,0.46457074137596094,-0.600545304661681,0.600545304661681,-0.7209661773352294,0.7209661773352294,-0.8227146565371428,0.8227146565371428,-0.9031559036148179,0.9031559036148179,-0.96020815213483,0.96020815213483,-0.9924068438435844,0.9924068438435844],[-0.07652652113349734,0.07652652113349734,-0.22778585114164507,0.22778585114164507,-0.37370608871541955,0.37370608871541955,-0.5108670019508271,0.5108670019508271,-0.636053680726515,0.636053680726515,-0.7463319064601508,0.7463319064601508,-0.8391169718222188,0.8391169718222188,-0.912234428251326,0.912234428251326,-0.9639719272779138,0.9639719272779138,-0.9931285991850949,0.9931285991850949],[0,-0.1455618541608951,0.1455618541608951,-0.2880213168024011,0.2880213168024011,-0.4243421202074388,0.4243421202074388,-0.5516188358872198,0.5516188358872198,-0.6671388041974123,0.6671388041974123,-0.7684399634756779,0.7684399634756779,-0.8533633645833173,0.8533633645833173,-0.9200993341504008,0.9200993341504008,-0.9672268385663063,0.9672268385663063,-0.9937521706203895,0.9937521706203895],[-0.06973927331972223,0.06973927331972223,-0.20786042668822127,0.20786042668822127,-0.34193582089208424,0.34193582089208424,-0.469355837986757,0.469355837986757,-0.5876404035069116,0.5876404035069116,-0.6944872631866827,0.6944872631866827,-0.7878168059792081,0.7878168059792081,-0.8658125777203002,0.8658125777203002,-0.926956772187174,0.926956772187174,-0.9700604978354287,0.9700604978354287,-0.9942945854823992,0.9942945854823992],[0,-0.1332568242984661,0.1332568242984661,-0.26413568097034495,0.26413568097034495,-0.3903010380302908,0.3903010380302908,-0.5095014778460075,0.5095014778460075,-0.6196098757636461,0.6196098757636461,-0.7186613631319502,0.7186613631319502,-0.8048884016188399,0.8048884016188399,-0.8767523582704416,0.8767523582704416,-0.9329710868260161,0.9329710868260161,-0.9725424712181152,0.9725424712181152,-0.9947693349975522,0.9947693349975522],[-0.06405689286260563,0.06405689286260563,-0.1911188674736163,0.1911188674736163,-0.3150426796961634,0.3150426796961634,-0.4337935076260451,0.4337935076260451,-0.5454214713888396,0.5454214713888396,-0.6480936519369755,0.6480936519369755,-0.7401241915785544,0.7401241915785544,-0.820001985973903,0.820001985973903,-0.8864155270044011,0.8864155270044011,-0.9382745520027328,0.9382745520027328,-0.9747285559713095,0.9747285559713095,-0.9951872199970213,0.9951872199970213]];var __weight=[[],[],[1,1],[0.8888888888888888,0.5555555555555556,0.5555555555555556],[0.6521451548625461,0.6521451548625461,0.34785484513745385,0.34785484513745385],[0.5688888888888889,0.47862867049936647,0.47862867049936647,0.23692688505618908,0.23692688505618908],[0.3607615730481386,0.3607615730481386,0.46791393457269104,0.46791393457269104,0.17132449237917036,0.17132449237917036],[0.4179591836734694,0.3818300505051189,0.3818300505051189,0.27970539148927664,0.27970539148927664,0.1294849661688697,0.1294849661688697],[0.362683783378362,0.362683783378362,0.31370664587788727,0.31370664587788727,0.22238103445337448,0.22238103445337448,0.10122853629037626,0.10122853629037626],[0.3302393550012598,0.1806481606948574,0.1806481606948574,0.08127438836157441,0.08127438836157441,0.31234707704000286,0.31234707704000286,0.26061069640293544,0.26061069640293544],[0.29552422471475287,0.29552422471475287,0.26926671930999635,0.26926671930999635,0.21908636251598204,0.21908636251598204,0.1494513491505806,0.1494513491505806,0.06667134430868814,0.06667134430868814],[0.2729250867779006,0.26280454451024665,0.26280454451024665,0.23319376459199048,0.23319376459199048,0.18629021092773426,0.18629021092773426,0.1255803694649046,0.1255803694649046,0.05566856711617366,0.05566856711617366],[0.24914704581340277,0.24914704581340277,0.2334925365383548,0.2334925365383548,0.20316742672306592,0.20316742672306592,0.16007832854334622,0.16007832854334622,0.10693932599531843,0.10693932599531843,0.04717533638651183,0.04717533638651183],[0.2325515532308739,0.22628318026289723,0.22628318026289723,0.2078160475368885,0.2078160475368885,0.17814598076194574,0.17814598076194574,0.13887351021978725,0.13887351021978725,0.09212149983772845,0.09212149983772845,0.04048400476531588,0.04048400476531588],[0.2152638534631578,0.2152638534631578,0.2051984637212956,0.2051984637212956,0.18553839747793782,0.18553839747793782,0.15720316715819355,0.15720316715819355,0.12151857068790319,0.12151857068790319,0.08015808715976021,0.08015808715976021,0.03511946033175186,0.03511946033175186],[0.2025782419255613,0.19843148532711158,0.19843148532711158,0.1861610000155622,0.1861610000155622,0.16626920581699392,0.16626920581699392,0.13957067792615432,0.13957067792615432,0.10715922046717194,0.10715922046717194,0.07036604748810812,0.07036604748810812,0.03075324199611727,0.03075324199611727],[0.1894506104550685,0.1894506104550685,0.18260341504492358,0.18260341504492358,0.16915651939500254,0.16915651939500254,0.14959598881657674,0.14959598881657674,0.12462897125553388,0.12462897125553388,0.09515851168249279,0.09515851168249279,0.062253523938647894,0.062253523938647894,0.027152459411754096,0.027152459411754096],[0.17944647035620653,0.17656270536699264,0.17656270536699264,0.16800410215645004,0.16800410215645004,0.15404576107681028,0.15404576107681028,0.13513636846852548,0.13513636846852548,0.11188384719340397,0.11188384719340397,0.08503614831717918,0.08503614831717918,0.0554595293739872,0.0554595293739872,0.02414830286854793,0.02414830286854793],[0.1691423829631436,0.1691423829631436,0.16427648374583273,0.16427648374583273,0.15468467512626524,0.15468467512626524,0.14064291467065065,0.14064291467065065,0.12255520671147846,0.12255520671147846,0.10094204410628717,0.10094204410628717,0.07642573025488905,0.07642573025488905,0.0497145488949698,0.0497145488949698,0.02161601352648331,0.02161601352648331],[0.1610544498487837,0.15896884339395434,0.15896884339395434,0.15276604206585967,0.15276604206585967,0.1426067021736066,0.1426067021736066,0.12875396253933621,0.12875396253933621,0.11156664554733399,0.11156664554733399,0.09149002162245,0.09149002162245,0.06904454273764123,0.06904454273764123,0.0448142267656996,0.0448142267656996,0.019461788229726478,0.019461788229726478],[0.15275338713072584,0.15275338713072584,0.14917298647260374,0.14917298647260374,0.14209610931838204,0.14209610931838204,0.13168863844917664,0.13168863844917664,0.11819453196151841,0.11819453196151841,0.10193011981724044,0.10193011981724044,0.08327674157670475,0.08327674157670475,0.06267204833410907,0.06267204833410907,0.04060142980038694,0.04060142980038694,0.017614007139152118,0.017614007139152118],[0.14608113364969041,0.14452440398997005,0.14452440398997005,0.13988739479107315,0.13988739479107315,0.13226893863333747,0.13226893863333747,0.12183141605372853,0.12183141605372853,0.10879729916714838,0.10879729916714838,0.09344442345603386,0.09344442345603386,0.0761001136283793,0.0761001136283793,0.057134425426857205,0.057134425426857205,0.036953789770852494,0.036953789770852494,0.016017228257774335,0.016017228257774335],[0.13925187285563198,0.13925187285563198,0.13654149834601517,0.13654149834601517,0.13117350478706238,0.13117350478706238,0.12325237681051242,0.12325237681051242,0.11293229608053922,0.11293229608053922,0.10041414444288096,0.10041414444288096,0.08594160621706773,0.08594160621706773,0.06979646842452049,0.06979646842452049,0.052293335152683286,0.052293335152683286,0.03377490158481415,0.03377490158481415,0.0146279952982722,0.0146279952982722],[0.13365457218610619,0.1324620394046966,0.1324620394046966,0.12890572218808216,0.12890572218808216,0.12304908430672953,0.12304908430672953,0.11499664022241136,0.11499664022241136,0.10489209146454141,0.10489209146454141,0.09291576606003515,0.09291576606003515,0.07928141177671895,0.07928141177671895,0.06423242140852585,0.06423242140852585,0.04803767173108467,0.04803767173108467,0.030988005856979445,0.030988005856979445,0.013411859487141771,0.013411859487141771],[0.12793819534675216,0.12793819534675216,0.1258374563468283,0.1258374563468283,0.12167047292780339,0.12167047292780339,0.1155056680537256,0.1155056680537256,0.10744427011596563,0.10744427011596563,0.09761865210411388,0.09761865210411388,0.08619016153195327,0.08619016153195327,0.0733464814110803,0.0733464814110803,0.05929858491543678,0.05929858491543678,0.04427743881741981,0.04427743881741981,0.028531388628933663,0.028531388628933663,0.0123412297999872,0.0123412297999872]];var __approximateIntegralValue=function(_f,_a,_b,_n){if(!_n){_n=5}if(isNaN(_a)||isNaN(_b)){throw"invalid parameters: _a or _b is not a number"}if(_a>=_b){throw"invalid parameters: _a is greater or equal to _b"}if(!(typeof _f==="function")){throw"invalid parameters: _f is not a function"}if(isNaN(_n)||_n<2){throw"invalid parameters: _n is not a number or _n is less than 2"}var n=Math.max(_n,2);n=Math.min(n,MAX_POINTS);var sum=0;if(_a==-1&&_b==1){for(var i=0;i<n;++i){sum+=_f(__abscissa[n][i]*__weight[n][i])}return sum}else{var mult=0.5*(_b-_a);var ab2=0.5*(_a+_b);for(i=0;i<n;++i){sum+=_f(ab2+mult*__abscissa[n][i])*__weight[n][i]}return mult*sum}};var __quadraticCurve=function(t,p1,p2,p3){var mt=1-t;return mt*mt*p1+2*mt*t*p2+t*t*p3};var __cubicCurve=function(t,p1,p2,p3,p4){var mt=1-t;return mt*mt*mt*p1+3*mt*mt*t*p2+3*mt*t*t*p3+t*t*t*p4};var __base2=function(t,p1,p2,p3){return t*(2*p1-4*p2+2*p3)-2*p1+2*p2};var __base2Root=function(s,c,e){var numerator=s-c;var denominator=s-2*c+e;if(denominator===0){return -1}return numerator/denominator};var __base3=function(t,p1,p2,p3,p4){var t1=-3*p1+9*p2-9*p3+3*p4;var t2=t*t1+6*p1-12*p2+6*p3;return t*t2-3*p1+3*p2};var __base3Roots=function(s,c1,c2,e){var tl=-s+2*c1-c2;var tr=Math.sqrt(-s*(c2-e)+c1*c1-c1*(c2+e)+c2*c2);var denominator=-s+3*c1-3*c2+e;if(denominator===0){return[-1,-1]}return[(tl-tr)/denominator,(tl+tr)/denominator]};var __lineDistance=function(start,end){return Math.sqrt(Math.pow(end.x-start.x,2)+Math.pow(end.y-start.y,2))};var __quadraticBezierDistance=function(start,control,end,start_t,end_t,steps){if(start_t<0||start_t>1||start_t>end_t||end_t<0||end_t>1){throw new Error("values of t must be between 0 and 1.0")}return __approximateIntegralValue(function(_t){var xPrime=__base2(_t,start.x,control.x,end.x);var yPrime=__base2(_t,start.y,control.y,end.y);return Math.sqrt(xPrime*xPrime+yPrime*yPrime)},start_t,end_t,steps)};var __cubicBezierDistance=function(start,control1,control2,end,start_t,end_t,steps){if(start_t<0||start_t>1||start_t>end_t||end_t<0||end_t>1){throw new Error("values of t must be between 0 and 1.0")}return __approximateIntegralValue(function(_t){var xPrime=__base3(_t,start.x,control1.x,control2.x,end.x);var yPrime=__base3(_t,start.y,control1.y,control2.y,end.y);return Math.sqrt(xPrime*xPrime+yPrime*yPrime)},start_t,end_t,steps)};var __linearBoundingBox=function(start,end){return[{x:Math.min(start.x,end.x),y:Math.min(start.y,end.y)},{x:Math.max(start.x,end.x),y:Math.max(start.y,end.y)}]};var __quadraticBoundingBox=function(start,control1,end){var linearBounds=__linearBoundingBox(start,end);if(control1.x<linearBounds[0].x||control1.y<linearBounds[0].y||control1.x>linearBounds[1].x||control1.y>linearBounds[1].y){var tx=__base2Root(start.x,control1.x,end.x);if(tx>=0&&tx<=1){var x=__quadraticCurve(tx,start.x,control1.x,end.x);linearBounds[0].x=Math.min(linearBounds[0].x,x);linearBounds[1].x=Math.max(linearBounds[1].x,x)}var ty=__base2Root(start.y,control1.y,end.y);if(ty>=0&&ty<=1){var y=__quadraticCurve(ty,start.y,control1.y,end.y);linearBounds[0].y=Math.min(linearBounds[0].y,y);linearBounds[1].y=Math.max(linearBounds[1].y,y)}}return linearBounds};var __cubicBoundingBox=function(start,control1,control2,end){var linearBounds=__linearBoundingBox(start,end);if(control1.x<linearBounds[0].x||control1.y<linearBounds[0].y||control1.x>linearBounds[1].x||control1.y>linearBounds[1].y||control2.x<linearBounds[0].x||control2.y<linearBounds[0].y||control2.x>linearBounds[1].x||control2.y>linearBounds[1].y){var i;var tx=__base3Roots(start.x,control1.x,control2.x,end.x);for(i=0;i<tx.length;i++){var t=tx[i];if(t>=0&&t<=1){var x=__cubicCurve(t,start.x,control1.x,control2.x,end.x);linearBounds[0].x=Math.min(linearBounds[0].x,x);linearBounds[1].x=Math.max(linearBounds[1].x,x)}}var ty=__base3Roots(start.y,control1.y,control2.y,end.y);for(i=0;i<ty.length;i++){var t=ty[i];if(t>=0&&t<=1){var y=__cubicCurve(t,start.y,control1.y,control2.y,end.y);linearBounds[0].y=Math.min(linearBounds[0].y,y);linearBounds[1].y=Math.max(linearBounds[1].y,y)}}}return linearBounds};var __newtonsMethodQuadratic=function(start,control,end,distance,n,iterations){var xPrime=__base2(n,start.x,control.x,end.x);var yPrime=__base2(n,start.y,control.y,end.y);var nPlusOne=n-(__quadraticBezierDistance(start,control,end,0,n,12)-distance)/Math.sqrt(xPrime*xPrime+yPrime*yPrime);if(nPlusOne<=0){nPlusOne=0.00001}if(nPlusOne>=1){nPlusOne=0.99999}if(iterations===0){return nPlusOne}else{return __newtonsMethodQuadratic(start,control,end,distance,nPlusOne,--iterations)}};var __newtonsMethodCubic=function(start,control1,control2,end,distance,n,iterations){var xPrime=__base3(n,start.x,control1.x,control2.x,end.x);var yPrime=__base3(n,start.y,control1.y,control2.y,end.y);var nPlusOne=n-(__cubicBezierDistance(start,control1,control2,end,0,n,12)-distance)/Math.sqrt(xPrime*xPrime+yPrime*yPrime);if(nPlusOne<=0){nPlusOne=0.00001}if(nPlusOne>=1){nPlusOne=0.99999}if(iterations===0){return nPlusOne}else{return __newtonsMethodCubic(start,control1,control2,end,distance,nPlusOne,--iterations)}};var __splitQuadraticCurve=function(start,control,end,t){var a={x:(1-t)*start.x+t*control.x,y:(1-t)*start.y+t*control.y};var b={x:(1-t)*control.x+t*end.x,y:(1-t)*control.y+t*end.y};var c={x:(1-t)*a.x+t*b.x,y:(1-t)*a.y+t*b.y};return[[start,a,c],[c,b,end]]};var __splitCubicCurve=function(start,control1,control2,end,t){var a={x:(1-t)*start.x+t*control1.x,y:(1-t)*start.y+t*control1.y};var b={x:(1-t)*control1.x+t*control2.x,y:(1-t)*control1.y+t*control2.y};var c={x:(1-t)*control2.x+t*end.x,y:(1-t)*control2.y+t*end.y};var m={x:(1-t)*a.x+t*b.x,y:(1-t)*a.y+t*b.y};var n={x:(1-t)*b.x+t*c.x,y:(1-t)*b.y+t*c.y};var p={x:(1-t)*m.x+t*n.x,y:(1-t)*m.y+t*n.y};return[[start,a,m,p],[p,n,c,end]]};var __splitLine=function(start,end,distance){var splitPoint,unitVector,vector;vector=_gliffy.Vec2.difference(end,start);unitVector=vector.safeNormalize();splitPoint={x:start.x+distance*unitVector.x,y:start.y+distance*unitVector.y};return[[start,splitPoint],[splitPoint,end]]};var __zeroSumDashArrayFix=function(dasharray){var i,sum;sum=0;if(dasharray instanceof Array){for(i=0;i<dasharray.length;i++){sum+=parseFloat(dasharray[i])}}return sum===0||sum!==sum?[Number.MAX_VALUE]:dasharray};var RECURSIVE_CALL_LIMIT=3000;return{lineTo:function(start,end,ctx,callLayer){if(!callLayer){callLayer=0}if(callLayer>RECURSIVE_CALL_LIMIT){return}ctx.dasharray=__zeroSumDashArrayFix(ctx.dasharray);if(!ctx.dasharray){throw new Error("No dasharray property set on canvas context. Ex: ctx.dasharray = [10,5]")}if(!ctx.dashinfo){ctx.dashinfo={index:0,remainder:0}}var index=ctx.dashinfo.index%ctx.dasharray.length;var dash=ctx.dasharray[index];if(ctx.dashinfo.remainder&&ctx.dashinfo.remainder>0){dash=ctx.dashinfo.remainder}else{ctx.moveTo(start.x,start.y)}var distance=__lineDistance(start,end);if(distance<dash){if(index%2===0){ctx.lineTo(end.x,end.y)}ctx.dashinfo={remainder:(dash-distance),index:index}}else{var lines=__splitLine(start,end,dash);if(index%2===0){ctx.lineTo(lines[0][1].x,lines[0][1].y)}ctx.dashinfo={remainder:0,index:++index};this.lineTo(lines[1][0],lines[1][1],ctx,callLayer+1)}},quadraticCurveTo:function(start,control,end,ctx,callLayer){if(!callLayer){callLayer=0}if(callLayer>RECURSIVE_CALL_LIMIT){return}ctx.dasharray=__zeroSumDashArrayFix(ctx.dasharray);if(!ctx.dasharray){throw new Error("No dasharray property set on canvas context. Ex: ctx.dasharray = [10,5]")}if(!ctx.dashinfo){ctx.dashinfo={index:0,remainder:0}}var index=ctx.dashinfo.index%ctx.dasharray.length;var dash=ctx.dasharray[index];if(ctx.dashinfo.remainder&&ctx.dashinfo.remainder>0){dash=ctx.dashinfo.remainder}else{ctx.moveTo(start.x,start.y)}var distance=__quadraticBezierDistance(start,control,end,0,1,12);if(distance<dash){if(index%2===0){ctx.quadraticCurveTo(control.x,control.y,end.x,end.y)}ctx.dashinfo={remainder:dash-distance,index:index}}else{var t=__newtonsMethodQuadratic(start,control,end,dash,0.5,3);var curves=__splitQuadraticCurve(start,control,end,t);if(index%2===0){ctx.quadraticCurveTo(curves[0][1].x,curves[0][1].y,curves[0][2].x,curves[0][2].y)}ctx.dashinfo={remainder:0,index:++index};this.quadraticCurveTo(curves[1][0],curves[1][1],curves[1][2],ctx,callLayer+1)}},bezierCurveTo:function(start,control1,control2,end,ctx,callLayer){if(!callLayer){callLayer=0}if(callLayer>RECURSIVE_CALL_LIMIT){return}ctx.dasharray=__zeroSumDashArrayFix(ctx.dasharray);if(!ctx.dasharray){throw new Error("No dasharray property set on canvas context. Ex: ctx.dasharray = [10,5]")}if(!ctx.dashinfo){ctx.dashinfo={index:0,remainder:0}}var index=ctx.dashinfo.index%ctx.dasharray.length;var dash=ctx.dasharray[index];if(ctx.dashinfo.remainder&&ctx.dashinfo.remainder>0){dash=ctx.dashinfo.remainder}else{ctx.moveTo(start.x,start.y)}var distance=__cubicBezierDistance(start,control1,control2,end,0,1,12);if(distance<dash){if(index%2===0){ctx.bezierCurveTo(control1.x,control1.y,control2.x,control2.y,end.x,end.y)}ctx.dashinfo={remainder:dash-distance,index:index}}else{var t=__newtonsMethodCubic(start,control1,control2,end,dash,0.5,3);var curves=__splitCubicCurve(start,control1,control2,end,t);if(index%2===0){ctx.bezierCurveTo(curves[0][1].x,curves[0][1].y,curves[0][2].x,curves[0][2].y,curves[0][3].x,curves[0][3].y)}ctx.dashinfo={remainder:0,index:++index};this.bezierCurveTo(curves[1][0],curves[1][1],curves[1][2],curves[1][3],ctx,callLayer+1)}},cleanCtx:function(ctx){delete ctx.dashinfo;delete ctx.dasharray},getPathDistance:function(path){var totalDistance=0;var distanceArray=[];for(var i=0;i<path.length;i++){var line=path[i];switch(line.length){case 2:var d=__lineDistance(line[0],line[1]);distanceArray.push(d);totalDistance+=d;break;case 3:var d=__quadraticBezierDistance(line[0],line[1],line[2],0,1,12);distanceArray.push(d);totalDistance+=d;break;case 4:var d=__cubicBezierDistance(line[0],line[1],line[2],line[3],0,1,12);distanceArray.push(d);totalDistance+=d;break;default:throw new Error("a line with "+line.length+" points is unsupported")}}return{totalDistance:totalDistance,distanceArray:distanceArray}},getPointInPathAtT:function(path,t){if(t===0){return path[0][0]}else{if(t===1){var last=path[path.length-1];return last[last.length-1]}else{var d=this.getPathDistance(path);return this.getPointInPathAtDistance(path,d.totalDistance*t,d)}}},getBoundingBox:function(path){var bounds;for(var i=0;i<path.length;i++){var line=path[i];switch(line.length){case 2:var b=__linearBoundingBox(line[0],line[1]);if(!bounds){bounds=b}else{bounds[0].x=Math.min(bounds[0].x,b[0].x);bounds[0].y=Math.min(bounds[0].y,b[0].y);bounds[1].x=Math.max(bounds[1].x,b[1].x);bounds[1].y=Math.max(bounds[1].y,b[1].y)}break;case 3:var b=__quadraticBoundingBox(line[0],line[1],line[2]);if(!bounds){bounds=b}else{bounds[0].x=Math.min(bounds[0].x,b[0].x);bounds[0].y=Math.min(bounds[0].y,b[0].y);bounds[1].x=Math.max(bounds[1].x,b[1].x);bounds[1].y=Math.max(bounds[1].y,b[1].y)}break;case 4:var b=__cubicBoundingBox(line[0],line[1],line[2],line[3]);if(!bounds){bounds=b}else{bounds[0].x=Math.min(bounds[0].x,b[0].x);bounds[0].y=Math.min(bounds[0].y,b[0].y);bounds[1].x=Math.max(bounds[1].x,b[1].x);bounds[1].y=Math.max(bounds[1].y,b[1].y)}break;default:throw new Error("a line with "+line.length+" points is unsupported")}}return bounds},getPointInPathAtDistance:function(path,distance,distanceInfo){if(distance===0){return path[0][0]}else{var d=(distanceInfo)?distanceInfo:this.getPathDistance(path);var i=0,distanceLeft=distance;while(distanceLeft>d.distanceArray[i]){distanceLeft-=d.distanceArray[i];i++}if(i>=path.length){var points=path[i-1];return points[points.length-1]}switch(path[i].length){case 2:return __splitLine(path[i][0],path[i][1],distanceLeft)[0][1];case 3:var t=__newtonsMethodQuadratic(path[i][0],path[i][1],path[i][2],distanceLeft,0.5,3);return __splitQuadraticCurve(path[i][0],path[i][1],path[i][2],t)[0][2];case 4:var t=__newtonsMethodCubic(path[i][0],path[i][1],path[i][2],path[i][3],distanceLeft,0.5,3);return __splitCubicCurve(path[i][0],path[i][1],path[i][2],path[i][3],t)[0][3];default:throw new Error("a line with "+path[i].length+" points is unsupported")}}},library:{__splitLine:__splitLine}}};_gliffy.candash=candash()})();(function(){var Point,PathParser,Linevg,compressSpaces,trim,drawPath,generatedDrawPath;compressSpaces=function(s){return s.replace(/[\s\r\t\n]+/gm," ")};trim=function(s){return s.replace(/^\s+|\s+$/g,"")};Point=function(x,y){this.x=x;this.y=y};Point.prototype.angleTo=function(p){return Math.atan2(p.y-this.y,p.x-this.x)};Point.prototype.applyTransform=function(v){var xp=this.x*v[0]+this.y*v[2]+v[4];var yp=this.x*v[1]+this.y*v[3]+v[5];this.x=xp;this.y=yp};PathParser=function(d){var i,tokens=[];for(i=0;i<d.length;i++){tokens.push(d[i].name);tokens=tokens.concat(d[i].args.split(/[,\s+)]/))}this.tokens=tokens};PathParser.prototype.reset=function(){this.i=-1;this.command="";this.previousCommand="";this.start=new Point(0,0);this.control=new Point(0,0);this.current=new Point(0,0);this.points=[];this.angles=[]};PathParser.prototype.isEnd=function(){return this.i>=this.tokens.length-1};PathParser.prototype.isCommandOrEnd=function(){if(this.isEnd()){return true}return this.tokens[this.i+1].match(/^[A-Za-z]$/)!=null};PathParser.prototype.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return true;break}return false};PathParser.prototype.getToken=function(){this.i++;return this.tokens[this.i]};PathParser.prototype.getScalar=function(){return parseFloat(this.getToken())};PathParser.prototype.nextCommand=function(){this.previousCommand=this.command;this.command=this.getToken()};PathParser.prototype.getPoint=function(){var p=new Point(this.getScalar(),this.getScalar());return this.makeAbsolute(p)};PathParser.prototype.getAsControlPoint=function(){var p=this.getPoint();this.control=p;return p};PathParser.prototype.getAsCurrentPoint=function(){var p=this.getPoint();this.current=p;return p};PathParser.prototype.getReflectedControlPoint=function(){if(this.previousCommand.toLowerCase()!="c"&&this.previousCommand.toLowerCase()!="s"){return this.current}return new Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y)};PathParser.prototype.makeAbsolute=function(p){if(this.isRelativeCommand()){p.x+=this.current.x;p.y+=this.current.y}return p};PathParser.prototype.addMarker=function(p,from,priorTo){var pointPath,length,referencePointForAngle;pointPath=_gliffy.Utils.buildPointsPathFromDrawingCommand(generatedDrawPath);length=_gliffy.candash.getPathDistance(pointPath);if(pointPath.length>0){referencePointForAngle=_gliffy.candash.getPointInPathAtDistance(pointPath,10,length)}else{referencePointForAngle=p}if(priorTo!=null&&this.angles.length>0&&this.angles[this.angles.length-1]==null){this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(referencePointForAngle)}this.addMarkerAngle(p,from==null?null:from.angleTo(p))};PathParser.prototype.addMarkerAngle=function(p,a){this.points.push(p);this.angles.push(a)};PathParser.prototype.getMarkerPoints=function(){return this.points};PathParser.prototype.getMarkerAngles=function(){for(var i=0;i<this.angles.length;i++){if(this.angles[i]==null){for(var j=i+1;j<this.angles.length;j++){if(this.angles[j]!=null){this.angles[i]=this.angles[j];break}}}}return this.angles};PathParser.prototype.generateDrawPath=function(){var drawPath=[],drawCommandObject,coordinatePairCounter=1,self=this;_.each(this.tokens,function(pathToken){if(self.isPathCommand(pathToken)){if(drawCommandObject){drawPath.push(drawCommandObject);coordinatePairCounter=1}drawCommandObject={};drawCommandObject.name=pathToken}else{if(coordinatePairCounter%3===0){drawCommandObject.args+=" "+pathToken}else{if(drawCommandObject.args===undefined){drawCommandObject.args=pathToken}else{drawCommandObject.args+=","+pathToken}}coordinatePairCounter+=1}});return drawPath};PathParser.prototype.isPathCommand=function(path){switch(path.toLowerCase()){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return true;break}return false};drawPath=function(ctx,pp){var p,c,curr,p1,cntrl,cp,currp,cpp,centp,newP,r,rx,ry,sx,sy,u,v,ad,a,m,l,a1,xAxisRotation,largeArcFlag,sweepFlag,halfWay;pp.reset();if(ctx!=null){ctx.beginPath()}while(!pp.isEnd()){pp.nextCommand();switch(pp.command){case"M":case"m":p=pp.getAsCurrentPoint();pp.addMarker(p);if(ctx!=null){ctx.moveTo(p.x,p.y)}pp.start=pp.current;while(!pp.isCommandOrEnd()){p=pp.getAsCurrentPoint();pp.addMarker(p,pp.start);if(ctx!=null){ctx.lineTo(p.x,p.y)}}break;case"L":case"l":while(!pp.isCommandOrEnd()){c=pp.current;p=pp.getAsCurrentPoint();pp.addMarker(p,c);if(ctx!=null){if(ctx.dasharray&&ctx.dasharray.length>0){_gliffy.candash.lineTo({x:c.x,y:c.y},{x:p.x,y:p.y},ctx)}else{ctx.lineTo(p.x,p.y)}}}break;case"H":case"h":while(!pp.isCommandOrEnd()){newP=new Point((pp.isRelativeCommand()?pp.current.x:0)+pp.getScalar(),pp.current.y);pp.addMarker(newP,pp.current);pp.current=newP;if(ctx!=null){ctx.lineTo(pp.current.x,pp.current.y)}}break;case"V":case"v":while(!pp.isCommandOrEnd()){newP=new Point(pp.current.x,(pp.isRelativeCommand()?pp.current.y:0)+pp.getScalar());pp.addMarker(newP,pp.current);pp.current=newP;if(ctx!=null){ctx.lineTo(pp.current.x,pp.current.y)}}break;case"C":case"c":while(!pp.isCommandOrEnd()){curr=pp.current;p1=pp.getPoint();cntrl=pp.getAsControlPoint();cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,p1);if(ctx!=null){if(ctx.dasharray&&ctx.dasharray.length>0){_gliffy.candash.bezierCurveTo({x:curr.x,y:curr.y},{x:p1.x,y:p1.y},{x:cntrl.x,y:cntrl.y},{x:cp.x,y:cp.y},ctx)}else{ctx.bezierCurveTo(p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y)}}}break;case"S":case"s":while(!pp.isCommandOrEnd()){curr=pp.current;p1=pp.getReflectedControlPoint();cntrl=pp.getAsControlPoint();cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,p1);if(ctx!=null){ctx.bezierCurveTo(p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y)}}break;case"Q":case"q":while(!pp.isCommandOrEnd()){curr=pp.current;cntrl=pp.getAsControlPoint();cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,cntrl);if(ctx!=null){if(ctx.dasharray&&ctx.dasharray.length>0){_gliffy.candash.quadraticCurveTo({x:curr.x,y:curr.y},{x:cntrl.x,y:cntrl.y},{x:cp.x,y:cp.y},ctx)}else{ctx.quadraticCurveTo(cntrl.x,cntrl.y,cp.x,cp.y)}}}break;case"T":case"t":while(!pp.isCommandOrEnd()){curr=pp.current;cntrl=pp.getReflectedControlPoint();pp.control=cntrl;cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,cntrl);if(ctx!=null){ctx.quadraticCurveTo(cntrl.x,cntrl.y,cp.x,cp.y)}}break;case"A":case"a":while(!pp.isCommandOrEnd()){curr=pp.current;rx=pp.getScalar();ry=pp.getScalar();xAxisRotation=pp.getScalar()*(Math.PI/180);largeArcFlag=pp.getScalar();sweepFlag=pp.getScalar();cp=pp.getAsCurrentPoint();currp=new Point(Math.cos(xAxisRotation)*(curr.x-cp.x)/2+Math.sin(xAxisRotation)*(curr.y-cp.y)/2,-Math.sin(xAxisRotation)*(curr.x-cp.x)/2+Math.cos(xAxisRotation)*(curr.y-cp.y)/2);l=Math.pow(currp.x,2)/Math.pow(rx,2)+Math.pow(currp.y,2)/Math.pow(ry,2);if(l>1){rx*=Math.sqrt(l);ry*=Math.sqrt(l)}var s=(largeArcFlag==sweepFlag?-1:1)*Math.sqrt(((Math.pow(rx,2)*Math.pow(ry,2))-(Math.pow(rx,2)*Math.pow(currp.y,2))-(Math.pow(ry,2)*Math.pow(currp.x,2)))/(Math.pow(rx,2)*Math.pow(currp.y,2)+Math.pow(ry,2)*Math.pow(currp.x,2)));if(isNaN(s)){s=0}cpp=new Point(s*rx*currp.y/ry,s*-ry*currp.x/rx);centp=new Point((curr.x+cp.x)/2+Math.cos(xAxisRotation)*cpp.x-Math.sin(xAxisRotation)*cpp.y,(curr.y+cp.y)/2+Math.sin(xAxisRotation)*cpp.x+Math.cos(xAxisRotation)*cpp.y);m=function(v){return Math.sqrt(Math.pow(v[0],2)+Math.pow(v[1],2))};r=function(u,v){return(u[0]*v[0]+u[1]*v[1])/(m(u)*m(v))};a=function(u,v){return(u[0]*v[1]<u[1]*v[0]?-1:1)*Math.acos(r(u,v))};a1=a([1,0],[(currp.x-cpp.x)/rx,(currp.y-cpp.y)/ry]);u=[(currp.x-cpp.x)/rx,(currp.y-cpp.y)/ry];v=[(-currp.x-cpp.x)/rx,(-currp.y-cpp.y)/ry];ad=a(u,v);if(r(u,v)<=-1){ad=Math.PI}if(r(u,v)>=1){ad=0}if(sweepFlag==0&&ad>0){ad=ad-2*Math.PI}if(sweepFlag==1&&ad<0){ad=ad+2*Math.PI}halfWay=new Point(centp.x-rx*Math.cos((a1+ad)/2),centp.y-ry*Math.sin((a1+ad)/2));pp.addMarkerAngle(halfWay,(a1+ad)/2+(sweepFlag==0?1:-1)*Math.PI/2);pp.addMarkerAngle(cp,ad+(sweepFlag==0?1:-1)*Math.PI/2);if(ctx!=null){r=rx>ry?rx:ry;sx=rx>ry?1:rx/ry;sy=rx>ry?ry/rx:1;ctx.translate(centp.x,centp.y);ctx.rotate(xAxisRotation);ctx.scale(sx,sy);ctx.arc(0,0,r,a1,a1+ad,1-sweepFlag);ctx.scale(1/sx,1/sy);ctx.rotate(-xAxisRotation);ctx.translate(-centp.x,-centp.y)}}break;case"Z":case"z":if(ctx!=null){ctx.closePath()}pp.current=pp.start}}ctx.stroke()};Linevg=function(d){this.PathParser=new PathParser(d)};Linevg.prototype.getMarkers=function(){var points=this.PathParser.getMarkerPoints();var angles=this.PathParser.getMarkerAngles();var markers=[];for(var i=0;i<points.length;i++){markers.push([points[i],angles[i]])}return markers};Linevg.prototype.drawPath=function(ctx,data){var angle,point,markers;ctx.save();if(data.stroke_width!==undefined&&data.stroke_width!==null){ctx.lineWidth=data.stroke_width}if(data.stroke_dasharray!==undefined&&data.stroke_dasharray!==null){ctx.dasharray=data.stroke_dasharray.split(",")}if(data.opacity!==undefined&&data.opacity!==null){ctx.globalAlpha=data.opacity}if(data.stroke_linejoin!==undefined&&data.stroke_linejoin!==null){ctx.lineJoin=data.stroke_linejoin}if(data.stroke!==undefined&&data.stroke!==null){ctx.strokeStyle=(data.strokeStyle==="none")?"rgba(0,0,0,0)":data.stroke}generatedDrawPath=this.PathParser.generateDrawPath();drawPath(ctx,this.PathParser);if(ctx.dasharray){_gliffy.candash.cleanCtx(ctx)}markers=this.getMarkers();if(data.start_arrow!==0&&data.start_arrow!==null&&data.start_arrow!==undefined&&data.start_arrow!=="none"){ctx.save();point=markers[0][0];angle=markers[0][1];ctx.translate(point.x,point.y);if(data.marker_start_orient==="auto"){ctx.rotate(angle)}else{ctx.rotate(data.marker_start_orient*Math.PI/180)}_gliffy.shapeLibrary.drawStencil(data.start_arrow_tid,ctx,data);ctx.restore()}if(data.end_arrow!==0&&data.end_arrow!==null&&data.end_arrow!==undefined&&data.end_arrow!=="none"){ctx.save();point=markers[markers.length-1][0];angle=markers[markers.length-1][1];ctx.translate(point.x,point.y);if(data.marker_end_orient==="auto"){ctx.rotate(angle)}else{ctx.rotate(data.marker_end_orient*Math.PI/180)}_gliffy.shapeLibrary.drawStencil(data.end_arrow_tid,ctx,data);ctx.restore()}ctx.restore()};_gliffy.Linevg=Linevg}());(function(){var styleProp=($.browser.msie)?"display":"pointerEvents";var KoreSampl=function(){};KoreSampl.prototype.fromEvent=function(e,lastElement){e=e||window.event;return this.atPoint(e.clientX,e.clientY,lastElement)};KoreSampl.prototype.atPoint=function(clientX,clientY,lastElement,previousElement){var d=(lastElement)?lastElement.ownerDocument:document;lastElement=lastElement||d.getElementsByTagName("html")[0];var element=d.elementFromPoint(clientX,clientY);if(element===null||element===undefined||element===previousElement){return[]}else{if(element===lastElement||element.nodeName==="HTML"){return[element]}else{var style=element.style[styleProp];element.style[styleProp]="none";var result=[element].concat(this.atPoint(clientX,clientY,lastElement,element));element.style[styleProp]=style;return result}}};_gliffy.KoreSampl=new KoreSampl()})();(function($){var check={};var keys=[];$.fn.lazyload=function(options){var settings={threshold:0,failurelimit:0,delay:100,container:window,callback:function(element){}},elements=this,timeout=null;if(options){$.extend(settings,options)}$.fn.lazyload.delay=settings.delay;var key=new Date().getTime();var unseen=this.length;function checkElements(){var counter=0;var containerOffsets=getOffsets(settings.container);elements.each(function(){var $this=$(this);if($this.is(":visible")){var elementOffsets=getOffsets($this);if(aboveTheTop(containerOffsets,elementOffsets,settings)||leftOfBegin(containerOffsets,elementOffsets,settings)){}else{if(!belowTheFold(containerOffsets,elementOffsets,settings)&&!rightOfFold(containerOffsets,elementOffsets,settings)){$this.trigger("appear")}else{if(counter++>settings.failurelimit){return false}}}}})}function getOffsets(element){var elementTop,elementLeft,elementWidth,elementHeight;if(element==undefined||element==window){var $window=$(window);elementTop=$window.scrollTop();elementHeight=$window.height();elementLeft=$window.scrollLeft();elementWidth=$window.width()}else{var $element=$(element);elementTop=$element.offset().top;elementHeight=$element.height();elementLeft=$element.offset().left;elementWidth=$element.width()}return{top:elementTop,height:elementHeight,left:elementLeft,width:elementWidth}}function belowTheFold(containerOffsets,elementOffsets,settings){var fold=containerOffsets.top+containerOffsets.height;return fold<=elementOffsets.top-settings.threshold}function rightOfFold(containerOffsets,elementOffsets,settings){var fold=containerOffsets.left+containerOffsets.width;return fold<=elementOffsets.left-settings.threshold}function aboveTheTop(containerOffsets,elementOffsets,settings){var fold=containerOffsets.top;return fold>=elementOffsets.top+settings.threshold+elementOffsets.height}function leftOfBegin(containerOffsets,elementOffsets,settings){var fold=containerOffsets.left;return fold>=elementOffsets.left+settings.threshold+elementOffsets.width}this.each(function(){var $this=$(this);$this.one("appear",function(e){unseen--;if(unseen===0){var index=keys.indexOf(key);if(index>-1){keys.splice(index,1);delete check[key]}else{$(settings.container).unbind("scroll."+key)}}settings.callback($this)})});if(settings.container!==window){$(settings.container).bind("scroll."+key+" lazyload",function(e){if(timeout){clearTimeout(timeout)}timeout=setTimeout(function(){checkElements()},settings.delay)})}else{keys.push(key);check[key]=checkElements}checkElements();return this};var windowTimeout;$(window).bind("scroll.lazyload resize.lazyload lazyload",function(){if(windowTimeout){clearTimeout(windowTimeout)}if(keys.length>0){windowTimeout=setTimeout(function(){for(var i=0;i<keys.length;i++){check[keys[i]]()}},$.fn.lazyload.delay)}else{if(document.readyState==="complete"){$(window).unbind("scroll.lazyload resize.lazyload lazyload")}}})})(jQuery);(function(){var isDef=function(val){return val!==undefined};var Coordinate=function(opt_x,opt_y){this.x=isDef(opt_x)?opt_x:0;this.y=isDef(opt_y)?opt_y:0};Coordinate.prototype.clone=function(){return new Coordinate(this.x,this.y)};Coordinate.prototype.toString=function(){return"("+this.x+", "+this.y+")"};Coordinate.equals=function(a,b){if(a==b){return true}if(!a||!b){return false}return a.x==b.x&&a.y==b.y};Coordinate.distance=function(a,b){var dx=a.x-b.x;var dy=a.y-b.y;return Math.sqrt(dx*dx+dy*dy)};Coordinate.squaredDistance=function(a,b){var dx=a.x-b.x;var dy=a.y-b.y;return dx*dx+dy*dy};Coordinate.difference=function(a,b){return new Coordinate(a.x-b.x,a.y-b.y)};Coordinate.sum=function(a,b){return new Coordinate(a.x+b.x,a.y+b.y)};_gliffy.Coordinate=Coordinate})();(function(){var inherits=function(childCtor,parentCtor){function tempCtor(){}tempCtor.prototype=parentCtor.prototype;childCtor.superClass_=parentCtor.prototype;childCtor.prototype=new tempCtor();childCtor.prototype.constructor=childCtor};var Vec2=function(x,y){this.x=x;this.y=y};inherits(Vec2,_gliffy.Coordinate);Vec2.randomUnit=function(){var angle=Math.random()*Math.PI*2;return new Vec2(Math.cos(angle),Math.sin(angle))};Vec2.random=function(){var mag=Math.sqrt(Math.random());var angle=Math.random()*Math.PI*2;return new Vec2(Math.cos(angle)*mag,Math.sin(angle)*mag)};Vec2.fromCoordinate=function(a){return new Vec2(a.x,a.y)};Vec2.prototype.clone=function(){return new Vec2(this.x,this.y)};Vec2.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};Vec2.prototype.squaredMagnitude=function(){return this.x*this.x+this.y*this.y};Vec2.prototype.scale=function(s){this.x*=s;this.y*=s;return this};Vec2.prototype.invert=function(){this.x=-this.x;this.y=-this.y;return this};Vec2.prototype.normalize=function(){return this.scale(1/this.magnitude())};Vec2.prototype.safeNormalize=function(){var mag=this.magnitude();if(mag>0.00001){return this.scale(1/mag)}return this};Vec2.prototype.add=function(b){this.x+=b.x;this.y+=b.y;return this};Vec2.prototype.subtract=function(b){this.x-=b.x;this.y-=b.y;return this};Vec2.prototype.rotate=function(angle){var cos=Math.cos(angle);var sin=Math.sin(angle);var newX=this.x*cos-this.y*sin;var newY=this.y*cos+this.x*sin;this.x=newX;this.y=newY;return this};Vec2.rotateAroundPoint=function(v,axisPoint,angle){var res=v.clone();return res.subtract(axisPoint).rotate(angle).add(axisPoint)};Vec2.prototype.equals=function(b){return this==b||!!b&&this.x==b.x&&this.y==b.y};Vec2.distance=_gliffy.Coordinate.distance;Vec2.squaredDistance=_gliffy.Coordinate.squaredDistance;Vec2.equals=_gliffy.Coordinate.equals;Vec2.sum=function(a,b){return new Vec2(a.x+b.x,a.y+b.y)};Vec2.difference=function(a,b){return new Vec2(a.x-b.x,a.y-b.y)};Vec2.dot=function(a,b){return a.x*b.x+a.y*b.y};var lerp=function(a,b,x){return a+x*(b-a)};Vec2.lerp=function(a,b,x){return new Vec2(lerp(a.x,b.x,x),lerp(a.y,b.y,x))};_gliffy.Vec2=Vec2})();!function(window,document,undefined){var prefixes=["webkit","Moz","ms","O"],animations={},useCssAnimations;function createEl(tag,prop){var el=document.createElement(tag||"div"),n;for(n in prop){el[n]=prop[n]}return el}function ins(parent){for(var i=1,n=arguments.length;i<n;i++){parent.appendChild(arguments[i])}return parent}var sheet=function(){var el=createEl("style",{type:"text/css"});ins(document.getElementsByTagName("head")[0],el);return el.sheet||el.styleSheet}();function addAnimation(alpha,trail,i,lines){var name=["opacity",trail,~~(alpha*100),i,lines].join("-"),start=0.01+i/lines*100,z=Math.max(1-(1-alpha)/trail*(100-start),alpha),prefix=useCssAnimations.substring(0,useCssAnimations.indexOf("Animation")).toLowerCase(),pre=prefix&&"-"+prefix+"-"||"";if(!animations[name]){sheet.insertRule("@"+pre+"keyframes "+name+"{0%{opacity:"+z+"}"+start+"%{opacity:"+alpha+"}"+(start+0.01)+"%{opacity:1}"+(start+trail)%100+"%{opacity:"+alpha+"}100%{opacity:"+z+"}}",sheet.cssRules.length);animations[name]=1}return name}function vendor(el,prop){var s=el.style,pp,i;if(s[prop]!==undefined){return prop}prop=prop.charAt(0).toUpperCase()+prop.slice(1);for(i=0;i<prefixes.length;i++){pp=prefixes[i]+prop;if(s[pp]!==undefined){return pp}}}function css(el,prop){for(var n in prop){el.style[vendor(el,n)||n]=prop[n]}return el}function merge(obj){for(var i=1;i<arguments.length;i++){var def=arguments[i];for(var n in def){if(obj[n]===undefined){obj[n]=def[n]}}}return obj}function pos(el){var o={x:el.offsetLeft,y:el.offsetTop};while((el=el.offsetParent)){o.x+=el.offsetLeft,o.y+=el.offsetTop}return o}var defaults={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",speed:1,trail:100,opacity:1/4,fps:20,zIndex:2000000000,className:"spinner",top:"auto",left:"auto",position:"relative"};function Spinner(o){if(!this.spin){return new Spinner(o)}this.opts=merge(o||{},Spinner.defaults,defaults)}Spinner.defaults={};merge(Spinner.prototype,{spin:function(target){this.stop();var self=this,o=self.opts,el=self.el=css(createEl(0,{className:o.className}),{position:o.position,width:0,zIndex:o.zIndex}),mid=o.radius+o.length+o.width,ep,tp;if(target){target.insertBefore(el,target.firstChild||null);tp=pos(target);ep=pos(el);css(el,{left:(o.left=="auto"?tp.x-ep.x+(target.offsetWidth>>1):parseInt(o.left,10)+mid)+"px",top:(o.top=="auto"?tp.y-ep.y+(target.offsetHeight>>1):parseInt(o.top,10)+mid)+"px"})}el.setAttribute("aria-role","progressbar");self.lines(el,self.opts);if(!useCssAnimations){var i=0,fps=o.fps,f=fps/o.speed,ostep=(1-o.opacity)/(f*o.trail/100),astep=f/o.lines;(function anim(){i++;for(var s=o.lines;s;s--){var alpha=Math.max(1-(i+s*astep)%f*ostep,o.opacity);self.opacity(el,o.lines-s,alpha,o)}self.timeout=self.el&&setTimeout(anim,~~(1000/fps))})()}return self},stop:function(){var el=this.el;if(el){clearTimeout(this.timeout);if(el.parentNode){el.parentNode.removeChild(el)}this.el=undefined}return this},lines:function(el,o){var i=0,seg;function fill(color,shadow){return css(createEl(),{position:"absolute",width:(o.length+o.width)+"px",height:o.width+"px",background:color,boxShadow:shadow,transformOrigin:"left",transform:"rotate("+~~(360/o.lines*i+o.rotate)+"deg) translate("+o.radius+"px,0)",borderRadius:(o.corners*o.width>>1)+"px"})}for(;i<o.lines;i++){seg=css(createEl(),{position:"absolute",top:1+~(o.width/2)+"px",transform:o.hwaccel?"translate3d(0,0,0)":"",opacity:o.opacity,animation:useCssAnimations&&addAnimation(o.opacity,o.trail,i,o.lines)+" "+1/o.speed+"s linear infinite"});if(o.shadow){ins(seg,css(fill("#000","0 0 4px #000"),{top:2+"px"}))}ins(el,ins(seg,fill(o.color,"0 0 1px rgba(0,0,0,.1)")))}return el},opacity:function(el,i,val){if(i<el.childNodes.length){el.childNodes[i].style.opacity=val}}});(function(){function vml(tag,attr){return createEl("<"+tag+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',attr)}var s=css(createEl("group"),{behavior:"url(#default#VML)"});if(!vendor(s,"transform")&&s.adj){sheet.addRule(".spin-vml","behavior:url(#default#VML)");Spinner.prototype.lines=function(el,o){var r=o.length+o.width,s=2*r;function grp(){return css(vml("group",{coordsize:s+" "+s,coordorigin:-r+" "+-r}),{width:s,height:s})}var margin=-(o.width+o.length)*2+"px",g=css(grp(),{position:"absolute",top:margin,left:margin}),i;function seg(i,dx,filter){ins(g,ins(css(grp(),{rotation:360/o.lines*i+"deg",left:~~dx}),ins(css(vml("roundrect",{arcsize:o.corners}),{width:r,height:o.width,left:o.radius,top:-o.width>>1,filter:filter}),vml("fill",{color:o.color,opacity:o.opacity}),vml("stroke",{opacity:0}))))}if(o.shadow){for(i=1;i<=o.lines;i++){seg(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)")}}for(i=1;i<=o.lines;i++){seg(i)}return ins(el,g)};Spinner.prototype.opacity=function(el,i,val,o){var c=el.firstChild;o=o.shadow&&o.lines||0;if(c&&i+o<c.childNodes.length){c=c.childNodes[i+o];c=c&&c.firstChild;c=c&&c.firstChild;if(c){c.opacity=val}}}}else{useCssAnimations=vendor(s,"animation")}})();if(typeof define=="function"&&define.amd){define(function(){return Spinner})}else{window.Spinner=Spinner}}(window,document);var RTree=function(width){var _Min_Width=3;var _Max_Width=6;if(!isNaN(width)){_Min_Width=Math.floor(width/2);_Max_Width=width}var _T={x:0,y:0,w:0,h:0,id:"root",nodes:[]};var isArray=function(o){return Object.prototype.toString.call(o)==="[object Array]"};var _name_to_id=(function(){var idCache={};return function(idPrefix){var idVal=0;if(idPrefix in idCache){idVal=idCache[idPrefix]++}else{idCache[idPrefix]=0}return idPrefix+"_"+idVal}})();RTree.Rectangle.squarified_ratio=function(l,w,fill){var lperi=(l+w)/2;var larea=l*w;var lgeo=larea/(lperi*lperi);return(larea*fill/lgeo)};var _remove_subtree=function(rect,obj,root){var hit_stack=[];var count_stack=[];var ret_array=[];var current_depth=1;if(!rect||!RTree.Rectangle.overlap_rectangle(rect,root)){return ret_array}var ret_obj={x:rect.x,y:rect.y,w:rect.w,h:rect.h,target:obj};count_stack.push(root.nodes.length);hit_stack.push(root);do{var tree=hit_stack.pop();var i=count_stack.pop()-1;if("target" in ret_obj){while(i>=0){var ltree=tree.nodes[i];if(RTree.Rectangle.overlap_rectangle(ret_obj,ltree)){if((ret_obj.target&&"leaf" in ltree&&ltree.leaf===ret_obj.target)||(!ret_obj.target&&("leaf" in ltree||RTree.Rectangle.contains_rectangle(ltree,ret_obj)))){if("nodes" in ltree){ret_array=_search_subtree(ltree,true,[],ltree);tree.nodes.splice(i,1)}else{ret_array=tree.nodes.splice(i,1)}RTree.Rectangle.make_MBR(tree.nodes,tree);delete ret_obj.target;if(tree.nodes.length<_Min_Width){ret_obj.nodes=_search_subtree(tree,true,[],tree)}break}else{if("nodes" in ltree){current_depth+=1;count_stack.push(i);hit_stack.push(tree);tree=ltree;i=ltree.nodes.length}}}i-=1}}else{if("nodes" in ret_obj){tree.nodes.splice(i+1,1);if(tree.nodes.length>0){RTree.Rectangle.make_MBR(tree.nodes,tree)}for(var t=0;t<ret_obj.nodes.length;t++){_insert_subtree(ret_obj.nodes[t],tree)}ret_obj.nodes.length=0;if(hit_stack.length==0&&tree.nodes.length<=1){ret_obj.nodes=_search_subtree(tree,true,ret_obj.nodes,tree);tree.nodes.length=0;hit_stack.push(tree);count_stack.push(1)}else{if(hit_stack.length>0&&tree.nodes.length<_Min_Width){ret_obj.nodes=_search_subtree(tree,true,ret_obj.nodes,tree);tree.nodes.length=0}else{delete ret_obj.nodes}}}else{RTree.Rectangle.make_MBR(tree.nodes,tree)}}current_depth-=1}while(hit_stack.length>0);return(ret_array)};var _choose_leaf_subtree=function(rect,root){var best_choice_index=-1;var best_choice_stack=[];var best_choice_area;var load_callback=function(local_tree,local_node){return(function(data){local_tree._attach_data(local_node,data)})};best_choice_stack.push(root);var nodes=root.nodes;do{if(best_choice_index!=-1){best_choice_stack.push(nodes[best_choice_index]);nodes=nodes[best_choice_index].nodes;best_choice_index=-1}for(var i=nodes.length-1;i>=0;i--){var ltree=nodes[i];if("leaf" in ltree){best_choice_index=-1;break}var old_lratio=RTree.Rectangle.squarified_ratio(ltree.w,ltree.h,ltree.nodes.length+1);var nw=Math.max(ltree.x+ltree.w,rect.x+rect.w)-Math.min(ltree.x,rect.x);var nh=Math.max(ltree.y+ltree.h,rect.y+rect.h)-Math.min(ltree.y,rect.y);var lratio=RTree.Rectangle.squarified_ratio(nw,nh,ltree.nodes.length+2);if(best_choice_index<0||Math.abs(lratio-old_lratio)<best_choice_area){best_choice_area=Math.abs(lratio-old_lratio);best_choice_index=i}}}while(best_choice_index!=-1);return(best_choice_stack)};var _linear_split=function(nodes){var n=_pick_linear(nodes);while(nodes.length>0){_pick_next(nodes,n[0],n[1])}return(n)};var _pick_next=function(nodes,a,b){var area_a=RTree.Rectangle.squarified_ratio(a.w,a.h,a.nodes.length+1);var area_b=RTree.Rectangle.squarified_ratio(b.w,b.h,b.nodes.length+1);var high_area_delta;var high_area_node;var lowest_growth_group;for(var i=nodes.length-1;i>=0;i--){var l=nodes[i];var new_area_a={};new_area_a.x=Math.min(a.x,l.x);new_area_a.y=Math.min(a.y,l.y);new_area_a.w=Math.max(a.x+a.w,l.x+l.w)-new_area_a.x;new_area_a.h=Math.max(a.y+a.h,l.y+l.h)-new_area_a.y;var change_new_area_a=Math.abs(RTree.Rectangle.squarified_ratio(new_area_a.w,new_area_a.h,a.nodes.length+2)-area_a);var new_area_b={};new_area_b.x=Math.min(b.x,l.x);new_area_b.y=Math.min(b.y,l.y);new_area_b.w=Math.max(b.x+b.w,l.x+l.w)-new_area_b.x;new_area_b.h=Math.max(b.y+b.h,l.y+l.h)-new_area_b.y;var change_new_area_b=Math.abs(RTree.Rectangle.squarified_ratio(new_area_b.w,new_area_b.h,b.nodes.length+2)-area_b);if(!high_area_node||!high_area_delta||Math.abs(change_new_area_b-change_new_area_a)<high_area_delta){high_area_node=i;high_area_delta=Math.abs(change_new_area_b-change_new_area_a);lowest_growth_group=change_new_area_b<change_new_area_a?b:a}}var temp_node=nodes.splice(high_area_node,1)[0];if(a.nodes.length+nodes.length+1<=_Min_Width){a.nodes.push(temp_node);RTree.Rectangle.expand_rectangle(a,temp_node)}else{if(b.nodes.length+nodes.length+1<=_Min_Width){b.nodes.push(temp_node);RTree.Rectangle.expand_rectangle(b,temp_node)}else{lowest_growth_group.nodes.push(temp_node);RTree.Rectangle.expand_rectangle(lowest_growth_group,temp_node)}}};var _pick_linear=function(nodes){var lowest_high_x=nodes.length-1;var highest_low_x=0;var lowest_high_y=nodes.length-1;var highest_low_y=0;var t1,t2;for(var i=nodes.length-2;i>=0;i--){var l=nodes[i];if(l.x>nodes[highest_low_x].x){highest_low_x=i}else{if(l.x+l.w<nodes[lowest_high_x].x+nodes[lowest_high_x].w){lowest_high_x=i}}if(l.y>nodes[highest_low_y].y){highest_low_y=i}else{if(l.y+l.h<nodes[lowest_high_y].y+nodes[lowest_high_y].h){lowest_high_y=i}}}var dx=Math.abs((nodes[lowest_high_x].x+nodes[lowest_high_x].w)-nodes[highest_low_x].x);var dy=Math.abs((nodes[lowest_high_y].y+nodes[lowest_high_y].h)-nodes[highest_low_y].y);if(dx>dy){if(lowest_high_x>highest_low_x){t1=nodes.splice(lowest_high_x,1)[0];t2=nodes.splice(highest_low_x,1)[0]}else{t2=nodes.splice(highest_low_x,1)[0];t1=nodes.splice(lowest_high_x,1)[0]}}else{if(lowest_high_y>highest_low_y){t1=nodes.splice(lowest_high_y,1)[0];t2=nodes.splice(highest_low_y,1)[0]}else{t2=nodes.splice(highest_low_y,1)[0];t1=nodes.splice(lowest_high_y,1)[0]}}return([{x:t1.x,y:t1.y,w:t1.w,h:t1.h,nodes:[t1]},{x:t2.x,y:t2.y,w:t2.w,h:t2.h,nodes:[t2]}])};var _attach_data=function(node,more_tree){node.nodes=more_tree.nodes;node.x=more_tree.x;node.y=more_tree.y;node.w=more_tree.w;node.h=more_tree.h;return(node)};var _search_subtree=function(rect,return_node,return_array,root){var hit_stack=[];if(!RTree.Rectangle.overlap_rectangle(rect,root)){return(return_array)}var load_callback=function(local_tree,local_node){return(function(data){local_tree._attach_data(local_node,data)})};hit_stack.push(root.nodes);do{var nodes=hit_stack.pop();for(var i=nodes.length-1;i>=0;i--){var ltree=nodes[i];if(RTree.Rectangle.overlap_rectangle(rect,ltree)){if("nodes" in ltree){hit_stack.push(ltree.nodes)}else{if("leaf" in ltree){if(!return_node){return_array.push(ltree.leaf)}else{return_array.push(ltree)}}}}}}while(hit_stack.length>0);return(return_array)};var _insert_subtree=function(node,root){var bc;if(root.nodes.length==0){root.x=node.x;root.y=node.y;root.w=node.w;root.h=node.h;root.nodes.push(node);return}var tree_stack=_choose_leaf_subtree(node,root);var ret_obj=node;do{if(bc&&"nodes" in bc&&bc.nodes.length==0){var pbc=bc;bc=tree_stack.pop();for(var t=0;t<bc.nodes.length;t++){if(bc.nodes[t]===pbc||bc.nodes[t].nodes.length==0){bc.nodes.splice(t,1);break}}}else{bc=tree_stack.pop()}if("leaf" in ret_obj||"nodes" in ret_obj||isArray(ret_obj)){if(isArray(ret_obj)){for(var ai=0;ai<ret_obj.length;ai++){RTree.Rectangle.expand_rectangle(bc,ret_obj[ai])}bc.nodes=bc.nodes.concat(ret_obj)}else{RTree.Rectangle.expand_rectangle(bc,ret_obj);bc.nodes.push(ret_obj)}if(bc.nodes.length<=_Max_Width){ret_obj={x:bc.x,y:bc.y,w:bc.w,h:bc.h}}else{var a=_linear_split(bc.nodes);ret_obj=a;if(tree_stack.length<1){bc.nodes.push(a[0]);tree_stack.push(bc);ret_obj=a[1]}}}else{RTree.Rectangle.expand_rectangle(bc,ret_obj);ret_obj={x:bc.x,y:bc.y,w:bc.w,h:bc.h}}}while(tree_stack.length>0)};this.get_tree=function(){return _T};this.set_tree=function(new_tree,where){if(!where){where=_T}return(_attach_data(where,new_tree))};this.search=function(rect,return_node,return_array){if(arguments.length<1){throw"Wrong number of arguments. RT.Search requires at least a bounding rectangle."}switch(arguments.length){case 1:arguments[1]=false;case 2:arguments[2]=[];case 3:arguments[3]=_T;default:arguments.length=4}return(_search_subtree.apply(this,arguments))};this.toJSON=function(rect,tree){var hit_stack=[];var count_stack=[];var return_stack={};var max_depth=3;var current_depth=1;var return_string="";if(rect&&!RTree.Rectangle.overlap_rectangle(rect,_T)){return""}if(!tree){count_stack.push(_T.nodes.length);hit_stack.push(_T.nodes);return_string+="var main_tree = {x:"+_T.x.toFixed()+",y:"+_T.y.toFixed()+",w:"+_T.w.toFixed()+",h:"+_T.h.toFixed()+",nodes:["}else{max_depth+=4;count_stack.push(tree.nodes.length);hit_stack.push(tree.nodes);return_string+="var main_tree = {x:"+tree.x.toFixed()+",y:"+tree.y.toFixed()+",w:"+tree.w.toFixed()+",h:"+tree.h.toFixed()+",nodes:["}do{var nodes=hit_stack.pop();var i=count_stack.pop()-1;if(i>=0&&i<nodes.length-1){return_string+=","}while(i>=0){var ltree=nodes[i];if(!rect||RTree.Rectangle.overlap_rectangle(rect,ltree)){if(ltree.nodes){if(current_depth>=max_depth){var len=return_stack.length;var nam=_name_to_id("saved_subtree");return_string+="{x:"+ltree.x.toFixed()+",y:"+ltree.y.toFixed()+",w:"+ltree.w.toFixed()+",h:"+ltree.h.toFixed()+",load:'"+nam+".js'}";return_stack[nam]=this.toJSON(rect,ltree);if(i>0){return_string+=","}}else{return_string+="{x:"+ltree.x.toFixed()+",y:"+ltree.y.toFixed()+",w:"+ltree.w.toFixed()+",h:"+ltree.h.toFixed()+",nodes:[";current_depth+=1;count_stack.push(i);hit_stack.push(nodes);nodes=ltree.nodes;i=ltree.nodes.length}}else{if(ltree.leaf){var data=ltree.leaf.toJSON?ltree.leaf.toJSON():JSON.stringify(ltree.leaf);return_string+="{x:"+ltree.x.toFixed()+",y:"+ltree.y.toFixed()+",w:"+ltree.w.toFixed()+",h:"+ltree.h.toFixed()+",leaf:"+data+"}";if(i>0){return_string+=","}}else{if(ltree.load){return_string+="{x:"+ltree.x.toFixed()+",y:"+ltree.y.toFixed()+",w:"+ltree.w.toFixed()+",h:"+ltree.h.toFixed()+",load:'"+ltree.load+"'}";if(i>0){return_string+=","}}}}}i-=1}if(i<0){return_string+="]}";current_depth-=1}}while(hit_stack.length>0);return_string+=";";for(var my_key in return_stack){return_string+="\nvar "+my_key+" = function(){"+return_stack[my_key]+" return(main_tree);};"}return(return_string)};this.remove=function(rect,obj){if(arguments.length<1){throw"Wrong number of arguments. RT.remove requires at least a bounding rectangle."}switch(arguments.length){case 1:arguments[1]=false;case 2:arguments[2]=_T;default:arguments.length=3}if(arguments[1]===false){var numberdeleted=0;var ret_array=[];do{numberdeleted=ret_array.length;ret_array=ret_array.concat(_remove_subtree.apply(this,arguments))}while(numberdeleted!=ret_array.length);return ret_array}else{return(_remove_subtree.apply(this,arguments))}};this.insert=function(rect,obj){if(arguments.length<2){throw"Wrong number of arguments. RT.Insert requires at least a bounding rectangle and an object."}return(_insert_subtree({x:rect.x,y:rect.y,w:rect.w,h:rect.h,leaf:obj},_T))}};RTree.Rectangle=function(ix,iy,iw,ih){var x,x2,y,y2,w,h;if(ix.x){x=ix.x;y=ix.y;if(ix.w!==0&&!ix.w&&ix.x2){w=ix.x2-ix.x;h=ix.y2-ix.y}else{w=ix.w;h=ix.h}x2=x+w;y2=y+h}else{x=ix;y=iy;w=iw;h=ih;x2=x+w;y2=y+h}this.x1=this.x=function(){return x};this.y1=this.y=function(){return y};this.x2=function(){return x2};this.y2=function(){return y2};this.w=function(){return w};this.h=function(){return h};this.toJSON=function(){return('{"x":'+x.toString()+', "y":'+y.toString()+', "w":'+w.toString()+', "h":'+h.toString()+"}")};this.overlap=function(a){return(this.x()<a.x2()&&this.x2()>a.x()&&this.y()<a.y2()&&this.y2()>a.y())};this.expand=function(a){var nx=Math.min(this.x(),a.x());var ny=Math.min(this.y(),a.y());w=Math.max(this.x2(),a.x2())-nx;h=Math.max(this.y2(),a.y2())-ny;x=nx;y=ny;return(this)};this.setRect=function(ix,iy,iw,ih){var x,x2,y,y2,w,h;if(ix.x){x=ix.x;y=ix.y;if(ix.w!==0&&!ix.w&&ix.x2){w=ix.x2-ix.x;h=ix.y2-ix.y}else{w=ix.w;h=ix.h}x2=x+w;y2=y+h}else{x=ix;y=iy;w=iw;h=ih;x2=x+w;y2=y+h}}};RTree.Rectangle.overlap_rectangle=function(a,b){return(a.x<(b.x+b.w)&&(a.x+a.w)>b.x&&a.y<(b.y+b.h)&&(a.y+a.h)>b.y)};RTree.Rectangle.contains_rectangle=function(a,b){return((a.x+a.w)<=(b.x+b.w)&&a.x>=b.x&&(a.y+a.h)<=(b.y+b.h)&&a.y>=b.y)};RTree.Rectangle.expand_rectangle=function(a,b){var nx=Math.min(a.x,b.x);var ny=Math.min(a.y,b.y);a.w=Math.max(a.x+a.w,b.x+b.w)-nx;a.h=Math.max(a.y+a.h,b.y+b.h)-ny;a.x=nx;a.y=ny;return(a)};RTree.Rectangle.make_MBR=function(nodes,rect){if(nodes.length<1){return({x:0,y:0,w:0,h:0})}if(!rect){rect={x:nodes[0].x,y:nodes[0].y,w:nodes[0].w,h:nodes[0].h}}else{rect.x=nodes[0].x}rect.y=nodes[0].y;rect.w=nodes[0].w;rect.h=nodes[0].h;for(var i=nodes.length-1;i>0;i--){RTree.Rectangle.expand_rectangle(rect,nodes[i])}return(rect)};_gliffy.RTree=RTree;(function($){var Popover=function(options){var o=$.extend({},{target:$("body"),title:"Title",content:"Content",contentAsHTML:null,placement:"e",zIndex:590000,cookieExpires:365,cookie:null,left:null,top:null,addClass:null,width:null,shouldShow:null,onShow:null,onHide:null},options),self=this;this.title=o.title;this.target=o.target;this.content=o.content;this.placement=o.placement;this.cookie=o.cookie;this.left=o.left;this.top=o.top;this.shouldShow=o.shouldShow;this.onShow=o.onShow;this.onHide=o.onHide;this.width=o.width;this.zIndex=o.zIndex;this.time=new Date().getTime();if(this.target&&this.target.length>0&&this.shouldRender()){var template=$("script[data-template-name='gliffy-popover-template']"),$popoverContent;if(template.length===0){template=$("#gliffy-popover")}this.htmlContent=$(Handlebars.compile(template.html())($.extend({title:o.title,content:o.content})));$popoverContent=$(this.htmlContent).find(".gliffy-popover-content");if(this.width){$(this.htmlContent).width(this.width)}if(o.contentAsHTML){$popoverContent.html(o.contentAsHTML);$popoverContent.css("white-space","")}else{$popoverContent.css("white-space","pre-wrap")}this.htmlContent.appendTo("body");if(o.addClass){this.htmlContent.addClass(o.addClass)}$(this.htmlContent).find(".gliffy-icon-sidebar-close").click(function(){self.hide()});this.addArrow();this.bindResize();this.position()}return this};Popover.prototype.getBoundingBox=function(){var $content=$(this.htmlContent);return _gliffy.Utils.getTextBoundingBox($content)};Popover.prototype.shouldRender=function(){if(this.cookie===null&&this.shouldShow){return this.shouldShow()}return this.cookie===null||!($.cookie(this.cookie)||window.localStorage.getItem(this.cookie))};Popover.prototype.addArrow=function(){var arrow=this.htmlContent.find(".gliffy-arrow"),arrowBorder=this.htmlContent.find(".gliffy-arrow-border");switch(this.placement){case"n":arrow.addClass("gliffy-arrow-down");arrowBorder.addClass("gliffy-arrow-border-down");break;case"nl":case"ne":arrow.addClass("gliffy-arrow-down-left");arrowBorder.addClass("gliffy-arrow-border-down-left");break;case"nr":case"nw":arrow.addClass("gliffy-arrow-down-right");arrowBorder.addClass("gliffy-arrow-border-down-right");break;case"e":arrow.addClass("gliffy-arrow-left");arrowBorder.addClass("gliffy-arrow-border-left");break;case"et":arrow.addClass("gliffy-arrow-left-top");arrowBorder.addClass("gliffy-arrow-border-left-top");break;case"eb":arrow.addClass("gliffy-arrow-left-bottom");arrowBorder.addClass("gliffy-arrow-border-left-bottom");break;case"w":arrow.addClass("gliffy-arrow-right");arrowBorder.addClass("gliffy-arrow-border-right");break;case"wt":arrow.addClass("gliffy-arrow-right-top");arrowBorder.addClass("gliffy-arrow-border-right-top");break;case"wb":arrow.addClass("gliffy-arrow-right-bottom");arrowBorder.addClass("gliffy-arrow-border-right-bottom");break;case"s":arrow.addClass("gliffy-arrow-up");arrowBorder.addClass("gliffy-arrow-border-up");break;case"sl":case"se":arrow.addClass("gliffy-arrow-up-left");arrowBorder.addClass("gliffy-arrow-border-up-left");break;case"sr":case"sw":arrow.addClass("gliffy-arrow-up-right");arrowBorder.addClass("gliffy-arrow-border-up-right");break}};Popover.prototype.position=function(){var topOffset=0,leftOffset=0,caret=7,width,height,parentWidth,parentHeight;height=this.htmlContent.outerHeight();width=this.htmlContent.outerWidth();if(this.left!=null&&this.top!=null){this.htmlContent.css({left:this.left,top:this.top,visibility:"visible",zIndex:this.zIndex});return}parentWidth=this.target.outerWidth();parentHeight=this.target.outerHeight();this.parentOffset=this.target.offset();if(this.placement.indexOf("n")>-1){topOffset=-height-caret}else{if(this.placement.indexOf("s")>-1){topOffset=parentHeight+caret}else{if(this.placement.indexOf("t")>-1){topOffset=0}else{if(this.placement.indexOf("b")>-1){topOffset=parentHeight-height}else{topOffset=parentHeight/2-height/2}}}}if(this.placement.indexOf("e")>-1){leftOffset=parentWidth+caret;if(this.placement.indexOf("n")>-1||this.placement.indexOf("s")>-1){leftOffset=leftOffset-caret-25}}else{if(this.placement.indexOf("w")>-1){leftOffset=-width-caret;if(this.placement.indexOf("n")>-1||this.placement.indexOf("s")>-1){leftOffset=leftOffset+caret+25}}else{if(this.placement.indexOf("l")>-1){leftOffset=0}else{if(this.placement.indexOf("r")>-1){leftOffset=parentWidth-width}else{leftOffset=parentWidth/2-width/2}}}}this.htmlContent.css({left:this.parentOffset.left+leftOffset,top:this.parentOffset.top+topOffset,visibility:"visible",zIndex:this.zIndex})};Popover.prototype.bindResize=function(){var self=this;$(window).bind("resize.popover."+this.time,function(){self.position()})};Popover.prototype.show=function(){if(this.onShow){this.onShow(this)}this.bindResize();this.htmlContent.show();return this};Popover.prototype.hide=function(){if(this.onHide){this.onHide(this)}if(this.cookie!==null){window.localStorage.setItem(this.cookie,true);$.cookie(this.cookie,true,{expires:this.cookieExpires})}$(window).unbind("resize.popover."+this.time);if(this.htmlContent){this.htmlContent.hide()}return this};Popover.prototype.remove=function(){if(this.cookie!==null){window.localStorage.setItem(this.cookie,true);$.cookie(this.cookie,true,{expires:this.cookieExpires})}$(window).unbind("resize.popover."+this.time);if(this.htmlContent){this.htmlContent.remove()}return this};_gliffy.Popover=Popover}(jQuery));(function(global){var undefined=(void 0);var MAX_ARRAY_LENGTH=100000;function Type(v){switch(typeof v){case"undefined":return"undefined";case"boolean":return"boolean";case"number":return"number";case"string":return"string";default:return v===null?"null":"object"}}function Class(v){return Object.prototype.toString.call(v).replace(/^\[object *|\]$/g,"")}function IsCallable(o){return typeof o==="function"}function ToObject(v){if(v===null||v===undefined){throw TypeError()}return Object(v)}function ToInt32(v){return v>>0}function ToUint32(v){return v>>>0}var LN2=Math.LN2,abs=Math.abs,floor=Math.floor,log=Math.log,max=Math.max,min=Math.min,pow=Math.pow,round=Math.round;(function(){var orig=Object.defineProperty;var dom_only=!(function(){try{return Object.defineProperty({},"x",{})}catch(_){return false}}());if(!orig||dom_only){Object.defineProperty=function(o,prop,desc){if(orig){try{return orig(o,prop,desc)}catch(_){}}if(o!==Object(o)){throw TypeError("Object.defineProperty called on non-object")}if(Object.prototype.__defineGetter__&&("get" in desc)){Object.prototype.__defineGetter__.call(o,prop,desc.get)}if(Object.prototype.__defineSetter__&&("set" in desc)){Object.prototype.__defineSetter__.call(o,prop,desc.set)}if("value" in desc){o[prop]=desc.value}return o}}}());function makeArrayAccessors(obj){if(obj.length>MAX_ARRAY_LENGTH){throw RangeError("Array too large for polyfill")}function makeArrayAccessor(index){Object.defineProperty(obj,index,{get:function(){return obj._getter(index)},set:function(v){obj._setter(index,v)},enumerable:true,configurable:false})}var i;for(i=0;i<obj.length;i+=1){makeArrayAccessor(i)}}function as_signed(value,bits){var s=32-bits;return(value<<s)>>s}function as_unsigned(value,bits){var s=32-bits;return(value<<s)>>>s}function packI8(n){return[n&255]}function unpackI8(bytes){return as_signed(bytes[0],8)}function packU8(n){return[n&255]}function unpackU8(bytes){return as_unsigned(bytes[0],8)}function packU8Clamped(n){n=round(Number(n));return[n<0?0:n>255?255:n&255]}function packI16(n){return[(n>>8)&255,n&255]}function unpackI16(bytes){return as_signed(bytes[0]<<8|bytes[1],16)}function packU16(n){return[(n>>8)&255,n&255]}function unpackU16(bytes){return as_unsigned(bytes[0]<<8|bytes[1],16)}function packI32(n){return[(n>>24)&255,(n>>16)&255,(n>>8)&255,n&255]}function unpackI32(bytes){return as_signed(bytes[0]<<24|bytes[1]<<16|bytes[2]<<8|bytes[3],32)}function packU32(n){return[(n>>24)&255,(n>>16)&255,(n>>8)&255,n&255]}function unpackU32(bytes){return as_unsigned(bytes[0]<<24|bytes[1]<<16|bytes[2]<<8|bytes[3],32)}function packIEEE754(v,ebits,fbits){var bias=(1<<(ebits-1))-1,s,e,f,ln,i,bits,str,bytes;function roundToEven(n){var w=floor(n),f=n-w;if(f<0.5){return w}if(f>0.5){return w+1}return w%2?w+1:w}if(v!==v){e=(1<<ebits)-1;f=pow(2,fbits-1);s=0}else{if(v===Infinity||v===-Infinity){e=(1<<ebits)-1;f=0;s=(v<0)?1:0}else{if(v===0){e=0;f=0;s=(1/v===-Infinity)?1:0}else{s=v<0;v=abs(v);if(v>=pow(2,1-bias)){e=min(floor(log(v)/LN2),1023);f=roundToEven(v/pow(2,e)*pow(2,fbits));if(f/pow(2,fbits)>=2){e=e+1;f=1}if(e>bias){e=(1<<ebits)-1;f=0}else{e=e+bias;f=f-pow(2,fbits)}}else{e=0;f=roundToEven(v/pow(2,1-bias-fbits))}}}}bits=[];for(i=fbits;i;i-=1){bits.push(f%2?1:0);f=floor(f/2)}for(i=ebits;i;i-=1){bits.push(e%2?1:0);e=floor(e/2)}bits.push(s?1:0);bits.reverse();str=bits.join("");bytes=[];while(str.length){bytes.push(parseInt(str.substring(0,8),2));str=str.substring(8)}return bytes}function unpackIEEE754(bytes,ebits,fbits){var bits=[],i,j,b,str,bias,s,e,f;for(i=bytes.length;i;i-=1){b=bytes[i-1];for(j=8;j;j-=1){bits.push(b%2?1:0);b=b>>1}}bits.reverse();str=bits.join("");bias=(1<<(ebits-1))-1;s=parseInt(str.substring(0,1),2)?-1:1;e=parseInt(str.substring(1,1+ebits),2);f=parseInt(str.substring(1+ebits),2);if(e===(1<<ebits)-1){return f!==0?NaN:s*Infinity}else{if(e>0){return s*pow(2,e-bias)*(1+f/pow(2,fbits))}else{if(f!==0){return s*pow(2,-(bias-1))*(f/pow(2,fbits))}else{return s<0?-0:0}}}}function unpackF64(b){return unpackIEEE754(b,11,52)}function packF64(v){return packIEEE754(v,11,52)}function unpackF32(b){return unpackIEEE754(b,8,23)}function packF32(v){return packIEEE754(v,8,23)}(function(){function ArrayBuffer(length){length=ToInt32(length);if(length<0){throw RangeError("ArrayBuffer size is not a small enough positive integer.")}Object.defineProperty(this,"byteLength",{value:length});Object.defineProperty(this,"_bytes",{value:Array(length)});for(var i=0;i<length;i+=1){this._bytes[i]=0}}global.ArrayBuffer=global.ArrayBuffer||ArrayBuffer;function $TypedArray$(){if(!arguments.length||typeof arguments[0]!=="object"){return(function(length){length=ToInt32(length);if(length<0){throw RangeError("length is not a small enough positive integer.")}Object.defineProperty(this,"length",{value:length});Object.defineProperty(this,"byteLength",{value:length*this.BYTES_PER_ELEMENT});Object.defineProperty(this,"buffer",{value:new ArrayBuffer(this.byteLength)});Object.defineProperty(this,"byteOffset",{value:0})}).apply(this,arguments)}if(arguments.length>=1&&Type(arguments[0])==="object"&&arguments[0] instanceof $TypedArray$){return(function(typedArray){if(this.constructor!==typedArray.constructor){throw TypeError()}var byteLength=typedArray.length*this.BYTES_PER_ELEMENT;Object.defineProperty(this,"buffer",{value:new ArrayBuffer(byteLength)});Object.defineProperty(this,"byteLength",{value:byteLength});Object.defineProperty(this,"byteOffset",{value:0});Object.defineProperty(this,"length",{value:typedArray.length});for(var i=0;i<this.length;i+=1){this._setter(i,typedArray._getter(i))}}).apply(this,arguments)}if(arguments.length>=1&&Type(arguments[0])==="object"&&!(arguments[0] instanceof $TypedArray$)&&!(arguments[0] instanceof ArrayBuffer||Class(arguments[0])==="ArrayBuffer")){return(function(array){var byteLength=array.length*this.BYTES_PER_ELEMENT;Object.defineProperty(this,"buffer",{value:new ArrayBuffer(byteLength)});Object.defineProperty(this,"byteLength",{value:byteLength});Object.defineProperty(this,"byteOffset",{value:0});Object.defineProperty(this,"length",{value:array.length});for(var i=0;i<this.length;i+=1){var s=array[i];this._setter(i,Number(s))}}).apply(this,arguments)}if(arguments.length>=1&&Type(arguments[0])==="object"&&(arguments[0] instanceof ArrayBuffer||Class(arguments[0])==="ArrayBuffer")){return(function(buffer,byteOffset,length){byteOffset=ToUint32(byteOffset);if(byteOffset>buffer.byteLength){throw RangeError("byteOffset out of range")}if(byteOffset%this.BYTES_PER_ELEMENT){throw RangeError("buffer length minus the byteOffset is not a multiple of the element size.")}if(length===undefined){var byteLength=buffer.byteLength-byteOffset;if(byteLength%this.BYTES_PER_ELEMENT){throw RangeError("length of buffer minus byteOffset not a multiple of the element size")}length=byteLength/this.BYTES_PER_ELEMENT}else{length=ToUint32(length);byteLength=length*this.BYTES_PER_ELEMENT}if((byteOffset+byteLength)>buffer.byteLength){throw RangeError("byteOffset and length reference an area beyond the end of the buffer")}Object.defineProperty(this,"buffer",{value:buffer});Object.defineProperty(this,"byteLength",{value:byteLength});Object.defineProperty(this,"byteOffset",{value:byteOffset});Object.defineProperty(this,"length",{value:length})}).apply(this,arguments)}throw TypeError()}Object.defineProperty($TypedArray$,"from",{value:function(iterable){return new this(iterable)}});Object.defineProperty($TypedArray$,"of",{value:function(){return new this(arguments)}});var $TypedArrayPrototype$={};$TypedArray$.prototype=$TypedArrayPrototype$;Object.defineProperty($TypedArray$.prototype,"_getter",{value:function(index){if(arguments.length<1){throw SyntaxError("Not enough arguments")}index=ToUint32(index);if(index>=this.length){return undefined}var bytes=[],i,o;for(i=0,o=this.byteOffset+index*this.BYTES_PER_ELEMENT;i<this.BYTES_PER_ELEMENT;i+=1,o+=1){bytes.push(this.buffer._bytes[o])}return this._unpack(bytes)}});Object.defineProperty($TypedArray$.prototype,"get",{value:$TypedArray$.prototype._getter});Object.defineProperty($TypedArray$.prototype,"_setter",{value:function(index,value){if(arguments.length<2){throw SyntaxError("Not enough arguments")}index=ToUint32(index);if(index>=this.length){return}var bytes=this._pack(value),i,o;for(i=0,o=this.byteOffset+index*this.BYTES_PER_ELEMENT;i<this.BYTES_PER_ELEMENT;i+=1,o+=1){this.buffer._bytes[o]=bytes[i]}}});Object.defineProperty($TypedArray$.prototype,"constructor",{value:$TypedArray$});Object.defineProperty($TypedArray$.prototype,"copyWithin",{value:function(target,start){var end=arguments[2];var o=ToObject(this);var lenVal=o.length;var len=ToUint32(lenVal);len=max(len,0);var relativeTarget=ToInt32(target);var to;if(relativeTarget<0){to=max(len+relativeTarget,0)}else{to=min(relativeTarget,len)}var relativeStart=ToInt32(start);var from;if(relativeStart<0){from=max(len+relativeStart,0)}else{from=min(relativeStart,len)}var relativeEnd;if(end===undefined){relativeEnd=len}else{relativeEnd=ToInt32(end)}var final_;if(relativeEnd<0){final_=max(len+relativeEnd,0)}else{final_=min(relativeEnd,len)}var count=min(final_-from,len-to);var direction;if(from<to&&to<from+count){direction=-1;from=from+count-1;to=to+count-1}else{direction=1}while(count>0){o._setter(to,o._getter(from));from=from+direction;to=to+direction;count=count-1}return o}});Object.defineProperty($TypedArray$.prototype,"every",{value:function(callbackfn){if(this===undefined||this===null){throw TypeError()}var t=Object(this);var len=ToUint32(t.length);if(!IsCallable(callbackfn)){throw TypeError()}var thisArg=arguments[1];for(var i=0;i<len;i++){if(!callbackfn.call(thisArg,t._getter(i),i,t)){return false}}return true}});Object.defineProperty($TypedArray$.prototype,"fill",{value:function(value){var start=arguments[1],end=arguments[2];var o=ToObject(this);var lenVal=o.length;var len=ToUint32(lenVal);len=max(len,0);var relativeStart=ToInt32(start);var k;if(relativeStart<0){k=max((len+relativeStart),0)}else{k=min(relativeStart,len)}var relativeEnd;if(end===undefined){relativeEnd=len}else{relativeEnd=ToInt32(end)}var final_;if(relativeEnd<0){final_=max((len+relativeEnd),0)}else{final_=min(relativeEnd,len)}while(k<final_){o._setter(k,value);k+=1}return o}});Object.defineProperty($TypedArray$.prototype,"filter",{value:function(callbackfn){if(this===undefined||this===null){throw TypeError()}var t=Object(this);var len=ToUint32(t.length);if(!IsCallable(callbackfn)){throw TypeError()}var res=[];var thisp=arguments[1];for(var i=0;i<len;i++){var val=t._getter(i);if(callbackfn.call(thisp,val,i,t)){res.push(val)}}return new this.constructor(res)}});Object.defineProperty($TypedArray$.prototype,"find",{value:function(predicate){var o=ToObject(this);var lenValue=o.length;var len=ToUint32(lenValue);if(!IsCallable(predicate)){throw TypeError()}var t=arguments.length>1?arguments[1]:undefined;var k=0;while(k<len){var kValue=o._getter(k);var testResult=predicate.call(t,kValue,k,o);if(Boolean(testResult)){return kValue}++k}return undefined}});Object.defineProperty($TypedArray$.prototype,"findIndex",{value:function(predicate){var o=ToObject(this);var lenValue=o.length;var len=ToUint32(lenValue);if(!IsCallable(predicate)){throw TypeError()}var t=arguments.length>1?arguments[1]:undefined;var k=0;while(k<len){var kValue=o._getter(k);var testResult=predicate.call(t,kValue,k,o);if(Boolean(testResult)){return k}++k}return -1}});Object.defineProperty($TypedArray$.prototype,"forEach",{value:function(callbackfn){if(this===undefined||this===null){throw TypeError()}var t=Object(this);var len=ToUint32(t.length);if(!IsCallable(callbackfn)){throw TypeError()}var thisp=arguments[1];for(var i=0;i<len;i++){callbackfn.call(thisp,t._getter(i),i,t)}}});Object.defineProperty($TypedArray$.prototype,"indexOf",{value:function(searchElement){if(this===undefined||this===null){throw TypeError()}var t=Object(this);var len=ToUint32(t.length);if(len===0){return -1}var n=0;if(arguments.length>0){n=Number(arguments[1]);if(n!==n){n=0}else{if(n!==0&&n!==(1/0)&&n!==-(1/0)){n=(n>0||-1)*floor(abs(n))}}}if(n>=len){return -1}var k=n>=0?n:max(len-abs(n),0);for(;k<len;k++){if(t._getter(k)===searchElement){return k}}return -1}});Object.defineProperty($TypedArray$.prototype,"join",{value:function(separator){if(this===undefined||this===null){throw TypeError()}var t=Object(this);var len=ToUint32(t.length);var tmp=Array(len);for(var i=0;i<len;++i){tmp[i]=t._getter(i)}return tmp.join(separator===undefined?",":separator)}});Object.defineProperty($TypedArray$.prototype,"lastIndexOf",{value:function(searchElement){if(this===undefined||this===null){throw TypeError()}var t=Object(this);var len=ToUint32(t.length);if(len===0){return -1}var n=len;if(arguments.length>1){n=Number(arguments[1]);if(n!==n){n=0}else{if(n!==0&&n!==(1/0)&&n!==-(1/0)){n=(n>0||-1)*floor(abs(n))}}}var k=n>=0?min(n,len-1):len-abs(n);for(;k>=0;k--){if(t._getter(k)===searchElement){return k}}return -1}});Object.defineProperty($TypedArray$.prototype,"map",{value:function(callbackfn){if(this===undefined||this===null){throw TypeError()}var t=Object(this);var len=ToUint32(t.length);if(!IsCallable(callbackfn)){throw TypeError()}var res=[];res.length=len;var thisp=arguments[1];for(var i=0;i<len;i++){res[i]=callbackfn.call(thisp,t._getter(i),i,t)}return new this.constructor(res)}});Object.defineProperty($TypedArray$.prototype,"reduce",{value:function(callbackfn){if(this===undefined||this===null){throw TypeError()}var t=Object(this);var len=ToUint32(t.length);if(!IsCallable(callbackfn)){throw TypeError()}if(len===0&&arguments.length===1){throw TypeError()}var k=0;var accumulator;if(arguments.length>=2){accumulator=arguments[1]}else{accumulator=t._getter(k++)}while(k<len){accumulator=callbackfn.call(undefined,accumulator,t._getter(k),k,t);k++}return accumulator}});Object.defineProperty($TypedArray$.prototype,"reduceRight",{value:function(callbackfn){if(this===undefined||this===null){throw TypeError()}var t=Object(this);var len=ToUint32(t.length);if(!IsCallable(callbackfn)){throw TypeError()}if(len===0&&arguments.length===1){throw TypeError()}var k=len-1;var accumulator;if(arguments.length>=2){accumulator=arguments[1]}else{accumulator=t._getter(k--)}while(k>=0){accumulator=callbackfn.call(undefined,accumulator,t._getter(k),k,t);k--}return accumulator}});Object.defineProperty($TypedArray$.prototype,"reverse",{value:function(){if(this===undefined||this===null){throw TypeError()}var t=Object(this);var len=ToUint32(t.length);var half=floor(len/2);for(var i=0,j=len-1;i<half;++i,--j){var tmp=t._getter(i);t._setter(i,t._getter(j));t._setter(j,tmp)}return t}});Object.defineProperty($TypedArray$.prototype,"set",{value:function(index,value){if(arguments.length<1){throw SyntaxError("Not enough arguments")}var array,sequence,offset,len,i,s,d,byteOffset,byteLength,tmp;if(typeof arguments[0]==="object"&&arguments[0].constructor===this.constructor){array=arguments[0];offset=ToUint32(arguments[1]);if(offset+array.length>this.length){throw RangeError("Offset plus length of array is out of range")}byteOffset=this.byteOffset+offset*this.BYTES_PER_ELEMENT;byteLength=array.length*this.BYTES_PER_ELEMENT;if(array.buffer===this.buffer){tmp=[];for(i=0,s=array.byteOffset;i<byteLength;i+=1,s+=1){tmp[i]=array.buffer._bytes[s]}for(i=0,d=byteOffset;i<byteLength;i+=1,d+=1){this.buffer._bytes[d]=tmp[i]}}else{for(i=0,s=array.byteOffset,d=byteOffset;i<byteLength;i+=1,s+=1,d+=1){this.buffer._bytes[d]=array.buffer._bytes[s]}}}else{if(typeof arguments[0]==="object"&&typeof arguments[0].length!=="undefined"){sequence=arguments[0];len=ToUint32(sequence.length);offset=ToUint32(arguments[1]);if(offset+len>this.length){throw RangeError("Offset plus length of array is out of range")}for(i=0;i<len;i+=1){s=sequence[i];this._setter(offset+i,Number(s))}}else{throw TypeError("Unexpected argument type(s)")}}}});Object.defineProperty($TypedArray$.prototype,"slice",{value:function(start,end){var o=ToObject(this);var lenVal=o.length;var len=ToUint32(lenVal);var relativeStart=ToInt32(start);var k=(relativeStart<0)?max(len+relativeStart,0):min(relativeStart,len);var relativeEnd=(end===undefined)?len:ToInt32(end);var final_=(relativeEnd<0)?max(len+relativeEnd,0):min(relativeEnd,len);var count=final_-k;var c=o.constructor;var a=new c(count);var n=0;while(k<final_){var kValue=o._getter(k);a._setter(n,kValue);++k;++n}return a}});Object.defineProperty($TypedArray$.prototype,"some",{value:function(callbackfn){if(this===undefined||this===null){throw TypeError()}var t=Object(this);var len=ToUint32(t.length);if(!IsCallable(callbackfn)){throw TypeError()}var thisp=arguments[1];for(var i=0;i<len;i++){if(callbackfn.call(thisp,t._getter(i),i,t)){return true}}return false}});Object.defineProperty($TypedArray$.prototype,"sort",{value:function(comparefn){if(this===undefined||this===null){throw TypeError()}var t=Object(this);var len=ToUint32(t.length);var tmp=Array(len);for(var i=0;i<len;++i){tmp[i]=t._getter(i)}if(comparefn){tmp.sort(comparefn)}else{tmp.sort()}for(i=0;i<len;++i){t._setter(i,tmp[i])}return t}});Object.defineProperty($TypedArray$.prototype,"subarray",{value:function(start,end){function clamp(v,min,max){return v<min?min:v>max?max:v}start=ToInt32(start);end=ToInt32(end);if(arguments.length<1){start=0}if(arguments.length<2){end=this.length}if(start<0){start=this.length+start}if(end<0){end=this.length+end}start=clamp(start,0,this.length);end=clamp(end,0,this.length);var len=end-start;if(len<0){len=0}return new this.constructor(this.buffer,this.byteOffset+start*this.BYTES_PER_ELEMENT,len)}});function makeTypedArray(elementSize,pack,unpack){var TypedArray=function(){Object.defineProperty(this,"constructor",{value:TypedArray});$TypedArray$.apply(this,arguments);makeArrayAccessors(this)};if("__proto__" in TypedArray){TypedArray.__proto__=$TypedArray$}else{TypedArray.from=$TypedArray$.from;TypedArray.of=$TypedArray$.of}TypedArray.BYTES_PER_ELEMENT=elementSize;var TypedArrayPrototype=function(){};TypedArrayPrototype.prototype=$TypedArrayPrototype$;TypedArray.prototype=new TypedArrayPrototype();Object.defineProperty(TypedArray.prototype,"BYTES_PER_ELEMENT",{value:elementSize});Object.defineProperty(TypedArray.prototype,"_pack",{value:pack});Object.defineProperty(TypedArray.prototype,"_unpack",{value:unpack});return TypedArray}var Int8Array=makeTypedArray(1,packI8,unpackI8);var Uint8Array=makeTypedArray(1,packU8,unpackU8);var Uint8ClampedArray=makeTypedArray(1,packU8Clamped,unpackU8);var Int16Array=makeTypedArray(2,packI16,unpackI16);var Uint16Array=makeTypedArray(2,packU16,unpackU16);var Int32Array=makeTypedArray(4,packI32,unpackI32);var Uint32Array=makeTypedArray(4,packU32,unpackU32);var Float32Array=makeTypedArray(4,packF32,unpackF32);var Float64Array=makeTypedArray(8,packF64,unpackF64);global.Int8Array=global.Int8Array||Int8Array;global.Uint8Array=global.Uint8Array||Uint8Array;global.Uint8ClampedArray=global.Uint8ClampedArray||Uint8ClampedArray;global.Int16Array=global.Int16Array||Int16Array;global.Uint16Array=global.Uint16Array||Uint16Array;global.Int32Array=global.Int32Array||Int32Array;global.Uint32Array=global.Uint32Array||Uint32Array;global.Float32Array=global.Float32Array||Float32Array;global.Float64Array=global.Float64Array||Float64Array}());(function(){function r(array,index){return IsCallable(array.get)?array.get(index):array[index]}var IS_BIG_ENDIAN=(function(){var u16array=new Uint16Array([4660]),u8array=new Uint8Array(u16array.buffer);return r(u8array,0)===18}());function DataView(buffer,byteOffset,byteLength){if(!(buffer instanceof ArrayBuffer||Class(buffer)==="ArrayBuffer")){throw TypeError()}byteOffset=ToUint32(byteOffset);if(byteOffset>buffer.byteLength){throw RangeError("byteOffset out of range")}if(byteLength===undefined){byteLength=buffer.byteLength-byteOffset}else{byteLength=ToUint32(byteLength)}if((byteOffset+byteLength)>buffer.byteLength){throw RangeError("byteOffset and length reference an area beyond the end of the buffer")}Object.defineProperty(this,"buffer",{value:buffer});Object.defineProperty(this,"byteLength",{value:byteLength});Object.defineProperty(this,"byteOffset",{value:byteOffset})}function makeGetter(arrayType){return function GetViewValue(byteOffset,littleEndian){byteOffset=ToUint32(byteOffset);if(byteOffset+arrayType.BYTES_PER_ELEMENT>this.byteLength){throw RangeError("Array index out of range")}byteOffset+=this.byteOffset;var uint8Array=new Uint8Array(this.buffer,byteOffset,arrayType.BYTES_PER_ELEMENT),bytes=[];for(var i=0;i<arrayType.BYTES_PER_ELEMENT;i+=1){bytes.push(r(uint8Array,i))}if(Boolean(littleEndian)===Boolean(IS_BIG_ENDIAN)){bytes.reverse()}return r(new arrayType(new Uint8Array(bytes).buffer),0)}}Object.defineProperty(DataView.prototype,"getUint8",{value:makeGetter(Uint8Array)});Object.defineProperty(DataView.prototype,"getInt8",{value:makeGetter(Int8Array)});Object.defineProperty(DataView.prototype,"getUint16",{value:makeGetter(Uint16Array)});Object.defineProperty(DataView.prototype,"getInt16",{value:makeGetter(Int16Array)});Object.defineProperty(DataView.prototype,"getUint32",{value:makeGetter(Uint32Array)});Object.defineProperty(DataView.prototype,"getInt32",{value:makeGetter(Int32Array)});Object.defineProperty(DataView.prototype,"getFloat32",{value:makeGetter(Float32Array)});Object.defineProperty(DataView.prototype,"getFloat64",{value:makeGetter(Float64Array)});function makeSetter(arrayType){return function SetViewValue(byteOffset,value,littleEndian){byteOffset=ToUint32(byteOffset);if(byteOffset+arrayType.BYTES_PER_ELEMENT>this.byteLength){throw RangeError("Array index out of range")}var typeArray=new arrayType([value]),byteArray=new Uint8Array(typeArray.buffer),bytes=[],i,byteView;for(i=0;i<arrayType.BYTES_PER_ELEMENT;i+=1){bytes.push(r(byteArray,i))}if(Boolean(littleEndian)===Boolean(IS_BIG_ENDIAN)){bytes.reverse()}byteView=new Uint8Array(this.buffer,byteOffset,arrayType.BYTES_PER_ELEMENT);byteView.set(bytes)}}Object.defineProperty(DataView.prototype,"setUint8",{value:makeSetter(Uint8Array)});Object.defineProperty(DataView.prototype,"setInt8",{value:makeSetter(Int8Array)});Object.defineProperty(DataView.prototype,"setUint16",{value:makeSetter(Uint16Array)});Object.defineProperty(DataView.prototype,"setInt16",{value:makeSetter(Int16Array)});Object.defineProperty(DataView.prototype,"setUint32",{value:makeSetter(Uint32Array)});Object.defineProperty(DataView.prototype,"setInt32",{value:makeSetter(Int32Array)});Object.defineProperty(DataView.prototype,"setFloat32",{value:makeSetter(Float32Array)});Object.defineProperty(DataView.prototype,"setFloat64",{value:makeSetter(Float64Array)});global.DataView=global.DataView||DataView}())}(this));
/*!
 * miniTip v1.5.3
 *
 * Updated: July 15, 2012
 * Requires: jQuery v1.3+
 *
 * (c) 2011, James Simpson
 * http://goldfirestudios.com
 *
 * Dual licensed under the MIT and GPL
 *
 * Documentation found at:
 * http://goldfirestudios.com/blog/81/miniTip-jQuery-Plugin
*/
(function($){$.fn.miniTip=function(opts){var d={title:"",content:false,delay:300,anchor:"n",event:"hover",fadeIn:200,fadeOut:200,aHide:true,maxW:"250px",offset:5,stemOff:0,doHide:false},o=$.extend(d,opts);if(!$("#miniTip")[0]){$("body").append('<div id="miniTip"><div id="miniTip_t"></div><div id="miniTip_c"></div><div id="miniTip_a"></div></div>')}var tt_w=$("#miniTip"),tt_t=$("#miniTip_t"),tt_c=$("#miniTip_c"),tt_a=$("#miniTip_a");if(o.doHide){tt_w.stop(true,true).fadeOut(o.fadeOut);return false}return this.each(function(){var el=$(this);var cont=o.content?o.content:el.attr("title");if(cont!=""&&typeof cont!="undefined"){window.delay=false;var tHov=false,aHov=true;if(!o.content){el.removeAttr("title")}if(o.event=="hover"){el.hover(function(){tt_w.removeAttr("click");aHov=true;show.call(this)},function(){aHov=false;hide()});if(!o.aHide){tt_w.hover(function(){tHov=true},function(){tHov=false;setTimeout(function(){if(!aHov&&!tt_w.attr("click")){hide()}},20)})}}else{if(o.event=="click"){o.aHide=true;el.click(function(){tt_w.attr("click","t");if(tt_w.data("last_target")!==el){show.call(this)}else{if(tt_w.css("display")=="none"){show.call(this)}else{hide()}}tt_w.data("last_target",el);$("html").unbind("click").click(function(e){if(tt_w.css("display")=="block"&&!$(e.target).closest("#miniTip").length){$("html").unbind("click");hide()}});return false})}}var show=function(){if(o.show){o.show.call(this,o)}if(o.content&&o.content!=""){cont=o.content}tt_c.html(cont);if(o.title!=""){tt_t.html(o.title).show()}else{tt_t.hide()}if(o.render){o.render(tt_w)}tt_a.removeAttr("class");tt_w.hide().width("").width(tt_w.width()).css("max-width",o.maxW);var isArea=el.is("area");if(isArea){var i,x=[],y=[],c=el.attr("coords").split(",");function num(a,b){return a-b}for(i=0;i<c.length;i++){x.push(c[i++]);y.push(c[i])}var mapImg=el.parent().attr("name"),mapOff=$("img[usemap=\\#"+mapImg+"]").offset(),left=parseInt(mapOff.left,10)+parseInt((parseInt(x.sort(num)[0],10)+parseInt(x.sort(num)[x.length-1],10))/2,10),top=parseInt(mapOff.top,10)+parseInt((parseInt(y.sort(num)[0],10)+parseInt(y.sort(num)[y.length-1],10))/2,10)}else{var top=parseInt(el.offset().top,10),left=parseInt(el.offset().left,10)}var elW=isArea?0:parseInt(el.outerWidth(),10),elH=isArea?0:parseInt(el.outerHeight(),10),tipW=tt_w.outerWidth(),tipH=tt_w.outerHeight(),mLeft=Math.round(left+Math.round((elW-tipW)/2)),mTop=Math.round(top+elH+o.offset+8),aLeft=(Math.round(tipW-16)/2)-parseInt(tt_w.css("borderLeftWidth"),10),aTop=0,eOut=(left+elW+tipW+o.offset+8)>parseInt($(window).width(),10),wOut=(tipW+o.offset+8)>left,nOut=(tipH+o.offset+8)>top-$(window).scrollTop(),sOut=(top+elH+tipH+o.offset+8)>parseInt($(window).height()+$(window).scrollTop(),10),elPos=o.anchor;if(wOut||o.anchor=="e"&&!eOut){if(o.anchor=="w"||o.anchor=="e"){elPos="e";aTop=Math.round((tipH/2)-8-parseInt(tt_w.css("borderRightWidth"),10));aLeft=-8-parseInt(tt_w.css("borderRightWidth"),10);mLeft=left+elW+o.offset+8;mTop=Math.round((top+elH/2)-(tipH/2))}}else{if(eOut||o.anchor=="w"&&!wOut){if(o.anchor=="w"||o.anchor=="e"){elPos="w";aTop=Math.round((tipH/2)-8-parseInt(tt_w.css("borderLeftWidth"),10));aLeft=tipW-parseInt(tt_w.css("borderLeftWidth"),10);mLeft=left-tipW-o.offset-8;mTop=Math.round((top+elH/2)-(tipH/2))}}}if(sOut||o.anchor=="n"&&!nOut){if(o.anchor=="n"||o.anchor=="s"){elPos="n";aTop=tipH-parseInt(tt_w.css("borderTopWidth"),10);mTop=top-(tipH+o.offset+8)}}else{if(nOut||o.anchor=="s"&&!sOut){if(o.anchor=="n"||o.anchor=="s"){elPos="s";aTop=-8-parseInt(tt_w.css("borderBottomWidth"),10);mTop=top+elH+o.offset+8}}}if(o.anchor=="n"||o.anchor=="s"){if((tipW/2)>left){mLeft=mLeft<0?aLeft+mLeft:aLeft;aLeft=0}else{if((left+tipW/2)>parseInt($(window).width(),10)){mLeft-=aLeft;aLeft*=2}}}else{if(nOut){mTop=mTop+aTop;aTop=0}else{if(sOut){mTop-=aTop;aTop*=2}}}tt_a.css({"margin-left":(aLeft>0?aLeft:aLeft+parseInt(o.stemOff,10)/2)+"px","margin-top":aTop+"px"}).attr("class",elPos);if(delay){clearTimeout(delay)}delay=setTimeout(function(){tt_w.css({"margin-left":mLeft+"px","margin-top":mTop+"px"}).stop(true,true).fadeIn(o.fadeIn)},o.delay)};var hide=function(){if(!o.aHide&&!tHov||o.aHide){if(delay){clearTimeout(delay)}delay=setTimeout(function(){hide2()},o.delay)}};var hide2=function(){if(!o.aHide&&!tHov||o.aHide){tt_w.stop(true,true).fadeOut(o.fadeOut);if(o.hide){o.hide.call(this)}}else{setTimeout(function(){hide()},200)}}}})}})(jQuery);(function(window,document,undefined){var j=void 0,k=!0,l=null,p=!1;function q(a){return function(){return this[a]}}var aa=this;function ba(a,b){var c=a.split("."),d=aa;!(c[0] in d)&&d.execScript&&d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());){!c.length&&b!==j?d[e]=b:d=d[e]?d[e]:d[e]={}}}aa.Ba=k;function ca(a,b,c){return a.call.apply(a.bind,arguments)}function da(a,b,c){if(!a){throw Error()}if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function s(a,b,c){s=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ca:da;return s.apply(l,arguments)}var ea=Date.now||function(){return +new Date};function fa(a,b){this.G=a;this.u=b||a;this.z=this.u.document;this.R=j}fa.prototype.createElement=function(a,b,c){a=this.z.createElement(a);if(b){for(var d in b){if(b.hasOwnProperty(d)){if("style"==d){var e=a,f=b[d];ga(this)?e.setAttribute("style",f):e.style.cssText=f}else{a.setAttribute(d,b[d])}}}}c&&a.appendChild(this.z.createTextNode(c));return a};function t(a,b,c){a=a.z.getElementsByTagName(b)[0];a||(a=document.documentElement);a&&a.lastChild&&a.insertBefore(c,a.lastChild)}function u(a,b){return a.createElement("link",{rel:"stylesheet",href:b})}function ha(a,b){return a.createElement("script",{src:b})}function v(a,b){for(var c=a.className.split(/\s+/),d=0,e=c.length;d<e;d++){if(c[d]==b){return}}c.push(b);a.className=c.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function w(a,b){for(var c=a.className.split(/\s+/),d=[],e=0,f=c.length;e<f;e++){c[e]!=b&&d.push(c[e])}a.className=d.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function ia(a,b){for(var c=a.className.split(/\s+/),d=0,e=c.length;d<e;d++){if(c[d]==b){return k}}return p}function ga(a){if(a.R===j){var b=a.z.createElement("p");b.innerHTML='<a style="top:1px;">w</a>';a.R=/top/.test(b.getElementsByTagName("a")[0].getAttribute("style"))}return a.R}function x(a){var b=a.u.location.protocol;"about:"==b&&(b=a.G.location.protocol);return"https:"==b?"https:":"http:"}function y(a,b,c){this.w=a;this.T=b;this.Aa=c}ba("webfont.BrowserInfo",y);y.prototype.qa=q("w");y.prototype.hasWebFontSupport=y.prototype.qa;y.prototype.ra=q("T");y.prototype.hasWebKitFallbackBug=y.prototype.ra;y.prototype.sa=q("Aa");y.prototype.hasWebKitMetricsBug=y.prototype.sa;function z(a,b,c,d){this.e=a!=l?a:l;this.o=b!=l?b:l;this.ba=c!=l?c:l;this.f=d!=l?d:l}var ja=/^([0-9]+)(?:[\._-]([0-9]+))?(?:[\._-]([0-9]+))?(?:[\._+-]?(.*))?$/;z.prototype.toString=function(){return[this.e,this.o||"",this.ba||"",this.f||""].join("")};function A(a){a=ja.exec(a);var b=l,c=l,d=l,e=l;a&&(a[1]!==l&&a[1]&&(b=parseInt(a[1],10)),a[2]!==l&&a[2]&&(c=parseInt(a[2],10)),a[3]!==l&&a[3]&&(d=parseInt(a[3],10)),a[4]!==l&&a[4]&&(e=/^[0-9]+$/.test(a[4])?parseInt(a[4],10):a[4]));return new z(b,c,d,e)}function B(a,b,c,d,e,f,g,h,n,m,r){this.J=a;this.Ha=b;this.za=c;this.ga=d;this.Fa=e;this.fa=f;this.xa=g;this.Ga=h;this.wa=n;this.ea=m;this.k=r}ba("webfont.UserAgent",B);B.prototype.getName=q("J");B.prototype.getName=B.prototype.getName;B.prototype.pa=q("za");B.prototype.getVersion=B.prototype.pa;B.prototype.la=q("ga");B.prototype.getEngine=B.prototype.la;B.prototype.ma=q("fa");B.prototype.getEngineVersion=B.prototype.ma;B.prototype.na=q("xa");B.prototype.getPlatform=B.prototype.na;B.prototype.oa=q("wa");B.prototype.getPlatformVersion=B.prototype.oa;B.prototype.ka=q("ea");B.prototype.getDocumentMode=B.prototype.ka;B.prototype.ja=q("k");B.prototype.getBrowserInfo=B.prototype.ja;function C(a,b){this.a=a;this.H=b}var ka=new B("Unknown",new z,"Unknown","Unknown",new z,"Unknown","Unknown",new z,"Unknown",j,new y(p,p,p));C.prototype.parse=function(){var a;if(-1!=this.a.indexOf("MSIE")){a=D(this);var b=E(this),c=A(b),d=F(this.a,/MSIE ([\d\w\.]+)/,1),e=A(d);a=new B("MSIE",e,d,"MSIE",e,d,a,c,b,G(this.H),new y("Windows"==a&&6<=e.e||"Windows Phone"==a&&8<=c.e,p,p))}else{if(-1!=this.a.indexOf("Opera")){a:{a="Unknown";var b=F(this.a,/Presto\/([\d\w\.]+)/,1),c=A(b),d=E(this),e=A(d),f=G(this.H);c.e!==l?a="Presto":(-1!=this.a.indexOf("Gecko")&&(a="Gecko"),b=F(this.a,/rv:([^\)]+)/,1),c=A(b));if(-1!=this.a.indexOf("Opera Mini/")){var g=F(this.a,/Opera Mini\/([\d\.]+)/,1),h=A(g);a=new B("OperaMini",h,g,a,c,b,D(this),e,d,f,new y(p,p,p))}else{if(-1!=this.a.indexOf("Version/")&&(g=F(this.a,/Version\/([\d\.]+)/,1),h=A(g),h.e!==l)){a=new B("Opera",h,g,a,c,b,D(this),e,d,f,new y(10<=h.e,p,p));break a}g=F(this.a,/Opera[\/ ]([\d\.]+)/,1);h=A(g);a=h.e!==l?new B("Opera",h,g,a,c,b,D(this),e,d,f,new y(10<=h.e,p,p)):new B("Opera",new z,"Unknown",a,c,b,D(this),e,d,f,new y(p,p,p))}}}else{if(/AppleWeb(K|k)it/.test(this.a)){a=D(this);var b=E(this),c=A(b),d=F(this.a,/AppleWeb(?:K|k)it\/([\d\.\+]+)/,1),e=A(d),f="Unknown",g=new z,h="Unknown",n=p;-1!=this.a.indexOf("Chrome")||-1!=this.a.indexOf("CrMo")||-1!=this.a.indexOf("CriOS")?f="Chrome":/Silk\/\d/.test(this.a)?f="Silk":"BlackBerry"==a||"Android"==a?f="BuiltinBrowser":-1!=this.a.indexOf("Safari")?f="Safari":-1!=this.a.indexOf("AdobeAIR")&&(f="AdobeAIR");"BuiltinBrowser"==f?h="Unknown":"Silk"==f?h=F(this.a,/Silk\/([\d\._]+)/,1):"Chrome"==f?h=F(this.a,/(Chrome|CrMo|CriOS)\/([\d\.]+)/,2):-1!=this.a.indexOf("Version/")?h=F(this.a,/Version\/([\d\.\w]+)/,1):"AdobeAIR"==f&&(h=F(this.a,/AdobeAIR\/([\d\.]+)/,1));g=A(h);n="AdobeAIR"==f?2<g.e||2==g.e&&5<=g.o:"BlackBerry"==a?10<=c.e:"Android"==a?2<c.e||2==c.e&&1<c.o:526<=e.e||525<=e.e&&13<=e.o;a=new B(f,g,h,"AppleWebKit",e,d,a,c,b,G(this.H),new y(n,536>e.e||536==e.e&&11>e.o,"iPhone"==a||"iPad"==a||"iPod"==a||"Macintosh"==a))}else{-1!=this.a.indexOf("Gecko")?(a="Unknown",b=new z,c="Unknown",d=E(this),e=A(d),f=p,-1!=this.a.indexOf("Firefox")?(a="Firefox",c=F(this.a,/Firefox\/([\d\w\.]+)/,1),b=A(c),f=3<=b.e&&5<=b.o):-1!=this.a.indexOf("Mozilla")&&(a="Mozilla"),g=F(this.a,/rv:([^\)]+)/,1),h=A(g),f||(f=1<h.e||1==h.e&&9<h.o||1==h.e&&9==h.o&&2<=h.ba||g.match(/1\.9\.1b[123]/)!=l||g.match(/1\.9\.1\.[\d\.]+/)!=l),a=new B(a,b,c,"Gecko",h,g,D(this),e,d,G(this.H),new y(f,p,p))):a=ka}}}return a};function D(a){var b=F(a.a,/(iPod|iPad|iPhone|Android|Windows Phone|BB\d{2}|BlackBerry)/,1);if(""!=b){return/BB\d{2}/.test(b)&&(b="BlackBerry"),b}a=F(a.a,/(Linux|Mac_PowerPC|Macintosh|Windows|CrOS)/,1);return""!=a?("Mac_PowerPC"==a&&(a="Macintosh"),a):"Unknown"}function E(a){var b=F(a.a,/(OS X|Windows NT|Android) ([^;)]+)/,2);if(b||(b=F(a.a,/Windows Phone( OS)? ([^;)]+)/,2))||(b=F(a.a,/(iPhone )?OS ([\d_]+)/,2))){return b}if(b=F(a.a,/(?:Linux|CrOS) ([^;)]+)/,1)){for(var b=b.split(/\s/),c=0;c<b.length;c+=1){if(/^[\d\._]+$/.test(b[c])){return b[c]}}}return(a=F(a.a,/(BB\d{2}|BlackBerry).*?Version\/([^\s]*)/,2))?a:"Unknown"}function F(a,b,c){return(a=a.match(b))&&a[c]?a[c]:""}function G(a){if(a.documentMode){return a.documentMode}}function la(a){this.va=a||"-"}la.prototype.f=function(a){for(var b=[],c=0;c<arguments.length;c++){b.push(arguments[c].replace(/[\W_]+/g,"").toLowerCase())}return b.join(this.va)};function H(a,b){this.J=a;this.U=4;this.K="n";var c=(b||"n4").match(/^([nio])([1-9])$/i);c&&(this.K=c[1],this.U=parseInt(c[2],10))}H.prototype.getName=q("J");function I(a){return a.K+a.U}function ma(a){var b=4,c="n",d=l;a&&((d=a.match(/(normal|oblique|italic)/i))&&d[1]&&(c=d[1].substr(0,1).toLowerCase()),(d=a.match(/([1-9]00|normal|bold)/i))&&d[1]&&(/bold/i.test(d[1])?b=7:/[1-9]00/.test(d[1])&&(b=parseInt(d[1].substr(0,1),10))));return c+b}function na(a,b,c){this.c=a;this.h=b;this.M=c;this.j="wf";this.g=new la("-")}function pa(a){v(a.h,a.g.f(a.j,"loading"));J(a,"loading")}function K(a){w(a.h,a.g.f(a.j,"loading"));ia(a.h,a.g.f(a.j,"active"))||v(a.h,a.g.f(a.j,"inactive"));J(a,"inactive")}function J(a,b,c){if(a.M[b]){if(c){a.M[b](c.getName(),I(c))}else{a.M[b]()}}}function L(a,b){this.c=a;this.C=b;this.s=this.c.createElement("span",{"aria-hidden":"true"},this.C)}function M(a,b){var c=a.s,d;d=[];for(var e=b.J.split(/,\s*/),f=0;f<e.length;f++){var g=e[f].replace(/['"]/g,"");-1==g.indexOf(" ")?d.push(g):d.push("'"+g+"'")}d=d.join(",");e="normal";f=b.U+"00";"o"===b.K?e="oblique":"i"===b.K&&(e="italic");d="position:absolute;top:-999px;left:-999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+d+";"+("font-style:"+e+";font-weight:"+f+";");ga(a.c)?c.setAttribute("style",d):c.style.cssText=d}function N(a){t(a.c,"body",a.s)}L.prototype.remove=function(){var a=this.s;a.parentNode&&a.parentNode.removeChild(a)};function qa(a,b,c,d,e,f,g,h){this.V=a;this.ta=b;this.c=c;this.q=d;this.C=h||"BESbswy";this.k=e;this.F={};this.S=f||5000;this.Z=g||l;this.B=this.A=l;a=new L(this.c,this.C);N(a);for(var n in O){O.hasOwnProperty(n)&&(M(a,new H(O[n],I(this.q))),this.F[O[n]]=a.s.offsetWidth)}a.remove()}var O={Ea:"serif",Da:"sans-serif",Ca:"monospace"};qa.prototype.start=function(){this.A=new L(this.c,this.C);N(this.A);this.B=new L(this.c,this.C);N(this.B);this.ya=ea();M(this.A,new H(this.q.getName()+",serif",I(this.q)));M(this.B,new H(this.q.getName()+",sans-serif",I(this.q)));ra(this)};function sa(a,b,c){for(var d in O){if(O.hasOwnProperty(d)&&b===a.F[O[d]]&&c===a.F[O[d]]){return k}}return p}function ra(a){var b=a.A.s.offsetWidth,c=a.B.s.offsetWidth;b===a.F.serif&&c===a.F["sans-serif"]||a.k.T&&sa(a,b,c)?ea()-a.ya>=a.S?a.k.T&&sa(a,b,c)&&(a.Z===l||a.Z.hasOwnProperty(a.q.getName()))?P(a,a.V):P(a,a.ta):setTimeout(s(function(){ra(this)},a),25):P(a,a.V)}function P(a,b){a.A.remove();a.B.remove();b(a.q)}function R(a,b,c,d){this.c=b;this.t=c;this.N=0;this.ca=this.Y=p;this.S=d;this.k=a.k}function ta(a,b,c,d,e){if(0===b.length&&e){K(a.t)}else{a.N+=b.length;e&&(a.Y=e);for(e=0;e<b.length;e++){var f=b[e],g=c[f.getName()],h=a.t,n=f;v(h.h,h.g.f(h.j,n.getName(),I(n).toString(),"loading"));J(h,"fontloading",n);(new qa(s(a.ha,a),s(a.ia,a),a.c,f,a.k,a.S,d,g)).start()}}}R.prototype.ha=function(a){var b=this.t;w(b.h,b.g.f(b.j,a.getName(),I(a).toString(),"loading"));w(b.h,b.g.f(b.j,a.getName(),I(a).toString(),"inactive"));v(b.h,b.g.f(b.j,a.getName(),I(a).toString(),"active"));J(b,"fontactive",a);this.ca=k;ua(this)};R.prototype.ia=function(a){var b=this.t;w(b.h,b.g.f(b.j,a.getName(),I(a).toString(),"loading"));ia(b.h,b.g.f(b.j,a.getName(),I(a).toString(),"active"))||v(b.h,b.g.f(b.j,a.getName(),I(a).toString(),"inactive"));J(b,"fontinactive",a);ua(this)};function ua(a){0==--a.N&&a.Y&&(a.ca?(a=a.t,w(a.h,a.g.f(a.j,"loading")),w(a.h,a.g.f(a.j,"inactive")),v(a.h,a.g.f(a.j,"active")),J(a,"active")):K(a.t))}function S(a,b,c){this.G=a;this.W=b;this.a=c;this.O=this.P=0}function T(a,b){U.W.$[a]=b}S.prototype.load=function(a){var b=a.context||this.G;this.c=new fa(this.G,b);b=new na(this.c,b.document.documentElement,a);if(this.a.k.w){var c=this.W,d=this.c,e=[],f;for(f in a){if(a.hasOwnProperty(f)){var g=c.$[f];g&&e.push(g(a[f],d))}}a=a.timeout;this.O=this.P=e.length;a=new R(this.a,this.c,b,a);f=0;for(c=e.length;f<c;f++){d=e[f],d.v(this.a,s(this.ua,this,d,b,a))}}else{K(b)}};S.prototype.ua=function(a,b,c,d){var e=this;d?a.load(function(a,d,h){var n=0==--e.P;n&&pa(b);setTimeout(function(){ta(c,a,d||{},h||l,n)},0)}):(a=0==--this.P,this.O--,a&&(0==this.O?K(b):pa(b)),ta(c,[],{},l,a))};var va=window,wa=(new C(navigator.userAgent,document)).parse(),U=va.WebFont=new S(window,new function(){this.$={}},wa);U.load=U.load;function V(a,b){this.c=a;this.d=b}V.prototype.load=function(a){var b,c,d=this.d.urls||[],e=this.d.families||[];b=0;for(c=d.length;b<c;b++){t(this.c,"head",u(this.c,d[b]))}d=[];b=0;for(c=e.length;b<c;b++){var f=e[b].split(":");if(f[1]){for(var g=f[1].split(","),h=0;h<g.length;h+=1){d.push(new H(f[0],g[h]))}}else{d.push(new H(f[0]))}}a(d)};V.prototype.v=function(a,b){return b(a.k.w)};T("custom",function(a,b){return new V(b,a)});function W(a,b){this.c=a;this.d=b}var xa={regular:"n4",bold:"n7",italic:"i4",bolditalic:"i7",r:"n4",b:"n7",i:"i4",bi:"i7"};W.prototype.v=function(a,b){return b(a.k.w)};W.prototype.load=function(a){t(this.c,"head",u(this.c,x(this.c)+"//webfonts.fontslive.com/css/"+this.d.key+".css"));for(var b=this.d.families,c=[],d=0,e=b.length;d<e;d++){c.push.apply(c,ya(b[d]))}a(c)};function ya(a){var b=a.split(":");a=b[0];if(b[1]){for(var c=b[1].split(","),b=[],d=0,e=c.length;d<e;d++){var f=c[d];if(f){var g=xa[f];b.push(g?g:f)}}c=[];for(d=0;d<b.length;d+=1){c.push(new H(a,b[d]))}return c}return[new H(a)]}T("ascender",function(a,b){return new W(b,a)});function X(a,b,c){this.a=a;this.c=b;this.d=c;this.m=[]}X.prototype.v=function(a,b){var c=this,d=c.d.projectId,e=c.d.version;if(d){var f=c.c.u,g=c.c.createElement("script");g.id="__MonotypeAPIScript__"+d;var h=p;g.onload=g.onreadystatechange=function(){if(!h&&(!this.readyState||"loaded"===this.readyState||"complete"===this.readyState)){h=k;if(f["__mti_fntLst"+d]){var e=f["__mti_fntLst"+d]();if(e){for(var m=0;m<e.length;m++){c.m.push(new H(e[m].fontfamily))}}}b(a.k.w);g.onload=g.onreadystatechange=l}};g.src=c.D(d,e);t(this.c,"head",g)}else{b(k)}};X.prototype.D=function(a,b){var c=x(this.c),d=(this.d.api||"fast.fonts.com/jsapi").replace(/^.*http(s?):(\/\/)?/,"");return c+"//"+d+"/"+a+".js"+(b?"?v="+b:"")};X.prototype.load=function(a){a(this.m)};T("monotype",function(a,b){var c=(new C(navigator.userAgent,document)).parse();return new X(c,b,a)});function Y(a,b){this.c=a;this.d=b;this.m=[]}Y.prototype.D=function(a){var b=x(this.c);return(this.d.api||b+"//use.typekit.net")+"/"+a+".js"};Y.prototype.v=function(a,b){var c=this.d.id,d=this.d,e=this.c.u,f=this;c?(e.__webfonttypekitmodule__||(e.__webfonttypekitmodule__={}),e.__webfonttypekitmodule__[c]=function(c){c(a,d,function(a,c,d){for(var e=0;e<c.length;e+=1){var g=d[c[e]];if(g){for(var Q=0;Q<g.length;Q+=1){f.m.push(new H(c[e],g[Q]))}}else{f.m.push(new H(c[e]))}}b(a)})},c=ha(this.c,this.D(c)),t(this.c,"head",c)):b(k)};Y.prototype.load=function(a){a(this.m)};T("typekit",function(a,b){return new Y(b,a)});function za(a,b,c){this.L=a?a:b+Aa;this.p=[];this.Q=[];this.da=c||""}var Aa="//fonts.googleapis.com/css";za.prototype.f=function(){if(0==this.p.length){throw Error("No fonts to load !")}if(-1!=this.L.indexOf("kit=")){return this.L}for(var a=this.p.length,b=[],c=0;c<a;c++){b.push(this.p[c].replace(/ /g,"+"))}a=this.L+"?family="+b.join("%7C");0<this.Q.length&&(a+="&subset="+this.Q.join(","));0<this.da.length&&(a+="&text="+encodeURIComponent(this.da));return a};function Ba(a){this.p=a;this.aa=[];this.I={}}var Ca={latin:"BESbswy",cyrillic:"&#1081;&#1103;&#1046;",greek:"&#945;&#946;&#931;",khmer:"&#x1780;&#x1781;&#x1782;",Hanuman:"&#x1780;&#x1781;&#x1782;"},Da={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},Ea={i:"i",italic:"i",n:"n",normal:"n"},Fa=RegExp("^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$");Ba.prototype.parse=function(){for(var a=this.p.length,b=0;b<a;b++){var c=this.p[b].split(":"),d=c[0].replace(/\+/g," "),e=["n4"];if(2<=c.length){var f;var g=c[1];f=[];if(g){for(var g=g.split(","),h=g.length,n=0;n<h;n++){var m;m=g[n];if(m.match(/^[\w]+$/)){m=Fa.exec(m.toLowerCase());var r=j;if(m==l){r=""}else{r=j;r=m[1];if(r==l||""==r){r="4"}else{var oa=Da[r],r=oa?oa:isNaN(r)?"4":r.substr(0,1)}r=[m[2]==l||""==m[2]?"n":Ea[m[2]],r].join("")}m=r}else{m=""}m&&f.push(m)}}0<f.length&&(e=f);3==c.length&&(c=c[2],f=[],c=!c?f:c.split(","),0<c.length&&(c=Ca[c[0]])&&(this.I[d]=c))}this.I[d]||(c=Ca[d])&&(this.I[d]=c);for(c=0;c<e.length;c+=1){this.aa.push(new H(d,e[c]))}}};function Z(a,b,c){this.a=a;this.c=b;this.d=c}var Ga={Arimo:k,Cousine:k,Tinos:k};Z.prototype.v=function(a,b){b(a.k.w)};Z.prototype.load=function(a){var b=this.c;if("MSIE"==this.a.getName()&&this.d.blocking!=k){var c=s(this.X,this,a),d=function(){b.z.body?c():setTimeout(d,0)};d()}else{this.X(a)}};Z.prototype.X=function(a){for(var b=this.c,c=new za(this.d.api,x(b),this.d.text),d=this.d.families,e=d.length,f=0;f<e;f++){var g=d[f].split(":");3==g.length&&c.Q.push(g.pop());var h="";2==g.length&&""!=g[1]&&(h=":");c.p.push(g.join(h))}d=new Ba(d);d.parse();t(b,"head",u(b,c.f()));a(d.aa,d.I,Ga)};T("google",function(a,b){var c=(new C(navigator.userAgent,document)).parse();return new Z(c,b,a)});function $(a,b){this.c=a;this.d=b;this.m=[]}$.prototype.D=function(a){return x(this.c)+(this.d.api||"//f.fontdeck.com/s/css/js/")+(this.c.u.location.hostname||this.c.G.location.hostname)+"/"+a+".js"};$.prototype.v=function(a,b){var c=this.d.id,d=this.c.u,e=this;c?(d.__webfontfontdeckmodule__||(d.__webfontfontdeckmodule__={}),d.__webfontfontdeckmodule__[c]=function(a,c){for(var d=0,n=c.fonts.length;d<n;++d){var m=c.fonts[d];e.m.push(new H(m.name,ma("font-weight:"+m.weight+";font-style:"+m.style)))}b(a)},c=ha(this.c,this.D(c)),t(this.c,"head",c)):b(k)};$.prototype.load=function(a){a(this.m)};T("fontdeck",function(a,b){return new $(b,a)});window.WebFontConfig&&U.load(window.WebFontConfig)})(this,document);(function(){_gliffy._GoogleTagManager=_gliffy.Class.extend({init:function(id){var w=window,d=document,s="script",l="dataLayer",i=id;w[l]=w[l]||[];w[l].push({"gtm.start":new Date().getTime(),event:"gtm.js"});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!="dataLayer"?"&l="+l:"";j.async=true;j.src="//www.googletagmanager.com/gtm.js?id="+i+dl;f.parentNode.insertBefore(j,f)}})}());(function($){
/*!! Simple JavaScript Inheritance
     * By John Resig http://ejohn.org/
     * MIT Licensed.
     * http://ejohn.org/blog/simple-javascript-inheritance
     *
     */
var initializing=false,fnTest=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;var Class=function(){};Class.extend=function(prop){var _super=this.prototype;initializing=true;var prototype=new this();initializing=false;for(var name in prop){prototype[name]=typeof prop[name]=="function"&&typeof _super[name]=="function"&&fnTest.test(prop[name])?(function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);this._super=tmp;return ret}})(name,prop[name]):prop[name]}function Class(){if(!(this instanceof Class)){return new Class(arguments)}if(!initializing&&this.init){this.init.apply(this,arguments)}}Class.prototype=prototype;Class.prototype.constructor=Class;Class.extend=arguments.callee;return Class};var AnalyticsInterface=Class.extend({init:function(){},setAccount:function(){},trackEvent:function(){},trackPageView:function(){},logEvents:function(){},setLabel:function(){},runFuncIfAnalyticsExists:function(){}});var EventThrottler=Class.extend({__eventsRemaining:0,__maxEvents:0,__regenInterval:-1,__functionQueue:null,abort:function(){clearInterval(this.__regenInterval)},init:function(o){var options=$.extend({eventBucket:9,regen:1,per:1100},o),self=this;self.__eventsRemaining=options.eventBucket;self.__maxEvents=options.eventBucket;self.__functionQueue=[];self.__regenInterval=setInterval(function(){self.__eventsRemaining=Math.min(options.eventBucket,self.__eventsRemaining+options.regen);self.__runEvents()},options.per)},__runEvents:function(){var self=this,queueEntry;while(self.__eventsRemaining>0&&self.__functionQueue.length>0){queueEntry=self.__functionQueue.shift();queueEntry.func.apply(this,queueEntry.args);self.__eventsRemaining--}},addFunction:function(func,funcArgsArray){this.__functionQueue.push({func:func,args:funcArgsArray});this.__runEvents()}});var GoogleAnalytics=AnalyticsInterface.extend({_loaded:false,_trackerID:"",_logEvents:false,_logger:null,_activeLabel:null,_optPageName:null,_eventThrottler:null,_eventWarningCtr:450,_customVariableIndices:null,_canLog:function(){return this._logger!==null&&this._logEvents===true},init:function(trackerID,optPageName,onScriptLoadedFunc,debug){var s,ga=document.createElement("script"),self=this;this._optPageName=optPageName;if(debug===undefined){debug=false}ga.type="text/javascript";ga.async=true;ga.src=("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/"+(debug?"u/ga_debug.js":"ga.js");s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(ga,s);this._trackerID=trackerID;this._eventWarningCtr=450;ga.onreadystatechange=function(){if(this.readyState==="complete"){self._scriptLoaded();if(onScriptLoadedFunc){onScriptLoadedFunc()}}};ga.onload=function(){self._scriptLoaded();if(onScriptLoadedFunc){onScriptLoadedFunc()}};self._customVariableIndices={product:1,license:2,numUsers:3};self._eventThrottler=new EventThrottler()},loaded:function(){return this._loaded},setAccount:function(account){this._push(["_setAccount",account])},setLabel:function(label){this._activeLabel=label},setCustomVariables:function(product,license,numUsers){var PAGE_SCOPE=3;if(product){this._push(["_setCustomVar",this._customVariableIndices.product,"product",product,PAGE_SCOPE])}this._push(["_setCustomVar",this._customVariableIndices.license,"license",license,PAGE_SCOPE]);this._push(["_setCustomVar",this._customVariableIndices.numUsers,"numUsers",numUsers,PAGE_SCOPE])},trackEvent:function(category,action,opt_label,opt_value,opt_non_interaction){opt_label=opt_label===undefined?null:opt_label;opt_value=opt_value===undefined?null:opt_value;opt_non_interaction===undefined?null:opt_non_interaction;if(opt_label===null&&this._activeLabel!==null){opt_label=this._activeLabel}this._push(["_trackEvent",category,action,opt_label,opt_value,opt_non_interaction]);if(--this._eventWarningCtr===0){this._push(["_trackEvent","warning","eventsExceed450",opt_label,null,null])}if(category==="lzxclient"){this._push(["_trackPageview","/lzxEvent/"+action])}},trackPageView:function(){if(this._optPageName){this._push(["_trackPageview",this._optPageName])}else{this._push(["_trackPageview"])}},logEvents:function(bool,logger){this._logEvents=bool;this._logger=logger},_scriptLoaded:function(){this._loaded=true;this._push(["_setDomainName","none"]);this.setAccount(this._trackerID);this.trackPageView()},_push:function(eventArray){var self=this;this._eventThrottler.addFunction(function(){if(typeof _gaq!="undefined"){_gaq.push(eventArray);if(self._canLog()){self._logger.log("ANALYTICS: "+eventArray.join(", "))}}})},runFuncIfAnalyticsExists:function(func){if(func){func()}}});var _AnalyticsListener=Class.extend({_analytics:null,_queuedEvents:null,init:function(){var self=this;self._queuedEvents=[];$(window).bind("init.gliffyAnalytics",function(event,o){var options=$.extend({},{accountType:"none",accountID:"UA-248648-8",debug:false,optPageName:null},o);if(!self._analytics){switch(options.accountType){case"google":self._analytics=new GoogleAnalytics(options.accountID,options.optPageName,function(){var typeAndOption;while(typeAndOption=self._queuedEvents.shift()){$(window).trigger(typeAndOption[0]+".gliffyAnalytics",typeAndOption[1])}},options.debug);break}}});$(window).bind("trackEvent.gliffyAnalytics",function(event,o){var options=$.extend({},{category:"",action:"",label:null,value:null,non_interaction:null},o);if(self._analytics&&self._analytics.loaded()){self._analytics.trackEvent(options.category,options.action,options.label,options.value,options.non_interaction)}else{self._queuedEvents.push(["trackEvent",o])}});$(window).bind("setLabel.gliffyAnalytics",function(event,o){var options=$.extend({},{label:null},o);if(self._analytics&&self._analytics.loaded()){self._analytics.setLabel(options.label)}else{self._queuedEvents.push(["setLabel",o])}});$(window).bind("logEvents.gliffyAnalytics",function(event,o){var options=$.extend({},{logEvents:false,logger:null},o);if(self._analytics&&self._analytics.loaded()){self._analytics.logEvents(options.logEvents,options.logger)}else{self._queuedEvents.push(["logEvents",o])}});$(window).bind("setCustomVariables.gliffyAnalytics",function(event,o){var options=$.extend({},{product:null,license:"none",numUsers:0},o);if(self._analytics&&self._analytics.loaded()){self._analytics.setCustomVariables(options.product,options.license,options.numUsers)}else{self._queuedEvents.push(["setCustomVariables",o])}});$(window).bind("runFuncIfAnalyticsExists.gliffyAnalytics",function(event,o){var options=$.extend({},{func:null},o);if(self._analytics){self._analytics.runFuncIfAnalyticsExists(options.func)}})}});var AnalyticsListener=new _AnalyticsListener()}(jQuery));(function(){var MAX_STACK_LENGTH=1000;_gliffy.logger=_gliffy.Class.extend({stack:null,init:function(){this.stack=[]},log:function(message){this.stack.push({type:"log",message:"[LOG]   "+message});this.__check_length()},error:function(message){this.stack.push({type:"error",message:"[ERROR] "+message});this.__check_length()},warn:function(message){this.stack.push({type:"warn",message:"[WARN] "+message});this.__check_length()},__check_length:function(){if(_gliffy.Debug.LOG_TO_CONSOLE){console.log(this.stack[this.stack.length-1].message)}while(this.stack.length>MAX_STACK_LENGTH){this.stack.shift()}},getLog:function(o){var options=$.extend({log:true,warn:true,error:true,tail:MAX_STACK_LENGTH},o),i,stack=[];for(i=0;i<this.stack.length;i++){if(options[this.stack[i].type]>=0&&(i>this.stack.length-options.tail-1)){stack.unshift(this.stack[i].message)}}return stack}});_gliffy.Logger=new _gliffy.logger()}());(function(){var __errorHandler=null,__globalTarget=null;_gliffy.handleError=function(key,args,exception,target){args=args||[];target=target||__globalTarget||null;var message=$.i18n._(key,args);if(exception&&exception.toString().indexOf("0x80040111 (NS_ERROR_NOT_AVAILABLE)")!==-1){_gliffy.Logger.warn("FF 0x80040111 (NS_ERROR_NOT_AVAILABLE) "+exception.toString())}else{__errorHandler.report(message,exception,target)}};_gliffy.setErrorHandler=function(errorHandler){__errorHandler=errorHandler};_gliffy.setGlobalErrorTarget=function(target){__globalTarget=target||null};var DefaultErrorHandler=_gliffy.Class.extend({feedbackDialog:function(message,exception,report){var prop,output="",zIndex,confluenceSpinner,isIFrame=window.parent.document!==window.document;_gliffy.Dialog.showGenericDialog({content:message+"  "+$.i18n._("ERRORHANDLER_PLEASE_SEND_A_REPORT_TO_GLIFFY.__YOU_CAN_VIEW_THE_REPORT_BEFORE_IT_IS_SENT.")+"  "+$.i18n._("ERRORHANDLER_SADLY,_YOU_MAY_NEED_TO_REFRESH_YOUR_BROWSER_TO_CONTINUE_WORKING_NORMALLY."),title:$.i18n._("ERRORHANDLER_ERROR"),cancelCallback:null,buttons:[{text:$.i18n._("ERRORHANDLER_SEND_ERROR_REPORT"),callback:function(){$("body").trigger("send-error.gliffy-body",{message:message,report:report})},primary:true,dismiss:true},{text:$.i18n._("ERRORHANDLER_NO_THANKS"),callback:null,primary:false,dismiss:true}]});if(isIFrame){confluenceSpinner=$(window.parent.document).find(".gliffy-spinner");if(confluenceSpinner.is(":visible")){confluenceSpinner.remove();_gliffy.Spinner.show("confluence")}}},getErrorReport:function(message,exception){var prop,output=$.i18n._("ERRORHANDLER_WHAT_WERE_YOU_DOING_JUST_BEFORE_THIS_ERROR?")+"\n===============================\n\n\n\n\n"+$.i18n._("ERRORHANDLER_ERROR_REPORT")+"\n============\n\nError Type: "+message+"\n\n";try{output+="Gliffy Version: ["+_gliffy.versionString+"] \n\n"}catch(e0){output+="Missing Gliffy Version\n\n"}try{output+="Confluence Build Number ["+_gliffy.confluenceVersion+"] \n\n"}catch(e0a){output+="Missing Confluence Build Number."}try{output+=_gliffy.BrowserDetect.dump()+"\n\n"}catch(e1){output+="Missing BrowserDetect\n\n"}if(!exception||exception===undefined){output+="No exception generated.\n\n"}else{try{output+="Exception: ["+exception.toString()+"]\n\n"}catch(e2){output+="Missing exception.toString().\n\n"}try{for(prop in exception){if(exception.hasOwnProperty(prop)){output+="Exception property: "+prop+" value: ["+exception[prop]+"]\n\n"}}}catch(e3){output+="Missing Exception properties.\n\n"}try{if(exception.stack!==undefined){output+="Stack: ["+exception.stack+"]\n\n"}else{output+="No stack available\n\n"}}catch(e4){output+="Missing Stack\n\n"}}try{output+="Logger: [\n"+_gliffy.Logger.getLog({tail:20}).join("\t\n")+"]\n\n"}catch(e5){output+="Missing Logger\n"}try{_gliffy.Mouse.editor.getDocumentManager().getActiveStage().commandHistory.forceFinalizeCommandBundle();output+=_gliffy.Mouse.editor.getDocumentManager().getActiveStage().commandHistory.getReport(10)}catch(e6){output+="Missing Command Report\n"}return output},report:function(message,exception,target){var report;if(message===null||message===undefined){message="An unknown error has occurred."}report=this.getErrorReport(message,exception);if(_gliffy.Debug.NO_ERROR_DIALOG!==true){if(_gliffy.Dialog){this.feedbackDialog(message,exception,report)}else{window.alert(message)}}window.console.log(report)}});_gliffy.setErrorHandler(new DefaultErrorHandler())}());(function(){var MAC_KEYS={command:String.fromCharCode(8984),shift:String.fromCharCode(8679),del:String.fromCharCode(9003),esc:String.fromCharCode(9099),alt:String.fromCharCode(8997)},uidCounter=0;_gliffy.Utils={SNAP_DEGREES_MULTIPLIER:360,FLOAT_EQUALS_THRESHOLD:0.0001,FLOAT_FIXED:4,SNAP_PIXELS:10,__urlParams:null,getValueOrDefault:function(value,defaultValue){if(value===undefined||value===null){return defaultValue}return value},getContext:function(canvas){return canvas.getContext("2d")},getMockContext:function(){return{width:0,height:0,canvas:document.createElement("canvas"),save:function(){},restore:function(){},scale:function(){},rotate:function(){},translate:function(){},transform:function(){},setTransform:function(){},globalAlpha:function(){},globalCompositeOperation:function(){},strokeStyle:"",fillStyle:"",createLinearGradient:function(){return{addColorStop:function(){}}},createRadialGradient:function(){return{addColorStop:function(){}}},createPattern:function(){},lineCap:"",lineJoin:"",miterLimit:"",shadowColor:"",shadowOffsetX:"",shadowOffsetY:"",shadowBlur:"",clearRect:function(){},fillRect:function(){},strokeRect:function(){},beginPath:function(){},moveTo:function(){},closePath:function(){},lineTo:function(){},quadraticCurveTo:function(){},bezierCurveTo:function(){},arcTo:function(){},arc:function(){},rect:function(){},fill:function(){},stroke:function(){},clip:function(){},isPointInPath:function(){},drawFocusRing:function(){},font:"",textAlign:"",textBaseline:"",fillText:function(){},strokeText:function(){},measureText:function(){return{width:0}},drawImage:function(){},createImageData:function(){},getImageData:function(){return{width:0,height:0,data:""}},putImageData:function(){}}},randomString:function(holder){var chars,randomstring,i;if(!holder){throw"cannot create a random attribute name for an undefined object"}chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";randomstring="";do{randomstring="";for(i=0;i<12;i++){randomstring+=chars[Math.floor(Math.random()*chars.length)]}}while(holder[randomstring]);return randomstring},simpleRandomString:function(){var chars,randomstring,i;chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";randomstring="";for(i=0;i<12;i++){randomstring+=chars[Math.floor(Math.random()*chars.length)]}return randomstring},forceMatrixOnly:false,transformCss:function(transform,o){var options=$.extend({originX:0,originY:0,roundTranslate:false,matrixOnly:false},o),transformCss,transform_origin;if(this.forceMatrixOnly){options.matrixOnly=true}if(options.matrixOnly){transformCss=transform.toCss({isMoz:false,roundTranslate:options.roundTranslate});transform_origin=options.originX+" "+options.originY;return{"-moz-transform":transform.toCss({isMoz:true,roundTranslate:options.roundTranslate}),"-webkit-transform":transformCss,"-o-transform":transformCss,msTransform:transformCss,transform:transformCss,"transform-origin":transform_origin,msTransformOrigin:transform_origin,"-webkit-transform-origin":transform_origin,"-moz-transform-origin":transform_origin,"-o-transform-origin":transform_origin}}else{transformCss=transform.toCssNoTranslate({isMoz:false,roundTranslate:options.roundTranslate});transform_origin=options.originX+" "+options.originY;return{"-moz-transform":transform.toCssNoTranslate({isMoz:true,roundTranslate:options.roundTranslate}),"-webkit-transform":transformCss,"-o-transform":transformCss,msTransform:transformCss,transform:transformCss,"transform-origin":transform_origin,msTransformOrigin:transform_origin,"-webkit-transform-origin":transform_origin,"-moz-transform-origin":transform_origin,"-o-transform-origin":transform_origin,top:transform.getTranslateY(),left:transform.getTranslateX()}}},posMod:function(x,y){if(y===0){return x}return x-y*Math.floor(x/y)},unwrapRadians:function(radians){return _gliffy.Utils.posMod(radians,Math.PI*2)},trim_right:function(text){if(String.prototype.trimRight){return text.trimRight()}else{return text.replace(/\s+$/,"")}},maxBounds:function(transform,width,height,stage){var maxX,maxY,i,inViewport=false,point,points=[{x:0,y:0},{x:width,y:0},{x:width,y:height},{x:0,y:height}];for(i=0;i<points.length;i++){point=transform.transformPoint(points[i].x,points[i].y);if(i===0){maxX=point.x;maxY=point.y}maxX=Math.max(point.x,maxX);maxY=Math.max(point.y,maxY);if(stage.autoFit){if(point.x>0&&point.y>0){inViewport=true}}else{if(point.x>0&&point.y>0&&point.x<stage.width*stage.getZoom()&&point.y<stage.height*stage.getZoom()){inViewport=true}}}return{x:maxX,y:maxY,inViewport:inViewport}},maxInArray:function(arr){return Math.max.apply(Math,arr)},minInArray:function(arr){return Math.min.apply(Math,arr)},tryCatch:function(tryFunc,catchFunc){if(_gliffy.Debug.SKIP_CATCH_ERRORS){return tryFunc()}else{try{return tryFunc()}catch(e){catchFunc(e)}}},cloneArray:function(arr){var out=[],i;for(i=0;i<arr.length;i++){if(arr[i].length){out[i]=_gliffy.Utils.cloneArray(arr[i])}else{out[i]=arr[i]}}return out},wrapDegrees:function(degree){while(degree<0){degree+=360}return degree%360},radiansToDegrees:function(radians){return(radians*180/Math.PI)},degreesToRadians:function(degrees){return(degrees*Math.PI/180)},convertRanges:function(oldValue,oldRangeStart,oldRangeEnd,newRangeStart,newRangeEnd){return(((oldValue-oldRangeStart)*(newRangeEnd-newRangeStart))/(oldRangeEnd-oldRangeStart))+newRangeStart},calculateLineSnap:function(curPoint,opposingPoint,snapDegrees){var pointToPoint=_gliffy.Vec2.difference(curPoint,opposingPoint),snapped,angle,degrees,mod,newDegrees;snapped=false;if(pointToPoint.x!==0||pointToPoint.y!==0){angle=_gliffy.Utils.unwrapRadians(Math.atan2(pointToPoint.y,pointToPoint.x));degrees=_gliffy.Utils.radiansToDegrees(angle);mod=_gliffy.Utils.posMod(degrees,90);if(mod>(90-snapDegrees)||mod<snapDegrees){snapped=true;newDegrees=Math.floor(_gliffy.Utils.posMod(degrees+snapDegrees,360)/90)*90;pointToPoint=pointToPoint.rotate(_gliffy.Utils.degreesToRadians(newDegrees-degrees));curPoint=_gliffy.Vec2.sum(pointToPoint,opposingPoint)}}return{snapped:snapped,point:curPoint}},floatEquals:function(float1,float2,threshold){threshold=threshold||this.FLOAT_EQUALS_THRESHOLD;return Math.abs(float1-float2)<=threshold},floatToString:function(floatz,fixed){var result;if(isNaN(fixed)){fixed=this.FLOAT_FIXED}result=floatz.toFixed(fixed).replace(/\.?0+$/,"");return(result==="-0")?"0":result},boundingBoxToCss:function(boundingBox,zoom){var topLeft=new _gliffy.Vec2(boundingBox.min.x,boundingBox.min.y),dimension=boundingBox.getDimension();if(zoom!==undefined){dimension.scale(zoom);topLeft.scale(zoom)}return{left:topLeft.x+"px",top:topLeft.y+"px",width:dimension.x+"px",height:dimension.y+"px"}},stealFocus:function(){if($(document.activeElement).get(0)!==document.body){$("<textarea />").prependTo($("body")).focus().blur().remove()}},hsv2rgb:function(hsv){var h=hsv.hue,s=hsv.sat,v=hsv.val,rgb,i,data=[];if(s===0){rgb=[v,v,v]}else{h=h/60;i=Math.floor(h);data=[v*(1-s),v*(1-s*(h-i)),v*(1-s*(1-(h-i)))];switch(i){case 0:rgb=[v,data[2],data[0]];break;case 1:rgb=[data[1],v,data[0]];break;case 2:rgb=[data[0],v,data[2]];break;case 3:rgb=[data[0],data[1],v];break;case 4:rgb=[data[2],data[0],v];break;default:rgb=[v,data[0],data[1]];break}}return"#"+rgb.map(function(x){return("0"+Math.round(x*255).toString(16)).slice(-2)}).join("")},selectAllTextInElement:function(element){var range,selection;element=$(element);if(element.length>0){element=element.get(0);if(document.body.createTextRange){range=document.body.createTextRange();range.moveToElementText(element);range.select()}else{if(window.getSelection){selection=window.getSelection();range=document.createRange();range.selectNodeContents(element);selection.removeAllRanges();selection.addRange(range)}}}},getTextBoundingBox:function(element,offset){var range,rect;element=$(element);if(element.length>0){element=element.get(0);offset=offset||{x:0,y:0};if(document.createRange){range=document.createRange();range.selectNodeContents(element);if(range.getBoundingClientRect){rect=range.getBoundingClientRect();if(rect){return new _gliffy.BoundingBox((rect.left+offset.x),(rect.top+offset.y),(rect.right+offset.x),(rect.bottom+offset.y))}}}}return new _gliffy.BoundingBox()},setSnapToGrid:function(auto){this.__autoGrid=auto},shouldSnapToGrid:function(){if(this.__autoGrid){return _gliffy.KeyManager.shiftKeyDown?!GliffyApp.documentModel.snapToGrid:GliffyApp.documentModel.snapToGrid}else{return false}},hasNonWhitespaceCharacter:function(str){var pattern=/\S+/;return pattern.test(str)},removeLineBreaks:function(str){return str.replace(/(\r\n|\n|\r)/gm,"")},getLocalOffset:function(startPosition,endPosition,node){var localSpace=node.worldTransform.createInverse();return _gliffy.Vec2.difference(localSpace.transformPoint(endPosition.x,endPosition.y),localSpace.transformPoint(startPosition.x,startPosition.y))},isHorizontal:function(startPoint,endPoint){return Math.abs(startPoint.y-endPoint.y)<0.001},clamp:function(value,min,max){return(value<min)?min:((value>max)?max:value)},parseBoolean:function(str){return(/true/i.test(str))},capitalize:function(str){return str.replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()})},capitalizeFirstWord:function(word){word=word.toLowerCase();return word.charAt(0).toUpperCase().concat(word.slice(1,word.length))},hashCode:function(string){var hash=0,i,char_;if(string.length===0){return hash}for(i=0;i<string.length;i++){char_=string.charCodeAt(i);hash=((hash<<5)-hash)+char_;hash=hash&hash}return hash},equalPoints:function(p1,p2,tolerance){if(tolerance===undefined){tolerance=0}if($.isArray(p1)&&$.isArray(p2)){return((Math.abs(p1[0]-p2[0])<=tolerance)&&Math.abs(p1[1]-p2[1])<=tolerance)}return false},drawBoundingBox:function(boundingBox,style,parentElement){var css=$.extend(style||{backgroundColor:"#ff0000",opacity:0.5},_gliffy.Utils.boundingBoxToCss(boundingBox)),div=$("<div></div>");css.position="absolute";css.padding="0px";css.margin="0px";css.zIndex=530000;$(parentElement||"#container").append(div.css(css));$(document).dblclick(function(){div.remove()})},drawPoint:function(point,style,parentElement){style=$.extend(style||{},{backgroundColor:"#ffffff",outline:"5px solid #000000",opacity:0.5});_gliffy.Utils.drawBoundingBox(new _gliffy.BoundingBox(point.x,point.y,point.x+1,point.y+1),style,parentElement)},pointToColor:function(point,min,max,invert){var xColor=Math.round((point.x-min)/(max-min)*255),yColor=Math.round((point.y-min)/(max-min)*255),prefix="#00";if(invert){xColor=255-xColor;yColor=255-yColor;prefix="#ff"}xColor=xColor.toString(16);if(xColor.length===1){xColor="0"+xColor}yColor=yColor.toString(16);if(yColor.length===1){yColor="0"+yColor}return prefix+xColor+yColor},getRenderedStyle:function($ele,requestedStyle){var style="",DOCUMENT_TYPE=9;while((style===""||style===undefined||style===null)&&($ele.length>0)&&$ele[0].nodeType!==DOCUMENT_TYPE){style=$ele.css(requestedStyle);$ele=$ele.parent()}return(style===undefined||style===null)?"":style},addDynamicStyle:function(styleString){$("#gliffy-dynamic-style").append(styleString)},notify:function(type,title,message,fadeOutTime,rightOffset,topOffset){var html,template;if(Handlebars&&$("#gliffy-notify-popup-template").length>0){template=Handlebars.compile($("#gliffy-notify-popup-template").html());html=template({type:type,title:title,message:message});$(html).appendTo("body");if(rightOffset){$("#gliffy-notify-popup").css("right",rightOffset)}if(topOffset){$("#gliffy-notify-popup").css("top",topOffset)}if(fadeOutTime){setTimeout(function(){$("#gliffy-notify-popup").fadeOut(1000,function(){$("#gliffy-notify-popup").alert("close")})},fadeOutTime)}}else{window.alert(title+"\n\n"+message)}},analyticsEvent:function(type,options){$(window).trigger(type+".gliffyAnalytics",options);$(window).trigger([type,options.category].join("-"),options);$(window).trigger([type,options.category,options.action].join("-"),options)},analyticsTimerStart:function(name,alsoProfile){_gliffy.Timer.start(name,alsoProfile)},analyticsTimerEnd:function(name){var time=_gliffy.Timer.end(name);_gliffy.Utils.analyticsEvent("trackEvent",{category:"time",action:name,value:time/1000,non_interaction:true})},sortJson:function(myObj){var keys=[],k,i,len,out;for(k in myObj){if(myObj.hasOwnProperty(k)){keys.push(k)}}keys.sort();len=keys.length;for(i=0;i<len;i++){k=keys[i];out+='"'+k+'":"'+myObj[k]+'"\n'}window.console.log(out)},createIframe:function(name,onReady){var iframe,contents;iframe=$("<iframe />",{src:"",name:name,id:name}).appendTo("body");contents=iframe.contents();if(contents&&contents.get(0).readyState==="complete"){onReady(iframe)}else{iframe.bind("load.preajax",function(){iframe.unbind("load.preajax");onReady(iframe)})}},iframeDownload:function(url,successCallback,errorCallback){var name="iframeDownload"+uidCounter;uidCounter++;this.createIframe(name,function(iframe){iframe.bind("load.ajax",function(){if(successCallback){successCallback()}iframe.unbind(".ajax");iframe.remove()});iframe.bind("error.ajax",function(){if(errorCallback){errorCallback()}iframe.unbind(".ajax");iframe.remove()});iframe.attr("src",url)})},iframeAjax:function(url,data,successCallback,errorCallback){var name="iframeAjax"+uidCounter;uidCounter++;this.createIframe(name,function(iframe){var form,key;iframe.bind("load.ajax",function(){if(successCallback){successCallback()}iframe.unbind(".ajax");iframe.remove()});iframe.bind("error.ajax",function(){if(errorCallback){errorCallback()}iframe.unbind(".ajax");iframe.remove()});form=$("<form/>",{method:"post",action:url,target:iframe.attr("id")});for(key in data){if(data.hasOwnProperty(key)){form.append($("<input/>",{type:"hidden",name:key,value:data[key]}))}}form.appendTo($("body"));form.submit();form.remove()})},isEnglish:function(editor){return(!editor.language||editor.language.indexOf("en")===0)},getImageUrlFromHtml:function(html){html=html.replace("'",'"');var match=/<img\s+(\S+\s+)*src="([^"]+)"/.exec(html);if(match){return match[2]}else{return null}},disableExportsForBeta:function(){$(".gliffy-filemenu-exportAsGXML").addClass("disabled")},enableExportsForBeta:function(){$(".gliffy-filemenu-exportAsGXML").removeClass("disabled");$(".gliffy-filemenu-exportAsSVG").removeClass("disabled")},firstInArray:function(arr){if(Array.isArray(arr)&&arr.length>0){return arr[0]}return null},compareVersionNumbers:function(v1,v2){var i,v1_array,v1_element,v2_array,v2_element;v1_array=typeof v1==="string"?v1.split("."):[v1];v2_array=typeof v2==="string"?v2.split("."):[v2];for(i=0;i<v1_array.length;++i){v1_element=parseInt(v1_array[i]);v2_element=parseInt(v2_array[i]);if(v2_array.length===i){return 1}if(v1_element===v2_element){continue}if(v1_element>v2_element){return 1}return -1}if(v1_array.length!=v2_array.length){return -1}return 0},getNthNode:function(n){n=n||0;return _gliffy.Mouse.documentManager.getActiveStage().objects[n]},getCommandHistory:function(){return _gliffy.Mouse.documentManager.getActiveStage().commandHistory},getI18nDictionary:function(){var dictionary,english,otherLanguage=null;english=GLIFFY.DICTIONARY?(GLIFFY.DICTIONARY.en||{}):{};if(GLIFFY.DICTIONARY){$.each(GLIFFY.DICTIONARY,function(key,value){if(key!=="en"){otherLanguage=value;return false}})}if(otherLanguage){dictionary=$.extend({},english,otherLanguage)}else{dictionary=english}return dictionary},moveEmberView:function($src,$dest){$src.closest(".ember-view").detach().appendTo($dest)},setupAnimationDelay:function(){var __requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){window.setTimeout(callback,1000/60)};jQuery.fn.extend({animationDelay:function(type){type=type||"fx";return this.queue(type,function(next){__requestAnimationFrame(next)})}})},buildPointsPathFromDrawingCommand:function(drawingCommands){var path=[],p,point,lastPoint,currPath,points;if(drawingCommands===null||drawingCommands===undefined){throw new Error("path is null")}_.each(drawingCommands,function(drawPath){switch(drawPath.name){case"M":point=drawPath.args.split(",");path.push([{x:parseFloat(point[0]),y:parseFloat(point[1])}]);break;case"L":lastPoint=path[path.length-1][path[path.length-1].length-1];point=drawPath.args.split(",");path.push([lastPoint,{x:parseFloat(point[0]),y:parseFloat(point[1])}]);break;case"C":case"Q":lastPoint=path[path.length-1][path[path.length-1].length-1];currPath=[lastPoint];points=drawPath.args.split(" ");_.each(points,function(point){p=point.split(",");currPath.push({x:parseFloat(p[0]),y:parseFloat(p[1])})});path.push(currPath);break;default:throw"We don't currently support "+drawPath.name+" please add an implementation to candash.js"}});path.splice(0,1);return path},isUIDPartOfGliffySymbolLibrary:function(uid,libraryId){return(uid!==null&&uid.indexOf("com.gliffy.shape")===0&&libraryId.indexOf("com.gliffy.libraries")===0&&uid.indexOf(libraryId.substring("com.gliffy.libraries".length))>0)},loadMultipleScripts:function(scripts){var array=[],deferredReturn=$.Deferred();scripts.forEach(function(script){array.push(_gliffy.Utils.cachedGetScript(script))});$.when.apply($,array).done(function(){deferredReturn.resolve()});return deferredReturn.promise()},forceUnicodeEncoding:function(string){return unescape(encodeURIComponent(string))},cachedGetScript:function(url,options){options=$.extend(options||{},{dataType:"script",cache:true,url:url});return $.ajax(options)}};_gliffy.Utils.forceMatrixOnly=_gliffy.BrowserDetect.browser==="Safari"&&_gliffy.BrowserDetect.version===5.1}());(function(){var __requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){window.setTimeout(callback,1000/60)},__frameRate,__tasks=[],__stop=true;function currentTime(){return(new Date()).getTime()/1000}function FrameRate(){this.__div=$("<div class='gliffy-frame-rate'>Computing fps...</div>");$("body").append(this.__div);this.__deltaTime=0;this.__currentTime=currentTime();this.__frame=0;this.update=function(){var newTime=currentTime(),display;this.__frame++;this.__deltaTime=newTime-this.__currentTime;if(this.__deltaTime>1){display=(this.__frame/this.__deltaTime).toFixed(1)+" fps";this.__div.html(display);this.__deltaTime=0;this.__frame=0;this.__currentTime=newTime}};this.remove=function(){this.__div.remove();this.__div=null}}function __runTasks(){var i;for(i=0;i<__tasks.length;i++){__tasks[i]()}}function __catchError(e){_gliffy.RenderLoop.stop();_gliffy.Logger.error("Render loop failed: "+e.message);_gliffy.handleError("com.gliffy.error.render_loop",[],e)}function __loop(){var i;if(!__stop){__requestAnimationFrame(__loop);for(i=0;i<__tasks.length;i++){if(!__stop){_gliffy.Utils.tryCatch(__runTasks,__catchError)}}if(__frameRate){__frameRate.update()}}}_gliffy.RenderLoop={start:function(){if(__stop===true&&!_gliffy.Debug.SKIP_RENDER_LOOP){__stop=false;__requestAnimationFrame(__loop)}},stop:function(){_gliffy.Logger.warn("Render loop was stopped.");__stop=true},appendTask:function(task){__tasks.push(task)},removeTask:function(task){var index=__tasks.indexOf(task);if(index!==-1){__tasks.splice(index,1)}},showFrameRate:function(){__frameRate=new FrameRate()},hideFrameRate:function(){__frameRate.remove();__frameRate=null},toggleFrameRate:function(){if(__frameRate){this.hideFrameRate()}else{this.showFrameRate()}}}}());(function(){_gliffy.Serializable=_gliffy.Class.extend({toObject:function(){var serialized=this.__toObject();if(serialized){return $.extend(true,{},serialized)}else{return null}},fromObject:function(object,opt){this.__fromObject($.extend(true,{},object),opt);return this},__toObject:function(){throw new Error("__toObject is not implemented!")},__fromObject:function(object){throw new Error("__fromObject is not implemented!")}});_gliffy.Serializable.polymorphicToObject=function(instance){var object={type:instance.getClassName()};object[instance.getClassName()]=instance.toObject();return object};_gliffy.Serializable.polymorphicFromObject=function(object,node){var instance=new _gliffy[object.type]();instance.node=node;instance.fromObject(object[object.type]);return instance}}());(function(){_gliffy.SerializableWithAabb=_gliffy.Serializable.extend({setWorldAabb:function(aabb){this.__worldAabb=aabb},getWorldAabb:function(){return this.__worldAabb},setLocalAabb:function(aabb){this.__localAabb=aabb},getLocalAabb:function(){return this.__localAabb},setLocalOverlayAabb:function(aabb){this.__localOverlayAabb=aabb},getLocalOverlayAabb:function(){return this.__localOverlayAabb},setWorldOverlayAabb:function(aabb){this.__worldOverlayAabb=aabb},getWorldOverlayAabb:function(){return this.__worldOverlayAabb}})}());(function(){var __tempArray=[];_gliffy.BoundingBox=_gliffy.Serializable.extend({min:null,max:null,init:function(minX,minY,maxX,maxY){this.min=new _gliffy.Vec2(minX||0,minY||0);this.max=new _gliffy.Vec2(maxX||0,maxY||0)},growPoint:function(point){return this.grow(point.x,point.y)},grow:function(x,y){if(x<this.min.x){this.min.x=x}if(x>this.max.x){this.max.x=x}if(y<this.min.y){this.min.y=y}if(y>this.max.y){this.max.y=y}return this},extend:function(amount){this.min.x-=amount;this.min.y-=amount;this.max.x+=amount;this.max.y+=amount;if(amount<0){this.fit([this.min.x,this.min.y,this.max.x,this.max.y])}return this},add:function(boundingBox){this.grow(boundingBox.min.x,boundingBox.min.y);this.grow(boundingBox.max.x,boundingBox.max.y);return this},copy:function(boundingBox){this.min.x=boundingBox.min.x;this.min.y=boundingBox.min.y;this.max.x=boundingBox.max.x;this.max.y=boundingBox.max.y;return this},fitPoints:function(points){var i,x,y;x=points[0].x;y=points[0].y;this.min.x=x;this.max.x=x;this.min.y=y;this.max.y=y;for(i=1;i<points.length;i++){this.grow(points[i].x,points[i].y)}return this},fit:function(coords){var i,x,y;if(coords.length<2){throw new Error("The parameter coords must be an array of at lest 2 length.")}x=coords[0];y=coords[1];this.min.x=x;this.max.x=x;this.min.y=y;this.max.y=y;for(i=2;i<coords.length;i+=2){this.grow(coords[i],coords[i+1])}return this},clone:function(){return new _gliffy.BoundingBox(this.min.x,this.min.y,this.max.x,this.max.y)},transform:function(affineTransform){this.fit(this.__toRectangle(affineTransform));return this},intersects:function(boundingBox,affineTransform){if(affineTransform){boundingBox=boundingBox.clone().transform(affineTransform)}if(this.max.x<boundingBox.min.x||this.min.x>boundingBox.max.x||this.max.y<boundingBox.min.y||this.min.y>boundingBox.max.y){return false}else{return true}},boundingBoxInside:function(boundingBox,affineTransform){if(affineTransform){boundingBox=boundingBox.clone().transform(affineTransform)}return this.min.x<=boundingBox.min.x&&this.min.y<=boundingBox.min.y&&this.max.x>=boundingBox.max.x&&this.max.y>=boundingBox.max.y},inBoundingBox:function(containingBoundingBox){return(this.max.x>containingBoundingBox.min.x)&&(this.max.y>containingBoundingBox.min.y)&&(this.min.x<containingBoundingBox.max.x)&&(this.min.y<containingBoundingBox.max.y)},pointInside:function(x,y){return x>=this.min.x&&x<=this.max.x&&y>=this.min.y&&y<=this.max.y},pointDistance:function(x,y){var xDistance=0,yDistance=0;if(x<this.min.x){xDistance=x-this.min.x}else{if(x>this.max.x){xDistance=x-this.max.x}}if(y<this.min.y){yDistance=y-this.min.y}else{if(y>this.max.y){yDistance=y-this.max.y}}return new _gliffy.Vec2(xDistance,yDistance)},setMinMax:function(minX,minY,maxX,maxY){this.min.x=minX||0;this.min.y=minY||0;this.max.x=maxX||0;this.max.y=maxY||0;return this},setByCenter:function(center,dimension){var halfX=dimension.x/2,halfY=dimension.y/2;this.min.x=center.x-halfX;this.min.y=center.y-halfY;this.max.x=center.x+halfX;this.max.y=center.y+halfY},toString:function(){return"min("+_gliffy.Utils.floatToString(this.min.x)+","+_gliffy.Utils.floatToString(this.min.y)+") max("+_gliffy.Utils.floatToString(this.max.x)+","+_gliffy.Utils.floatToString(this.max.y)+")"},equals:function(boundingBox){if(boundingBox){return _gliffy.Utils.floatEquals(this.min.x,boundingBox.min.x)&&_gliffy.Utils.floatEquals(this.max.x,boundingBox.max.x)&&_gliffy.Utils.floatEquals(this.min.y,boundingBox.min.y)&&_gliffy.Utils.floatEquals(this.max.y,boundingBox.max.y)}else{return false}},getDimension:function(){return _gliffy.Vec2.difference(this.max,this.min)},getWidth:function(){return this.getDimension().x},getHeight:function(){return this.getDimension().y},getCenter:function(){return _gliffy.Vec2.lerp(this.max,this.min,0.5)},__toRectangle:function(affineTransform){__tempArray[0]=this.min.x;__tempArray[1]=this.min.y;__tempArray[2]=this.min.x;__tempArray[3]=this.max.y;__tempArray[4]=this.max.x;__tempArray[5]=this.max.y;__tempArray[6]=this.max.x;__tempArray[7]=this.min.y;affineTransform.transform(__tempArray,0,__tempArray,0,4);return __tempArray},fromClientRect:function(clientRect){this.min.x=clientRect.left;this.max.x=clientRect.right;this.min.y=clientRect.top;this.max.y=clientRect.bottom;return this},toCss:function(){return{left:this.min.x+"px",top:this.min.y+"px",width:this.getWidth()+"px",height:this.getHeight()+"px"}},isZeroSize:function(){return this.getWidth()===0&&this.getHeight()===0},__toObject:function(){return{min:{x:this.min.x,y:this.min.y},max:{x:this.max.x,y:this.max.y}}},__fromObject:function(o){if(o&&o.max&&o.min){this.min.x=o.min.x;this.min.y=o.min.y;this.max.x=o.max.x;this.max.y=o.max.y}}});_gliffy.BoundingBox.INFINITE=new _gliffy.BoundingBox(-Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);_gliffy.BoundingBox.SMALLEST=new _gliffy.BoundingBox(Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}());(function(){var _compositeColor=new _gliffy.RGBColor("#000000");var MAX_BYTE=255;_gliffy.ColorUtils={multiply:function(sourceColor,destColor){sourceColor=new _gliffy.RGBColor(sourceColor);destColor=new _gliffy.RGBColor(destColor);_compositeColor.r=Math.floor(sourceColor.r*destColor.r/MAX_BYTE);_compositeColor.g=Math.floor(sourceColor.g*destColor.g/MAX_BYTE);_compositeColor.b=Math.floor(sourceColor.b*destColor.b/MAX_BYTE);return _compositeColor.toHex()},generator:function(type,sourceColor){return function(){return function(destColor){return _gliffy.ColorUtils[type](sourceColor,destColor)}}}}}());(function(){function WindowMessage(nameSpace,domainFilter,targetWindowName){this.__nameSpace=nameSpace;this.__domainFilter=domainFilter;this.__targetWindowName=targetWindowName||null}WindowMessage.prototype.setDomainFilter=function(domainFilter){this.__domainFilter=domainFilter};WindowMessage.prototype.setNameSpace=function(nameSpace){this.__nameSpace=nameSpace};WindowMessage.prototype.setTargetWindowName=function(targetWindowName){this.__targetWindowName=targetWindowName||null};WindowMessage.prototype.getTargetWindow=function(){var frame=null;if(this.__targetWindowName!==null){if(typeof(this.__targetWindowName)==="string"){frame=window.frames[this.__targetWindowName]}else{frame={window:this.__targetWindowName}}}else{frame=window.parent}if(frame&&frame.postMessage){return frame}else{if(frame&&frame.window&&frame.window.postMessage){return frame.window}else{if(frame&&frame.contentWindow&&frame.contentWindow.postMessage){return frame.contentWindow}else{throw new Error("The frame "+this.__targetWindowName+" was not found.")}}}};WindowMessage.prototype.send=function(action,data){if(this.__domainFilter){this.getTargetWindow().postMessage(JSON.stringify({nameSpace:this.__nameSpace,action:action,data:data||null}),this.__domainFilter)}else{throw new Error("No domain filter was set.")}};WindowMessage.prototype.receive=function(action,callback){var self=this,listener;listener=function(event){if(event.source===self.getTargetWindow()&&event.data){var data=JSON.parse(event.data);if(data.nameSpace===self.__nameSpace&&data.action===action){callback(data.data);window.removeEventListener("message",listener,false);listener=null}}};window.addEventListener("message",listener,false)};window.GLIFFY=window.GLIFFY||{};window.GLIFFY.WindowMessage=WindowMessage}());(function(){var STENCIL_DEPENDENCIES={RGBColor:_gliffy.RGBColor,candash:_gliffy.candash};_gliffy.ShapeLibrary=_gliffy.Class.extend({init:function(options){var o=$.extend({},{rootServiceURL:"../api"},options);this.rootServiceURL=o.rootServiceURL;this.svgToStencilTransformURL=o.svgToStencilTransformURL;if(this.svgToStencilTransformURL===undefined||this.svgToStencilTransformURL===null){this.svgToStencilTransformURL=this.rootServiceURL+"/stencils/svg.json"}this.shapes={};this.templates={};this.custom_function={};this.svgDim={};this.svgStencil={};this.libraries={};this.shapeLibrariesDeferred=new $.Deferred();this.loaded=this.shapeLibrariesDeferred.promise();this.time=new Date().getTime();this.DEFAULT_ICON_HEIGHT=50;this.DEFAULT_ICON_WIDTH=50;this.__librariesLoaded={}},setup:function(options){var o=$.extend({},{rootServiceURL:this.rootServiceURL,svgToStencilTransformURL:this.svgToStencilTransformURL},options);this.rootServiceURL=o.rootServiceURL;this.svgToStencilTransformURL=o.svgToStencilTransformURL},shapes:null,svgDim:null,templates:null,custom_function:null,markersLoaded:false,libraries:null,svgStencil:null,defaultLibraries:[],__uidLookupTable:null,shapeLibrariesIndexLoaded:false,__librariesLoaded:null,__buildUidLookupTable:function(){this.__uidLookupTable={};_.each(window.GLIFFY_LIBRARIES,function(library){var libraryUid=library.uid;_.each(library.shapes,function(shapeUid){this.__uidLookupTable[shapeUid]=libraryUid},this)},this)},getLibraryUid:function(shapeUid){if(this.__uidLookupTable===null){this.__buildUidLookupTable()}return this.__uidLookupTable[shapeUid]},loadShapes:function(shapeArray,delayEvery){var self=this;shapeArray.forEach(function(shape,i){if(delayEvery===undefined){self.addShape(shape)}else{_gliffy.workQueue.queue(function(next){if(shapeArray){self.addShape(shape)}next()});if(i%delayEvery===0){_gliffy.workQueue.delay(1)}}})},loadStencils:function(stencilArray,delayEvery){var self=this;stencilArray.forEach(function(stencil,i){if(delayEvery===undefined){if(stencilArray){self.__addStencil(stencil)}}else{_gliffy.workQueue.queue(function(next){if(stencilArray){self.__addStencil(stencil)}next()});if(i%delayEvery===0){_gliffy.workQueue.delay(1)}}})},loadShapeLibrariesIndex:function(libraries,delayEvery){var self=this;libraries.forEach(function(library,i){if(delayEvery===undefined){if(window.GLIFFY_LIBRARIES){self.libraries[library.uid]=library}}else{_gliffy.workQueue.queue(function(next){if(window.GLIFFY_LIBRARIES){self.libraries[library.uid]=library}next()})}if(i%delayEvery===0){_gliffy.workQueue.delay(1)}},this);this.shapeLibrariesIndexLoaded=true},loadShapesAndStencilsInDocument:function(document,callback){var self=this,interval,deferred=$.Deferred();function doLoad(document){var libraries=document.getGon().getAllLibrariesRequiredToLoad();self.loadShapeLibraryJs(libraries).then(function(){self.shapeLibrariesDeferred.resolve();deferred.resolve()})}if(this.shapeLibrariesIndexLoaded===true){doLoad(document)}else{interval=setInterval(function(){if(self.shapeLibrariesIndexLoaded){doLoad(document);clearInterval(interval)}},16)}return deferred.promise()},loadAll:function(){var DELAY_EVERY_N=100,self=this;this.loadShapeLibrariesIndex(window.GLIFFY_LIBRARIES,DELAY_EVERY_N);_gliffy.workQueue.delay(1);this.loadShapes(window.GLIFFY_SHAPES,DELAY_EVERY_N);_gliffy.workQueue.delay(1);this.loadStencils(window.GLIFFY_STENCILS,DELAY_EVERY_N);_gliffy.workQueue.delay(1);_gliffy.workQueue.queue(function(next){window.GLIFFY_LIBRARIES=null;window.GLIFFY_SHAPES=null;window.GLIFFY_STENCILS=null;self.shapeLibrariesDeferred.resolve();next()})},loadSvgStencil:function(svg,resource,useDefaultFailHandler){var url=this.svgToStencilTransformURL,self=this,defer;if(!this.svgStencil[svg]){defer=$.Deferred();$.ajax({url:url,type:"POST",data:svg,dataType:"json",contentType:"application/svg+xml; charset=utf-8",traditional:true}).pipe(function(data){return data},function(xhr,text,error){defer.reject(xhr.responseText)}).then(function(data){try{self.templates[svg]=new Function("ctx","data","_gliffy",data.template);self.svgDim[svg]={width:parseFloat(data.width),height:parseFloat(data.height),x:parseFloat(data.x),y:parseFloat(data.y)};if(resource){resource.setX(parseFloat(data.x));resource.setY(parseFloat(data.y));resource.setWidth(parseFloat(data.width));resource.setHeight(parseFloat(data.height))}defer.resolve(data)}catch(e){var message="200, but failed to load svg:"+e+" ";if(e.stack!==undefined){message+="Stack: ["+e.stack+"]\n\n"}_gliffy.Logger.warn(message);defer.reject(svg)}});this.svgStencil[svg]=defer.promise()}if(useDefaultFailHandler){return this.svgStencil[svg].fail(function(xhr,text,error){_gliffy.Logger.warn("failed to load svg: "+svg);_gliffy.handleError("com.gliffy.error.stencil_load",[url],new Error(xhr.responseText))})}else{return this.svgStencil[svg]}},loadLibraries:function(libraryArray){var url=this.rootServiceURL+"/libraries.json?locale=en",i,libraries=[],promise,self=this;libraryArray=libraryArray||[];for(i=0;i<libraryArray.length;i++){if(libraryArray[i].indexOf("com.gliffy.libraries")===-1&&!this.libraries[libraryArray[i]]){libraries.push(libraryArray[i])}}if(libraries.length>0){promise=$.Deferred(function(defer){$.ajax({url:url,type:"POST",data:JSON.stringify(libraries),dataType:"json",contentType:"application/json; charset=utf-8",traditional:true}).then(function(data){for(i=0;i<data.libraries.length;i++){self.libraries[data.libraries[i].uid]=data.libraries[i]}defer.resolve()},defer.fail)}).promise();return $.when(promise,this.loaded).promise()}else{return this.loaded}},canDrawStencil:function(tid){return this.templates[tid]!==undefined},drawStencil:function(tid,ctx,data){if(this.canDrawStencil(tid)){this.templates[tid](ctx,data,STENCIL_DEPENDENCIES)}else{_gliffy.Logger.warn("Attempted to draw stencil "+tid+" but was not available")}},customFunction:function(tid,data){if(this.custom_function[tid]!==undefined&&this.custom_function[tid]!==null){this.custom_function[tid](data,STENCIL_DEPENDENCIES)}},__addStencil:function(stencil){var self=this;if(!self.templates[stencil.tid]){if(stencil.cfb){self.custom_function[stencil.tid]=new Function("data","_gliffy",stencil.cfb)}self.templates[stencil.tid]=new Function("ctx","data","_gliffy",stencil.template)}},addShape:function(shape){if(!this.shapes[shape.uid]){this.shapes[shape.uid]=shape}},getShape:function(uid){var self=this;if(self.shapes[uid]){return self.shapes[uid]}return null},addDefaultLibrary:function(uid){if(uid&&this.defaultLibraries.indexOf(uid)===-1){this.defaultLibraries.push(uid)}},getShapePreview:function(library){var shapePreview={},shape;if(library&&library.shapes&&library.shapes[0]&&library.hasOwnProperty("largestShapeIndex")){shape=_gliffy.shapeLibrary.shapes[library.shapes[library.largestShapeIndex]];if(shape){shapePreview=shape.preview}}else{if(library&&library.shapes&&library.shapes[0]&&_gliffy.shapeLibrary.shapes[library.shapes[0]]){shapePreview=_gliffy.shapeLibrary.shapes[library.shapes[0]].preview}}if(!shapePreview.hasOwnProperty("iconWidth")){shapePreview.iconWidth=_gliffy.shapeLibrary.DEFAULT_ICON_WIDTH;shapePreview.iconHeight=_gliffy.shapeLibrary.DEFAULT_ICON_HEIGHT}return shapePreview},loadShapeLibraryJs:function(libraries){var jsFiles,deferred=$.Deferred();if(libraries.indexOf("com.gliffy.libraries.mindmap.mindmap_v1.default")>=0){libraries.push("com.gliffy.libraries.mindmap.mindmap_v1.default_no_display")}jsFiles=_.chain(libraries).filter(function(library){var libraryNotLoaded=this.__librariesLoaded[library]!==true,notCustomLibrary=library.indexOf("com.gliffy.custom")<0,loadMe=libraryNotLoaded&&notCustomLibrary;this.__librariesLoaded[library]=true;return loadMe},this).map(function(library){var filename="gliffy-shape-"+library.replace(/\./g,"-");return GLIFFY.getShapeLibraryUrl(filename)}).value();if(jsFiles.length===0){deferred.resolve()}else{_gliffy.Utils.loadMultipleScripts(jsFiles).then(function(){deferred.resolve()})}return deferred.promise()},EXISTING_SHAPE_UID_TO_LIBRARY_MAP:{"com.gliffy.shape.basic.basic_v1.default":["com.gliffy.libraries.basic.basic_v1.default"],"com.gliffy.shape.basic.basic_v2.default":["com.gliffy.libraries.basic.basic_v2.default"],"com.gliffy.shape.bpmn.bpmn_v1.activities":["com.gliffy.libraries.bpmn.bpmn_v1.events","com.gliffy.libraries.bpmn.bpmn_v1.data_artifacts","com.gliffy.libraries.bpmn.bpmn_v1.activities","com.gliffy.libraries.bpmn.bpmn_v1.connectors","com.gliffy.libraries.bpmn.bpmn_v1.gateways"],"com.gliffy.shape.bpmn.bpmn_v1.connectors":["com.gliffy.libraries.bpmn.bpmn_v1.events","com.gliffy.libraries.bpmn.bpmn_v1.data_artifacts","com.gliffy.libraries.bpmn.bpmn_v1.activities","com.gliffy.libraries.bpmn.bpmn_v1.connectors","com.gliffy.libraries.bpmn.bpmn_v1.gateways"],"com.gliffy.shape.bpmn.bpmn_v1.data_artifacts":["com.gliffy.libraries.bpmn.bpmn_v1.events","com.gliffy.libraries.bpmn.bpmn_v1.data_artifacts","com.gliffy.libraries.bpmn.bpmn_v1.activities","com.gliffy.libraries.bpmn.bpmn_v1.connectors","com.gliffy.libraries.bpmn.bpmn_v1.gateways"],"com.gliffy.shape.bpmn.bpmn_v1.events":["com.gliffy.libraries.bpmn.bpmn_v1.events","com.gliffy.libraries.bpmn.bpmn_v1.data_artifacts","com.gliffy.libraries.bpmn.bpmn_v1.activities","com.gliffy.libraries.bpmn.bpmn_v1.connectors","com.gliffy.libraries.bpmn.bpmn_v1.gateways"],"com.gliffy.shape.bpmn.bpmn_v1.gateways":["com.gliffy.libraries.bpmn.bpmn_v1.events","com.gliffy.libraries.bpmn.bpmn_v1.data_artifacts","com.gliffy.libraries.bpmn.bpmn_v1.activities","com.gliffy.libraries.bpmn.bpmn_v1.connectors","com.gliffy.libraries.bpmn.bpmn_v1.gateways"],"com.gliffy.shape.erd.erd_v1.default":["com.gliffy.libraries.erd.erd_v1.default"],"com.gliffy.shape.floorplan.floorplan_v1.default":["com.gliffy.libraries.floorplan.floorplan_v2.structure","com.gliffy.libraries.floorplan.floorplan_v2.bathroom","com.gliffy.libraries.floorplan.floorplan_v2.bedroom","com.gliffy.libraries.floorplan.floorplan_v2.dining_room","com.gliffy.libraries.floorplan.floorplan_v2.kitchen","com.gliffy.libraries.floorplan.floorplan_v2.living_room","com.gliffy.libraries.floorplan.floorplan_v2.miscellaneous","com.gliffy.libraries.floorplan.floorplan_v2.office"],"com.gliffy.shape.floorplan.floorplan_v2.structure":["com.gliffy.libraries.floorplan.floorplan_v2.structure","com.gliffy.libraries.floorplan.floorplan_v2.bathroom","com.gliffy.libraries.floorplan.floorplan_v2.bedroom","com.gliffy.libraries.floorplan.floorplan_v2.dining_room","com.gliffy.libraries.floorplan.floorplan_v2.kitchen","com.gliffy.libraries.floorplan.floorplan_v2.living_room","com.gliffy.libraries.floorplan.floorplan_v2.miscellaneous","com.gliffy.libraries.floorplan.floorplan_v2.office"],"com.gliffy.shape.floorplan.floorplan_v2.bathroom":["com.gliffy.libraries.floorplan.floorplan_v2.structure","com.gliffy.libraries.floorplan.floorplan_v2.bathroom","com.gliffy.libraries.floorplan.floorplan_v2.bedroom","com.gliffy.libraries.floorplan.floorplan_v2.dining_room","com.gliffy.libraries.floorplan.floorplan_v2.kitchen","com.gliffy.libraries.floorplan.floorplan_v2.living_room","com.gliffy.libraries.floorplan.floorplan_v2.miscellaneous","com.gliffy.libraries.floorplan.floorplan_v2.office"],"com.gliffy.shape.floorplan.floorplan_v2.bedroom":["com.gliffy.libraries.floorplan.floorplan_v2.structure","com.gliffy.libraries.floorplan.floorplan_v2.bathroom","com.gliffy.libraries.floorplan.floorplan_v2.bedroom","com.gliffy.libraries.floorplan.floorplan_v2.dining_room","com.gliffy.libraries.floorplan.floorplan_v2.kitchen","com.gliffy.libraries.floorplan.floorplan_v2.living_room","com.gliffy.libraries.floorplan.floorplan_v2.miscellaneous","com.gliffy.libraries.floorplan.floorplan_v2.office"],"com.gliffy.shape.floorplan.floorplan_v2.dining_room":["com.gliffy.libraries.floorplan.floorplan_v2.structure","com.gliffy.libraries.floorplan.floorplan_v2.bathroom","com.gliffy.libraries.floorplan.floorplan_v2.bedroom","com.gliffy.libraries.floorplan.floorplan_v2.dining_room","com.gliffy.libraries.floorplan.floorplan_v2.kitchen","com.gliffy.libraries.floorplan.floorplan_v2.living_room","com.gliffy.libraries.floorplan.floorplan_v2.miscellaneous","com.gliffy.libraries.floorplan.floorplan_v2.office"],"com.gliffy.shape.floorplan.floorplan_v2.kitchen":["com.gliffy.libraries.floorplan.floorplan_v2.structure","com.gliffy.libraries.floorplan.floorplan_v2.bathroom","com.gliffy.libraries.floorplan.floorplan_v2.bedroom","com.gliffy.libraries.floorplan.floorplan_v2.dining_room","com.gliffy.libraries.floorplan.floorplan_v2.kitchen","com.gliffy.libraries.floorplan.floorplan_v2.living_room","com.gliffy.libraries.floorplan.floorplan_v2.miscellaneous","com.gliffy.libraries.floorplan.floorplan_v2.office"],"com.gliffy.shape.floorplan.floorplan_v2.living_room":["com.gliffy.libraries.floorplan.floorplan_v2.structure","com.gliffy.libraries.floorplan.floorplan_v2.bathroom","com.gliffy.libraries.floorplan.floorplan_v2.bedroom","com.gliffy.libraries.floorplan.floorplan_v2.dining_room","com.gliffy.libraries.floorplan.floorplan_v2.kitchen","com.gliffy.libraries.floorplan.floorplan_v2.living_room","com.gliffy.libraries.floorplan.floorplan_v2.miscellaneous","com.gliffy.libraries.floorplan.floorplan_v2.office"],"com.gliffy.shape.floorplan.floorplan_v2.miscellaneous":["com.gliffy.libraries.floorplan.floorplan_v2.structure","com.gliffy.libraries.floorplan.floorplan_v2.bathroom","com.gliffy.libraries.floorplan.floorplan_v2.bedroom","com.gliffy.libraries.floorplan.floorplan_v2.dining_room","com.gliffy.libraries.floorplan.floorplan_v2.kitchen","com.gliffy.libraries.floorplan.floorplan_v2.living_room","com.gliffy.libraries.floorplan.floorplan_v2.miscellaneous","com.gliffy.libraries.floorplan.floorplan_v2.office"],"com.gliffy.shape.floorplan.floorplan_v2.office":["com.gliffy.libraries.floorplan.floorplan_v2.structure","com.gliffy.libraries.floorplan.floorplan_v2.bathroom","com.gliffy.libraries.floorplan.floorplan_v2.bedroom","com.gliffy.libraries.floorplan.floorplan_v2.dining_room","com.gliffy.libraries.floorplan.floorplan_v2.kitchen","com.gliffy.libraries.floorplan.floorplan_v2.living_room","com.gliffy.libraries.floorplan.floorplan_v2.miscellaneous","com.gliffy.libraries.floorplan.floorplan_v2.office"],"com.gliffy.shape.flowchart.flowchart_v1.default":["com.gliffy.libraries.flowchart.flowchart_v1.default"],"com.gliffy.shape.flowchart.flowchart_v2.default":["com.gliffy.libraries.flowchart.flowchart_v2.default"],"com.gliffy.shape.network.network_v1.default":["com.gliffy.libraries.network.network_v3.business","com.gliffy.libraries.network.network_v3.home","com.gliffy.libraries.network.network_v3.rack"],"com.gliffy.shape.network.network_v2.business":["com.gliffy.libraries.network.network_v3.business"],"com.gliffy.shape.network.network_v2.home":["com.gliffy.libraries.network.network_v3.home"],"com.gliffy.shape.network.network_v2.rack":["com.gliffy.libraries.network.network_v3.rack"],"com.gliffy.shape.network.network_v3.business":["com.gliffy.libraries.network.network_v3.business"],"com.gliffy.shape.network.network_v3.home":["com.gliffy.libraries.network.network_v3.home"],"com.gliffy.shape.network.network_v3.rack":["com.gliffy.libraries.network.network_v3.rack"],"com.gliffy.shape.sitemap.sitemap_v1.default":["com.gliffy.libraries.sitemap.sitemap_v1.default"],"com.gliffy.shape.sitemap.sitemap_v2":["com.gliffy.libraries.sitemap.sitemap_v2"],"com.gliffy.shape.swimlanes.swimlanes_v1.default":["com.gliffy.libraries.swimlanes.swimlanes_v1.default"],"com.gliffy.shape.ui.ui_v1.default":["com.gliffy.libraries.ui.ui_v2.content","com.gliffy.libraries.ui.ui_v2.forms_components","com.gliffy.libraries.ui.ui_v2.miscellaneous"],"com.gliffy.shape.ui.ui_v2.content":["com.gliffy.libraries.ui.ui_v2.content","com.gliffy.libraries.ui.ui_v2.forms_components","com.gliffy.libraries.ui.ui_v2.miscellaneous"],"com.gliffy.shape.ui.ui_v2.forms_components":["com.gliffy.libraries.ui.ui_v2.content","com.gliffy.libraries.ui.ui_v2.forms_components","com.gliffy.libraries.ui.ui_v2.miscellaneous"],"com.gliffy.shape.ui.ui_v2.miscellaneous":["com.gliffy.libraries.ui.ui_v2.content","com.gliffy.libraries.ui.ui_v2.forms_components","com.gliffy.libraries.ui.ui_v2.miscellaneous"],"com.gliffy.shape.uml.uml_v1.default":["com.gliffy.libraries.uml.uml_v1.default","com.gliffy.libraries.uml.uml_v2.class","com.gliffy.libraries.uml.uml_v2.sequence","com.gliffy.libraries.uml.uml_v2.activity","com.gliffy.libraries.uml.uml_v2.state_machine","com.gliffy.libraries.uml.uml_v2.component","com.gliffy.libraries.uml.uml_v2.deployment","com.gliffy.libraries.uml.uml_v2.use_case"],"com.gliffy.shape.venn.flat.default":["com.gliffy.libraries.venn.flat.default"],"com.gliffy.shape.venn.outline.default":["com.gliffy.libraries.venn.outline.default"],"com.gliffy.shape.venn.radial.default":["com.gliffy.libraries.venn.radial.default"]}});_gliffy.shapeLibrary=new _gliffy.ShapeLibrary({rootServiceURL:"../api"})}());(function(){_gliffy._Timer=_gliffy.Class.extend({_timers:null,_profileActive:false,init:function(){this._timers={}},start:function(name,shouldProfile){if(this._timers[name]!==undefined){_gliffy.Logger.warn("Warning, overriding existing timer.")}this._timers[name]={startTime:(new Date()).getTime(),profile:shouldProfile===true};if(shouldProfile&&console&&console.profile){if(this._profileActive){_gliffy.Logger.warn("Only one profile can be active at a time")}else{console.profile(name)}}},end:function(name){var timer=this._timers[name],timeMs=0;if(timer===undefined){_gliffy.Logger.warn("Warning: timer does not exist: "+name)}else{timeMs=(new Date()).getTime()-timer.startTime;if(timer.profile&&console&&console.profile){console.profileEnd();this._profileActive=false}delete this._timers[name]}return timeMs},hasTimer:function(name){return this._timers[name]!==undefined}});_gliffy.Timer=new _gliffy._Timer()}());(function(){var _tempBB=new _gliffy.BoundingBox();function __sort(node1,node2){return node2.getOrder()-node1.getOrder()}_gliffy.Tree={tree:new _gliffy.RTree(5000),debugClear:function(){if(_gliffy.Debug.SHOW_RTREE||_gliffy.Debug.SHOW_LAYERS){$(".gliffy-stage").find(".rtree").remove();if($(".gliffy-stage").find(".gliffy-shift-notify").length===0){$(".gliffy-stage").append('<div class="gliffy-shift-notify" style="color:white;background-color:black">hold ctrl/cmd key down to show groups/selections for rtree/layers.</div>')}}},clear:function(){this.tree=new _gliffy.RTree(5000);this.debugClear()},searchPoint:function(x,y,padding){var rect=padding?{x:x-padding,y:y-padding,w:padding*2,h:padding*2}:{x:x,y:y,w:0,h:0};return this.tree.search(rect)},searchSelection:function(bb){var rect=this.createRectFromBB(bb);return this.tree.search(rect)},createRect:function(node,grow){if(node.parent===null&&(node.isSelection()||node.isGroup()||node.isStandAloneText()||node.isMultipartShape())){return this.createRectFromNode(node)}else{return this.createRectFromBB(node.getWorldOverlayAabb(),grow)}},createRectFromBB:function(bb,grow){if(grow){bb=bb.clone().extend(grow)}var d=bb.getDimension(),rect={x:Math.max(bb.min.x,0),y:Math.max(bb.min.y,0),w:d.x,h:d.y};if(bb.min.x<0){rect.w+=bb.min.x}if(bb.min.y<0){rect.h+=bb.min.y}return rect},createRectFromNode:function(node){var rect={x:Math.max(node.getX(),0),y:Math.max(node.getY(),0),w:node.getWidth(),h:node.getHeight()},bb,dim;if(node.getX()<0){rect.w+=node.getX()}if(node.getY()<0){rect.h+=node.getY()}if(node.getRotation()>0){bb=new _gliffy.BoundingBox(0,0,rect.w,rect.h);bb.transform(node.worldTransform);dim=bb.getDimension();return{x:bb.min.x,y:bb.min.y,w:dim.x,h:dim.y}}else{return rect}},debugAdd:function(node,rect){var border,info,activeLayersDisplay=null;if(_gliffy.Debug.SHOW_RTREE||_gliffy.Debug.SHOW_LAYERS){if(_gliffy.Debug.SHOW_RTREE&&_gliffy.Debug.SHOW_LAYERS){_gliffy.Logger.error("cannot show rtree and layers.  pick one or the other!")}border="1px solid red";if(node.isSelection()){border="1px dotted blue"}else{if(node.isGroup()){border="1px dotted green"}}if(node.getActiveLayers()){activeLayersDisplay=_.map(node.getActiveLayers(),function(layer){return layer.getOrder()}).join(",")}info=node.getId()+" L:"+(activeLayersDisplay?activeLayersDisplay:"?");info+=" O:"+node.getOrder()+" "+node.getUid();if(!node.isText()){$(".gliffy-stage").append($("<div/>",{id:"rtree"+node.getId(),"class":"rtree"}).css({top:rect.y,left:rect.x,width:rect.w,height:rect.h,background:_gliffy.Debug.SHOW_RTREE?"green":"transparent",border:border,position:"absolute",opacity:_gliffy.Debug.SHOW_RTREE?0.25:1,zIndex:519900,pointerEvents:"none"}).text(info));if(node.isSelection()||node.isGroup()){$("#rtree"+node.getId()).addClass("rtree-group")}else{$("#rtree"+node.getId()).addClass("rtree-single")}}}},add:function(node,addChildren){var i,rect,grow;if(node.isSelectable()&&node.getId()!==null){if(node.getGraphic()&&node.getGraphic().getStrokeWidth){grow=node.getGraphic().getStrokeWidth()}rect=this.createRect(node,grow);this.debugAdd(node,rect);this.tree.insert(rect,""+node.getId());if(addChildren&&node.children&&node.children.length>0){for(i=0;i<node.children.length;i++){this.add(node.children[i],addChildren)}}}},debugRemove:function(node){if(_gliffy.Debug.SHOW_RTREE||_gliffy.Debug.SHOW_LAYERS){$(".gliffy-stage").find("#rtree"+node.getId()).remove()}},remove:function(node,removeChildren){var rect=this.createRect(node),removed,i;removed=this.tree.remove(rect,""+node.getId());this.debugRemove(node);if(!removed||removed.length===0){this.tree.remove({x:0,y:0,w:5000,h:5000},""+node.getId())}if(removeChildren&&node.children&&node.children.length>0){for(i=0;i<node.children.length;i++){this.remove(node.children[i],removeChildren)}}}};_gliffy.Pick={pickAllNodesInside:function(nodes,boundingBox,options){var o=$.extend({},{excludeUnpickableNodes:false},options),result;if(o.excludeUnpickableNodes){nodes=this.__removeUnpickableNodes(nodes)}result=this.__pickAllNodesInsideTree(nodes,boundingBox);return result},pickAllNodesPartiallyInside:function(nodes,boundingBox,options){var o=$.extend({},{excludeUnpickableNodes:false},options),result;if(o.excludeUnpickableNodes){nodes=this.__removeUnpickableNodes(nodes)}result=this.__pickAllNodesPartiallyInsideTree(nodes,boundingBox);return result},pickAllNodesAt:function(nodes,x,y,padding,options){var o=$.extend({},{excludeUnpickableNodes:false},options),result;if(o.excludeUnpickableNodes){nodes=this.__removeUnpickableNodes(nodes)}result=this.__pickAllNodesAtTree(nodes,x,y,padding);return result},selectNodesInclusive:function(nodes,boundingBox,options){var o=$.extend({},{excludeUnpickableNodes:false},options),i,search,node,result=[],stage;if(o.excludeUnpickableNodes){nodes=this.__removeUnpickableNodes(nodes)}if(nodes.length>0){stage=nodes.length>0?nodes[0].stage:null;if(stage){search=_gliffy.Tree.searchSelection(boundingBox);for(i=0;i<search.length;i++){node=stage.find(search[i]);if(node){result.push(node)}}result=$.grep(result,function(n,i){return $.inArray(n,nodes)!==-1});result.sort(__sort)}}return result},__removeUnpickableNodes:function(nodes){var pickableNodes;pickableNodes=_.select(nodes,function(node){return node.isPickable()});return pickableNodes},__pickAllNodesInsideTree:function(nodes,boundingBox){var i,search,node,result=[],stage;if(nodes.length>0){stage=nodes.length>0?nodes[0].stage:null;if(stage){search=_gliffy.Tree.searchSelection(boundingBox);for(i=0;i<search.length;i++){node=stage.find(search[i]);if(node&&this.isNodeInside(node,boundingBox)){result.push(node)}}result=$.grep(result,function(n,i){return $.inArray(n,nodes)!==-1});result.sort(__sort)}}return result},__pickAllNodesPartiallyInsideTree:function(nodes,boundingBox){var i,search,node,result=[],stage;if(nodes.length>0){stage=nodes.length>0?nodes[0].stage:null;if(stage){search=_gliffy.Tree.searchSelection(boundingBox);for(i=0;i<search.length;i++){node=stage.find(search[i]);if(node&&this.isNodePartiallyInside(node,boundingBox)){result.push(node)}}result=$.grep(result,function(n,i){return $.inArray(n,nodes)!==-1});result.sort(__sort)}}return result},__pickAllNodesInsideLinear:function(nodes,boundingBox){var i,node,result=[];for(i=0;i<nodes.length;i++){node=nodes[i];if(this.isNodeInside(node,boundingBox)){result.push(node)}}result.sort(__sort);return result},__isNodePicked:function(child,x,y,padding){if(child.getGraphic() instanceof _gliffy.Text){if(this.isNodePicked(child,x-child.getGraphic().style.x,y-child.getGraphic().style.y,padding)){return child}}else{if(this.isNodePicked(child,x,y,padding)){return child}}return null},__pickAllNodesAtLinear:function(nodes,x,y,padding){var i,j,k,node,child,child2,result=[];for(i=0;i<nodes.length;i++){node=nodes[i];if(node.children){for(j=0;j<node.children.length;j++){child=node.children[j];if(this.__isNodePicked(child,x,y,padding)){result.push(child)}for(k=0;child.children&&k<child.children.length;k++){child2=child.children[k];if(this.__isNodePicked(child2,x,y,padding)){result.push(child2)}}}}if(this.isNodePicked(node,x,y,padding)){result.push(node)}}result.sort(__sort);return result},flattenNodes:function(objects){var nodes=[],i;for(i=0;i<objects.length;i++){this.__preorder(objects[i],nodes)}return nodes},__preorder:function(node,array,forceUpdate){var c;if(!node){return}array.push(node);for(c=0;node.children&&c<node.children.length;c++){this.__preorder(node.children[c],array,forceUpdate)}},__pickAllNodesAtTree:function(nodes,x,y,padding){var i,search,node,result=[],flattenedNodes,stage,filter;if(nodes.length>0){stage=nodes.length>0?nodes[0].stage:null;if(stage!==null){filter=stage&&!(nodes.length===stage.objects.length&&nodes[0].getId()===stage.objects[0].getId()&&nodes[nodes.length-1].getId()===stage.objects[stage.objects.length-1].getId());search=_gliffy.Tree.searchPoint(x,y,padding);for(i=0;i<search.length;i++){node=stage.find(search[i]);if(node&&this.__isNodePicked(node,x,y,Math.max(padding,5))){result.push(node)}}if(filter){flattenedNodes=this.flattenNodes(nodes);result=$.grep(result,function(n,i){return $.inArray(n,flattenedNodes)!==-1})}result.sort(__sort)}}return result},pickFirstTextChildNode:function(nodes,x,y){var i,node;if(nodes){nodes=this.pickAllNodesAt(nodes,x,y,0);for(i=0;i<nodes.length;i++){if(nodes[i].isTextChild()){return nodes[i]}}}return null},isNodePicked:function(node,x,y,padding){var point;if(node.isSelectable()){point=node.worldTransform.createInverse().transformPoint(x,y);if(padding){return _tempBB.copy(node.getLocalAabb()).extend(padding).pointInside(point.x,point.y)}else{return node.getLocalAabb().pointInside(point.x,point.y)}}else{return false}},isNodeInside:function(node,boundingBox){return boundingBox.boundingBoxInside(node.getWorldOverlayAabb())},isNodePartiallyInside:function(node,boundingBox){return boundingBox.inBoundingBox(node.getWorldOverlayAabb())},_isNodeTransparencySpecialCase:function(node){return(node&&node.getGraphic() instanceof _gliffy.Shape&&node.getGraphic().getFillColor()==="none"&&node.getGraphic().getOpacity()<1)},shouldBeSelected:function(node,x,y){return this._isNodeTransparencySpecialCase(node)||this.getAlphaAtPixel(node,x,y)>0||node.getGraphic() instanceof _gliffy.Text||node.getShapeInformation().boundingBoxSelect||node.getUid()===null},nearEdge:function(node,x,y){var bb=node.getWorldAabb().clone(),diff=10;if(Math.abs(bb.min.x-x)<diff){return true}else{if(Math.abs(bb.max.x-x)<diff){return true}else{if(Math.abs(bb.min.y-y)<diff){return true}else{if(Math.abs(bb.max.y-y)<diff){return true}}}}return false},_hasText:function(nodes){var i;for(i=0;i<nodes.length;i++){if(nodes[i].getGraphic() instanceof _gliffy.Text){return true}}return false},_isNodeViableCandidate:function(node,x,y){return node.isBoundingBoxSelectActingLikeContainer()||node.getGraphic() instanceof _gliffy.Text||node.isMultipartShape()||this.isNodeOpaqueAt(node,x,y)||node.isSelection()},getNodeAt:function(nodes,x,y,options){return this.getNodeAtExt(nodes,x,y,options).node},getNodeAtExt:function(nodes,x,y,options){var i=0,node,parent,group,swimlaneNodes,tmp,bestSoFar=null,defaults={doNotIncludeGroup:false,subNodeSelection:false,excludeUnpickableNodes:false},o=$.extend({},defaults,options);if(o.excludeUnpickableNodes){nodes=this.__removeUnpickableNodes(nodes)}if(!nodes){return{node:bestSoFar,textChild:null}}nodes=this.pickAllNodesAt(nodes,x,y,0);for(;node=nodes[i++];){if(node.isSwimlane()||node.isIcon()){continue}if(!this.shouldBeSelected(node,x,y)){continue}if(node.getUid()===null){parent=node.getUidNode();if(parent&&parent.isSwimlane()&&parent.children){swimlaneNodes=this.pickAllNodesAt(parent.children,x,y,10);if(this._hasText(swimlaneNodes)){tmp=parent}else{if(swimlaneNodes.length>0&&swimlaneNodes[0].getGraphic()&&this.nearEdge(node,x,y)){tmp=parent}else{continue}}}else{tmp=parent}}if(!o.doNotIncludeGroup){group=node.topGroup()}if(group&&node.getId()!==group.getId()){tmp=group}else{if(node.getUid()===null&&!o.subNodeSelection){tmp=parent}else{tmp=node}}if(this._isNodeViableCandidate(node,x,y)){return{node:tmp,textChild:(node.isTextChild()?node:null)}}else{bestSoFar=bestSoFar||tmp}}return{node:bestSoFar,textChild:null}},getAlphaAtPixel:function(node,x,y){var element,alphaAtPixel,point,scale,ctx=null;element=node.getDomElement();if(element){if(element.is("canvas")){ctx=element[0].getContext("2d")}else{if(element.is("img")){ctx=element.data("ctx")}}if(ctx){scale=element.data("scale");point=element.data("transform").createInverse().transformPoint(x*scale,y*scale);alphaAtPixel=ctx.getImageData(point.x,point.y,1,1).data[3]}return alphaAtPixel}return 0},isNodeOpaqueAt:function(node,x,y){if(node.isLine()){return this.getAlphaAtPixel(node,x,y)>0}else{return this.getAlphaAtPixel(node,x,y)>_gliffy.MIN_VISIBLE_VALUE||node.getGraphic() instanceof _gliffy.Text}},pickConnectionPoint:function(node,point,radius){var i,connectionPoint,closest=null,closestDist;if(node.supportsConnections()){radius*=radius;closestDist=radius;for(i=0;i<node.getConnections().length;i++){connectionPoint=node.getConnectionPoint(i);var currentDist=_gliffy.Vec2.squaredDistance(connectionPoint,point);if(currentDist<closestDist){closest=i;closestDist=currentDist}}}return closest}}}());(function(){var _plugins=[],_activePlugins={},_id=0,_Plugin;_Plugin=_gliffy.Class.extend({activate:function(editor){},deactivate:function(){},isActive:function(){return _gliffy.Plugins.isActive(this.getName())},initTemplates:function(){_gliffy.Plugins.initTemplates(this.getTemplateNames())},getTemplateNames:function(){return[]},getName:function(){throw new Error("Please implement getName!")},addToolbarButton:function(actionName,title,className,id){var self=this;title=title||this.getName();_gliffy.Plugins.addToolbarButton(function(e){self[actionName](e)},title,className,id)},onAllPluginsActivated:function(editor){}});_gliffy.Plugins={create:function(plugin){plugin=new (_Plugin.extend(plugin))();_plugins.push(plugin);return plugin},activate:function(editor){var i,plugin;for(i=0;i<_plugins.length;i++){plugin=_plugins[i];plugin.initTemplates();plugin.activate(editor);_activePlugins[plugin.getName()]=plugin}for(i=0;i<_plugins.length;i++){plugin=_plugins[i];plugin.onAllPluginsActivated(editor)}if(editor.pluginsReadyCallback){setTimeout(function(){editor.pluginsReadyCallback(editor)},100)}},initTemplates:function(templateNames){var i;for(i=0;i<templateNames.length;i++){Ember.View.create({templateName:templateNames[i]}).appendTo("#gliffy")}},isActive:function(pluginName){return this.getInstance(pluginName)!==null},getInstance:function(pluginName){return _activePlugins[pluginName]||null},addToolbarButton:function(actionFunction,title,className,id){var self=this,button,activateFunc;id=id||("__gliffy_plugin__"+_id++);className=className||"";title=title||"";button=$("<button/>",{"class":"btn",id:id,title:title});button.append($("<div/>",{"class":className}));activateFunc=function(){var anchor=$("#gliffy-toolbar-extensions");if(anchor.length>0){anchor.append(button);button.click(actionFunction)}else{setTimeout(activateFunc,30)}};activateFunc()}}}());(function(){_gliffy.fontLoader=_gliffy.Class.extend({_loaded:null,_tinyMCEHasLoaded:false,_queuedStyleForTinyMCE:null,_fontPath:null,init:function(options){var i,nonWebFonts=_gliffy.TextUtils.getFontList(false);this._loaded={};this._queuedStyleForTinyMCE="";for(i=0;i<nonWebFonts.length;i++){this._loaded[nonWebFonts[i]]=true}},setPath:function(path){this._fontPath=path},attachPlaceholderFont:function(font){var fontWithDashes=font.replace(/\ /g,"-"),style,template=Handlebars.compile($("#gliffy-font-loader").html()),self=this,$selector;style=template($.extend({woffBase64:$("#gliffy-font-"+fontWithDashes+"-placeholder").html(),fontName:fontWithDashes+"Placeholder"}));this._appendStyle($("head"),style);$selector=$('span[title="'+font+'"]');$selector.css("font-family",fontWithDashes+"Placeholder")},_appendStyle:function($head,style){var $styleSheet=$head.find("#gliffy-font-style");if($styleSheet.length===0){$styleSheet=$('<style id="gliffy-font-style"></style>');$head.append($styleSheet)}$styleSheet.html($styleSheet.text()+"\n\n\n\n"+style)},attachLoadedFontsToTinyMCE:function(){this._tinyMCEHasLoaded=true;this._appendStyle($("#gliffy-edit-text_ifr").contents().find("head"),this._queuedStyleForTinyMCE);this._queuedStyleForTinyMCE=null},waitForWebfonts:function(fonts){var deferred=$.Deferred();if(fonts.length===0){deferred.resolve()}else{WebFont.load({custom:{families:fonts},timeout:3000,active:function(which){deferred.resolve()},fontinactive:function(){_gliffy.Logger.warn("unable to detect font load "+fonts.join(", "));deferred.resolve()}})}return deferred.promise()},loadFont:function(font,callback){var template,style,self=this;font=font.replace(/\'|\"/g,"");if(this._loaded[font]||(_gliffy.TextUtils.FONT_FIXES[font]&&!_gliffy.TextUtils.FONT_FIXES[font].isWebFont)){return}this._loaded[font]=true;template=Handlebars.compile($("#gliffy-font-loader").html());style=template($.extend({woffBase64:(this._fontPath?this._fontPath:"../images/rtefont/")+font+".woff",fontName:font}));self._appendStyle($("head"),style);if(_gliffy.Editor!==undefined){if(self._tinyMCEHasLoaded&&window.tinymce&&tinymce.activeEditor){self._appendStyle($("#gliffy-edit-text_ifr").contents().find("head"),style);tinymce.activeEditor.plugins.autoresize.forceResize()}else{self._queuedStyleForTinyMCE+=style}}if(callback){self.waitForWebfonts([font]).then(callback)}},isLoadedOrLoading:function(fontName){return !!this._loaded[fontName]},getEmbeddableFonts:function(cb){var webFontsToLoad={},self=this,doLoad,noFonts,embeddableFont;for(var loadedFont in this._loaded){if(this._loaded.hasOwnProperty(loadedFont)&&_gliffy.TextUtils.FONT_FIXES[loadedFont]&&_gliffy.TextUtils.FONT_FIXES[loadedFont].isWebFont){webFontsToLoad[loadedFont]=null}}doLoad=function(fontName,cb){var loadedEmbeddableFont,fullStyle;self.__loadEmbeddableFont(fontName,function(fontName,style){webFontsToLoad[fontName]=style;for(loadedEmbeddableFont in webFontsToLoad){if(webFontsToLoad.hasOwnProperty(loadedEmbeddableFont)&&webFontsToLoad[loadedEmbeddableFont]===null){return}}fullStyle="";for(loadedEmbeddableFont in webFontsToLoad){fullStyle+=webFontsToLoad[loadedEmbeddableFont]+"\n"}cb(fullStyle)})};noFonts=true;for(embeddableFont in webFontsToLoad){if(webFontsToLoad.hasOwnProperty(embeddableFont)){noFonts=false;doLoad(embeddableFont,cb)}}if(noFonts){cb("")}},__loadEmbeddableFont:function(font,callback){var fontName=font,url;font=font.replace(/\'|\"/g,"");url=(this._fontPath?this._fontPath:"../images/rtefont/")+font+".woff.txt";$.ajax({url:url,type:"GET"}).done(function(data){var dataURL="data:font/woff;base64,"+data.replace("\n",""),template=Handlebars.compile($("#gliffy-font-loader").html()),style=template($.extend({woffBase64:dataURL,fontName:font}));if(callback){callback(fontName,style)}}).error(function(xhr,text,error){_gliffy.Logger.warn("Failed to download: "+fontName+".  This font will not be in the SVG.");_gliffy.Logger.warn("xhr: "+xhr+", text: "+text+", error: "+error);if(callback){callback(fontName,"")}})}});$(function(){_gliffy.FontLoader=new _gliffy.fontLoader()})}());(function(){_gliffy.EmbeddedResource=_gliffy.Serializable.extend({id:null,mimeType:null,data:null,width:100,height:100,x:0,y:0,init:function(id,mimeType,data,x,y,width,height){this.id=id;this.mimeType=mimeType;this.data=data;this.x=x;this.y=y;this.width=width;this.height=height},getId:function(){return this.id},setId:function(id){this.id=id},setMimeType:function(mimeType){this.mimeType=mimeType},getMimeType:function(){return this.mimeType},setData:function(data){this.data=data},getData:function(){return this.data},getWidth:function(){return this.width},setWidth:function(width){this.width=width},getX:function(){return this.x},setX:function(x){this.x=x},getY:function(){return this.y},setY:function(y){this.y=y},getHeight:function(){return this.height},setHeight:function(height){this.height=height},__toObject:function(){return{id:this.getId(),mimeType:this.getMimeType(),data:this.getData(),x:this.getX(),y:this.getY(),width:this.getWidth(),height:this.getHeight()}},__fromObject:function(object){if(object.id!==undefined&&object.id!==null){this.setId(object.id)}if(object.mimeType!==undefined&&object.mimeType!==null){this.setMimeType(object.mimeType)}if(object.data!==undefined&&object.data!==null){this.setData(object.data)}if(object.x!==undefined&&object.x!==null){this.setX(object.x)}if(object.y!==undefined&&object.y!==null){this.setY(object.y)}if(object.width!==undefined&&object.width!==null){this.setWidth(object.width)}if(object.height!==undefined&&object.height!==null){this.setHeight(object.height)}return this}});_gliffy.EmbeddedResources=_gliffy.Serializable.extend({index:0,resources:null,_resourceMap:null,init:function(){this._resourceMap={}},getIndex:function(){return this.index},setIndex:function(index){this.index=index},add:function(mimeType,data,x,y,width,height){var resource,i;if(this.resources===null){this.resources=[]}resource=new _gliffy.EmbeddedResource(this.getIndex(),mimeType,data,x,y,width,height);for(i=0;i<this.resources.length;i++){if(this.resources[i].getData()===resource.getData()&&this.resources[i].getMimeType()===resource.getMimeType()){return this.resources[i]}}this.resources.push(resource);this._resourceMap[resource.getId()]=resource;this.index++;return resource},remove:function(resource){var index;if(this.resources!==null){index=$.inArray(resource,this.resources);if(index>=0){this.resources.splice(index,1);delete this._resourceMap[resource.getId()]}}},getResource:function(id){return this._resourceMap[id]},findExisitngResource:function(data,mimetype){var i;for(i=0;i<this.resources.length;i++){if(this.resources[i].getData()===data&&this.resources[i].getMimeType()===mimetype){return this.resources[i]}}return null},__toObject:function(){var i,resources=[],resource;for(i=0;this.resources&&i<this.resources.length;i++){resource=this.resources[i].toObject();resources.push(resource)}return{index:this.index,resources:resources}},__fromObject:function(object){var i,resource;if(object.index!==undefined&&object.index!==null){this.setIndex(object.index)}if(object.resources&&object.resources.length>0){this.resources=[];this._resourceMap={};for(i=0;i<object.resources.length;i++){resource=new _gliffy.EmbeddedResource();resource.fromObject(object.resources[i]);this.resources.push(resource);this._resourceMap[resource.getId()]=resource}}return this}})}());(function(){_gliffy.Graphic=_gliffy.SerializableWithAabb.extend({_dirty:true,editable:null,init:function(){if(_gliffy.Editable){this.editable=_gliffy.Editable.getInstance(this)}},getTid:function(){throw new Error("getTid not implemented.")},markDirty:function(){this._dirty=true;if(this.node){this.node.markDirty();this.node.setFlag("skin")}},shouldBeDrawn:function(){if(this.node){return this.node.shouldBeDrawn()}return true},isDirty:function(){return this._dirty},hasParentOfType:function(type){return this.node&&this.node.parent&&this.node.parent.getGraphic() instanceof type},updateProperty:function(prop,value){if(this["set"+prop]!==undefined){this["set"+prop](value)}else{var msg="Property setter: set"+prop+" not found on graphic";throw new Error(msg)}},update:function(){throw new Error("update not implemented.")},applyStyle:function(style){throw new Error("applyStyle not implemented.")},getClassName:function(){throw new Error("getClassName not implemented.")},__toObject:function(){throw new Error("toObject not implemented.")},__fromObject:function(object){throw new Error("fromObject not implemented.")}})})();(function(){_gliffy.Editable=_gliffy.Serializable.extend({isEditable:false,__graphic:null,init:function(o){if(!o){throw new Error("editable init needs options")}if(!o.graphic){throw new Error("editable init options needs graphic")}this.__graphic=o.graphic},__toObject:function(){return{}},__fromObject:function(object){}});_gliffy.Editable.getInstance=function(graphic){var className="Editable"+graphic.getClassName();if(typeof _gliffy[className]==="function"){return new _gliffy[className]({graphic:graphic})}return new _gliffy.Editable({graphic:graphic})}})();(function(){_gliffy.AbstractGeometry=_gliffy.Graphic.extend({_strokeWidth:2,_strokeColor:"#000000",_dropShadow:true,_shadowX:5,_shadowY:5,_connections:null,_showConnections:false,svg:null,setStrokeWidth:function(strokeWidth){this._strokeWidth=strokeWidth;if(this.node){this.node.setFlag("bounds")}this.markDirty()},getStrokeWidth:function(){return this._strokeWidth},setStrokeColor:function(strokeColor){this._strokeColor=strokeColor;this.markDirty()},getStrokeColor:function(){return this._strokeColor},setDropShadow:function(dropShadow){this._dropShadow=dropShadow;if(dropShadow){this.setShadowX(4);this.setShadowY(4)}else{this.setShadowX(0);this.setShadowY(0)}if(this.node){this.node.setFlag("bounds");this.node.setFlag("skin")}this.markDirty()},isDropShadow:function(){return this._dropShadow},setShadowX:function(shadowX){this._shadowX=shadowX;this.markDirty()},getShadowX:function(){return this._shadowX},setShadowY:function(shadowY){this._shadowY=shadowY;this.markDirty()},getShadowY:function(){return this._shadowY},calculateShadowOffset:function(){if(this.isDropShadow()&&this.node){var shadow_x=this.getShadowX(),shadow_y=this.getShadowY(),rotation=this.node.getWorldRotation(),rat1,rat2;var nx=0;var ny=0;var r=rotation%360;if(r<0){r+=360}if(r>=0&&r<=90){rat1=0;if(r<45){rat1=r/45}else{rat1=(90-r)/45}rat2=(45-r)/45;nx=shadow_x+shadow_x/3*rat1;ny=shadow_y*rat2}else{if(r>90&&r<=180){r=r-90;if(r<45){rat1=r/45}else{rat1=(90-r)/45}rat2=(45-r)/45;nx=shadow_x*rat2;ny=-(shadow_y+shadow_y/3*rat1)}else{if(r>180&&r<=270){r=r-180;if(r<45){rat1=r/45}else{rat1=(90-r)/45}rat2=(45-r)/45;nx=-(shadow_x+shadow_x/4*rat1);ny=-(shadow_y*rat2)}else{if(r<0){r=360+r}r=r-270;if(r<45){rat1=r/45}else{rat1=(90-r)/45}rat2=(45-r)/45;nx=-(shadow_x*rat2);ny=shadow_y+shadow_y/3*rat1}}}return{x:nx,y:ny}}else{return{x:0,y:0}}}})}());(function(){var TID=null,OVERFLOW={name:"overflow",values:["left","none","right","both"],left:"left",right:"right",both:"both",none:"none"},VALIGN={name:"valign",values:["top","middle","bottom"],top:"top",middle:"middle",bottom:"bottom"},VPOSITION={name:"vposition",values:["above","none","below"],above:"above",none:"none",below:"below"},HPOSITION={name:"hposition",values:["left","none","right"],left:"left",none:"none",right:"right"},HORIZONTAL_MAGIC_OFFSETS={left:3,overflow_both:3,overflow_left:3,right:-2};var DEFAULT_FONT_FIX={9:0,10:0,11:0,12:0,13:0,14:0,16:0,18:0,20:0,24:0,36:0,48:0,64:0,72:0,96:0,110:0,127:0};_gliffy.TextUtils={FONT_FIXES:{Arial:{isOffset:true,isWebFont:false,isFontOption:true,normal:{9:1,10:1,11:1,12:2,13:2.5,14:2.5,16:2.5,18:2.5,20:2.75,24:3,36:5,48:5,64:8,72:8,96:10,110:12,127:16},bold:{9:1,10:1,11:1,12:2,13:2.5,14:2.5,16:2.5,18:2.5,20:2.75,24:3,36:5,48:5,64:8,72:8,96:10,110:12,127:16}},Verdana:{isOffset:true,isWebFont:false,isFontOption:true,normal:{9:2.5,10:2.5,11:2.5,12:2.5,13:3.5,14:3.5,16:3.75,18:4,20:4.25,24:5,36:8,48:10,64:12,72:15,96:21,110:24,127:28},bold:{9:2.5,10:2.5,11:2.5,12:2.5,13:3.5,14:3.5,16:3.75,18:4,20:4.25,24:5,36:8,48:10,64:12,72:15,96:21,110:24,127:28}},Helvetica:{isOffset:true,isWebFont:false,isFontOption:true,normal:DEFAULT_FONT_FIX,bold:DEFAULT_FONT_FIX},Courier:{isOffset:true,isWebFont:false,isFontOption:true,normal:DEFAULT_FONT_FIX,bold:DEFAULT_FONT_FIX},Times:{isOffset:true,isWebFont:false,isFontOption:true,normal:DEFAULT_FONT_FIX,bold:DEFAULT_FONT_FIX},"Times New Roman":{isOffset:true,isWebFont:false,isFontOption:false,normal:DEFAULT_FONT_FIX,bold:DEFAULT_FONT_FIX}},appendWebFontFixes:function(){if($("#gliffy-font-line-heights").length>0){var webFontFixes=JSON.parse($("#gliffy-font-line-heights").html());for(var fontName in webFontFixes){if(webFontFixes.hasOwnProperty(fontName)){var fixObj={isOffset:false,isWebFont:true,isFontOption:true,normal:{},bold:{}};for(var fontSize in webFontFixes[fontName]){if(webFontFixes[fontName].hasOwnProperty(fontSize)){fixObj.normal[parseInt(fontSize)]=parseFloat(webFontFixes[fontName][fontSize]);fixObj.bold[parseInt(fontSize)]=parseFloat(webFontFixes[fontName][fontSize])}}_gliffy.TextUtils.FONT_FIXES[fontName]=fixObj}}}},getFontList:function(webFonts){var fonts=[];for(var fontName in _gliffy.TextUtils.FONT_FIXES){if(_gliffy.TextUtils.FONT_FIXES.hasOwnProperty(fontName)){if(_gliffy.TextUtils.FONT_FIXES[fontName].isFontOption){if(webFonts===true&&_gliffy.TextUtils.FONT_FIXES[fontName].isWebFont){fonts.push(fontName)}else{if(webFonts===false&&!_gliffy.TextUtils.FONT_FIXES[fontName].isWebFont){fonts.push(fontName)}else{if(webFonts===null||webFonts===undefined){fonts.push(fontName)}}}}}}return fonts},removeErroneousTrailingParagraphs:function($html){var i,$paragraph,paragraphs,validParagraphFound;paragraphs=$html.find("p");if(paragraphs.length>1){validParagraphFound=false;i=paragraphs.length;while(i>0&&!validParagraphFound){i--;$paragraph=$(paragraphs[i]);if($paragraph.find("br").length>0&&$paragraph.text().length===0){$paragraph.remove()}else{validParagraphFound=true}}}return $html},validateAndFix:function(html){var $html;$html=$("<div>"+html+"</div>");if(_gliffy.BrowserDetect.browser==="Explorer"&&_gliffy.BrowserDetect.version===11){$html=this.removeErroneousTrailingParagraphs($html)}$html.contents().each(function(){if(this.nodeType===3&&_gliffy.Utils.hasNonWhitespaceCharacter(this.textContent)){$(this).wrap("<p />")}});$html.contents().each(function(){var $p=$(this);if($p.is("p")){if($p.attr("style")===null||$p.attr("style")===undefined||$p.attr("style").toLowerCase().indexOf("text-align")<0){$p.css("text-align","center")}$p.contents().each(function(){if(this.nodeType===3){$(this).wrap("<span />")}})}});$html.find("a").each(function(){var $this=$(this),spans;if($this.attr("target")===undefined||$this.attr("target")===null){$this.attr("target","_blank")}});return $html.html()},adjustHeightsAndColor:function(html){var textNode=$("<div>").append($(html)),spans=textNode.find("span"),color,isBlack,renderedColor;spans.each(function(index){var span=$(this),font=span.css("font-family"),weight=span.css("font-weight"),size=parseFloat(span.css("font-size").replace("px","")),height,needsLineHeight=false;if(span[0].childNodes.length===0){needsLineHeight=true}for(var i=0;i<span[0].childNodes.length;i++){if(span[0].childNodes[i].nodeType===3||span[0].childNodes[i].tagName.toLowerCase()==="a"){needsLineHeight=true;break}}font=_gliffy.Utils.getRenderedStyle(span,"font-family");font=font===""?"Arial":font;_gliffy.FontLoader.loadFont(font);if(needsLineHeight){weight=_gliffy.Utils.getRenderedStyle(span,"font-weight");size=parseFloat(_gliffy.Utils.getRenderedStyle(span,"font-size").replace("px",""));switch(weight){case"bold":case"700":weight="bold";break;case"":case"normal":case"400":weight="normal";break;default:weight="normal"}if(_gliffy.TextUtils.FONT_FIXES[font]===undefined){font="Arial"}if(_gliffy.TextUtils.FONT_FIXES[font][weight]===undefined){weight="normal"}if(isNaN(size)||_gliffy.TextUtils.FONT_FIXES[font][weight][size]===undefined){size=12}if(_gliffy.TextUtils.FONT_FIXES[font].isOffset){height=""+(size+_gliffy.TextUtils.FONT_FIXES[font][weight][size])+"px"}else{height=_gliffy.TextUtils.FONT_FIXES[font][weight][size]}if($(this).html().length===0){$(this).html("&nbsp;")}$(this).css("line-height",height)}else{$(this).css("line-height","")}if(!_gliffy.Utils.hasNonWhitespaceCharacter(span[0].textContent)){$(this).css("text-decoration","none")}function isBlack(color){return color==="rgb(0, 0, 0)"||color==="black"||color==="#000000"||color==="#000"||color==="rgb(0,0,0)"}color=$(this).css("color");if(isBlack(color)){$(this).css("color","");renderedColor=_gliffy.Utils.getRenderedStyle($(this),"color");if(!isBlack(renderedColor)){$(this).css("color",color)}}});return textNode.html()},findFirstElementWithColor:function($html,notTopLevelCall){var black,$element,elementColor,firstElement;black="rgb(0, 0, 0)";$html.each(function(_,element){$element=$(element);elementColor=new _gliffy.RGBColor($element.css("color"));if(elementColor.toRGB()!==black){firstElement=firstElement||$element}else{if($element.children().length>0){firstElement=firstElement||_gliffy.TextUtils.findFirstElementWithColor($element.children(),{notTopLevelCall:true})}}});if(notTopLevelCall){return firstElement}else{return firstElement||$html.find("span")}}};_gliffy.Text=_gliffy.Graphic.extend({style_default:{width:200,height:100,x:0,y:0,type:"fixed",rotate:0},node:null,_lines:null,_valign:VALIGN.middle,_overflow:OVERFLOW.none,_vposition:VPOSITION.none,_hposition:HPOSITION.none,_html:null,_hashCode:null,_lineTValue:null,_linePerpValue:null,_cardinalityType:null,ruler:null,__padding_top:2,__padding_left:2,__padding_bottom:2,__padding_right:2,__outer_padding_top:null,__outer_padding_left:null,__outer_padding_bottom:null,__outer_padding_right:null,__legacyOuterPadding:{top:6,left:5,right:6,bottom:2},__webkit_height_offset:1,__cachedResult:null,__cachedDomResult:null,__computePositioning:false,__calculatedWidth:null,__calculatedHeight:null,__domRuler:null,init:function(){this.__domRuler=$("<div/>",{style:"visibility:hidden;padding:0;margin:0;position:fixed;","class":"gliffy-ruler-text"});this.style=$.extend({},this.style_default);this._super()},update:function(){if(this.node&&this._dirty){if(!this.editable.isEditable||!this.editable.getEditMode()){this.style=$.extend({},this.style_default,{width:this.node.getWidth(),height:this.node.getHeight()});this.__textHandler();this.__cachedDomResult=$(this._html)}this._dirty=false;return true}return false},markDirty:function(){this._dirty=true;if(this.node){this.node.markDirty()}},calculateWidth:function(){var width=0,recalcDimensions=this.node.isPartOfMultipartShape(),mapEntry;mapEntry=""+this.node.getId()+":"+this._hashCode;if(recalcDimensions||_gliffy.textDimensionMap.width[mapEntry]===undefined){if(!recalcDimensions&&++_gliffy.textDimensionMapSize.width>5000){_gliffy.textDimensionMap.width={};_gliffy.textDimensionMapSize.width=0}if(this.hasFixedWidth()){width=this.node.getWidth()}else{this.__domRuler.html(this._html).appendTo("body").css({width:""});width=this.__domRuler.width()}switch(this.getOverflow()){case OVERFLOW.none:width=width-this.getPaddingLeft()-this.getPaddingRight();break;case OVERFLOW.right:case OVERFLOW.both:width+=5;break}if(recalcDimensions){return width}_gliffy.textDimensionMap.width[mapEntry]=width}return _gliffy.textDimensionMap.width[mapEntry]},calculateHeight:function(forceRecalculate){var height,existingWidth,mapEntry;if(this.hasFixedWidth()){existingWidth=this.node.getWidth()-this.getPaddingLeft()-this.getPaddingRight();existingWidth=existingWidth.toFixed(2)}else{existingWidth=-1}mapEntry=""+this.node.getId()+":"+this._hashCode+":"+existingWidth;if(_gliffy.textDimensionMap.height[mapEntry]===undefined||forceRecalculate){if(++_gliffy.textDimensionMapSize.height>5000){_gliffy.textDimensionMap.height={};_gliffy.textDimensionMapSize.height=0}this.__domRuler.appendTo("body").css({width:""}).html(this._html);if(this.hasFixedWidth()){this.__domRuler.css("width",Number(existingWidth)+"px")}else{this.__domRuler.css("width","")}height=this.__domRuler.height();this.__domRuler.css("width","").remove();_gliffy.textDimensionMap.height[mapEntry]=height}return _gliffy.textDimensionMap.height[mapEntry]},invalidate:function(){this.setHTML(this.getHTML());this.calculateHeight(true)},getCalculatedHeight:function(){return this.calculateHeight()},getCalculatedWidth:function(){return this.calculateWidth()},setupDefaults:function(textDefaults){var spanStyle="",pStyle="",css={},valid,newHTML,key;valid=textDefaults&&textDefaults.length!==0;if(valid){this.fromObject(textDefaults[0]);if(textDefaults[0].html!==undefined&&textDefaults[0].html!==null){this.setHTML(textDefaults[0].html,true)}}if(valid&&textDefaults[0].bold===true){css["font-weight"]="bold"}if(valid&&textDefaults[0].italic===true){css["font-style"]="italic"}if(valid&&textDefaults[0].underline===true){css["text-decoration"]="underline"}if(valid&&textDefaults[0].face){css["font-family"]=textDefaults[0].face}else{css["font-family"]="Arial"}if(valid&&textDefaults[0].size){css["font-size"]=textDefaults[0].size+"px"}else{css["font-size"]="12px"}if(valid&&textDefaults[0].color){css.color=textDefaults[0].color}if(valid&&textDefaults[0].paddingLeft){this.setPaddingLeft(textDefaults[0].paddingLeft)}if(valid&&textDefaults[0].paddingRight){this.setPaddingRight(textDefaults[0].paddingRight)}if(valid&&textDefaults[0].paddingBottom){this.setPaddingBottom(textDefaults[0].paddingBottom)}if(valid&&textDefaults[0].paddingTop){this.setPaddingTop(textDefaults[0].paddingTop)}if(valid&&textDefaults[0].outerPaddingLeft){this.setOuterPaddingLeft(textDefaults[0].outerPaddingLeft)}if(valid&&textDefaults[0].outerPaddingRight){this.setOuterPaddingRight(textDefaults[0].outerPaddingRight)}if(valid&&textDefaults[0].outerPaddingBottom){this.setOuterPaddingBottom(textDefaults[0].outerPaddingBottom)}if(valid&&textDefaults[0].outerPaddingTop){this.setOuterPaddingTop(textDefaults[0].outerPaddingTop)}for(key in css){if(css.hasOwnProperty(key)){spanStyle+=key+":"+css[key]+";"}}if(valid&&textDefaults[0].align){pStyle+="text-align: "+textDefaults[0].align+"; "}newHTML=this.getHTML()&&this.getHTML().length!==0?this.getHTML():'<span class="gliffy-placeholder-text"><br></span>';newHTML='<p style="'+pStyle+'"><span style="'+spanStyle+'">'+newHTML+"</span></p>";this.setHTML(newHTML)},__setupCardinalityValues:function(cardinality){var line=this.node.parent.getGraphic(),totalDistance=line.getPathLength().totalDistance,arrow=line[(cardinality==="begin")?"getStartArrow":"getEndArrow"](),curDistance=(arrow===0?15:25),slopeVec,slope,isShortLine;isShortLine=totalDistance<80;this.setLinePerpValue(15*(cardinality==="end"&&isShortLine?-1:1));if(cardinality==="end"){curDistance=totalDistance-curDistance}this.setLineTValue(curDistance/totalDistance);slopeVec=line.getSlopeAtDistance(curDistance);slope=Math.atan2(slopeVec.y,slopeVec.x);if(slope>-1.571&&slope<1.57){this.setLinePerpValue(-15*(cardinality==="end"&&isShortLine?-1:1))}},__textHandler:function(){var hasMultipartParent,height,linePoint,offset,parent,slope,width;hasMultipartParent=this.node.isPartOfMultipartShape();if(this.node.hasRedrawCanvasFlag()||this.__calculatedWidth===null||this.__calculatedHeight===null){this.__calculatedWidth=this.calculateWidth();this.__calculatedHeight=this.calculateHeight();parent=this.node.getUidNode();if(hasMultipartParent){this.node.setHeight(this.__calculatedHeight+this.getPaddingTop()+this.getPaddingBottom());this.node.setWidth(this.__calculatedWidth+this.getPaddingLeft()+this.getPaddingRight())}else{if((parent&&parent.isLine())||!this.hasFixedWidth()){this.node.setHeight(this.__calculatedHeight);this.node.setWidth(this.__calculatedWidth)}else{if(this.node.parent&&!this.node.parent.isGroup()){this.node.setHeight(this.__calculatedHeight)}else{if(this.node.getHeight()<this.__calculatedHeight){this.node.setHeight(this.__calculatedHeight)}}}}}if(this.node.isStandAloneText()||!this.node.parent){height=this.node.getHeight();width=this.node.getWidth()}else{height=this.node.parent.getHeight();width=this.node.parent.getWidth()}this.style.width=this.node.getWidth();this.style.height=this.node.getHeight();if(this.getOverflow()===OVERFLOW.none){this.style.width=this.node.getWidth()-this.getPaddingLeft()-this.getPaddingRight()}else{if(hasMultipartParent){this.style.height=this.node.getHeight()-this.getPaddingTop()-this.getPaddingBottom()}}if(hasMultipartParent&&this.getValign()===VALIGN.bottom){this.style.height=this.node.getHeight()-this.getPaddingTop()-this.getPaddingBottom()}this.style.y=0;switch(this.getValign()){case VALIGN.top:this.style.y=this.getPaddingTop();break;case VALIGN.middle:this.style.y=(height-this.style.height)/2;break;case VALIGN.bottom:this.style.y=(height-this.style.height-this.getPaddingBottom())}switch(this.getVPosition()){case VPOSITION.above:this.style.y=-this.style.height-this.getOuterPaddingTop();break;case VPOSITION.below:this.style.y=height+this.getOuterPaddingBottom();break}switch(this.getHPosition()){case HPOSITION.right:this.style.x=width+this.getOuterPaddingRight()+HORIZONTAL_MAGIC_OFFSETS.right;break;case HPOSITION.left:this.style.x=-(this.style.width+this.getOuterPaddingLeft()+HORIZONTAL_MAGIC_OFFSETS.left);break;default:this.style.x=this.getPaddingLeft();break}switch(this.getOverflow()){case OVERFLOW.both:this.style.x=width/2-this.style.width/2-HORIZONTAL_MAGIC_OFFSETS.overflow_both;break;case OVERFLOW.left:this.style.x=-(this.getOuterPaddingLeft()+this.getCalculatedWidth()+HORIZONTAL_MAGIC_OFFSETS.overflow_left);break}if(this.node.parent&&this.node.parent.isLine()){if(this.node.stage){this.style.text_background_fill=this.node.stage.background}var cardinality=this.getCardinality();if(cardinality!==null){this.__setupCardinalityValues(cardinality)}linePoint=this.node.parent.getGraphic().getPointAt(this.getLineTValue());offset=new _gliffy.Vec2(0,0);if(this.getLinePerpValue()!==0){slope=this.node.parent.getGraphic().getSlopeAtT(this.getLineTValue());offset=slope.rotate(Math.PI/2).scale(this.getLinePerpValue())}this.style.x=offset.x+linePoint.x-this.style.width/2;this.style.y=offset.y+linePoint.y-this.style.height/2}},getLines:function(){return this._lines},setLines:function(lines){this._lines=lines;this.markDirty()},getValign:function(){return this._valign},setValign:function(valign){this._valign=valign;this.markDirty()},getHalign:function(){var html;html=this.getHTML();return $(html).css("text-align")},setHalign:function(halign){var html;html=this.getHTML();html=$("<div>").append($(html).css("text-align",halign)).html();this.setHTML(html,true);this.markDirty()},getFirstColor:function(){var $elementWithColor,$html;$html=$(this.getHTML());$elementWithColor=_gliffy.TextUtils.findFirstElementWithColor($html);return $elementWithColor.css("color")||"rgb(0, 0, 0)"},setFirstColor:function(color){var $elementWithColor,html,$html;$html=$(this.getHTML());$elementWithColor=_gliffy.TextUtils.findFirstElementWithColor($html);$elementWithColor.css("color",color);html=$("<div>").append($html).html();this.setHTML(html,true);this.markDirty()},setLineTValue:function(ratio){this._lineTValue=ratio;this.markDirty()},getLineTValue:function(){return(this._lineTValue!==null?this._lineTValue:0.5)},setLinePerpValue:function(px){this._linePerpValue=px},getLinePerpValue:function(){return(this._linePerpValue!==null?this._linePerpValue:0)},isCardinality:function(){return this._cardinalityType!==null},setCardinality:function(cardinalityType){this._cardinalityType=cardinalityType},getCardinality:function(){return this._cardinalityType},getOverflow:function(){return this._overflow},setOverflow:function(overflow){this._overflow=overflow;this.markDirty()},hasFixedWidth:function(){return !(this.getOverflow()===OVERFLOW.left||this.getOverflow()===OVERFLOW.right||this.getOverflow()===OVERFLOW.both)},getVPosition:function(){return this._vposition},setVPosition:function(vposition){this._vposition=vposition;this.markDirty()},setHTML:function(html,raw){if(raw!==true){html=_gliffy.TextUtils.validateAndFix(html);html=_gliffy.TextUtils.adjustHeightsAndColor(html)}this._html=html;this._hashCode=_gliffy.Utils.hashCode(this._html);if(this.node){this.node.setFlag("bounds")}this.markDirty()},getHTML:function(){return this._html||""},setContentHTML:function(html){var junk=$("<div>"+this._html+"</div>");$(junk[0].firstChild.firstChild).html(html);this.setHTML($(junk).html(),true)},getHPosition:function(){return this._hposition},setHPosition:function(hposition){this._hposition=hposition;this.markDirty()},getTid:function(){return TID},getClassName:function(){return"Text"},getNodeText:function(){var temporaryHtmlContainer,allInnerSpans,nodeText;temporaryHtmlContainer=document.createElement("div");temporaryHtmlContainer.innerHTML=this.getHTML();allInnerSpans=$("span",temporaryHtmlContainer);if(allInnerSpans.length>0){nodeText=allInnerSpans[0].textContent}return nodeText},setNodeText:function(text){var temporaryHtmlContainer,allInnerSpans;temporaryHtmlContainer=document.createElement("div");temporaryHtmlContainer.innerHTML=this.getHTML();allInnerSpans=$("span",temporaryHtmlContainer);if(allInnerSpans[0]){allInnerSpans[0].textContent=text;this.setHTML($(temporaryHtmlContainer).html())}else{this.setHTML("")}},getHtmlStyle:function(){var html,allInnerSpans,font="Ariel",weight="",size="12px",color="",textDecoration="",fontStyle="";html=this.getHTML();allInnerSpans=$("span",html);$.each(allInnerSpans,function(_,innerSpan){if($(innerSpan).text()){font=_gliffy.Utils.getRenderedStyle($(innerSpan),"font-family");weight=_gliffy.Utils.getRenderedStyle($(innerSpan),"font-weight");size=_gliffy.Utils.getRenderedStyle($(innerSpan),"font-size");color=_gliffy.Utils.getRenderedStyle($(innerSpan),"color");textDecoration=_gliffy.Utils.getRenderedStyle($(innerSpan),"text-decoration");fontStyle=_gliffy.Utils.getRenderedStyle($(innerSpan),"font-style");return false}});return{font:font,weight:weight,size:size,color:color,textDecoration:textDecoration,fontStyle:fontStyle}},applyStyleToHtml:function(style){var html=this.getHTML(),$temporaryHtmlContainer=$(document.createElement("div")),paragraphs,combinedText,$div,$paragraph,$outerSpan;$temporaryHtmlContainer.html(html);paragraphs=$temporaryHtmlContainer.find("p");combinedText=_.reduce(paragraphs,function(combinedText,paragraph){return combinedText+" "+$(paragraph).text()},"");if(combinedText&&style){$div=$(document.createElement("div"));$paragraph=$(document.createElement("p"));$outerSpan=$(document.createElement("span"));$paragraph.css({"text-align":"center"});$outerSpan.css({"font-family":style.font,"font-weight":style.weight,"font-size":style.size,color:style.color,"text-decoration":style.textDecoration,"font-style":style.fontStyle});$outerSpan.html(combinedText);$paragraph.append($outerSpan);$div.append($paragraph);this.setHTML($div.html())}else{this.setHTML(combinedText)}},isComputePositioning:function(){return this.__computePositioning},positionComputed:function(){this.__computePositioning=false},isStandalone:function(){return this.node&&this.node.isStandAloneText()},hasLineParent:function(){return this.hasParentOfType(_gliffy.Line)},setOuterPaddingLeft:function(outerPaddingLeft){this.__outer_padding_left=outerPaddingLeft},setOuterPaddingRight:function(outerPaddingRight){this.__outer_padding_right=outerPaddingRight},setOuterPaddingTop:function(outerPaddingTop){this.__outer_padding_top=outerPaddingTop},setOuterPaddingBottom:function(outerPaddingBottom){this.__outer_padding_bottom=outerPaddingBottom},getOuterPaddingLeft:function(){if(this.__outer_padding_top===null){return this.__legacyOuterPadding.left}else{return this.__outer_padding_top}},getOuterPaddingRight:function(){if(this.__outer_padding_right===null){return this.__legacyOuterPadding.right}else{return this.__outer_padding_right}},getOuterPaddingTop:function(){if(this.__outer_padding_top===null){return this.__legacyOuterPadding.top}else{return this.__outer_padding_top}},getOuterPaddingBottom:function(){if(this.__outer_padding_bottom===null){return this.__legacyOuterPadding.bottom}else{return this.__outer_padding_bottom}},hasLink:function(){return $(this._html).find("a").length!==0},getLinks:function(){var text=this.getHTML(),anchors=$(text).find("a");return $.map(anchors,function(anchor){return $(anchor).attr("href")})},setPaddingLeft:function(paddingLeft){this.__padding_left=paddingLeft},setPaddingRight:function(paddingRight){this.__padding_right=paddingRight},setPaddingTop:function(paddingTop){this.__padding_top=paddingTop},setPaddingBottom:function(paddingBottom){this.__padding_bottom=paddingBottom},getPaddingLeft:function(){return this.__padding_left},getPaddingRight:function(){return this.__padding_right},getPaddingTop:function(){return this.__padding_top},getPaddingBottom:function(){return this.__padding_bottom},getPosition:function(){var vPosition=this.getVPosition(),hPosition=this.getHPosition();if(vPosition===VPOSITION.above&&hPosition===HPOSITION.none){return"above"}if(vPosition===VPOSITION.below&&hPosition===HPOSITION.none){return"below"}if(vPosition===VPOSITION.none&&hPosition===HPOSITION.right){return"right"}if(vPosition===VPOSITION.none&&hPosition===HPOSITION.left){return"left"}if(vPosition===VPOSITION.none&&hPosition===HPOSITION.none){return"center"}_gliffy.Logger.warn("warning cannot find position in text.getPosition()");return null},setPosition:function(position,skipHalign){var hAlign,hPosition,overflow,vAlign,vPosition;switch(position){case"above":vPosition="above";hPosition="none";vAlign="bottom";hAlign="center";overflow="both";break;case"below":vPosition="below";hPosition="none";vAlign="top";hAlign="center";overflow="both";break;case"right":vPosition="none";hPosition="right";vAlign="middle";hAlign="left";overflow="right";break;case"left":vPosition="none";hPosition="left";vAlign="middle";hAlign="right";overflow="left";break;case"center":vPosition="none";hPosition="none";vAlign="middle";hAlign="center";overflow="both";break}this.setVPosition(vPosition);this.setHPosition(hPosition);this.setValign(vAlign);hAlign=skipHalign?this.getHalign():hAlign;this.setHalign(hAlign,{skipCommandRegistration:true});overflow=this.getOverflow()==="none"?"none":overflow;this.setOverflow(overflow);this.node.setFlag("bounds");this.markDirty()},runCallbackWhileEditing:function(overlay,callback){var $content,rte;rte=$("#gliffy-edit-text_ifr");if(rte.is(":visible")){$content=$("<div>").append(tinymce.activeEditor.getContent()).appendTo("body");this.editable.setEditMode(false);this.node.stage.commandHistory.addAndExecuteCommand(new _gliffy.SetTextCommand({node:this.node,text:_gliffy.Utils.removeLineBreaks($content.html())}));callback();overlay.editText(this.node)}},__toObject:function(){var obj={tid:this.getTid(),valign:this.getValign(),overflow:this.getOverflow(),vposition:this.getVPosition(),hposition:this.getHPosition(),html:this.getHTML(),paddingLeft:this.getPaddingLeft(),paddingRight:this.getPaddingRight(),paddingBottom:this.getPaddingBottom(),paddingTop:this.getPaddingTop(),outerPaddingLeft:this.getOuterPaddingLeft(),outerPaddingRight:this.getOuterPaddingRight(),outerPaddingBottom:this.getOuterPaddingBottom(),outerPaddingTop:this.getOuterPaddingTop()};if(this._lineTValue!==null){obj.lineTValue=this.getLineTValue()}if(this._linePerpValue!==null){obj.linePerpValue=this.getLinePerpValue()}if(this._cardinalityType!==null){obj.cardinalityType=this.getCardinality()}return obj},__fromObject:function(object){if(object.valign!==undefined&&object.valign!==null){this.setValign(object.valign)}if(object.overflow!==undefined&&object.overflow!==null){this.setOverflow(object.overflow)}if(object.vposition!==undefined&&object.vposition!==null){this.setVPosition(object.vposition)}if(object.hposition!==undefined&&object.hposition!==null){this.setHPosition(object.hposition)}if(object.html!==undefined&&object.html!==null){this.setHTML(object.html)}if(object.paddingLeft!==undefined&&object.paddingLeft!==null){this.setPaddingLeft(object.paddingLeft)}if(object.paddingRight!==undefined&&object.paddingRight!==null){this.setPaddingRight(object.paddingRight)}if(object.paddingBottom!==undefined&&object.paddingBottom!==null){this.setPaddingBottom(object.paddingBottom)}if(object.paddingTop!==undefined&&object.paddingTop!==null){this.setPaddingTop(object.paddingTop)}if(object.outerPaddingLeft!==undefined&&object.outerPaddingLeft!==null){this.setOuterPaddingLeft(object.outerPaddingLeft)}if(object.outerPaddingRight!==undefined&&object.outerPaddingRight!==null){this.setOuterPaddingRight(object.outerPaddingRight)}if(object.outerPaddingBottom!==undefined&&object.outerPaddingBottom!==null){this.setOuterPaddingBottom(object.outerPaddingBottom)}if(object.outerPaddingTop!==undefined&&object.outerPaddingTop!==null){this.setOuterPaddingTop(object.outerPaddingTop)}if(object.linePerpValue!==undefined&&object.linePerpValue!==null){this.setLinePerpValue(object.linePerpValue)}if(object.lineTValue!==undefined&&object.lineTValue!==null){this.setLineTValue(object.lineTValue)}if(object.cardinalityType!==undefined&&object.cardinalityType!==null){this.setCardinality(object.cardinalityType)}this.__computePositioning=true;return this}})}());(function(){var DEFAULT_STYLE={gradient_x1:"0%",gradient_x2:"0%",gradient_y1:"100%",gradient_y2:"-50%",stop_color_2:"#FFFFFF",zoom:1,stroke_dasharray:[Number.MAX_VALUE],stroke_linejoin:"miter",rx:10,ry:10};_gliffy.Shape=_gliffy.AbstractGeometry.extend({_tid:null,_fillColor:"#aaaaaa",_gradient:false,_opacity:1,style:null,node:null,svg:null,_dirty:true,_state:0,init:function(){this.style=$.extend({},DEFAULT_STYLE)},setTid:function(tid){this._tid=tid;this.style=$.extend({},DEFAULT_STYLE);this.markDirty()},getTid:function(){return this._tid},setFillColor:function(fillColor){this._fillColor=fillColor;if(this._fillColor==="none"){this._gradient=false}this.markDirty()},getFillColor:function(){return this._fillColor},setGradient:function(gradient){this._gradient=this._fillColor!=="none"&&gradient;this.markDirty()},getGradient:function(){return this._gradient},setDashStyle:function(dashArray,deserializing){if(this.hasMutable("dashStyle")||deserializing){if(dashArray instanceof Array){this.style.stroke_dasharray=dashArray}else{if(!dashArray||dashArray==="null"){this.style.stroke_dasharray=[Number.MAX_VALUE]}else{if(typeof dashArray==="string"){this.style.stroke_dasharray=$.map(dashArray.split(","),function(element){return parseFloat(element)})}}}this.markDirty()}return this.style.stroke_dasharray},getDashStyle:function(serializing){var dashStyle;if(serializing&&this.style.stroke_dasharray[0]>Number.MAX_VALUE/2){dashStyle=null}else{if(serializing){dashStyle=(this.style.stroke_dasharray||this.setDashStyle(null)).join(",")}else{dashStyle=this.style.stroke_dasharray||this.setDashStyle(null)}}return dashStyle},getMutableProperties:function(){if(this.node instanceof _gliffy.Node){return this.node.getShapeInformation().mutableProperties}else{return[]}},hasMutable:function(style){var mutableProperties;mutableProperties=this.getMutableProperties();return mutableProperties&&$.inArray(style,mutableProperties)>-1},isGradient:function(){return this.getGradient()},setOpacity:function(opacity){if(opacity!==this._opacity){this._opacity=opacity;this.markDirty()}},getOpacity:function(){return this._opacity},getState:function(){return this._state},setState:function(s){this._state=s;this.markDirty()},update:function(){var width=0,height=0,i=0,states;if(this._dirty){if(this.node){this.style.width=this.node.getWidth();this.style.height=this.node.getHeight()}this.style.opacity=this.getOpacity();this.style.stroke=this._strokeColor;this.style.gradient=this.getGradient();this.style.shadow=this.isDropShadow();if(this._fillColor!=="none"&&this.style.gradient){this.style.stop_multiply_color_2=_gliffy.ColorUtils.multiply(this._fillColor,"#AAAAAA")}this.style.fill=this._fillColor;this.style.stop_color_1=this._fillColor;this.style.center_x=width/2;this.style.center_y=height/2;if(this.node){states=this.node.getShapeInformation().states;if(states){for(i=0;i<states;i++){this.style["state"+i]=false}this.style["state"+this.getState()]=true}else{if(this.getState()===1){this.style.state0=false;this.style.state1=true}}}this.calculateStrokeOffset();this._dirty=false;return true}return false},getClassName:function(){return"Shape"},calculateGradientCoordinates:function(){var coords,width,height,rotation;if(this.node){width=this.node.getWidth();height=this.node.getHeight();rotation=this.node.getRotation()%360;if(rotation>135&&rotation<=225){coords={x1:"50%",y1:"150%",x2:"50%",y2:"0%"}}else{if(rotation>45&&rotation<=135){coords={x1:"-50%",y1:"50%",x2:"100%",y2:"50%"}}else{if(rotation>225&&rotation<=315){coords={x1:"150%",y1:"50%",x2:"0%",y2:"50%"}}else{coords={x1:"50%",y1:"-50%",x2:"50%",y2:"100%"}}}}}return coords},calculateStrokeOffset:function(){var width,height,maxMiter,shadow_offset;if(this.node){width=this.node?this.node.getWidth():0;height=this.node?this.node.getHeight():0;this.style.stroke_width=this.getStrokeWidth();maxMiter=this.maxMiterLength();this.style.graphic_width=width+maxMiter+2+this.style.stroke_width;this.style.graphic_height=height+maxMiter+2+this.style.stroke_width;shadow_offset=this.calculateShadowOffset();this.style.shadow_x=shadow_offset.x;this.style.shadow_y=shadow_offset.y;this.style.graphic_width=this.style.shadow?Math.abs(this.style.shadow_x)+this.style.graphic_width:this.style.graphic_width;this.style.graphic_height=this.style.shadow?Math.abs(this.style.shadow_y)+this.style.graphic_height:this.style.graphic_height;this.style.graphic_x_offset=maxMiter/2+-1*Math.min(shadow_offset.x,0);this.style.graphic_y_offset=maxMiter/2+-1*Math.min(shadow_offset.y,0);this.style.line_offset_x=0;this.style.line_offset_y=0;this.style.stroke_offset=this.style.stroke_width/2;if(_gliffy.shapeLibrary){_gliffy.shapeLibrary.customFunction(this.getTid(),this.style)}this.style.offset_x=this.style.graphic_x_offset+this.style.stroke_offset;this.style.offset_y=this.style.graphic_y_offset+this.style.stroke_offset}},maxMiterLength:function(){var defaultCanvasMiterLimit=10;return defaultCanvasMiterLimit*this.style.stroke_width},__toObject:function(){var dashStyle,returnObject;returnObject={tid:this.getTid(),strokeWidth:this.getStrokeWidth(),strokeColor:this.getStrokeColor(),fillColor:this.getFillColor(),gradient:this.isGradient(),dropShadow:this.isDropShadow(),state:this.getState(),shadowX:this.getShadowX(),shadowY:this.getShadowY(),opacity:this.getOpacity()};dashStyle=this.getDashStyle({serializing:true});if(dashStyle){returnObject.dashStyle=dashStyle}return returnObject},applyStyle:function(style){if(style==null){return}var shadowSize;this.setGradient(style.gradient);this.setDropShadow(style.shadow);this.setFillColor(style.fill);if(style.strokeWidth!==undefined&&style.strokeWidth!==null&&style.strokeWidth!=="null"){this.setStrokeWidth(style.strokeWidth)}if(style.stroke){this.setStrokeColor(style.stroke)}if(style.dashStyle){this.setDashStyle(style.dashStyle)}if(style.opacity){this.setOpacity(style.opacity)}if(style.shadow){this.setDropShadow(style.shadow)}},__fromObject:function(object){if(object.tid!==undefined){this.setTid(object.tid)}if(object.strokeWidth!==undefined){this.setStrokeWidth(object.strokeWidth)}if(object.strokeColor!==undefined){this.setStrokeColor(object.strokeColor)}if(object.dashStyle!==undefined){this.setDashStyle(object.dashStyle,{deserializing:true})}if(object.fillColor!==undefined){this.setFillColor(object.fillColor)}if(object.gradient!==undefined){this.setGradient(object.gradient)}if(object.dropShadow!==undefined){this.setDropShadow(object.dropShadow)}if(object.shadowX!==undefined){this.setShadowX(object.shadowX)}if(object.shadowY!==undefined){this.setShadowY(object.shadowY)}if(object.opacity!==undefined){this.setOpacity(object.opacity)}if(object.state!==undefined){this.setState(object.state)}return this}})}());(function(){_gliffy.MINDMAP_COLOR_SCHEME_GENERATION="generation";_gliffy.MINDMAP_COLOR_SCHEME_FAMILY="family";_gliffy.MINDMAP_SCHEME_NODE_TREE={family:[{uid:"com.gliffy.shape.mindmap.mindmap_v1.default.main_topic"},{uid:"com.gliffy.shape.mindmap.mindmap_v1.default.subtopic",fill:"line"},{uid:"com.gliffy.shape.mindmap.mindmap_v1.default.child_node"}],generation:[{uid:"com.gliffy.shape.mindmap.mindmap_v1.default.main_topic"},{uid:"com.gliffy.shape.mindmap.mindmap_v1.default.subtopic",fill:"line"},{uid:"com.gliffy.shape.mindmap.mindmap_v1.default.child_node"}]};_gliffy.Mindmap=_gliffy.Shape.extend({__rootNodeId:null,__parentNodeId:null,__childNodeIds:null,__treeDepth:0,__colorScheme:"family",__colorPalette:null,isCollapsed:false,getTreeDepth:function(){return this.__treeDepth},setTreeDepth:function(treeDepth){this.__treeDepth=treeDepth},getRootNodeId:function(){return this.__rootNodeId},setRootNodeId:function(rootNodeId){this.__rootNodeId=rootNodeId},getParentNodeId:function(){return this.__parentNodeId},setParentNodeId:function(parentNodeId){this.__parentNodeId=parentNodeId},getChildNodeIds:function(){if(this.__childNodeIds===null){this.__childNodeIds=[]}return this.__childNodeIds},setChildNodeIds:function(childNodeIds){this.__childNodeIds=childNodeIds},addChildNodeId:function(id){if(this.getChildNodeIds().indexOf(id)<0){this.getChildNodeIds().push(id)}},removeChildNodeId:function(id){if(this.__childNodeIds&&this.__childNodeIds.length>0){this.__childNodeIds.splice(this.__childNodeIds.indexOf(id),1)}},getColorScheme:function(){return this.__colorScheme},setColorScheme:function(colorScheme){this.__colorScheme=colorScheme;this.markDirty()},getColorPalette:function(){if(this.__colorPalette===null&&this.__treeDepth===0){this.__colorPalette=["#688a4f","#235695","#ff9900","#cc0000","#6342b8","#a64d79","#5b0f00","#666666"]}return this.__colorPalette},setColorPalette:function(colorPalette){this.__colorPalette=colorPalette;this.markDirty()},getClassName:function(){return"Mindmap"},removeNode:function(commandBundle){var stage=this.node.stage,parent,parentGraphic,childNodeIds;parent=stage.find(this.getParentNodeId());if(parent){this.getMindmapGraphic(parent).removeChildNodeId(this.node.getRootParent().getId())}this.getConnectedLines({commandBundle:commandBundle,removeConnectedLine:true});if(this.__childNodeIds){childNodeIds=this.__childNodeIds.slice();this.__removeChildren(childNodeIds,commandBundle)}},getConnectedLines:function(o){var i,options=$.extend({},{removeConnectedLine:false,commandBundle:null,ignoreLinesTo:false,ignoreLinesFrom:false},o),stage=this.node.stage,lines=stage.findGraphic(_gliffy.Line),line,connectionEndId,connectionStartId,topLevelNodeId,removeConnectedLine=options.removeConnectedLine,commandBundle=options.commandBundle,connectedLines=[];if(lines){for(i=0;i<lines.length;i++){line=lines[i].getGraphic();connectionEndId=line.getEndConnectionId();connectionStartId=line.getStartConnectionId();topLevelNodeId=this.node.getRootParent().getId();if((!options.ignoreLinesTo&&topLevelNodeId===connectionEndId)||(!options.ignoreLinesFrom&&topLevelNodeId===connectionStartId)){connectedLines.push(line.node);if(removeConnectedLine&&commandBundle){commandBundle.push(new _gliffy.RemoveNodeCommand({node:line.node}))}}}}return connectedLines},__removeChildren:function(childNodeIds,commandBundle){var i,stage=this.node.stage,child;if(childNodeIds){for(i=0;i<childNodeIds.length;i++){child=stage.find(childNodeIds[i]);if(child){this.getMindmapGraphic(child).removeNode(commandBundle);if(commandBundle){commandBundle.push(new _gliffy.RemoveNodeCommand({node:child}))}}}}},getMindmapGraphic:function(node){return node.findGraphic(_gliffy.Mindmap)[0].getGraphic()},addNode:function(stage){var self=this,parent,parentGraphic;setTimeout(function(){parent=stage.find(self.getParentNodeId());if(parent){self.getMindmapGraphic(parent).addChildNodeId(self.node.getRootParent().getId());self.setChildNodeIds(null)}},100)},getChildrenNodes:function(o){var options=$.extend({},{includeConnectedLines:false,excludeCollapsed:false},o),childrenNodes=[],i,childNode,childNodeGraphic;if(this.__childNodeIds){for(i=0;i<this.__childNodeIds.length;i++){childNode=this.node.stage.find(this.__childNodeIds[i]);if(childNode){childrenNodes.push(childNode);childNodeGraphic=this.getMindmapGraphic(childNode);if(options.excludeCollapsed&&childNodeGraphic.isCollapsed){if(options.includeConnectedLines){childrenNodes=childrenNodes.concat(childNodeGraphic.getConnectedLines({ignoreLinesFrom:true}))}}else{if(options.includeConnectedLines){childrenNodes=childrenNodes.concat(childNodeGraphic.getConnectedLines())}childrenNodes=childrenNodes.concat(this.getMindmapGraphic(childNode).getChildrenNodes(o))}}}}return childrenNodes},__toObject:function(){var o=this._super();o.rootNodeId=this.__rootNodeId;o.parentNodeId=this.__parentNodeId;o.childNodeIds=this.__childNodeIds;o.colorScheme=this.__colorScheme;o.treeDepth=this.__treeDepth;o.colorPalette=this.__colorPalette;return o},__fromObject:function(object){this._super(object);if(object.rootNodeId!==undefined){this.setRootNodeId(object.rootNodeId)}if(object.parentNodeId!==undefined){this.setParentNodeId(object.parentNodeId)}if(object.childNodeIds!==undefined){this.setChildNodeIds(object.childNodeIds)}if(object.colorScheme!==undefined){this.setColorScheme(object.colorScheme)}if(object.treeDepth!==undefined){this.setTreeDepth(object.treeDepth)}if(object.colorPalette!==undefined){this.setColorPalette(object.colorPalette)}return this}})}());(function(){var DEFAULT_STYLE={zoom:1,stroke_linejoin:"miter"},TID="com.gliffy.stencil.custom.svg.static";_gliffy.Svg=_gliffy.AbstractGeometry.extend({_url:null,style:null,node:null,_dirty:true,embeddedResourceId:null,init:function(node){this.node=node;this.style=$.extend({},DEFAULT_STYLE)},markDirty:function(){this._dirty=true;if(this.node){this.node.markDirty()}},getTid:function(){return TID},getEmbeddedResourceId:function(){return this.embeddedResourceId},setEmbeddedResourceId:function(id){this.embeddedResourceId=id;this.markDirty();if(this.node){this.node.setFlag("skin")}},setShadowX:function(shadowX){this._shadowX=shadowX;this.markDirty()},getShadowX:function(){return this._shadowX},setShadowY:function(shadowY){this._shadowY=shadowY;this.markDirty()},getShadowY:function(){return this._shadowY},update:function(){if(this._dirty){var width=0,height=0,shadow_offset,maxMiter;if(this.node){width=this.node.getWidth();height=this.node.getHeight();this.style.width=width;this.style.height=height}this.style.center_x=width/2;this.style.center_y=height/2;this.style.graphic_width=(this.node)?this.node.getWidth():0;this.style.graphic_height=(this.node)?this.node.getHeight():0;this.style.stroke_width=10;maxMiter=this.maxMiterLength();this.style.graphic_width=width+maxMiter+2+this.style.stroke_width;this.style.graphic_height=height+maxMiter+2+this.style.stroke_width;shadow_offset=this.calculateShadowOffset();this.style.shadow_x=shadow_offset.x;this.style.shadow_y=shadow_offset.y;this.style.graphic_width=this.style.shadow?Math.abs(this.style.shadow_x)+this.style.graphic_width:this.style.graphic_width;this.style.graphic_height=this.style.shadow?Math.abs(this.style.shadow_y)+this.style.graphic_height:this.style.graphic_height;this.style.graphic_x_offset=maxMiter/2+-1*Math.min(shadow_offset.x,0);this.style.graphic_y_offset=maxMiter/2+-1*Math.min(shadow_offset.y,0);this.style.line_offset_x=0;this.style.line_offset_y=0;this.style.stroke_offset=this.style.stroke_width/2;this.style.offset_x=this.style.graphic_x_offset+this.style.stroke_offset;this.style.offset_y=this.style.graphic_y_offset+this.style.stroke_offset;this._dirty=false;return true}return false},maxMiterLength:function(){var defaultCanvasMiterLimit=10;return defaultCanvasMiterLimit*this.style.stroke_width},getClassName:function(){return"Svg"},__toObject:function(){return{embeddedResourceId:this.getEmbeddedResourceId(),strokeWidth:this.getStrokeWidth(),strokeColor:this.getStrokeColor(),dropShadow:this.isDropShadow(),shadowX:this.getShadowX(),shadowY:this.getShadowY()}},__fromObject:function(object){if(object.embeddedResourceId!==undefined){this.setEmbeddedResourceId(object.embeddedResourceId)}if(object.strokeWidth!==undefined){this.setStrokeWidth(object.strokeWidth)}if(object.strokeColor!==undefined){this.setStrokeColor(object.strokeColor)}if(object.dropShadow!==undefined){this.setDropShadow(object.dropShadow)}if(object.shadowX!==undefined){this.setShadowX(object.shadowX)}if(object.shadowY!==undefined){this.setShadowY(object.shadowY)}}})}());(function(){var DEFAULT_STYLE={text_background:true,text_background_fill:true,start_arrow:"none",end_arrow:"none",zoom:1,stroke_dasharray:null,stroke_linejoin:"miter"},TID="path",START_MARKER="start",END_MARKER="end",ARROW_SIZE=10,INTERPOLATION_TYPE={linear:0,quadratic:1},INTERPOLATION_LOOKUP={0:"linear",1:"quadratic"};_gliffy.Line=_gliffy.Graphic.extend({_strokeWidth:2,_strokeColor:"#000000",_fillColor:"none",_fillId:null,_dashStyle:null,_startArrow:null,_endArrow:null,_pointPath:null,_drawCommands:null,_centerLinePoint:null,_startArrowRotation:"auto",_endArrowRotation:"auto",_interpolationType:INTERPOLATION_TYPE.linear,_ortho:false,_length:0,_controlPath:null,style:null,node:null,aabb:null,_dirty:true,OVERLAY_EXTEND:7,OVERLAY_DISPLAY_EXTEND:5,LINE_TYPE_STRAIGHT:"straight",LINE_TYPE_ORTHO_RIGHT_ANGLE:"ortho-right-angle",LINE_TYPE_ORTHO_ROUNDED:"ortho-rounded",LINE_TYPE_QUADRATIC_BEZIER:"quad-bezier",LINE_TYPE_ICON_MAP:{straight:"icon gliffy-icon-properties-button-straight",ortho_right_angle:"icon gliffy-icon-properties-button-ortho-right-angle",ortho_rounded:"icon gliffy-icon-properties-button-ortho-rounded",quad_bezier:"icon gliffy-icon-properties-button-quad-bezier"},_overlay:false,init:function(node,start,end){this.node=node;this.style=$.extend({},DEFAULT_STYLE);this.setLocalAabb(_gliffy.BoundingBox());if(start&&end){this._controlPath=[[start.x,start.y],[end.x,end.y]]}else{this._controlPath=[[0,0],[0,0]]}this._super()},getTid:function(){return TID},getLineStyle:function(){var style;style=new _gliffy.LineStyle();style.strokeWidth=this.getStrokeWidth();style.stroke=this.getStrokeColor();style.fill=this.getFillColor();style.dashStyle=this.getDashStyle();style.startArrow=this.getStartArrow();style.endArrow=this.getEndArrow();return style},setStartArrow:function(startArrow){this._startArrow=startArrow;this.markDirty()},getStartArrowTid:function(){if(this._startArrow!==0&&this._startArrow!==null&&this._startArrow!==undefined&&this._startArrow!=="none"){return"com.gliffy.stencil.marker_start.v"+this._startArrow}return null},getEndArrowTid:function(){if(this._endArrow!==0&&this._endArrow!==null&&this._endArrow!==undefined&&this._endArrow!=="none"){return"com.gliffy.stencil.marker_end.v"+this._endArrow}return null},setStartArrowRotation:function(rotation){this._startArrowRotation=rotation;this.markDirty()},getStartArrowRotation:function(){return this._startArrowRotation},setEndArrowRotation:function(rotation){this._endArrowRotation=rotation;this.markDirty()},getEndArrowRotation:function(){return this._endArrowRotation},getStartArrow:function(){if(this._startArrow==="none"||this._startArrow===null||this._startArrow===undefined){this._startArrow=0}return this._startArrow},setEndArrow:function(endArrow){this._endArrow=endArrow;this.markDirty()},getEndArrow:function(){if(this._endArrow==="none"||this._endArrow===null||this._endArrow===undefined){this._endArrow=0}return this._endArrow},setStrokeWidth:function(strokeWidth){this._strokeWidth=strokeWidth;if(strokeWidth<3){this.setFillColor(null)}if(this.node){this.node.setFlag("bounds")}this.markDirty()},getStrokeWidth:function(){return this._strokeWidth},setStrokeColor:function(strokeColor){this._strokeColor=strokeColor;this.markDirty()},getStrokeColor:function(){return this._strokeColor},setFillColor:function(fillColor){this._fillColor=fillColor;if(this._fillColor===null){this._fillColor="none"}this.markDirty()},getFillColor:function(){return this._fillColor},getStartConnectionId:function(){var constraint;if(this.node){constraint=this.node.getConstraints().getStartConstraint();if(constraint){return constraint.nodeId}else{return null}}else{return null}},getEndConnectionId:function(){var constraint;if(this.node){constraint=this.node.getConstraints().getEndConstraint();if(constraint){return constraint.nodeId}else{return null}}else{return null}},setStartConnection:function(node,ratio){var worldStartPoint;if(node){if(!ratio){worldStartPoint=this.getWorldControlPoint(0);ratio=node.worldPointToRatio(worldStartPoint.x,worldStartPoint.y)}this.node.getConstraints().add(new _gliffy.StartPositionConstraint(node,ratio.x,ratio.y))}else{this.node.getConstraints().removeStartConstraint()}this.markDirty()},getStartConnection:function(){var startConnectionId=this.getStartConnectionId(),node;if(startConnectionId!==null&&this.node&&this.node.stage){node=this.node.stage.find(startConnectionId);if(node&&node.hasConnectionIndices()){return node}}return null},getStartConnectionRatio:function(){var constraint=this.node.getConstraints().getStartConstraint();if(constraint){return constraint.getRatio()}else{return null}},setEndConnection:function(node,ratio){var worldEndPoint;if(node){if(!ratio){worldEndPoint=this.getWorldControlPoint(this.getControlPointCount()-1);ratio=node.worldPointToRatio(worldEndPoint.x,worldEndPoint.y)}this.node.getConstraints().add(new _gliffy.EndPositionConstraint(node,ratio.x,ratio.y))}else{this.node.getConstraints().removeEndConstraint()}this.markDirty()},connectedToUML2:function(){var startConnection=this.getStartConnection(),endConnection=this.getEndConnection();return((startConnection&&startConnection.isUML2())||(endConnection&&endConnection.isUML2()))},connectedToBPMN:function(){var startConnection=this.getStartConnection(),endConnection=this.getEndConnection();return((startConnection&&startConnection.isBPMN())||(endConnection&&endConnection.isBPMN()))},connectedToERD:function(){var startConnection=this.getStartConnection(),endConnection=this.getEndConnection();return((startConnection&&startConnection.isERD())||(endConnection&&endConnection.isERD()))},getEndConnectionRatio:function(){var constraint=this.node.getConstraints().getEndConstraint();if(constraint){return constraint.getRatio()}else{return null}},getEndConnection:function(){var endConnectionId=this.getEndConnectionId(),node;if(endConnectionId!==null&&this.node&&this.node.stage){node=this.node.stage.find(endConnectionId);if(node&&node.hasConnectionIndices()){return node}}return null},setDashStyle:function(dashStyle){this._dashStyle=dashStyle;this.markDirty()},setOverlay:function(overlay){this._overlay=overlay;this.markDirty()},getOverlay:function(){return this._overlay},getDashStyle:function(){return this._dashStyle},__getStrokePadding:function(){return Math.ceil(this.style.stroke_width+this.OVERLAY_EXTEND)/2},update:function(){if(this._dirty){var stage=null,background="#ffffff",width=0,height=0,padding,dashes,i;if(this.editable.isEditable&&this.node){this.editable.scaleControlPath(this.node.getScaleX(),this.node.getScaleY());this.editable.computeBestPath()}this._clearArrowMarkerAttributes(START_MARKER,this.style.start_arrow);this._clearArrowMarkerAttributes(END_MARKER,this.style.end_arrow);this.style.stroke=this._strokeColor;this.style.fill=this._fillColor;this.style.stroke_width=this.getStrokeWidth();if(this._dashStyle){dashes=this._dashStyle.split(",");for(i=0;i<dashes.length;i++){dashes[i]=parseFloat(dashes[i])*this.style.stroke_width}this.style.stroke_dasharray=dashes.join(",")}else{this.style.stroke_dasharray=null}this.style.start_arrow=this._startArrow||"none";this.style.end_arrow=this._endArrow||"none";this.style.start_arrow_tid=this.getStartArrowTid();this.style.end_arrow_tid=this.getEndArrowTid();this.setLocalAabb(this.getControlPathAabb(true));this.setWorldAabb(this.getWorldAabb(true));if(this.node){width=this.node.getWidth();height=this.node.getHeight();if(this.node.stage){stage=this.node.stage;background=stage.background}this.style.width=width;this.style.height=height}this.style.marker_fill=(background!=="transparent"?background:"#FFFFFF");this.style.center_x=width/2;this.style.center_y=height/2;this._drawCommands=this._generateDrawCommands();this._pointPath=_gliffy.Utils.buildPointsPathFromDrawingCommand(this._drawCommands);this._length=_gliffy.candash.getPathDistance(this._pointPath);if(this.editable.isEditable&&this.getInterpolationType()===INTERPOLATION_TYPE.quadratic){this.setStartArrowRotation(this.getQuadraticLineAngleAtStartPoint());this.setEndArrowRotation(this.getQuadraticLineAngleAtEndPoint())}else{this.setStartArrowRotation("auto");this.setEndArrowRotation("auto")}this.calculateStrokeOffset();this._dirty=false;return true}return false},calculateStrokeOffset:function(){if(this.node&&this.node.stage){var worldAabb,dimension;this.generateArrowMarkerAttributes(START_MARKER,this.style.start_arrow);this.generateArrowMarkerAttributes(END_MARKER,this.style.end_arrow);worldAabb=this.getWorldAabb();dimension=worldAabb.getDimension();this.style.width=dimension.x;this.style.height=dimension.y;this.style.stroke_offset=0;this.style.offset_x=this.node.worldTransform.getTranslateX()-worldAabb.min.x;this.style.offset_y=this.node.worldTransform.getTranslateY()-worldAabb.min.y;this.style.pos_x=this.node.worldTransform.getTranslateX();this.style.pos_y=this.node.worldTransform.getTranslateY();this.style.graphic_width=dimension.x;this.style.graphic_height=dimension.y}},maxMiterLength:function(){var defaultCanvasMiterLimit=10;return defaultCanvasMiterLimit*this.style.stroke_width},getClassName:function(){return"Line"},_clearArrowMarkerAttributes:function(arrowPos,arrowType){if(arrowType){delete this.style["marker_"+arrowPos+"_url"];delete this.style[arrowType+"_"+arrowPos];delete this.style["marker_"+arrowPos+"_width"];delete this.style["marker_"+arrowPos+"_height"];delete this.style["marker_"+arrowPos+"_viewbox"];delete this.style["marker_"+arrowPos+"_orient"];delete this.style["marker_"+arrowPos+"_clearx"];delete this.style["marker_"+arrowPos+"_cleary"];delete this.style["marker_"+arrowPos+"_refx"];delete this.style["marker_"+arrowPos+"_refy"]}},generateArrowMarkerAttributes:function(arrowPos,arrowType){var w,h;this.style["marker_"+arrowPos+"_url"]=(arrowType!=="none")?"url(#"+arrowType+"_"+arrowPos+")":"none";this.style["marker_"+arrowPos+"_orient"]=(arrowPos==="start")?this.getStartArrowRotation():this.getEndArrowRotation();this.style[arrowType+"_"+arrowPos]=true;if(arrowType!=="none"){this.style["marker_"+arrowPos+"_viewbox"]="0 0 10 10";if(arrowType===1){this.style["marker_"+arrowPos+"_width"]=(this.style.stroke_width===1?20:10);this.style["marker_"+arrowPos+"_height"]=(this.style.stroke_width===1?20:10)}else{if(arrowType===2||arrowType===3){w=22-4*this.style.stroke_width;h=22-4*this.style.stroke_width;this.style["marker_"+arrowPos+"_width"]=Math.max(10,w);this.style["marker_"+arrowPos+"_height"]=Math.max(10,h)}else{if(arrowType===17){if(this.style.stroke_width<4){w=30-5*this.style.stroke_width;h=30-5*this.style.stroke_width;this.style["marker_"+arrowPos+"_width"]=Math.max(10,w);this.style["marker_"+arrowPos+"_height"]=Math.max(10,h)}else{this.style["marker_"+arrowPos+"_width"]=10+(10-this.style.stroke_width);this.style["marker_"+arrowPos+"_height"]=10+(10-this.style.stroke_width)}}else{this.style.marker_strokewidth=this.style.stroke_width;if(this.style.stroke_width===1){this.style.marker_viewbox_width=20;this.style.marker_viewbox_height=20;this.style["marker_"+arrowPos+"_width"]=20;this.style["marker_"+arrowPos+"_height"]=20;this.style.marker_start_refx=-1;this.style.marker_end_refx=15}else{this.style["marker_"+arrowPos+"_width"]=(this.style.stroke_width*10);this.style["marker_"+arrowPos+"_height"]=(this.style.stroke_width*10);this.style.marker_viewbox_width=(this.style.stroke_width*10);this.style.marker_viewbox_height=(this.style.stroke_width*10);this.style.marker_start_refx=-1*this.style.stroke_width;this.style.marker_end_refx=14+this.style.stroke_width}}}}if(arrowPos==="start"){if(arrowType===1){this.style.marker_start_cleary=3;this.style.marker_start_clearx=-2}else{if(arrowType===2){this.style.marker_start_cleary=4;this.style.marker_start_clearx=-2}else{if(arrowType===3){this.style.marker_start_cleary=4;this.style.marker_start_clearx=-2}else{if(arrowType===4){this.style.marker_start_cleary=5;this.style.marker_start_clearx=-12}else{if(arrowType===5){this.style.marker_start_cleary=5;this.style.marker_start_clearx=-12}else{if(arrowType===6){this.style.marker_start_cleary=5;this.style.marker_start_clearx=-12}else{if(arrowType===7){this.style.marker_start_cleary=4;this.style.marker_start_clearx=-10}else{if(arrowType===8){this.style.marker_start_cleary=0;this.style.marker_start_clearx=-10}else{if(arrowType===15){this.style.marker_start_cleary=1;this.style.marker_start_clearx=-12}else{if(arrowType===17){this.style.marker_start_cleary=0;this.style.marker_start_clearx=0}}}}}}}}}}}else{if(arrowType===1){this.style.marker_end_cleary=3;this.style.marker_end_clearx=9}else{if(arrowType===2){this.style.marker_end_cleary=4;this.style.marker_end_clearx=7}else{if(arrowType===3){this.style.marker_end_cleary=4;this.style.marker_end_clearx=7}else{if(arrowType===4){this.style.marker_end_cleary=5;this.style.marker_end_clearx=12}else{if(arrowType===5){this.style.marker_end_cleary=5;this.style.marker_end_clearx=12}else{if(arrowType===6){this.style.marker_end_cleary=5;this.style.marker_end_clearx=12}else{if(arrowType===7){this.style.marker_end_cleary=4;this.style.marker_end_clearx=10}else{if(arrowType===8){this.style.marker_end_cleary=0;if(this.style.stroke_width>3){this.style.marker_end_clearx=16}else{this.style.marker_end_clearx=13}}else{if(arrowType===15){this.style.marker_end_cleary=1;this.style.marker_end_clearx=15}else{if(arrowType===17){this.style.marker_end_cleary=0;this.style.marker_end_clearx=2}}}}}}}}}}}}},getControlPathAabb:function(excludeArrows){var boundingBox=_gliffy.BoundingBox.SMALLEST.clone(),controlPath=this.getControlPath(),strokePadding=this.__getStrokePadding(),i;for(i=0;i<controlPath.length;i++){boundingBox.grow(controlPath[i][0],controlPath[i][1])}boundingBox.extend(strokePadding);if(excludeArrows!==true){boundingBox.add(this.getStartArrowAabb());boundingBox.add(this.getEndArrowAabb())}return boundingBox},getWorldAabb:function(excludeArrows){var boundingBox=_gliffy.BoundingBox.SMALLEST.clone(),worldControlPath=this.getWorldControlPath(),i,strokePadding=this.__getStrokePadding();for(i=0;i<worldControlPath.length;i++){boundingBox.grow(worldControlPath[i][0],worldControlPath[i][1])}boundingBox.extend(strokePadding);if(excludeArrows!==true){boundingBox.add(this.getStartArrowWorldAabb());boundingBox.add(this.getEndArrowWorldAabb())}return boundingBox},getStartArrowWorldAabb:function(){var startPoint=this.getWorldControlPoint(0);if(this.style.start_arrow!=="none"){return this.__getArrowWorldAabb(startPoint)}else{return new _gliffy.BoundingBox(startPoint.x,startPoint.y,startPoint.x,startPoint.y)}},getEndArrowWorldAabb:function(){var endPoint=this.getWorldControlPoint(this.getControlPointCount()-1);if(this.style.end_arrow!=="none"){return this.__getArrowWorldAabb(endPoint)}else{return new _gliffy.BoundingBox(endPoint.x,endPoint.y,endPoint.x,endPoint.y)}},__getArrowWorldAabb:function(point){var boundingBox=new _gliffy.BoundingBox(point.x,point.y,point.x,point.y);boundingBox.extend(ARROW_SIZE+this.maxMiterLength());return boundingBox},getStartArrowAabb:function(){var startPoint=this.getControlPoint(0);if(this.style.start_arrow!=="none"){return this.__getArrowAabb(startPoint)}else{return new _gliffy.BoundingBox(startPoint.x,startPoint.y,startPoint.x,startPoint.y)}},getEndArrowAabb:function(){var endPoint=this.getControlPoint(this.getControlPointCount()-1);if(this.style.end_arrow!=="none"){return this.__getArrowAabb(endPoint)}else{return new _gliffy.BoundingBox(endPoint.x,endPoint.y,endPoint.x,endPoint.y)}},__getArrowAabb:function(point){var boundingBox=new _gliffy.BoundingBox(point.x,point.y,point.x,point.y);boundingBox.extend(ARROW_SIZE+this.maxMiterLength());return boundingBox},getControlPoint:function(index){return new _gliffy.Vec2(this._controlPath[index][0],this._controlPath[index][1])},getWorldControlPoint:function(index){var local=this.getControlPoint(index);if(this.node){return this.node.worldTransform.transformPoint(local.x,local.y)}},setControlPoint:function(index,point){if(this._controlPath){this._controlPath[index][0]=point.x;this._controlPath[index][1]=point.y}this.markDirty()},setWorldControlPoint:function(index,worldPoint){var local;if(this.node){local=this.node.worldTransform.createInverse().transformPoint(worldPoint.x,worldPoint.y)}else{local=worldPoint}this.setControlPoint(index,local)},getWorldControlPath:function(){if(this.node){return this.transformPath(this._controlPath,this.node.worldTransform)}else{return this.getControlPath()}},setWorldControlPath:function(worldControlPath){this.setControlPath(this.transformPath(worldControlPath,this.node.worldTransform.createInverse()))},getControlPath:function(){var path=[],i;for(i=0;i<this._controlPath.length;i++){path.push([this._controlPath[i][0],this._controlPath[i][1]])}return path},setControlPath:function(path){if(path){this._controlPath=path}else{this._controlPath=[[0,0],[0,0]]}},getControlPointCount:function(){return this._controlPath.length},getSegmentCount:function(){return this.getControlPointCount()-1},isSegmentHorizontal:function(index){return _gliffy.Utils.isHorizontal(this.getWorldControlPoint(index),this.getWorldControlPoint(index+1))},isLinearLine:function(){var i,numSegments=this.getSegmentCount(),horizontalCount=0,verticalCount=0;for(i=0;i<numSegments;i++){if(this.isSegmentHorizontal(i)){horizontalCount++}else{verticalCount++}}return((horizontalCount===numSegments)||(verticalCount===numSegments))},getNormalizedSegmentAngle:function(p1,p2){var x=0,y=1,dx=p2[x]-p1[x],dy=p2[y]-p1[y],rot=Math.atan(dy/dx)*180/Math.PI;if(p1[x]>p2[x]&&p1[y]<p2[y]){rot=180+rot}else{if(p2[x]<p1[x]&&p2[y]<=p1[y]){rot=180+rot}else{if(p2[x]>=p1[x]&&p2[y]<p1[y]){rot=360+rot}}}return rot},transformPath:function(path,transform){var i,controlPoint,result=[];for(i=0;i<path.length;i++){controlPoint=path[i];controlPoint=transform.transformPoint(controlPoint[0],controlPoint[1]);result.push([controlPoint.x,controlPoint.y])}return result},isOrtho:function(){return this._ortho},setOrtho:function(ortho){this._ortho=ortho;this.markDirty()},getLineType:function(){var lineType=this.LINE_TYPE_STRAIGHT;if(!this._ortho&&this._interpolationType===0&&this._cornerRadius===null){lineType=this.LINE_TYPE_STRAIGHT}else{if(this._ortho&&this._interpolationType===0&&this._cornerRadius===null){lineType=this.LINE_TYPE_ORTHO_RIGHT_ANGLE}else{if(this._ortho&&this._interpolationType===0&&this._cornerRadius===10){lineType=this.LINE_TYPE_ORTHO_ROUNDED}else{if(this._ortho&&this._interpolationType===1&&this._cornerRadius===null){lineType=this.LINE_TYPE_QUADRATIC_BEZIER}}}}return lineType},getInterpolationType:function(){return this._interpolationType},setInterpolationType:function(interpolationType){this._interpolationType=interpolationType;this.markDirty()},getCornerRadius:function(){return this._cornerRadius},setCornerRadius:function(cornerRadius){this._cornerRadius=cornerRadius;this.markDirty()},getPointAt:function(ratio){var linePoint;linePoint=_gliffy.candash.getPointInPathAtT(this._pointPath,ratio);linePoint=this.node.worldTransform.createInverse().transformPoint(linePoint.x,linePoint.y);return linePoint},getPointAtDistance:function(distance){var linePoint;linePoint=_gliffy.candash.getPointInPathAtDistance(this._pointPath,distance);linePoint=this.node.worldTransform.createInverse().transformPoint(linePoint.x,linePoint.y);return linePoint},getPathLength:function(){return this._length},getPointInPathAtT:function(ratio){return _gliffy.candash.getPointInPathAtT(this._pointPath,ratio)},getPointInPathAtDistance:function(distance){return _gliffy.candash.getPointInPathAtDistance(this._pointPath,distance,this._length)},getSlopeAtDistance:function(distance){var startDistance,endDistance;if(distance<3){startDistance=0;endDistance=4}else{if(distance>=this._length.totalDistance-2){startDistance=this._length.totalDistance-4;endDistance=this._length.totalDistance}else{startDistance=distance-2;endDistance=distance+2}}return _gliffy.Vec2.difference(_gliffy.candash.getPointInPathAtDistance(this._pointPath,endDistance,this._length),_gliffy.candash.getPointInPathAtDistance(this._pointPath,startDistance,this._length)).safeNormalize()},getSlopeAtT:function(t){return this.getSlopeAtDistance(this._length.totalDistance*t)},getPointPath:function(){return this._pointPath},getDrawCommands:function(){return this._drawCommands},hasCardinality:function(type){var i=0,graphic;type=type||null;if(this.node.children){for(i=0;i<this.node.children.length;i++){graphic=this.node.children[i].getGraphic();if(type){if(graphic.getCardinality&&graphic.getCardinality()===type){return true}}else{if(graphic.isCardinality&&graphic.isCardinality()){return true}}}}return false},getQuadraticLineAngleAtStartPoint:function(){var a,b,point=_gliffy.candash.getPointInPathAtDistance(this._pointPath,10,this._length);a=point.y-this._pointPath[0][0].y;b=point.x-this._pointPath[0][0].x;return this.__normalizeIncidenceAngle(Math.atan(a/b)*180/Math.PI,this.editable.getMagnitudeAndAxis("start"))},getQuadraticLineAngleAtEndPoint:function(){var a,b,point=_gliffy.candash.getPointInPathAtDistance(this._pointPath,this.getPathLength().totalDistance-10,this._length);a=point.y-this._pointPath[this._pointPath.length-1][this._pointPath[this._pointPath.length-1].length-1].y;b=point.x-this._pointPath[this._pointPath.length-1][this._pointPath[this._pointPath.length-1].length-1].x;return this.__normalizeIncidenceAngle(Math.atan(a/b)*180/Math.PI,this.editable.getMagnitudeAndAxis("end"))},__normalizeIncidenceAngle:function(angle,magAxis){if(magAxis.axis==="y"){if(magAxis.mag===1&&angle<0){angle=angle+180}else{if(magAxis.mag===-1&&angle>0){angle=angle-180}}}else{if(magAxis.mag===-1&&magAxis.axis==="x"){angle=angle+180}}return angle},applyStyle:function(style){if(style.strokeWidth){this.setStrokeWidth(style.strokeWidth)}if(style.stroke){this.setStrokeColor(style.stroke)}this.setStartArrow(style.startArrow);this.setEndArrow(style.endArrow);if(!this._ortho){this.editable.setOrthoMode(_gliffy.Editor.ORTHO_MODE.straight)}else{if(style.orthoMode!==undefined&&style.orthoMode!==null){this.editable.setOrthoMode(style.orthoMode)}}if(style.fill&&this._strokeWidth>2){this.setFillColor(style.fill)}else{this.setFillColor(null)}if(style.dashStyle!==undefined){this.setDashStyle(style.dashStyle)}},_generateDrawCommands:function(){if(this._controlPath.length>2&&this.getInterpolationType()===INTERPOLATION_TYPE.quadratic){return this._generateQuadratic(this.getWorldControlPath(),this.getCornerRadius())}else{return this._generateStraight(this.getWorldControlPath(),this.getCornerRadius())}},_generateStraight:function(controlPath,cornerRadius){var i,path=[],cur,next,offset0,offset0Mag,l,q1,q1Mag,prev;if(cornerRadius===null||cornerRadius===0||controlPath.length<3){for(i=0;i<controlPath.length;i++){path.push({name:(i===0?"M":"L"),args:this._controlPointToString(controlPath[i])})}}else{path.push({name:"M",args:this._controlPointToString(controlPath[0])});for(i=1;i<controlPath.length-1;i++){cur=new _gliffy.Vec2(controlPath[i][0],controlPath[i][1]);prev=new _gliffy.Vec2(controlPath[i-1][0],controlPath[i-1][1]);next=new _gliffy.Vec2(controlPath[i+1][0],controlPath[i+1][1]);offset0=cur.clone().subtract(prev);offset0Mag=offset0.magnitude();if(offset0Mag>cornerRadius*2){offset0.normalize().scale(cornerRadius)}else{offset0.safeNormalize().scale(offset0Mag/2)}l=cur.clone().subtract(offset0);q1=next.clone().subtract(cur);q1Mag=q1.magnitude();if(q1Mag>=cornerRadius*2){q1.normalize().scale(cornerRadius)}else{q1.safeNormalize().scale(q1Mag/2)}q1.add(cur);path.push({name:("L"),args:this._vec2ToString(l)});path.push({name:("Q"),args:this._vec2ToString(cur)+" "+this._vec2ToString(q1)})}path.push({name:"L",args:this._controlPointToString(controlPath[controlPath.length-1])})}return path},_generateQuadratic:function(controlPath,cornerRadius){if(controlPath.length<3){throw new Error("curved lines must have at least 3 points")}var len=controlPath.length,midPath,i,path;midPath=[controlPath[0]];for(i=1;i<len-2;i++){midPath.push(controlPath[i]);midPath.push([(controlPath[i][0]+controlPath[i+1][0])/2,(controlPath[i][1]+controlPath[i+1][1])/2])}midPath.push(controlPath[len-2]);midPath.push(controlPath[len-1]);path=[];path.push({name:"M",args:this._controlPointToString(midPath[0])});for(i=1;i<midPath.length-1;i+=2){path.push({name:"Q",args:this._controlPointToString(midPath[i])+" "+this._controlPointToString(midPath[i+1])})}return path},_controlPointToString:function(controlPoint){return(controlPoint[0])+","+(controlPoint[1])},_vec2ToString:function(vec2,offset){return(vec2.x)+","+(vec2.y)},__toObject:function(){this.update();return $.extend({strokeWidth:this.getStrokeWidth(),strokeColor:this.getStrokeColor(),fillColor:this.getFillColor(),dashStyle:this.getDashStyle(),startArrow:this.getStartArrow(),endArrow:this.getEndArrow(),startArrowRotation:this.getStartArrowRotation(),endArrowRotation:this.getEndArrowRotation(),ortho:this._ortho,interpolationType:INTERPOLATION_LOOKUP[this._interpolationType],cornerRadius:this._cornerRadius,controlPath:this._controlPath},this.editable.toObject())},__fromObject:function(object){if(object.strokeWidth!==undefined){this.setStrokeWidth(object.strokeWidth)}if(object.strokeColor!==undefined){this.setStrokeColor(object.strokeColor)}if(object.dashStyle!==undefined){this.setDashStyle(object.dashStyle)}if(object.startArrow!==undefined){this.setStartArrow(object.startArrow)}if(object.endArrow!==undefined){this.setEndArrow(object.endArrow)}if(object.startArrowRotation!==undefined){this.setStartArrowRotation(object.startArrowRotation)}if(object.endArrowRotation!==undefined){this.setEndArrowRotation(object.endArrowRotation)}if(object.fillColor!==undefined){this.setFillColor(object.fillColor)}if(object.interpolationType!==undefined){this._interpolationType=INTERPOLATION_TYPE[object.interpolationType]||INTERPOLATION_TYPE.linear}if(object.cornerRadius!==undefined){this._cornerRadius=object.cornerRadius}if(object.ortho!==undefined){this._ortho=object.ortho}if(object.controlPath!==undefined){this._controlPath=object.controlPath}if(this.editable.isEditable){this.editable.fromObject(object)}return this}});_gliffy.Line.INTERPOLATION_TYPE=INTERPOLATION_TYPE}());(function(){var DEFAULT_STYLE={zoom:1,stroke_linejoin:"miter"},TID="com.gliffy.shapes.image",CONNECTION_PT_PATTERN=["Midpoint","Octagon","Center"];_gliffy.Image=_gliffy.AbstractGeometry.extend({_url:null,style:null,node:null,svg:null,imgWidth:null,imgHeight:null,useOriginalDimensions:false,_dirty:true,init:function(node){this.node=node;this.style=$.extend({},DEFAULT_STYLE)},markDirty:function(){this._dirty=true;if(this.node){this.node.markDirty()}},setImgWidth:function(width){this.imgWidth=width},getImgWidth:function(){return this.imgWidth},setImgHeight:function(height){this.imgHeight=height},getImgHeight:function(){return this.imgHeight},resizeToOriginalDimensions:function(){this.useOriginalDimensions=true;this.markDirty();if(this.node){this.node.setFlag("skin")}},getTid:function(){return TID},setUrl:function(url){this._url=url;this.markDirty();if(this.node){this.node.setFlag("skin")}},getUrl:function(){return this._url},setShadowX:function(shadowX){this._shadowX=shadowX;this.markDirty()},getShadowX:function(){return this._shadowX},setShadowY:function(shadowY){this._shadowY=shadowY;this.markDirty()},getShadowY:function(){return this._shadowY},update:function(){if(this._dirty){var stage=null,width=0,height=0,shadow_offset;if(this.node){stage=this.node.stage;width=this.node.getWidth();height=this.node.getHeight();this.style.width=width;this.style.height=height}this.style.center_x=width/2;this.style.center_y=height/2;this.style.graphic_width=(this.node)?this.node.getWidth():0;this.style.graphic_height=(this.node)?this.node.getHeight():0;shadow_offset=this.calculateShadowOffset();this.style.shadow_x=shadow_offset.x;this.style.shadow_y=shadow_offset.y;this.style.graphic_width=this._dropShadow?Math.abs(this.style.shadow_x)+this.style.graphic_width:this.style.graphic_width;this.style.graphic_height=this._dropShadow?Math.abs(this.style.shadow_y)+this.style.graphic_height:this.style.graphic_height;this.style.graphic_x_offset=-1*Math.min(shadow_offset.x,0);this.style.graphic_y_offset=-1*Math.min(shadow_offset.y,0);this.style.line_offset_x=0;this.style.line_offset_y=0;this.style.stroke_offset=0;this.style.offset_x=this.style.graphic_x_offset+this.style.stroke_offset;this.style.offset_y=this.style.graphic_y_offset+this.style.stroke_offset;this._dirty=false;return true}return false},getClassName:function(){return"Image"},__toObject:function(){return{url:this.getUrl(),strokeWidth:this.getStrokeWidth(),strokeColor:this.getStrokeColor(),dropShadow:this.isDropShadow(),shadowX:this.getShadowX(),shadowY:this.getShadowY()}},__fromObject:function(object){if(object.url!==undefined){this.setUrl(object.url)}if(object.strokeWidth!==undefined){this.setStrokeWidth(object.strokeWidth)}if(object.strokeColor!==undefined){this.setStrokeColor(object.strokeColor)}if(object.dropShadow!==undefined){this.setDropShadow(object.dropShadow)}if(object.shadowX!==undefined){this.setShadowX(object.shadowX)}if(object.shadowY!==undefined){this.setShadowY(object.shadowY)}}})}());(function(){var FLAGS=["bounds","skin","position","guide"];_gliffy.Node=_gliffy.SerializableWithAabb.extend({_id:null,_x:0,_y:0,_rotation:0,_width:100,_height:100,_lockAspectRatio:false,_lockPosition:false,_scaleX:1,_scaleY:1,_order:null,worldTransform:null,_graphic:null,_domId:null,_uid:null,stage:null,children:null,parent:null,_dirty:true,_serialize:true,_dirty_flags:null,_current_bounds:null,_aspectRatio:null,_parentDirty:false,_activeGuides:null,_constraints:null,_selectable:true,_isHidden:false,_layerId:null,_isCopiedSelection:false,__localAabb:null,__worldAabb:null,__localOverlayAabb:null,__worldOverlayAabb:null,__defaultTextGraphic:null,__editTextOnInit:true,init:function(stage,parent){this.stage=stage||null;this.parent=parent||null;this.worldTransform=new _gliffy.AffineTransform(1,0,0,1,0,0);this.setWorldAabb(new _gliffy.BoundingBox());this.setLocalAabb(new _gliffy.BoundingBox());this.setLocalOverlayAabb(new _gliffy.BoundingBox());this.setWorldOverlayAabb(new _gliffy.BoundingBox());this._connections=null;if(_gliffy.Constraints){this._constraints=new _gliffy.Constraints(this)}this.hideGuides();this.resetFlags()},isBoundingBoxSelectActingLikeContainer:function(){return this.getShapeInformation().boundingBoxSelect&&!(this.getShapeInformation().defaults&&this.getShapeInformation().defaults.isContainer)},notify:function(){if(!isNaN(parseInt(this.getId(),10))){$(window).trigger("gliffy-node-update-"+this.getId(),[this.getId()])}},notifyRemove:function(){if(!isNaN(parseInt(this.getId(),10))){$(window).trigger("gliffy-node-remove-"+this.getId(),[this.getId()])}},getId:function(){return this._id},applyBestOrder:function(){var activeLayers=this.getActiveLayers();if(activeLayers){var layer=_.first(activeLayers);if(layer){this.setOrder(layer.getOrderForNewNode());layer.incrementNodeIndex();this.stage.sendSingleLayerToLayersController(layer)}}else{_gliffy.Logger.warn("node needs a layer id")}},setId:function(id){if(this.stage){if(id==="auto"){this._id=this.stage._node_index;if(this._order==="undefined"||this._order===null){this.setOrder(this.stage._node_index);this.applyBestOrder()}this.stage._node_index++}else{if(isNaN(parseInt(id,10))){throw new Error("node id is not a number:"+id)}this._id=id}this.stage._node_map[this._id]=this;this._domId="gliffy_node_"+this._id}else{this._id=id}},setUid:function(uid){this._uid=uid},getUid:function(){return this._uid},getTids:function(returnObject){var child,childIndex,tid,tids;tids={};if(this.getGraphic() instanceof _gliffy.Shape){tid=this.getGraphic().getTid();if(tid&&tid!=="null"){tids[this.getGraphic().getTid()]=true}}if(this.children instanceof Array){for(childIndex=0;childIndex<this.children.length;childIndex++){child=this.children[childIndex];tids=$.extend(tids,child.getTids({returnObject:true}))}}if(returnObject){return tids}else{return Object.keys(tids)}},setCopiedSelection:function(isCopiedSelection){this._isCopiedSelection=isCopiedSelection},isCopiedSelection:function(){return this._isCopiedSelection},getDomElement:function(){if(this._domId){return $("#"+this._domId)}return null},getDomElements:function(){var selector=["#"+this._domId],children=this.flattenChildren(),i;for(i=0;i<children.length;i++){selector=selector.concat(["#"+children[i]._domId])}return $(selector.join(","))},getDomViewbox:function(){if(this._domId){return $("#"+this._domId+"viewbox")}return null},setOrder:function(order){if(order!==this._order){this._order=order;this.setFlag("position");this._markDirty()}},getOrder:function(){if(this._order==="auto"){return(this.parent)?this.parent.getOrder():0}else{return this._order}},getRawOrder:function(){return this._order},setX:function(x){if(x!==this._x&&x!==undefined&&x!==null){this._x=x;this.setFlag("position");this._markDirty()}},getX:function(){return this._x},setY:function(y){if(y!==this._y&&y!==undefined&&y!==null){this._y=y;this.setFlag("position");this._markDirty()}},getY:function(){return this._y},getStage:function(){return this.stage},setStage:function(stage){this.stage=stage},__clampWidth:function(width){},__clampHeight:function(height){var ratio=this.getWidth()/this.getHeight();if(height<this.getHeight()){this.setHeight(height);this.setWidth(this.getHeight()*ratio)}},clampTo:function(boundingBox){var dimension=boundingBox.getDimension(),ratio;ratio=this.getHeight()/this.getWidth();if(dimension.x<this.getWidth()){this.setWidth(dimension.x);this.setHeight(this.getWidth()*ratio)}ratio=this.getWidth()/this.getHeight();if(dimension.y<this.getHeight()){this.setHeight(dimension.y);this.setWidth(this.getHeight()*ratio)}},getPosition:function(){return new _gliffy.Vec2(this._x,this._y)},getRotateOffsetX:function(){return this.getWidth()/2},getRotateOffsetY:function(){return this.getHeight()/2},getCenterPosition:function(){return new _gliffy.Vec2(this._x+this._width/2,this._y+this._height/2)},setRotation:function(rotation){rotation=_gliffy.Utils.wrapDegrees(rotation);if(rotation!==this._rotation){this._rotation=rotation;this.setFlag("position");this._markDirty();var graphic=this.getGraphic();if(graphic&&graphic.isDropShadow&&graphic.isDropShadow()){this.setFlag("skin")}}},supportsConstraints:function(){return _gliffy.Constraints&&this._constraints},subscribeAllConstraints:function(){var i;if(this.hasConstraints()){this.getConstraints().subscribeAll()}for(i=0;this.children&&i<this.children.length;i++){this.children[i].subscribeAllConstraints()}},hasConstraints:function(){return this.supportsConstraints()&&this._constraints.hasConstraints()},getConstraints:function(){return this._constraints},setConstraints:function(constraints){if(_gliffy.Constraints){if(this._constraints){this._constraints.unsubscribeAll()}if(constraints){this._constraints=constraints;this._constraints.subscribeAll()}}},getRotation:function(){return _gliffy.Utils.wrapDegrees(this._rotation)},getWorldRotation:function(){var current=this,totalRotation=0;while(current){totalRotation+=current.getRotation();current=current.parent}return totalRotation},setWidth:function(width){if(width!==this._width){this._width=Math.min(Math.max(width,this.getMinWidth()),5000);this._markDirty();this.setFlag("bounds")}},getWidth:function(){return Math.min(Math.max(this._width,1),5000)},setHeight:function(height){if(height!==this._height){this._height=Math.min(Math.max(height,this.getMinHeight()),5000);this._dirty_flags.bounds=true;this.setFlag("bounds");this._markDirty()}},hasChildren:function(){return this.children&&this.children.length>0},getHeight:function(){return Math.min(Math.max(this._height,1),5000)},getMinWidth:function(skipAspectRatio){var minWidth=1;if(this.hasConstraint(_gliffy.MinWidthConstraint)){minWidth=Math.max(minWidth,this.getConstraints().getConstraint(_gliffy.MinWidthConstraint).width)}if(this.hasConstraint(_gliffy.WidthConstraint)){minWidth=Math.max(minWidth,this.getConstraints().getConstraint(_gliffy.WidthConstraint).getMinWidth(_gliffy.Mouse.documentManager.getActiveStage()))}if(this.hasConstraint(_gliffy.ConstWidthConstraint)){minWidth=Math.max(minWidth,this.getConstraints().getConstraint(_gliffy.ConstWidthConstraint).width)}if(this.getShapeInformation()&&this.getShapeInformation().minWidth){minWidth=Math.max(minWidth,this.getShapeInformation().minWidth)}if(this.getLockAspectRatio()&&!skipAspectRatio){minWidth=Math.max(minWidth,this.getMinHeight({skipAspectRatio:true})*this.getAspectRatio())}return minWidth},getMinHeight:function(skipAspectRatio){var minHeight=1;if(this.hasConstraint(_gliffy.MinHeightConstraint)){minHeight=Math.max(minHeight,this.getConstraints().getConstraint(_gliffy.MinHeightConstraint).height)}if(this.hasConstraint(_gliffy.HeightConstraint)){minHeight=Math.max(minHeight,this.getConstraints().getConstraint(_gliffy.HeightConstraint).getMinHeight(_gliffy.Mouse.documentManager.getActiveStage()))}if(this.hasConstraint(_gliffy.ConstHeightConstraint)){minHeight=Math.max(minHeight,this.getConstraints().getConstraint(_gliffy.ConstHeightConstraint).height)}if(this.getShapeInformation()&&this.getShapeInformation().minHeight){minHeight=Math.max(minHeight,this.getShapeInformation().minHeight)}if(this.getLockAspectRatio()&&!skipAspectRatio){minHeight=Math.max(minHeight,this.getMinWidth({skipAspectRatio:true})/this.getAspectRatio())}return minHeight},hasConstraint:function(constraint){return this.hasConstraints()&&this.getConstraints().hasConstraint(constraint)},setScaleXNoRatio:function(scaleX){if(scaleX!==this._scaleX){this._scaleX=scaleX;this.setFlag("bounds");this._markDirty()}},setScaleYNoRatio:function(scaleY){if(scaleY!==this._scaleY){this._scaleY=scaleY;this.setFlag("bounds");this._markDirty()}},setScaleX:function(scaleX){if(scaleX!==this._scaleX&&!isNaN(scaleX)){this._scaleX=scaleX;if(this._lockAspectRatio){this._scaleY=scaleX}this.setFlag("bounds");this._markDirty()}},setScaleY:function(scaleY){if(scaleY!==this._scaleY&&!isNaN(scaleY)){this._scaleY=scaleY;if(this._lockAspectRatio){this._scaleX=scaleY}this.setFlag("bounds");this._markDirty()}},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},_applyScale:function(){var i,child;if(this._scaleX!==1||this._scaleY!==1){this.setWidth(this.getWidth()*this._scaleX);this.setHeight(this.getHeight()*this._scaleY);if(this.children){for(i=0;i<this.children.length;i++){child=this.children[i];if((!child.isTextChild())||child.getGraphic().getOverflow()==="none"){if(!child.hasConstraints()||child.getConstraints().parentCanScaleWidth()){child.setX(child.getX()*this._scaleX);child.setScaleXNoRatio(this._scaleX)}if(!child.hasConstraints()||child.getConstraints().parentCanScaleHeight()){child.setY(child.getY()*this._scaleY);child.setScaleYNoRatio(this._scaleY)}}}}}},clearCachedAspectRatio:function(){this._aspectRatio=null},getAspectRatio:function(){if(this.getLockAspectRatio()){if(this._aspectRatio===null){this._aspectRatio=this._width/this._height}return this._aspectRatio}else{return this._width/this._height}},getLockAspectRatio:function(){return this._lockAspectRatio},setLockAspectRatio:function(lockAspectRatio){this._lockAspectRatio=lockAspectRatio;if(!this._lockAspectRatio){this._aspectRatio=null}},getLockPosition:function(){return this._lockPosition},setLockPosition:function(lockPosition){this._lockPosition=lockPosition},getDefaultTextGraphic:function(){return this.__defaultTextGraphic},setDefaultTextGraphic:function(defaultTextGraphic){this.__defaultTextGraphic=defaultTextGraphic},isEditTextOnInit:function(){return this.__editTextOnInit},setEditTextOnInit:function(b){this.__editTextOnInit=b},getMinDimensions:function(){return{x:this.getMinWidth(),y:this.getMinHeight()}},setGraphic:function(graphic){if(this._graphic){this._graphic.node=null}this._graphic=graphic;if(this._graphic){this._graphic.node=this;if(this.getUid()===null){if(this._graphic instanceof _gliffy.Line){this.setUid("com.gliffy.shape.basic.basic_v1.default.line")}}this._graphic.markDirty()}else{if(this.stage){this.stage.removeDomNode(this)}}return this},getGraphic:function(){return this._graphic},updateProperty:function(prop,value){var graphic,props={};props[prop]=value;if(this.stage){this.stage.commandHistory.addAndExecuteCommand(new _gliffy.ModifyNodeCommand({node:this,props:props}))}else{graphic=this.getGraphic();if(this["set"+prop]!==undefined){this["set"+prop](value)}else{graphic=this.getGraphic();if(graphic){graphic.updateProperty(prop,value)}}}},getChildrenAabb:function(includeSelf){var i,child,aabb=(includeSelf===true)?this.getLocalAabb().clone():_gliffy.BoundingBox.SMALLEST.clone(),childTransform,graphic,offsetY;for(i=0;this.children&&i<this.children.length;i++){child=this.children[i];childTransform=child.getLocalTransform();if(child.getGraphic() instanceof _gliffy.Text){graphic=child.getGraphic();offsetY=(graphic.getValign()==="middle")?(child.getHeight()/2)-(graphic.getCalculatedHeight()/2):0;childTransform=childTransform.clone().translate(child.getGraphic().style.x,child.getGraphic().style.y+offsetY)}if(!(child.getGraphic() instanceof _gliffy.Link)){aabb.add(child.getChildrenAabb(true).transform(childTransform))}}return aabb},getChildrenWorldAabb:function(includeSelf){var i,child,aabb;if(includeSelf===true){if(this.getGraphic() instanceof _gliffy.Text){aabb=new _gliffy.BoundingBox(0,0,this.getGraphic().getCalculatedWidth(),this.getGraphic().getCalculatedHeight());aabb.transform(this.__getTextWorldTransform())}else{aabb=this.getWorldAabb().clone()}}else{if(this.children instanceof Array&&this.children.length>0){aabb=_gliffy.BoundingBox.SMALLEST.clone()}else{aabb=new _gliffy.BoundingBox()}}_.each(this.children,function(childNode){aabb.add(childNode.getChildrenWorldAabb(true))});return aabb},getLocalTransform:function(){var local=new _gliffy.AffineTransform(1,0,0,1,0,0);local.translate(this._x,this._y).rotate(this._rotation*(Math.PI/180),this.getRotateOffsetX(),this.getRotateOffsetY());return local},updateWorldTransform:function(){this.worldTransform=(this.parent)?this.parent.worldTransform.clone():new _gliffy.AffineTransform(1,0,0,1,0,0);this.worldTransform.translate(this._x,this._y).rotate(this._rotation*(Math.PI/180),this.getRotateOffsetX(),this.getRotateOffsetY())},update:function(){var self=this;_gliffy.Utils.tryCatch(function(){if(self._dirty){if(self.stage&&(self._dirty_flags.bounds||self._dirty_flags.position)&&_gliffy.Tree){_gliffy.Tree.remove(self)}self._applyScale();var i,child,grow=false,updateChildren;if(self.stage&&self.hasConstraints()){self.getConstraints().executeConstraints()}if(self.stage&&self.getGraphic() instanceof _gliffy.Text){if(self.parent===null||self.parent.isGroup()||self.parent.isSelection()){if(self.getUid()===null){self.setUid("com.gliffy.shape.basic.basic_v1.default.text")}}else{if(self.getUid()!==null){self.setUid(null)}}}self.updateWorldTransform();if(self._graphic){self._graphic.update();if(self._graphic.getLocalAabb()){self.getLocalAabb().copy(self._graphic.getLocalAabb())}else{self.getLocalAabb().setMinMax(0,0,0,0);self.getLocalAabb().grow(self.getWidth(),self.getHeight())}if(self._graphic.getWorldAabb()){self.getWorldAabb().copy(self._graphic.getWorldAabb())}else{if(self.getGraphic() instanceof _gliffy.Text){self.getWorldAabb().copy(self.getLocalAabb()).transform(self.__getTextWorldTransform())}else{self.getWorldAabb().copy(self.getLocalAabb()).transform(self.worldTransform)}}self.getLocalOverlayAabb().copy(self.getLocalAabb())}else{self.getLocalAabb().setMinMax(0,0,0,0);self.getLocalAabb().grow(self.getWidth(),self.getHeight());if(self.isSelection()){self.getLocalOverlayAabb().copy(self.getLocalAabb())}grow=true}if(self.children){updateChildren=(self._dirty_flags.bounds||self._dirty_flags.position);for(i=0;i<self.children.length;i++){child=self.children[i];if(updateChildren){if(self._dirty_flags.bounds){child.setFlag("bounds")}if(self._dirty_flags.position){child.setFlag("position")}child._markDirty();child._parentDirty=true}child.update();if(child.getWorldAabb()){if(grow){if(self.isGroup()||self.isMultipartShape()){self.getLocalOverlayAabb().copy(child.getLocalOverlayAabb()).transform(child.getLocalTransform())}self.getWorldAabb().copy(child.getWorldAabb());grow=false}else{if(self.isGroup()||self.isMultipartShape()){self.getLocalOverlayAabb().add(child.getLocalOverlayAabb().clone().transform(child.getLocalTransform()))}self.getWorldAabb().add(child.getWorldAabb())}}}}self.getWorldOverlayAabb().copy(self.getLocalOverlayAabb()).transform(self.worldTransform);if(self.stage&&(self._dirty_flags.bounds||self._dirty_flags.position)&&_gliffy.Tree){_gliffy.Tree.add(self)}self.setScaleX(1);self.setScaleY(1);self._dirty=false}self._parentDirty=false},function(e){_gliffy.Logger.error("Node "+self.getId()+" failed to update in node.js");if(self.stage){self.stage.removeNode(self)}_gliffy.handleError("com.gliffy.error.fatal_error",[],e)})},getBoundsOffset:function(){var worldPos=this.getWorldPosition();return _gliffy.Vec2.difference(worldPos,this.getWorldAabb().min)},getWorldPosition:function(){if(this.parent){return this.parent.worldTransform.transformPoint(this._x,this._y)}else{return{x:this._x,y:this._y}}},markClean:function(){this._dirty=false},markDirty:function(){this._dirty=true;if(this.stage&&!isNaN(parseInt(this.getId(),10))&&this.stage.find(this.getId())===this){this.stage.addDirtyNode(this)}},_markDirty:function(){if(this.getGraphic()){this.getGraphic().markDirty()}else{this.markDirty()}},shouldBeDrawn:function(){if(this.stage&&!isNaN(parseInt(this.getId(),10))){return this.stage.dirty[this.getId()]===this.getId()}return true},isDirty:function(){return this._dirty},isAChildOf:function(n){if(this.parent===n){return true}else{if(this.parent===null){return false}else{this.parent.isAChildOf(n)}}},getRootParent:function(){var n=this;while(n.parent){n=n.parent}return n},setLayerId:function(layer){this._layerId=layer;return this},getLayerId:function(layer){return this._layerId},getActiveLayers:function(){var guid,topmostParent=this,layer,layers;if(this.isSelection()){if(this.children){var layers=_.map(this.children,function(child){return this.stage.getLayerByGUID(child.getLayerId())},this);layers=_.unique(layers);return layers}return[]}else{while(topmostParent.parent!==null&&(topmostParent.parent.isCopiedSelection()||!topmostParent.parent.isSelection())){topmostParent=topmostParent.parent}guid=topmostParent.getLayerId();if(guid){layer=topmostParent.stage.getLayerByGUID(guid);if(layer){return[layer]}}}_gliffy.Logger.error("Couldn't find layer for node "+this.getUid());return[]},isPickable:function(){var firstActiveLayer=_.first(this.getActiveLayers());if(firstActiveLayer){return !firstActiveLayer.isLocked()&&firstActiveLayer.isVisible()}_gliffy.Logger.warn("cannot determine if node is pickable");return true},setHidden:function(hidden){if(this._isHidden!==hidden){this._isHidden=hidden;this.markDirty()}_.each(this.children,function(childNode){childNode.setHidden(hidden)})},getHidden:function(){return this._isHidden},getLayerHidden:function(){var activeLayers=this.getActiveLayers(),layer;if(activeLayers){layer=_.first(activeLayers);if(layer){return !layer.isVisible()}}return false},getNodeOrLayerHidden:function(){return this.getHidden()||this.getLayerHidden()},getLayerLocked:function(){var activeLayers=this.getActiveLayers(),layer;if(activeLayers&&activeLayers.length>0){layer=_.first(activeLayers);if(layer){return layer.isLocked()}}return false},setSerializable:function(serializable){this._serialize=serializable},toObjectNoGraphic:function(){return $.extend(true,{},this.__toObject(true))},__toObject:function(noGraphic){if(this._serialize){var i,object={x:this.getX(),y:this.getY(),rotation:this.getRotation(),id:this.getId(),uid:this.getUid(),width:this.getWidth(),height:this.getHeight(),lockAspectRatio:this.getLockAspectRatio(),lockShape:this.getLockPosition(),order:this._order,hidden:this.getHidden(),graphic:null,children:null,layerId:this.getLayerId()},graphic=this.getGraphic(),childrenArray,child;if(!noGraphic&&this.hasConstraints()){object.constraints=this._constraints.toObject()}if(!noGraphic&&graphic!==null){if(graphic instanceof _gliffy.Graphic){object.graphic=_gliffy.Serializable.polymorphicToObject(graphic)}else{throw new Error("The graphic for this node is not an instance of Geometry")}}if(this.children){childrenArray=[];for(i=0;this.children&&i<this.children.length;i++){child=this.children[i].__toObject(noGraphic);if(child){childrenArray.push(child)}}object.children=childrenArray}if(!noGraphic&&this.stage&&this._uid!==null&&!this.isGroup()&&!this.isSelection()){object.linkMap=this.generateLinkMap()}return object}else{return null}},__getTextWorldTransform:function(){var graphic,offsetY;if(this.getGraphic() instanceof _gliffy.Text){graphic=this.getGraphic();offsetY=(graphic.getValign()==="middle")?(this.getHeight()/2)-(graphic.getCalculatedHeight()/2):0;return new _gliffy.AffineTransform().concatenate(this.worldTransform).translate(graphic.style.x,graphic.style.y+offsetY)}else{return this.worldTransform}},generateLinkMap:function(){var nodes,node,domNode,links,boundingBox,css,cssNoTransform,linkMap=[],offset={x:0,y:0},container,i,shapeLinkInfo,debugBoundingBox=function(boundingBox){if($("#linkBoundingBox").length===0){$(".gliffy-stage").append('<div id="linkBoundingBox" style="border: 1px solid red;width: 100px;height: 100px;position: absolute;top: 0px;left: 0px;"></div>')}$("#linkBoundingBox").width(boundingBox.getWidth());$("#linkBoundingBox").height(boundingBox.getHeight());$("#linkBoundingBox").css({top:boundingBox.min.y+"px",left:boundingBox.min.x})},handleLink=function(index,link){var stageBB=new _gliffy.BoundingBox(0,0,5000,5000),stageOffset=_gliffy.Mouse.getStageOffset();boundingBox=(new _gliffy.BoundingBox()).fromClientRect(link.getBoundingClientRect());boundingBox.transform(_gliffy.AffineTransform.getTranslateInstance(stageOffset.left,stageOffset.top).scale(node.stage.zoom,node.stage.zoom).createInverse());if(stageBB.intersects(boundingBox)){linkMap.push({url:$(link).attr("href"),minX:Math.round(boundingBox.min.x),minY:Math.round(boundingBox.min.y),maxX:Math.round(boundingBox.max.x),maxY:Math.round(boundingBox.max.y)})}},getShapeLink=function(node){var shapeLinkNodes=node.findGraphic(_gliffy.Link),shapeLinkNode=shapeLinkNodes.length>0?shapeLinkNodes[0]:null,aabb;if(shapeLinkNode){aabb=(new _gliffy.BoundingBox()).copy(node.getLocalAabb()).transform(node.worldTransform);return{url:shapeLinkNode.getGraphic().getHref(),minX:Math.round(aabb.min.x),minY:Math.round(aabb.min.y),maxX:Math.round(aabb.max.x),maxY:Math.round(aabb.max.y)}}return null};if(_gliffy.Mouse){container=_gliffy.Mouse.getContainerOffset();offset.x-=container.left;offset.y-=container.top}if(this.stage){offset.x-=this.stage.pan_x;offset.y-=this.stage.pan_y}shapeLinkInfo=getShapeLink(this);if(shapeLinkInfo){linkMap.push(shapeLinkInfo)}nodes=this.findGraphic(_gliffy.Text);for(i=0;i<nodes.length;i++){node=nodes[i];domNode=node.getDomElement();if(domNode&&domNode.length>0){links=domNode.find("a");links.each(handleLink)}}return linkMap},__fromObject:function(object,opt){var i,graphic=null,constraints,child,order,childOrder,options=$.extend({subscribeToConstraints:true},opt);if(object.uid!==undefined){this.setUid(object.uid)}if(object.x!==undefined){this.setX(object.x)}if(object.y!==undefined){this.setY(object.y)}if(object.rotation!==undefined){this.setRotation(object.rotation)}if(object.width!==undefined){this.setWidth(object.width)}if(object.height!==undefined){this.setHeight(object.height)}if(object.lockAspectRatio!==undefined){this.setLockAspectRatio(object.lockAspectRatio)}if(object.lockShape!==undefined){this.setLockPosition(object.lockShape)}if(object.id!==undefined){this.setId(object.id)}if(object.order!==undefined){this._order=object.order}if(object.hidden!==undefined){this.setHidden(object.hidden)}if(object.layerId!==undefined){this.setLayerId(object.layerId)}if(_gliffy.Constraints&&object.constraints!==undefined){constraints=new _gliffy.Constraints(this,options.subscribeToConstraints);constraints.fromObject(object.constraints);this.setConstraints(constraints)}if(object.graphic){graphic=_gliffy.Serializable.polymorphicFromObject(object.graphic,this);if(graphic instanceof _gliffy.Graphic){this.setGraphic(graphic);graphic.markDirty()}else{throw new Error("The graphic "+object.graphicClass+" is not an instance of Geometry.")}}order=0;if(object.children){this.children=[];for(i=0;i<object.children.length;i++){child=new _gliffy.Node().fromObject(object.children[i]);this.appendChild(child);childOrder=child.getOrder();if(order<childOrder){order=childOrder}}}if(this.isGroup()&&this.getOrder()<childOrder){this.setOrder(childOrder+1)}this.markDirty();return this},appendChild:function(node){if(this.stage&&this.stage.find(this.getId())===this){this.stage.appendNode(node,this)}else{if(!this.children){this.children=[]}node.parent=this;this.children.push(node)}},insertChild:function(node,index){if(this.stage&&this.stage.find(this.getId())===this){this.stage.insertNode(node,this,index)}else{if(!this.children){this.children=[]}node.parent=this;this.children.splice(index,0,node)}},prependChild:function(node){if(this.stage&&this.stage.find(this.getId())===this){this.stage.prependNode(node,this)}else{if(!this.children){this.children=[]}node.parent=this;this.children.unshift(node)}},removeChild:function(node,markForDeletion){if(this.stage&&this.stage.find(this.getId())===this){this.stage.removeNode(node,markForDeletion)}else{node.parent=null;this.__removeFromArray(this.children,node)}},__removeFromArray:function(array,object){var index=-1,other,i;for(i=0;array.length;i++){other=array[i];if((object.getId()!==null&&other.getId()===object.getId())||other===object){index=i;break}}if(index>-1&&index<array.length){array.splice(index,1)}},getShapeInformation:function(){return _gliffy.shapeLibrary.getShape(this.getUid())||{}},hasGroupDroppableCopyObject:function(){return this.getShapeInformation()&&this.getShapeInformation().defaults&&this.getShapeInformation().defaults.copyObject&&this.getShapeInformation().defaults.copyObject.uid==="com.gliffy.shape.basic.basic_v1.default.group_droppable"},resetFlags:function(){var i;this._dirty_flags={};for(i=0;i<FLAGS.length;i++){this._dirty_flags[FLAGS[i]]=false}},setFlag:function(flag){if($.inArray(flag,FLAGS)<0){throw new Error($.inArray(flag,FLAGS)>-1+" node does not have flag "+flag)}this._dirty_flags[flag]=true;if((flag==="position"||flag==="bounds")&&this.stage&&this.stage.setBoundsDirty){this.stage.setBoundsDirty()}},hasFlag:function(flag){var i;if(flag){return this._dirty_flags[flag]||false}else{for(i=0;i<FLAGS.length;i++){if(this._dirty_flags[FLAGS[i]]===true){return true}}}return false},hasRepositionCanvasFlag:function(){return this._dirty_flags.position||this._dirty_flags.bounds},hasRedrawCanvasFlag:function(){return this._dirty_flags.bounds||this._dirty_flags.skin},hasGuideFlag:function(){return this._dirty_flags.guide},closestGraphic:function(type){if(this.getGraphic() instanceof type){return this}else{if(this.parent){return this.parent.closestGraphic(type)}else{return null}}},closestGroup:function(){if(this.isGroup()){return this}else{if(this.parent){return this.parent.closestGroup()}else{return null}}},topGroup:function(){if(this.isGroup()&&(this.parent===null||this.parent.isSelection())){return this}else{if(this.parent){return this.parent.topGroup()}else{return null}}},getFirstNodeWithGraphic:function(){if(this.getGraphic()){return this}else{var i,node;for(i=0;i<this.children.length;i++){node=this.children[i].getFirstNodeWithGraphic();if(node){return node}}return null}},getFirstTopLevelNodeWithGraphic:function(type){var child,children,graphic,i;children=this.children;if(children&&children.length>0){for(i=0;i<children.length;i++){child=children[i];if(child instanceof _gliffy.Node&&!child.getUid()){graphic=child.getGraphic();if(graphic instanceof type){return child}}}}return null},findGraphic:function(type){var list=[],i;if((type!==null&&this.getGraphic() instanceof type)||(this.getGraphic()===null&&type===null)){list.push(this)}if(this.children&&this.children.length>0){for(i=0;i<this.children.length;i++){list=list.concat(this.children[i].findGraphic(type))}}return list},findImmediateChildGraphic:function(type){var list=[],i,child;if(this.children){for(i=0;i<this.children.length;i++){child=this.children[i];if((type!==null&&child.getGraphic() instanceof type)||(child.getGraphic()===null&&type===null)){list.push(child)}}}return list},findNodesWithGraphics:function(types){var list=[],i;for(i=0;i<types.length;i++){if((types[i]!==null&&this.getGraphic() instanceof types[i])||(this.getGraphic()===null&&types[i]===null)){list.push(this);break}}if(this.children&&this.children.length>0){for(i=0;i<this.children.length;i++){list=list.concat(this.children[i].findNodesWithGraphics(types))}}return list},getUidNode:function(){if(this.getUid()!==null){return this}else{if(this.parent){return this.parent.getUidNode()}else{return null}}},getLeafNodes:function(includeSelf){var list=[],i;if(includeSelf||(this.getUid()&&!(this.isGroup()||this.isSelection()))){list.push(this)}for(i=0;this.children&&i<this.children.length;i++){list=list.concat(this.children[i].getLeafNodes(false))}return list},findUid:function(uid){return this.findUidFunction(function(u){return u===uid})},findUidFunction:function(check){var list=[],i;if(check(this.getUid())){list.push(this)}if(this.children&&this.children.length>0){for(i=0;i<this.children.length;i++){list=list.concat(this.children[i].findUidFunction(check))}}return list},hasText:function(){var i=0;if(this.getGraphic() instanceof _gliffy.Text){return true}else{if(this.children&&this.children.length>0){for(i=0;i<this.children.length;i++){if(this.children[i].hasText()){return true}}}}return false},immediateChildrenHaveMixedRotation:function(){var i=0;if(this.children){for(i=0;i<this.children.length;i++){if(this.children[i].getRotation()!==0){return true}}}return false},isLine:function(){return this.getGraphic() instanceof _gliffy.Line&&!this.isGroup()&&!this.isSelection()&&!this.isMultipartShape()},isConnectedLine:function(){return this.isLine()&&(this.getGraphic().getStartConnection()||this.getGraphic().getEndConnection())},isGroup:function(){return this.getUid()==="com.gliffy.shape.basic.basic_v1.default.group"||this.isGroupDroppable()},isGroupDroppable:function(){return this.getUid()==="com.gliffy.shape.basic.basic_v1.default.group_droppable"},isOnlyNodeOnTheStage:function(){var objects;objects=this.getStage().objects;return(objects.length===1)&&(objects[0]===this)},isSelection:function(){return this.getUid()==="com.gliffy.shape.basic.basic_v1.default.selection"},isShape:function(){return !this.isGroup()&&!this.isSelection()&&((this.getUid()&&this.getGraphic() instanceof _gliffy.Shape)||this.isMultipartShape())},isShapePart:function(){return !this.getUid()&&this.getGraphic() instanceof _gliffy.Shape},isSvg:function(){return this.getGraphic() instanceof _gliffy.Svg&&this.getUid()==="com.gliffy.shape.basic.basic_v1.default.svg"},isProxy:function(){return _gliffy.Proxy&&this.getGraphic() instanceof _gliffy.Proxy},isPopupNote:function(){return _gliffy.PopupNote&&this.getGraphic() instanceof _gliffy.PopupNote},isImage:function(){return this.getGraphic() instanceof _gliffy.Image&&this.getUid()==="com.gliffy.shape.basic.basic_v1.default.image"},isMultipartShape:function(){return !this.isGroup()&&!this.isSelection()&&this.getUid()&&this.findNodesWithGraphics([_gliffy.Shape,null]).length>1},isStandAloneText:function(){return this.getUid()==="com.gliffy.shape.basic.basic_v1.default.text"&&this.getGraphic() instanceof _gliffy.Text},supportsDrawingGuides:function(){return(this.isShape()||this.isImage()||this.isStandAloneText()||this.isSvg())&&!this.getLayerHidden()&&!this.getHidden()},isAnnotation:function(){return this.getUid()==="com.gliffy.shape.bpmn.bpmn_v1.data_artifacts.annotation"},isText:function(){return this.getGraphic() instanceof _gliffy.Text},isLink:function(){return this.getGraphic() instanceof _gliffy.Link},isIcon:function(){return this.isLink()||this.isPopupNote()},isUML2:function(){return this.getUid()&&(this.getUid().indexOf("com.gliffy.shape.uml.uml_v2")===0)},isUML2Activation:function(){return this.getGraphic() instanceof _gliffy.Shape&&this.getUid()==="com.gliffy.shape.uml.uml_v2.sequence.activation"},isBPMN:function(){return this.getUid()&&(this.getUid().indexOf("com.gliffy.shape.bpmn")===0)},isERD:function(){return this.getUid()&&(this.getUid().indexOf("com.gliffy.shape.erd")===0)},isMindmap:function(){return(this.getUid()&&this.getUid().indexOf("com.gliffy.shape.mindmap")===0)},isTextChild:function(){return this.getGraphic() instanceof _gliffy.Text&&this.getUid()===null&&this.parent!==null},isSwimlane:function(){return(this.getUid()&&this.getUid().indexOf("com.gliffy.shape.swimlanes")===0)},isTable:function(){var uid=this.getUid();if(uid!==null&&uid!==undefined){return(uid.indexOf("com.gliffy.shape.table.table_v1")===-1&&((uid.indexOf("com.gliffy.shape.table")===0||uid==="com.gliffy.shape.ui.ui_v3.containers_content.table_three_by_three")))===true}else{return false}},isRackShape:function(){return(this.getUid()&&(this.getUid().indexOf("com.gliffy.shape.network.network_v4.rack")===0&&this.getUid().indexOf("7u_lcd")===-1))},isContainer:function(){var info=this.getShapeInformation();return info&&info.defaults&&info.defaults.isContainer},isPartOfMultipartShape:function(){var parent=this.getUidNode();return(parent&&parent.isMultipartShape()&&this!==parent)===true},__isPartOf:function(node,uid){if(node){return(node.getUid()===uid)||this.__isPartOf(node.parent,uid)}return false},isPartOf:function(uid){return this.__isPartOf(this.parent,uid)},__isPartOfRegExp:function(node,uidRegExp){if(node){return(node.getUid()&&node.getUid().match(uidRegExp))||this.__isPartOfRegExp(node.parent,uidRegExp)}return false},isPartOfRegExp:function(uidRegExp){return this.__isPartOfRegExp(this.parent,uidRegExp)},isPartOfGroup:function(){return this.isPartOf("com.gliffy.shape.basic.basic_v1.default.group")||this.isPartOf("com.gliffy.shape.basic.basic_v1.default.group_droppable")},isPartOfSelection:function(){return this.isPartOf("com.gliffy.shape.basic.basic_v1.default.selection")},isResizable:function(){var shapeInfo,mutableProps;shapeInfo=this.getShapeInformation();if(shapeInfo&&shapeInfo.mutableProperties){mutableProps=shapeInfo.mutableProperties;return $.inArray("width",mutableProps)!==-1||$.inArray("height",mutableProps)!==-1}else{return true}},supportsConnections:function(){var info=this.getShapeInformation();return !this.isProxy()&&info.defaults&&info.defaults.connPtPattern!==null&&info.defaults.connPtPattern!==undefined},supportsIcon:function(){return this.isImage()||this.isSvg()||(this.isShape()&&!this.isMultipartShape())},supportsStyleCopy:function(){return(!this.getLayerLocked()&&!this.isGroup()&&!this.isSelection())&&((this.isShape()&&!this.isMultipartShape())||this.isText()||this.isLine()||_gliffy.Utils.isUIDPartOfGliffySymbolLibrary(this.getUid(),"com.gliffy.libraries.basic.basic_v1.default"))},supportsCopyPaste:function(){return(this.findGraphic(_gliffy.Mindmap).length===0)},supportsLockAspect:function(){var i,info,supports=true,shapeNodes=this.findNodesWithGraphics([_gliffy.Shape,_gliffy.Image]);for(i=0;i<shapeNodes.length;i++){info=shapeNodes[i].getShapeInformation();if($.inArray("lockAspectRatio",info.mutableProperties)===-1){supports=false;break}}return supports},flattenChildren:function(){var nodes=[],i=0;for(i=0;this.children&&i<this.children.length;i++){this.__preorder(this.children[i],nodes)}nodes=nodes.sort(function(n1,n2){var result=n1.getOrder()-n2.getOrder();if(result===0){if(n1.isAChildOf(n2)){return 1}else{if(n2.isAChildOf(n1)){return -1}else{return n1.getId()>n2.getId()?1:-1}}}else{return result}});return nodes},getDrawingGuides:function(){var drawingGuides,optionalDrawingGuides,mergedGuides;drawingGuides={x:{left:this.getWorldOverlayAabb().min.x,center:(this.getWorldOverlayAabb().min.x+this.getWorldOverlayAabb().max.x)/2,right:this.getWorldOverlayAabb().max.x},y:{top:this.getWorldOverlayAabb().min.y,middle:(this.getWorldOverlayAabb().min.y+this.getWorldOverlayAabb().max.y)/2,bottom:this.getWorldOverlayAabb().max.y}};optionalDrawingGuides=this.__getOptionalDrawingGuides();mergedGuides=_.merge(drawingGuides,optionalDrawingGuides);return mergedGuides},__getOptionalDrawingGuides:function(){var optionalDrawingGuides,rotation,self,shapeInformation,x,y;x={};y={};rotation=Math.round(this.getRotation())%360;shapeInformation=this.getShapeInformation();if(shapeInformation&&shapeInformation.optionalDrawingGuides){optionalDrawingGuides=shapeInformation.optionalDrawingGuides;if(rotation===0){if(optionalDrawingGuides.left){x.containerLeft=this.getWorldOverlayAabb().min.x+optionalDrawingGuides.left}if(optionalDrawingGuides.right){x.containerRight=this.getWorldOverlayAabb().max.x-optionalDrawingGuides.right}if(optionalDrawingGuides.top){y.containerTop=this.getWorldOverlayAabb().min.y+optionalDrawingGuides.top}if(optionalDrawingGuides.bottom){y.containerBottom=this.getWorldOverlayAabb().max.y-optionalDrawingGuides.bottom}}else{if(rotation===90){if(optionalDrawingGuides.left){x.containerLeft=this.getWorldOverlayAabb().min.x+optionalDrawingGuides.bottom}if(optionalDrawingGuides.right){x.containerRight=this.getWorldOverlayAabb().max.x-optionalDrawingGuides.top}if(optionalDrawingGuides.top){y.containerTop=this.getWorldOverlayAabb().min.y+optionalDrawingGuides.left}if(optionalDrawingGuides.bottom){y.containerBottom=this.getWorldOverlayAabb().max.y-optionalDrawingGuides.right}}else{if(rotation===180){if(optionalDrawingGuides.left){x.containerLeft=this.getWorldOverlayAabb().min.x+optionalDrawingGuides.right}if(optionalDrawingGuides.right){x.containerRight=this.getWorldOverlayAabb().max.x-optionalDrawingGuides.left}if(optionalDrawingGuides.top){y.containerTop=this.getWorldOverlayAabb().min.y+optionalDrawingGuides.bottom}if(optionalDrawingGuides.bottom){y.containerBottom=this.getWorldOverlayAabb().max.y-optionalDrawingGuides.top}}else{if(rotation===270){if(optionalDrawingGuides.left){x.containerLeft=this.getWorldOverlayAabb().min.x+optionalDrawingGuides.top}if(optionalDrawingGuides.right){x.containerRight=this.getWorldOverlayAabb().max.x-optionalDrawingGuides.bottom}if(optionalDrawingGuides.top){y.containerTop=this.getWorldOverlayAabb().min.y+optionalDrawingGuides.right}if(optionalDrawingGuides.bottom){y.containerBottom=this.getWorldOverlayAabb().max.y-optionalDrawingGuides.left}}else{}}}}}return{x:x,y:y}},__hasDirtyGuides:function(){var hasDirtyGuides;hasDirtyGuides=_.any(this._activeGuides,function(xOrYGuides){return _.any(xOrYGuides,function(guideActiveFlag){return guideActiveFlag})});return hasDirtyGuides},hideGuides:function(){if(this.__hasDirtyGuides()){this.markDirty()}this._activeGuides={x:{},y:{}}},showDrawingGuide:function(xOrY,which){if((xOrY==="x"||xOrY==="y")){if(!this._activeGuides[xOrY][which]){this._activeGuides[xOrY][which]=true;this.setFlag("guide");this.markDirty()}}},shouldShowGuide:function(xOrY,which){if(xOrY==="x"||xOrY==="y"){return this._activeGuides[xOrY][which]}return false},worldPointToRatio:function(x,y){var point=this.worldTransform.createInverse().transformPoint(x,y);point.x/=this.getWidth();point.y/=this.getHeight();return point},ratioToWorldPoint:function(xRatio,yRatio){return this.worldTransform.transformPoint(xRatio*this.getWidth(),yRatio*this.getHeight())},__preorder:function(node,array){var c;if(!node){return}array.push(node);for(c=0;node.children&&c<node.children.length;c++){this.__preorder(node.children[c],array)}},getSubLibraryId:function(){var subLibraryId;if(this._uid!==null){if(this._uid.lastIndexOf(".")>-1){subLibraryId=this._uid.substring(0,this._uid.lastIndexOf("."))}}return subLibraryId},getConnections:function(){var i,patternStrings,patternString,pattern;if(!this._connections&&this.supportsConnections()){this._connections=[];patternStrings=this.getShapeInformation().defaults.connPtPattern;if(patternStrings){for(i=0;i<patternStrings.length;i++){patternString=patternStrings[i];pattern=_gliffy.ConnectionPointPattern.patterns[patternString];if(pattern){this._connections=this._connections.concat(pattern)}}}}else{if(!this._connections){this._connections=[]}}return this._connections},hasBoundsConnections:function(){var patternStrings,i;if(this.getShapeInformation().defaults){patternStrings=this.getShapeInformation().defaults.connPtPattern;if(patternStrings){for(i=0;i<patternStrings.length;i++){if(patternStrings[i]==="Bounds"){return true}}}}return false},updateGroupBounds:function(){var i,n,dimension,boundingBox;if(this.isGroup()||this.isSelection()){for(i=0;i<this.children.length;i++){n=this.children[i];n.updateGroupBounds();n.update()}boundingBox=this.getChildrenAabb();dimension=boundingBox.getDimension();this.setWidth(dimension.x);this.setHeight(dimension.y)}},getClosestConnectionPoint:function(point){point=this.worldTransform.createInverse().transformPoint(point.x,point.y);point.x/=this.getWidth();point.y/=this.getHeight();return this.getConnectionIndexByRatio(point)},hasConnectionIndices:function(){return this.getConnections()?true:false},getConnectionIndexByRatio:function(ratio){var connections=this.getConnections(),i,smallestDistance=Number.MAX_VALUE,index=0,distance;for(i=0;i<connections.length;i++){distance=_gliffy.Vec2.squaredDistance(ratio,connections[i].pos);if(distance<smallestDistance){index=i;smallestDistance=distance}}return index},getConnectionPointRatio:function(i){return this.getConnections()[i].pos},getConnectionPoint:function(i){var connLocal,xfm,pt;connLocal=this.getConnections()[i].pos;xfm=this.worldTransform.clone().translate(this.getWidth()*connLocal.x,this.getHeight()*connLocal.y);pt=xfm.transformPoint(0,0);return new _gliffy.Vec2(pt.x,pt.y)},getConnectionPointDom:function(i){return $("#cp"+i+"-"+this._domId)},getConnectionVector:function(i){var connections=this.getConnections();if(i<connections.length&&connections[i].vec){return(new _gliffy.Vec2(this.getConnections()[i].vec.x,this.getConnections()[i].vec.y)).rotate(this.getWorldRotation()*Math.PI/180)}else{return new _gliffy.Vec2(0,0)}},isSelectable:function(){return this._selectable},setSelectable:function(selectable){this._selectable=selectable},getLink:function(){var linkNode;if(!this.isGroup()&&!this.isSelection()&&this.children){linkNode=this.findGraphic(_gliffy.Link);if(linkNode.length>1){_gliffy.Logger.error("node found with more than one _gliffy.Link");return linkNode[0].getGraphic().getHref()}else{if(linkNode.length>0){return linkNode[0].getGraphic().getHref()}}}return null},isTableCellSelected:function(){if(this&&this.getDomViewbox()){return this.getDomViewbox().hasClass("table-border")}else{return false}},addTableSelectedCellClass:function(){if(this&&this.getDomViewbox()){this.getDomViewbox().addClass("table-border")}else{return false}},removeTableSelectedCellClass:function(){if(this&&this.getDomViewbox()){this.getDomViewbox().removeClass("table-border")}},isKnownShape:function(){return this.isText()||this.isLine()||this.isGroup()||this.isSelection()||this.isGroupDroppable()||this.isLink()||this.isPopupNote()||!!_gliffy.shapeLibrary.getShape(this.getUid())},setToActiveLayer:function(stage){stage=stage||this.stage;if(stage){this.setLayerId(stage.getTopmostActiveLayer().guid)}else{_gliffy.Logger.warn("node has no stage, can't set layer Id")}},getNodeAndChildrensBoundingBox:function(){var boundingBox=new _gliffy.BoundingBox(),nodeBoundingBox=this.getWorldOverlayAabb(),minX,minY,maxX,maxY;maxY=_.max(this.children,function(child){return child.getWorldAabb().max.y});maxY=Math.max(maxY,nodeBoundingBox.max.y)}})}());(function(){var ZOOM_FIT_PADDING=20,MAX_ZOOM=8,MAX_WIDTH=5000,MAX_HEIGHT=5000;_gliffy.Stage=_gliffy.SerializableWithAabb.extend({id:null,zoom:1,pan_x:0,pan_y:0,background:"#FFFFFF",__unsavedChanges:false,width:750,height:1000,maxWidth:MAX_WIDTH,maxHeight:MAX_HEIGHT,exportBorder:false,gridOn:true,snapToGrid:true,drawingGuidesOn:true,printModel:null,__viewportType:"default",fitBB:null,shapeStyles:null,lineStyles:null,textStyles:null,themeData:null,objects:null,_layers:null,_node_map:null,_node_index:0,_calculate_bounds:true,_pan_dirty:true,deletes:null,dirty:null,autoFit:true,gon:null,document:null,commandHistory:null,__worldAabb:null,options:{zoom:true,pan_x:true,pan_y:true,background:true,width:true,height:true,autoFit:true},init:function(options,id){var key;this.objects=[];this.shapeStyles={};this.lineStyles={};this.textStyles={};this._node_map={};this.deletes=[];this.dirty={};if(window.GliffyApp&&window.GliffyApp.PrintModel){this.printModel=GliffyApp.PrintModel.createFromObject()}this.setWorldAabb(new _gliffy.BoundingBox());this.fitBB=new _gliffy.BoundingBox();this.id=id||_gliffy.Utils.randomString(_gliffy.stages);_gliffy.stages[this.id]=this;if(_gliffy.Editor!==undefined){this.commandHistory=new _gliffy.CommandHistory(this)}if(options){if(options.predefineLayers){this._layers=[(new _gliffy.Layer()).fromDefault()];this._layers[0].setActive(true);delete options.predefineLayers}for(key in options){if(options.hasOwnProperty(key)){if(this.options[key]){this[key]=options[key]}else{throw key+" is not a valid option for stage"}}}}},getViewportType:function(){return this.__viewportType},setViewportType:function(viewportType){this.__viewportType=viewportType||"default"},getLayers:function(){return this._layers},getLayerByGUID:function(guid){var layer;layer=_.find(this._layers,{guid:guid})||null;return layer},addDirtyNode:function(node){this.dirty[node.getId()]=node.getId()},removeDirtyNode:function(node){delete this.dirty[node.getId()]},update:function(){var i;for(i=0;i<this.objects.length;i++){this.objects[i].update()}this.updateBounds()},setBoundsDirty:function(){this._calculate_bounds=true},setBoundsClean:function(){this._calculate_bounds=false},updateBounds:function(){if(this._calculate_bounds){this.setWorldAabb(this.calculateBoundingBox());this.width=Math.ceil(Math.min(this.getWorldAabb().max.x,this.maxWidth));this.height=Math.ceil(Math.min(this.getWorldAabb().max.y,this.maxHeight));this.setBoundsClean();this.fitBB=this.getWorldAabb()}},find:function(node_id){return this._node_map[node_id]||null},findGraphic:function(type){var list=[],i;for(i=0;i<this.objects.length;i++){list=list.concat(this.objects[i].findGraphic(type))}return list},findNodesByLayerId:function(guid){var nodes;nodes=_.filter(this.objects,function(node){return node.getLayerId()===guid});return nodes},iterateNodes:function(callback){$.each(this._node_map,function(key,node){callback(node)})},prependNode:function(new_node,parent){this.insertNode(new_node,parent,0)},insertNode:function(new_node,parent,index){this.removeNode(new_node,false);this.__resetNodeId(new_node);if(new_node&&parent){if(!parent.children){parent.children=[]}parent.children.splice(index,0,new_node);new_node.parent=parent;parent.markDirty()}else{this.objects.splice(index,0,new_node);new_node.markDirty()}if(new_node.supportsConstraints()){new_node.subscribeAllConstraints()}if(_gliffy.Editor&&new_node.isSelection()){_gliffy.Mouse.editor.overlayManager.addSelectionNodesToBreakup(new_node)}},appendNode:function(new_node,parent){var index;if(parent){if(parent.children){index=parent.children.length}else{index=0}}else{index=this.objects.length}this.insertNode(new_node,parent,index)},appendCopyNode:function(node){this.insertCopyNode(node,this.objects.length)},prependCopyNode:function(node){this.insertCopyNode(node,0)},insertCopyNode:function(node,index){var idMap={};this.__resetCopyNodeId(node,idMap);this.objects.splice(index,0,node);node.markDirty();if(node.supportsConstraints()){this.__updateConstraintIds(node,idMap)}if(node.isSelection()){_gliffy.Mouse.editor.overlayManager.addSelectionNodesToBreakup(node)}new _gliffy.BringToFrontCommand({node:node}).execute(this)},calculateBoundingBox:function(){var boundingBox;if(this.objects.length>0){boundingBox=_gliffy.BoundingBox.SMALLEST.clone();_.each(this.objects,function(node){boundingBox.add(node.getChildrenWorldAabb(true))})}else{boundingBox=new _gliffy.BoundingBox()}return boundingBox},__updateConstraintIds:function(node,idMap){var i;if(node.hasConstraints()){node.getConstraints().updateIds(idMap)}for(i=0;node.children&&i<node.children.length;i++){this.__updateConstraintIds(node.children[i],idMap)}},__resetNodeId:function(node){var i=0,id=node._id;node.stage=this;if(id===null||id===undefined||id<0){id="auto"}node.setId(id);for(i=0;node.children&&i<node.children.length;i++){this.__resetNodeId(node.children[i])}},__resetCopyNodeId:function(node,idMap){var i=0,id=node._id;node.stage=this;node.setId("auto");idMap[id]=node.getId();for(i=0;node.children&&i<node.children.length;i++){this.__resetCopyNodeId(node.children[i],idMap)}},removeNode:function(node,markForDeletion,isChild,cache){var i,parent;if(!_.isArray(cache)){cache=[]}this.setBoundsDirty();if(node&&cache.indexOf(node.getId())<0){if(markForDeletion===undefined||markForDeletion===null){markForDeletion=true}node=this.find(node.getId());if(node){(node.children||[]).forEach(function(child){this.removeNode(child,markForDeletion,true,cache)},this);if(markForDeletion){this.removeDomNode(node)}parent=node.parent;if(!isChild){if(parent===null){this.__removeFromArray(this.objects,node)}else{this.__removeFromArray(parent.children,node)}node.parent=null}if(markForDeletion){node.notifyRemove()}node.stage=null;cache.push(node.getId());delete this._node_map[node.getId()]}}return node},removeDomNode:function(node){if(node._domId){this.deletes.push("#"+node._domId)}},isDirty:function(){return this.deletes.length>0||Object.keys(this.dirty).length>0},hasUnsavedChanges:function(){return this.__unsavedChanges},setUnsavedChanges:function(hasChanges){if(_gliffy.Editor!==undefined&&hasChanges!==this.__unsavedChanges){this.__unsavedChanges=hasChanges;if(window.GliffyApp){GliffyApp.documentModel.update(this.document)}}},setBackground:function(color){this.background=color;if(window.GliffyApp){GliffyApp.documentModel.updateProperty("pageColor",color)}},__removeFromArray:function(array,object){var index=-1,other,i;for(i=0;i<array.length;i++){other=array[i];if(other.getId()===object.getId()){index=i;break}}if(index>-1&&index<array.length){array.splice(index,1)}},getStagePanX:function(){return -this.pan_x/this.zoom},getStagePanY:function(){return -this.pan_y/this.zoom},zoomAt:function(zoom,stageX,stageY,viewportWidth,viewportHeight){var stagePanX=this.getStagePanX(),stagePanY=this.getStagePanY(),zoomRatio;zoom=(zoom<MAX_ZOOM)?zoom:MAX_ZOOM;zoomRatio=zoom/this.zoom;stagePanX=(stagePanX-stageX)/(zoomRatio)+stageX;stagePanY=(stagePanY-stageY)/(zoomRatio)+stageY;viewportWidth=viewportWidth/zoomRatio;viewportHeight=viewportHeight/zoomRatio;this.setZoom(zoom);this.setStagePan(stagePanX,stagePanY,viewportWidth,viewportHeight)},setPanX:function(x){this.pan_x=x;this._pan_dirty=true},setPanY:function(y){this.pan_y=y;this._pan_dirty=true},setStagePan:function(x,y,viewportWidth,viewportHeight){this.setPan(-x*this.zoom,-y*this.zoom,viewportWidth,viewportHeight)},setPan:function(x,y,viewportWidth,viewportHeight){this.setPanX(x);this.setPanY(y);this.clampPanning(viewportWidth,viewportHeight)},offsetPan:function(x,y,viewportWidth,viewportHeight){this.setPan(this.pan_x+x,this.pan_y+y,viewportWidth,viewportHeight)},clampPanning:function(viewportWidth,viewportHeight){var stageWidth=(this.autoFit||this.width>this.maxWidth)?this.maxWidth:this.width,stageHeight=(this.autoFit||this.height>this.maxHeight)?this.maxHeight:this.height,minWidth=Math.ceil((viewportWidth-stageWidth)*this.zoom),minHeight=Math.ceil((viewportHeight-stageHeight)*this.zoom);if(minWidth>0){minWidth=0}if(minHeight>0){minHeight=0}if(this.pan_x>0){this.pan_x=0}else{if(this.pan_x<minWidth){this.pan_x=minWidth}}if(this.pan_y>0){this.pan_y=0}else{if(this.pan_y<minHeight){this.pan_y=minHeight}}this.pan_x=Math.ceil(this.pan_x);this.pan_y=Math.ceil(this.pan_y)},centerAt:function(stageX,stageY,viewportWidth,viewportHeight){this.setStagePan(stageX-viewportWidth/2,stageY-viewportHeight/2,viewportWidth,viewportHeight)},zoomToCenter:function(zoom,viewportWidth,viewportHeight){var zoomRatio,stageX=this.getStagePanX()+viewportWidth/2,stageY=this.getStagePanY()+viewportHeight/2;zoom=(zoom<MAX_ZOOM)?zoom:MAX_ZOOM;zoomRatio=this.zoom/zoom;this.setZoom(zoom);this.centerAt(stageX,stageY,viewportWidth*zoomRatio,viewportHeight*zoomRatio)},zoomToBox:function(boundingBox,viewportWidth,viewportHeight){var dimension,xZoom,yZoom,zoom,zoomRatio,center;dimension=boundingBox.getDimension();xZoom=viewportWidth*this.zoom/dimension.x;yZoom=viewportHeight*this.zoom/dimension.y;zoom=(xZoom<yZoom)?xZoom:yZoom;zoom=(zoom<MAX_ZOOM)?zoom:MAX_ZOOM;zoomRatio=this.zoom/zoom;viewportWidth=viewportWidth*zoomRatio;viewportHeight=viewportHeight*zoomRatio;center=boundingBox.getCenter();this.setZoom(zoom);this.centerAt(center.x,center.y,viewportWidth,viewportHeight)},zoomToFit:function(viewportWidth,viewportHeight){var i,aabb=new _gliffy.BoundingBox().copy(_gliffy.BoundingBox.SMALLEST),visibleObjects=this.visibleNodes();if(visibleObjects.length===0){this.pan_x=0;this.pan_y=0;this.setZoom(1)}else{_.each(visibleObjects,function(visibleNode){aabb.add(visibleNode.getWorldAabb())});aabb.extend(ZOOM_FIT_PADDING);this.zoomToBox(aabb,viewportWidth,viewportHeight)}},getZoom:function(){return this.zoom},setZoom:function(value){this.zoom=(value<MAX_ZOOM)?value:MAX_ZOOM;$(document).trigger("gliffy.zoom",value)},isGridVisible:function(){return this.gridOn},setGridVisible:function(b){this.gridOn=b},isPageBreaksVisible:function(){return this.pageBreaksOn},setPageBreaksVisible:function(b){this.pageBreaksOn=b},isSnapToGrid:function(){return this.snapToGrid},setSnapToGrid:function(b){this.snapToGrid=b},isDrawingGuideOn:function(){return this.drawingGuidesOn},setDrawingGuideOn:function(b){this.drawingGuidesOn=b},isExportBorder:function(){return this.exportBorder},setExportBorder:function(b){this.exportBorder=b},setMaxWidth:function(w){this.maxWidth=w;if(window.GliffyApp){GliffyApp.documentModel.updateProperty("maxWidth",w)}},setMaxHeight:function(h){this.maxHeight=h;if(window.GliffyApp){GliffyApp.documentModel.updateProperty("maxHeight",h)}},updateProperty:function(prop,value){if(this["set"+prop]!==undefined){this["set"+prop](value)}},__toObject:function(){var i,node,objects=[],layers,object,type,stageBoundingBox,stageObject,stageObjectsLength;stageBoundingBox=new _gliffy.BoundingBox(0,0,this.maxWidth,this.maxHeight);stageObjectsLength=this.objects.length;for(i=0;i<stageObjectsLength;i++){node=this.objects[i];if(node instanceof _gliffy.Node){object=node.toObject();if(object&&_gliffy.Pick.isNodePartiallyInside(node,stageBoundingBox)){objects.push(object)}}else{throw new Error("Stage contains an unknown object type.")}}layers=this.getLayersObject();stageObject={objects:objects,background:this.background,width:this.width,height:this.height,maxWidth:this.maxWidth,maxHeight:this.maxHeight,nodeIndex:this._node_index,autoFit:this.autoFit,exportBorder:this.exportBorder,gridOn:this.gridOn,snapToGrid:this.snapToGrid,drawingGuidesOn:this.drawingGuidesOn,pageBreaksOn:this.pageBreaksOn,printGridOn:this.printGridOn,printPaper:this.printPaper,printShrinkToFit:this.printShrinkToFit,printPortrait:this.printPortrait,shapeStyles:this.shapeStyles,lineStyles:this.lineStyles,textStyles:this.textStyles,themeData:this.themeData,viewportType:this.__viewportType,layers:layers,fitBB:this.fitBB.toObject()};if(this.printModel){stageObject.printModel=this.printModel.toObject()}return stageObject},getAnalyticsData:function(){var data={diagramCategory:"none",categories:{},nodeType:{nodes:0,lines:0,groups:0,shapes:0,shapeParts:0,textChildren:0,standaloneTexts:0,images:0,multipartShapes:0,rotatedNodes:0}},split,category,uid,max=0;$.each(this._node_map,function(key,node){data.nodeType.nodes++;if(node.isLine()){data.nodeType.lines++}if(node.isGroup()){data.nodeType.groups++}if(node.isShape()){data.nodeType.shapes++;uid=node.getUid();if(uid){split=uid.split(".");if(split.length>=4){category=split[3];if(!data.categories[category]){data.categories[category]=0}data.categories[category]++}}}if(node.isShapePart()){data.nodeType.shapeParts++}if(node.isImage()){data.nodeType.images++}if(node.isMultipartShape()){data.nodeType.multipartShapes++}if(node.isTextChild()){data.nodeType.textChildren++}if(node.isStandAloneText()){data.nodeType.standaloneTexts++}if(node.getRotation()!==0){data.nodeType.rotatedNodes++}});$.each(data.categories,function(category,num){if(num>max){data.diagramCategory=category;max=num}});delete data.nodeType;return data},getLayersObject:function(){var layers;layers=_.map(this._layers,function(layer){return layer.toObject()});return layers},setLayersFromObject:function(layersArray){this._layers=_.map(layersArray,function(layerJson){return(new _gliffy.Layer()).fromObject(layerJson)},this)},getActiveLayers:function(){var layers;layers=_.filter(this._layers,function(layer){return layer.isActive()});return layers},getTopmostActiveLayer:function(){var layer;layer=_.max(this.getActiveLayers(),function(layer){return layer.getOrder()});return layer},__retrofitForLayers:function(){this._layers=[new _gliffy.Layer().fromDefault()];this._layers[0].setActive(true);_.each(this.objects,function(node){if(node instanceof _gliffy.Node){node.setLayerId(this._layers[0].getGuid())}},this)},fixNoActiveLayers:function(){var anyActiveLayers;if(!this._layers){return}anyActiveLayers=_.some(this._layers,function(layer){return layer.isActive()});if(!anyActiveLayers&&this._layers.length>0){_gliffy.Logger.warn("detected no active layers, attempting fix.");_gliffy.Utils.analyticsEvent("trackEvent",{category:"layers",action:"noActiveLayerBug"});this._layers[0].setActive(true);_.each(this.objects,function(node){if(node instanceof _gliffy.Node&&!node.isSelection()){if(node.getLayerId()===null||this.getLayerByGUID(node.getLayerId())===null){node.setLayerId(this._layers[0].getGuid());node.setOrder(0)}}},this);this.reorderNodes(this.objects)}},__fromObject:function(object,opt){this.objects.length=0;this._node_index=0;this._node_map={};this.dirty={};if(object.nodeIndex!==undefined){this._node_index=object.nodeIndex}var i,node,o,options=$.extend({subscribeToConstraints:true},opt);for(i=0;i<object.objects.length;i++){o=object.objects[i];node=new _gliffy.Node(this);node.fromObject(o,options);this.objects.push(node)}if(object.background!==undefined){this.background=object.background}if(object.width!==undefined){this.width=object.width}if(object.height!==undefined){this.height=object.height}if(object.autoFit!==undefined){this.autoFit=object.autoFit}if(object.exportBorder!==undefined){this.exportBorder=object.exportBorder}if(object.gridOn!==undefined){this.gridOn=object.gridOn}if(object.snapToGrid!==undefined){this.snapToGrid=object.snapToGrid}if(object.themeData!==undefined){this.themeData=object.themeData}if(object.drawingGuidesOn!==undefined){this.drawingGuidesOn=object.drawingGuidesOn}if(object.pageBreaksOn!==undefined){this.pageBreaksOn=object.pageBreaksOn}if(object.printGridOn!==undefined){this.printGridOn=object.printGridOn}if(object.printPaper!==undefined){this.printPaper=object.printPaper}if(object.printShrinkToFit!==undefined){this.printShrinkToFit=object.printShrinkToFit}if(object.printPortrait!==undefined){this.printPortrait=object.printPortrait}if(object.maxHeight!==undefined){this.maxHeight=object.maxHeight||MAX_WIDTH}if(object.maxWidth!==undefined){this.maxWidth=object.maxWidth||MAX_HEIGHT}if(Array.isArray(object.layers)){this.setLayersFromObject(object.layers);if(this._layers.length===0){this._layers.push(new _gliffy.Layer().fromDefault());this._layers[0].setActive(true)}this.fixNoActiveLayers()}else{this.__retrofitForLayers()}this.sendAllLayersToLayersController();this.setViewportType(object.viewportType);if(object.fitBB!==undefined){this.fitBB.fromObject(object.fitBB)}if(object.printModel!==undefined&&this.printModel){this.printModel.fromObject(object.printModel)}if(_gliffy.Editor!==undefined){if(object.shapeStyles!==undefined){this.shapeStyles=this.__buildStyles(object.shapeStyles,"ShapeStyle")}if(object.lineStyles!==undefined){this.lineStyles=this.__buildStyles(object.lineStyles,"LineStyle")}if(object.textStyles!==undefined){this.textStyles=this.__buildStyles(object.textStyles,"TextStyle")}}return this},__buildStyles:function(stylesObject,type){var key,styles={};for(key in stylesObject){if(stylesObject.hasOwnProperty(key)){styles[key]=new _gliffy[type]();styles[key].fromObject(stylesObject[key])}}return styles},__bringFrontSendBackHelper:function(nodeOrNodes,isFront){var stageNodes,sendList,orderBegin,i,orderList,activeLayers=[],reorderOptions={},guids;if(nodeOrNodes!==null){stageNodes=this.flattenNodes(false);sendList=this.__separateNodeSendToList(nodeOrNodes,stageNodes);if(isFront){stageNodes=stageNodes.concat(sendList);orderBegin=_gliffy.Layer.ABOVE_ALL_LAYERS}else{stageNodes=sendList.concat(stageNodes);orderBegin=-_gliffy.Layer.ABOVE_ALL_LAYERS}i=0;_.each(sendList,function(node){node.prevOrder=node.getOrder();node.setOrder(orderBegin+i++);activeLayers=activeLayers.concat(node.getActiveLayers())});activeLayers=_.unique(activeLayers);guids=_.map(activeLayers,function(layer){return layer.guid});if(activeLayers.length===1){reorderOptions.layerIds=[activeLayers[0].guid]}orderList=this.reorderNodes(stageNodes,{layerIds:guids});return orderList}return[]},bringToFront:function(nodeOrNodes){return this.__bringFrontSendBackHelper(nodeOrNodes,true)},sendToBack:function(nodeOrNodes){return this.__bringFrontSendBackHelper(nodeOrNodes,false)},sendAllLayersToLayersController:function(){this.fixNoActiveLayers();$(window).trigger("gliffy-stage-all-layers-updated",[this.getLayersObject()])},sendSingleLayerToLayersController:function(layer){$(window).trigger("gliffy-stage-layer-updated",[layer])},reorderNodes:function(nodes,options){var orderList=[],currentNodeOrderInfo,allNodes=[],o=$.extend({layerIds:[]},{},options);nodes=this.flattenNodeArrayWithoutReorder(nodes);_.each(nodes,function(node){var layers=node.getActiveLayers(),layer;if(layers&&_.first(layers)){layer=_.first(layers);if(!layer.tmpNodes){layer.tmpNodes=[]}if(o.layerIds.length===0||_.indexOf(o.layerIds,layer.guid)>=0){layer.tmpNodes.push(node);layer.setNodeIndex(0)}}});_.each(this._layers,function(layer){if(layer.tmpNodes){layer.tmpNodes=_.sortBy(layer.tmpNodes,function(node){return node.getOrder()});allNodes=allNodes.concat(layer.tmpNodes);_.each(layer.tmpNodes,function(node){var newOrder;if(_gliffy.Debug.POLL_LAYER_STATE){if(_.first(node.getActiveLayers()).guid!==layer.guid){_gliffy.Logger.warn("mismatch detected between nodes' layer guid and the layer it thinks it's on")}}if(node.getRawOrder()!=="auto"){newOrder=layer.getOrderForNewNode();currentNodeOrderInfo=_.findWhere(orderList,{id:node.getId()});if(currentNodeOrderInfo){currentNodeOrderInfo.order=node.getOrder();currentNodeOrderInfo.newOrder=newOrder}else{orderList.push({id:node.getId(),order:node.getOrder(),newOrder:newOrder});if(_gliffy.Debug.SHOW_LAYERS){orderList[orderList.length-1].uid=node.getUid()}}node.setOrder(newOrder)}layer.incrementNodeIndex()});delete layer.tmpNodes}},this);this.sendAllLayersToLayersController();_.each(allNodes,function(node){if(node.prevOrder!==undefined&&node.prevOrder!==null){var foundIndex=_.findWhere(orderList,{id:node.getId()});if(foundIndex){foundIndex.order=node.prevOrder}delete node.prevOrder}});return orderList},__separateNodeSendToList:function(node,flatNodeList){var ids,i,j,n,childrenList,sendList=[];ids=(node instanceof _gliffy.Node)?[node]:node;for(i=0;i<ids.length;i++){n=ids[i];flatNodeList.splice($.inArray(n,flatNodeList),1);sendList.push(n);if(ids.length===1&&n.children&&n.children.length>0){childrenList=n.flattenChildren();for(j=0;j<childrenList.length;j++){flatNodeList.splice($.inArray(childrenList[j],flatNodeList),1)}sendList=sendList.concat(childrenList)}}return sendList},flattenNodeArrayWithoutReorder:function(nodes){var flattenRecursive=function(nodes,flattened){_.each(nodes,function(node){flattened.push(node);if(node.children instanceof Array){flattened=flattened.concat(flattenRecursive(node.children,[]))}});return flattened};return flattenRecursive(nodes,[])},flattenNodes:function(forceUpdate){var nodes=[],i=0;for(i=0;i<this.objects.length;i++){this.__preorder(this.objects[i],nodes,forceUpdate)}this.updateBounds();nodes=nodes.sort(function(n1,n2){var result=n1.getOrder()-n2.getOrder();if(result===0){if(n1.isAChildOf(n2)){return 1}else{if(n2.isAChildOf(n1)){return -1}else{return n1.getId()>n2.getId()?1:-1}}}else{return result}});return nodes},visibleFlattenedNodes:function(forceUpdate){var flattenedNodes,visibleFlattenedNodes;flattenedNodes=this.flattenNodes(forceUpdate);visibleFlattenedNodes=[];$.each(flattenedNodes,function(_,node){if(!node.getHidden()&&!node.getLayerHidden()){visibleFlattenedNodes.push(node)}});return visibleFlattenedNodes},visibleNodes:function(){var nodes;nodes=_.filter(this.objects,function(node){return !node.getNodeOrLayerHidden()});return nodes},__preorder:function(node,array,forceUpdate){var c=0;if(!node){return}if(forceUpdate){if(node.getGraphic()){node.getGraphic().markDirty()}node.markDirty()}if(node.isDirty()){node.update()}array.push(node);for(c=0;node.children&&c<node.children.length;c++){this.__preorder(node.children[c],array,forceUpdate)}},detachSelectionFromGroup:function(parentNode,childLayerMap){var stage=this,childNode,childTransform,childPos,parentParentNode,selectedNodeIds=[],children=[];if(parentNode.children){parentNode.children=_.sortBy(parentNode.children,function(child){return child.getOrder()})}while(parentNode.children.length){childNode=parentNode.children[0];if(childLayerMap&&childLayerMap[childNode.getId()]){childNode.setLayerId(childLayerMap[childNode.getId()])}else{if(parentNode.getLayerId()){childNode.setLayerId(parentNode.getLayerId())}}selectedNodeIds.push(childNode.getId());parentParentNode=childNode.parent.parent;childTransform=childNode.worldTransform.clone();childPos=childTransform.transformPoint(childNode.getWidth()/2,childNode.getHeight()/2);childNode.setX(childPos.x-childNode.getWidth()/2);childNode.setY(childPos.y-childNode.getHeight()/2);childNode.setRotation(childNode.getRotation()+parentNode.getRotation());stage.removeNode(childNode,false);stage.appendNode(childNode,parentParentNode);children.push(childNode)}parentNode.setCopiedSelection(false);return selectedNodeIds},attachSelectionToGroup:function(group,nodes){var boundingBox=_gliffy.BoundingBox.SMALLEST.clone(),i,node,stage=this;group.update();this.__updateGroupAndBounds(group,nodes,boundingBox);for(i=0;i<nodes.length;i++){node=nodes[i];if(!node.isProxy()){node.setX(node.getX()-group.getX());node.setY(node.getY()-group.getY());stage.removeNode(node,false);stage.appendNode(node,group)}}},__updateGroupAndBounds:function(group,nodes,boundingBox){var i,node,dimension,stage=this;for(i=0;i<nodes.length;i++){node=nodes[i];if(!node.isProxy()){node.update();boundingBox.add(node.getWorldOverlayAabb())}}group.setX(boundingBox.min.x);group.setY(boundingBox.min.y);dimension=boundingBox.getDimension();group.setWidth(dimension.x);group.setHeight(dimension.y)},invalidateTextWithFont:function(font){var nodes=this.findGraphic(_gliffy.Text),i;for(i=0;i<nodes.length;i++){var graphic=nodes[i].getGraphic();if(graphic.getHTML()&&graphic.getHTML().toLowerCase().indexOf(font)>=0){graphic.invalidate()}}},addSelectionToGroup:function(group,nodes){var i,node,stage=this,point,inverse,lastBB;group.update();lastBB=group.getWorldAabb().clone();this.__updateGroupAndBounds(group,nodes,group.getWorldAabb().clone());group.update();for(i=0;group.children&&i<group.children.length;i++){node=group.children[i];node.setX(node.getX()-(group.getWorldAabb().min.x-lastBB.min.x));node.setY(node.getY()-(group.getWorldAabb().min.y-lastBB.min.y))}for(i=0;i<nodes.length;i++){node=nodes[i];if(!node.isProxy()){node.update();stage.removeNode(node,false);stage.appendNode(node,group);node.setX(node.getX()-group.getX());node.setY(node.getY()-group.getY())}}},getWebFonts:function(){var stage=this,textNodes=stage.findGraphic(_gliffy.Text),loadMe={},i,textGraphic,fam,fontArray;$(_.invoke(textNodes,"getGraphic")).find("span").each(function(){fam=$(this).css("font-family");if(fam){fam=fam.replace(/[\'\"]/g,"");loadMe[fam]=true}});fontArray=[];$.each(loadMe,function(key){if(_gliffy.TextUtils.FONT_FIXES[key]&&_gliffy.TextUtils.FONT_FIXES[key].isWebFont){fontArray.push("'"+key+"'")}});return fontArray},hasObjects:function(){return(this.objects!==null&&this.objects.length>0)},isTransparent:function(){return(this.background==="rgba(0, 0, 0, 0)")}})}());(function(){var CURRENT_VERSION="1.3",BETA_VERSION="1.3",CONTENT_TYPE="application/gliffy+json";function isValidVersion(version){if($.type(version)!=="string"){version=version.toString()}return CURRENT_VERSION.split(".")[0]===version.split(".")[0]}_gliffy.Gon=_gliffy.Serializable.extend({version:null,stage:null,metadata:null,embeddedResources:null,__devLinkMap:null,init:function(options){this.stage=new _gliffy.Stage(options);this.stage.gon=this;this.metadata=this.getDefaultMetadata();this.embeddedResources=new _gliffy.EmbeddedResources()},getDefaultMetadata:function(){return{title:"untitled",revision:0,exportBorder:false,loadPosition:"default"}},getMetadata:function(){return this.metadata},setMetadata:function(o){this.metadata=$.extend(this.getDefaultMetadata(),o)},getLibrariesMetadata:function(){if(this.metadata){return this.metadata.libraries}return null},setLibrariesMetadata:function(libraries){if(!this.metadata){this.metadata=this.getDefaultMetadata()}this.metadata.libraries=libraries},getAllLibrariesRequiredToLoad:function(){var librariesMetaData=this.getLibrariesMetadata(),allLibraries=[],allStageNodes;if(librariesMetaData){allLibraries=librariesMetaData.slice(0)}allStageNodes=this.stage.flattenNodeArrayWithoutReorder(this.stage.objects);_.each(allStageNodes,function(node){var libraryUid=_gliffy.shapeLibrary.getLibraryUid(node.getUid());if(libraryUid){allLibraries.push(libraryUid)}});return _.unique(allLibraries)},getEmbeddedResources:function(){return this.embeddedResources},setBetaVersion:function(){this.version=BETA_VERSION;_gliffy.Utils.disableExportsForBeta()},isBetaVersion:function(){return this.version===BETA_VERSION},setCurrentVersion:function(){this.version=CURRENT_VERSION;_gliffy.Utils.enableExportsForBeta()},updateProperty:function(prop,value){if(this["set"+prop]!==undefined){this["set"+prop](value)}else{this.stage.updateProperty(prop,value)}},__toObject:function(){var object=null,self=this,embeddedResources=null;_gliffy.Utils.tryCatch(function(){object=self.stage.toObject();embeddedResources=self.embeddedResources.toObject()},function(e){_gliffy.handleError("com.gliffy.error.file_save_malformed",[],e,self.errorTarget)});if(object!==null){return{contentType:CONTENT_TYPE,version:CURRENT_VERSION,metadata:this.metadata,embeddedResources:embeddedResources,stage:object}}else{return null}},fromObject:function(object,opt){if(!object.version||!isValidVersion(object.version)){_gliffy.Logger.error("gon.fromObject failed. The file being loaded is not a valid version:"+object.version);throw new Error("The file being loaded is not a valid version: "+object.version)}else{if(object.version===BETA_VERSION){_gliffy.Utils.disableExportsForBeta()}else{if(_gliffy.Utils.compareVersionNumbers(object.version,CURRENT_VERSION)>0){_gliffy.Logger.warn("Gliffy file is version "+object.version+" but current version is "+CURRENT_VERSION);_gliffy.Utils.notify("warn",$.i18n._("NEWER_VERSION_TITLE"),$.i18n._("NEWER_VERSION_MSG"))}}this.version=object.version||CURRENT_VERSION;this.setMetadata(object.metadata);this.stage.fromObject(object.stage,opt);this.embeddedResources.fromObject(object.embeddedResources)}return this},__populateUids:function(nodes,uids){var i,uid,node;for(i=0;i<nodes.length;i++){node=nodes[i];uid=node.getUid();if($.inArray(uid,uids)===-1&&uid){uids.push(uid)}if(node.children){this.__populateUids(node.children,uids)}}},loadEditableProperties:function(callback){if(!_gliffy.shapeLibrary){throw new Error("the shapeLibrary instance has not been initialized.")}var uids=[];this.__populateUids(this.stage.objects,uids);_gliffy.shapeLibrary.loaded.done(callback)},setDevLinkMap:function(map){this.__devLinkMap=map},getDevLinkMap:function(map){return this.__devLinkMap},__registerShapes:function(callback){var i,nodes,graphic,deferred=[],svg,resource;if(!_gliffy.shapeLibrary){throw new Error("the shapeLibrary instance has not been initialized.")}nodes=this.stage.flattenNodeArrayWithoutReorder(this.stage.objects);for(i=0;i<nodes.length;i++){graphic=nodes[i].getGraphic();if(graphic&&graphic instanceof _gliffy.Svg&&graphic.getTid()==="com.gliffy.stencil.custom.svg.static"){resource=this.getEmbeddedResources().getResource(graphic.getEmbeddedResourceId());svg=resource.getData();deferred.push(_gliffy.shapeLibrary.loadSvgStencil(svg,resource,true))}}deferred.push(_gliffy.shapeLibrary.loaded);$.when.apply(null,deferred).done(callback)},__flattenNodes:function(stage){var i,nodes=[];for(i=0;i<stage.objects.length;i++){this.__preorder(stage.objects[i],nodes)}return nodes},__preorder:function(node,array){var c;if(!node){return}array.push(node);for(c=0;node.children&&c<node.children.length;c++){this.__preorder(node.children[c],array)}}})}());(function(){_gliffy.Document=_gliffy.Serializable.extend({__gon:null,__image:null,__title:"untitled",__revision:0,__urls:null,__autosaveDisabled:false,__devLinkMap:null,__loadPosition:"default",editable:null,errorTarget:null,init:function(options){this.__gon=new _gliffy.Gon(options);this.__gon.stage.document=this;this.__urls={};this.editable=_gliffy.Editor!==undefined},getUrls:function(){return this.__urls},getGon:function(){return this.__gon},getStage:function(){return this.__gon.stage},getImage:function(){return this.__image},setImage:function(image){this.__image=image},getMetadata:function(){return this.__gon.getMetadata()},getEmbeddedResources:function(){return this.__gon.getEmbeddedResources()},getLibrariesMetadata:function(){return this.__gon.getLibrariesMetadata()},setLibrariesMetadata:function(libraries){this.__gon.setLibrariesMetadata(libraries)},setMetadata:function(metadata){this.__gon.setMetadata(metadata)},setTitle:function(title){this.__title=title},getTitle:function(){return this.__title||"untitled"},getCurrentRevision:function(){return this.__revision||0},setCurrentRevision:function(rev){this.__revision=rev},setAutosaveDisabled:function(b){this.__autosaveDisabled=b},isAutosaveDisabled:function(){if(this.__autosaveDisabled===undefined||this.__autosaveDisabled===null){return false}return this.__autosaveDisabled},getLoadPosition:function(){return this.__loadPosition},setLoadPosition:function(loadPosition){this.__loadPosition=loadPosition||"default"},loadFromObject:function(object,callback){var self=this;try{if(window.GLIFFY.DevLinkMap){window.GLIFFY.DevLinkMap.getLinkMap(object,function(map){self.__gon.setDevLinkMap(map)})}this.fromObject(object);_gliffy.shapeLibrary.loadShapesAndStencilsInDocument(this).then(function(){return _gliffy.FontLoader.waitForWebfonts(self.getGon().stage.getWebFonts())}).then(function(){self.__gon.__registerShapes(function(){if(self.editable){self.__gon.loadEditableProperties(function(){self.getStage().update();if(callback){callback()}})}else{if(callback){callback()}}})})}catch(e){if(callback){callback()}_gliffy.handleError("com.gliffy.error.file_malformed",[],e)}},loadFromText:function(text,callback){this.loadFromObject($.parseJSON(text),callback)},updateProperty:function(prop,value){if(this["set"+prop]!==undefined){this["set"+prop](value)}else{this.__gon.updateProperty(prop,value)}},refreshFromObject:function(object){this.__urls=object.urls||{};this.__title=object.title;this.__revision=object.revision;return this},isNewNotDirty:function(){return(this.getCurrentRevision()===0&&!this.getStage().isDirty())},convertToTemplate:function(){this.__title="untitled";this.__revision=0},__toObject:function(){var object=null,self=this;_gliffy.Utils.tryCatch(function(){if(_gliffy.FEATURES.allowDisableAutosave){self.setMetadata($.extend({},self.getMetadata(),{autosaveDisabled:self.__autosaveDisabled}))}self.setMetadata($.extend({},self.getMetadata(),{loadPosition:self.__loadPosition,lastSerialized:new Date().getTime(),analyticsProduct:_gliffy.analyticsProduct}));object=self.__gon.toObject()},function(e){_gliffy.handleError("com.gliffy.error.file_save_malformed",[],e,self.errorTarget)});if(object!==null){return{gon:object,image:this.__image,urls:this.__urls,title:this.__title,revision:this.__revision}}else{return null}},fromObject:function(object){if(object.gon){this.__gon.fromObject(object.gon);this.__image=object.image;this.__urls=object.urls||{};this.__title=object.title;this.__revision=object.revision;this.__metaDataFromObject(object.gon.metadata);return this}else{this.__gon.fromObject(object);this.__image=null;this.__urls=object.urls||{};this.__title=object.title;this.__revision=object.revision;this.__metaDataFromObject(object.metadata);return this}},__metaDataFromObject:function(metadata){if(metadata){if(_gliffy.FEATURES.allowDisableAutosave&&metadata.autosaveDisabled){this.setAutosaveDisabled(metadata.autosaveDisabled)}this.setLoadPosition(metadata.loadPosition)}}})}());(function(){_gliffy.Link=_gliffy.Graphic.extend({_href:null,_renderIcon:true,style:null,init:function(){this.style={}},getTid:function(){return"link"},markDirty:function(){this._dirty=true;if(this.node){this.node.markDirty();this.node.setFlag("skin");if(this.node.parent){this.node.parent.markDirty()}}},getRenderIcon:function(){return this._renderIcon},setRenderIcon:function(render){this._renderIcon=render},getHref:function(){return this._href},setHref:function(text){this._href=text;this.markDirty()},update:function(){},applyStyle:function(style){},getClassName:function(){return"Link"},__toObject:function(){this.update();return{href:this.getHref(),renderIcon:this.getRenderIcon()}},__fromObject:function(object){if(object.href!==undefined){this.setHref(object.href)}if(object.renderIcon!==undefined){this.setRenderIcon(object.renderIcon)}}})})();(function(){_gliffy.Layer=_gliffy.Serializable.extend({guid:null,_name:null,_active:null,_locked:null,_visible:null,_order:null,_nodeIndex:null,setName:function(name){this._name=name;return this},getName:function(){return this._name},setActive:function(active){this._active=active;return this},isActive:function(){return this._active},setLocked:function(locked){this._locked=locked;return this},setGuid:function(guid){this.guid=guid;return this},getGuid:function(){return this.guid},setOrder:function(order){this._order=order;return this},getOrder:function(){return this._order},isLocked:function(){return this._locked},setVisible:function(visible){this._visible=visible;return this},isVisible:function(){return this._visible},fromDefault:function(){return this.fromObject(_gliffy.Layer.DEFAULT_LAYER).setGuid(_gliffy.Utils.simpleRandomString())},getNodeIndex:function(){return this._nodeIndex},setNodeIndex:function(index){this._nodeIndex=index;return this},incrementNodeIndex:function(){this._nodeIndex++;return this},getOrderForNewNode:function(){return this.getOrder()*_gliffy.Layer.LAYER_OFFSET+this.getNodeIndex()},fromObject:function(object){if(object.name!==undefined){this.setName(object.name)}if(object.active!==undefined){this.setActive(object.active)}if(object.locked!==undefined){this.setLocked(object.locked)}if(object.visible!==undefined){this.setVisible(object.visible)}if(object.guid!==undefined){this.setGuid(object.guid)}if(object.order!==undefined){this.setOrder(object.order)}if(object.nodeIndex!==undefined){this.setNodeIndex(object.nodeIndex)}return this},toObject:function(){return{guid:this.getGuid(),order:this.getOrder(),name:this.getName(),active:this.isActive(),locked:this.isLocked(),visible:this.isVisible(),nodeIndex:this.getNodeIndex()}}});_gliffy.Layer.DEFAULT_LAYER={name:"Layer 0",active:false,locked:false,visible:true,order:0,nodeIndex:0};_gliffy.Layer.MAX_LAYERS=20;_gliffy.Layer.LAYER_OFFSET=10000;_gliffy.Layer.ABOVE_ALL_LAYERS=_gliffy.Layer.MAX_LAYERS*_gliffy.Layer.LAYER_OFFSET}());(function(){_gliffy.Viewer=_gliffy.Class.extend({document:null,target:null,iframeTarget:null,errorTarget:null,renderer:null,pointerEvents:null,__pan_on:false,__textOnHover:false,__popupNotes:false,__skipPanRender:false,__resetPanOnCenter:false,VIEWPORT_FIT_PADDING:25,init:function(o){var options=$.extend({},{rootServiceURL:_gliffy.shapeLibrary.rootServiceURL,fontPath:null},o),self=this;_gliffy.shapeLibrary.setup({rootServiceURL:options.rootServiceURL});_gliffy.FontLoader.setPath(options.fontPath);this.document=new _gliffy.Document();_gliffy.TextUtils.appendWebFontFixes();_gliffy.Plugins.activate(this);_gliffy.LinkMouseHandler=new _gliffy._LinkMouseHandler({getStageCallback:function(){return self.document.getStage()}})},render:function(o){var options,self,renderer,contents,iframeDeferred=new $.Deferred(),lazyLoadDeferred=new $.Deferred(),documentDeferred=new $.Deferred(),renderDeferred=new $.Deferred();options=$.extend({},{renderer:_gliffy.Renderer.StageMultiCanvas,url:null,json:null,jsonObj:null,target:null,iframe:false,document:null,callback:null,scale:1,textId:null,lazyLoad:false,queueRender:true,pan:false,resizeTarget:true,useImages:true,autoFitPadding:true,pointerEvents:($.browser.msie)?"auto":"none",textOnHover:($.browser.msie)?true:false,popupNotes:false,enablePan:false,skipPanRender:false,resetPanOnCenter:false},o);self=this;if(!options.target){throw new Error("No target specified")}if(!options.url&&!options.json&&!options.textId&&!options.jsonObj&&!options.document){throw new Error("No diagram to view. Pass in a url or json string.")}this.target=options.target;this.errorTarget=options.target;if(options.iframe){this.iframeTarget=options.target}if(!_gliffy.renderers[options.renderer.prototype.id]){renderer=new options.renderer();_gliffy.renderers[renderer.id]=renderer}this.renderer=_gliffy.renderers[options.renderer.prototype.id];this.__pan_on=options.pan;this.__textOnHover=options.textOnHover;this.pointerEvents=options.pointerEvents;this.__popupNotes=options.popupNotes;this.__skipPanRender=options.skipPanRender;this.__resetPanOnCenter=options.resetPanOnCenter;if(options.iframe){contents=options.target.contents();if(contents&&contents.get(0).readyState==="complete"&&contents.find("#container").length>0){iframeDeferred.resolve()}else{options.target.load(function(){iframeDeferred.resolve()})}}else{iframeDeferred.resolve()}iframeDeferred.then(function(){if(options.lazyLoad){var t=self.iframeTarget||self.target;t.lazyload({threshold:0,delay:200,callback:function(){lazyLoadDeferred.resolve()}})}else{lazyLoadDeferred.resolve()}});lazyLoadDeferred.then(function(){self.document.errorTarget=self.errorTarget;self.cleanTarget();self.setupPanHandler();self.loadDocument(options,self.document).then(function(){documentDeferred.resolve()},function(msg,error){var args=(options.url)?[options.url]:[];_gliffy.handleError(msg,args,error,self.errorTarget)})});documentDeferred.then(function(){_gliffy.Utils.tryCatch(function(){self.document.getStage().setZoom(options.scale);self.resetPan();self.renderer.render({object:self.document.getStage(),target:self.target,renderCallback:function(){renderDeferred.resolve()},resizeTarget:options.resizeTarget,pointerEvents:self.pointerEvents,queueRender:options.queueRender,useImages:options.useImages,autoFitPadding:options.autoFitPadding,cssPan:false,linkMap:options.linkMap})},function(e){_gliffy.handleError("com.gliffy.error.render_failed",[],e,self.errorTarget)})});renderDeferred.then(function(){if(self.iframeTarget){self.iframeTarget.css({width:Math.ceil(self.document.getStage().width),height:Math.ceil(self.document.getStage().height)})}if(self.__textOnHover){self.setupTextOnHover()}if(self.__popupNotes){self.setupPickForPopupNotes()}if(options.callback){options.callback()}})},loadDocument:function(options,document){var deferred=new $.Deferred();if(options.document){document=options.document;deferred.resolve()}else{_gliffy.Utils.tryCatch(function(){if(options.json){document.loadFromText(options.json,function(){deferred.resolve()})}else{if(options.url){jQuery.ajax({type:"GET",url:options.url,dataType:"json",success:function(data){document.loadFromObject(data,function(){deferred.resolve()})},error:function(xhr,text,error){var msg=$.i18n._("com.gliffy.viewer.error.general");if(xhr.status===404){msg=$.i18n._("com.gliffy.viewer.error.not_found")}else{if(xhr.status===403){msg=$.i18n._("com.gliffy.viewer.error.forbidden")}else{if(xhr.status>=500){msg=$.i18n._("com.gliffy.viewer.error.server")}}}deferred.reject(msg,error)}})}else{if(options.textId){document.loadFromText($(options.textId),function(){deferred.resolve()})}else{if(options.jsonObj){document.loadFromObject(options.jsonObj,function(){deferred.resolve()})}}}}},function(e){deferred.reject("com.gliffy.error.file_load",e)})}return deferred.promise()},cleanTarget:function(){this.target.html("");this.target.data("contexts",null)},setupTextOnHover:function(){var self,last;self=this;self.target.unbind("mousemove.gliffy.viewer");last=null;self.target.bind("mousemove.gliffy.viewer",function(event){var elements,i,ele;if(!last||last.x!==event.pageX||last.y!==event.pageY){elements=_gliffy.KoreSampl.fromEvent(event,this);i=0;for(i=0;i<elements.length;i++){ele=$(elements[i]);if(ele.hasClass("gliffy-text")){ele.css({zIndex:self.document.getStage()._node_index+1});break}}last={x:event.pageX,y:event.pageY}}})},redraw:function(callback,forceUpdate,resizeTarget,autoFitPadding){forceUpdate=(forceUpdate)?true:false;autoFitPadding=(autoFitPadding)?true:false;resizeTarget=(resizeTarget!==false);var self=this;_gliffy.Utils.tryCatch(function(){self.errorTarget=self.target;self.renderer.render({object:self.document.getStage(),target:self.target,cssPan:true,renderCallback:function(){if(self.__textOnHover){self.setupTextOnHover()}if(callback){callback()}},forceUpdate:forceUpdate,resizeTarget:resizeTarget,pointerEvents:self.pointerEvents,queueRender:true,useImages:true,autoFitPadding:autoFitPadding})},function(e){_gliffy.handleError("com.gliffy.error.render_failed",[],e,self.errorTarget)})},zoom:function(zoomValue,callback,resizeTarget){this.document.getStage().setZoom(zoomValue);this.redraw(callback,true,resizeTarget)},zoomToCenter:function(zoomValue,callback,resizeTarget){this.document.getStage().zoomToCenter(zoomValue,this.target.width(),this.target.height());this.redraw(callback,true,resizeTarget)},zoomToFit:function(viewportWidth,viewportHeight,callback,resizeTarget){this.document.getStage().zoomToCenter(viewportWidth,viewportHeight);this.redraw(callback,true,resizeTarget)},reset:function(callback,resizeTarget){this.document.getStage().pan_x=0;this.document.getStage().pan_y=0;this.document.getStage().setZoom(1);this.redraw(callback,true,resizeTarget)},resetPan:function(callback){var fitBB=this.document.getStage().fitBB.clone(),hasValidBoundingBox;hasValidBoundingBox=fitBB.getWidth()>0&&fitBB.getHeight()>0;if(hasValidBoundingBox&&this.__resetPanOnCenter){fitBB.max.x=Math.min(fitBB.max.x,this.document.getStage().maxWidth);fitBB.max.y=Math.min(fitBB.max.y,this.document.getStage().maxHeight);this.pan(-fitBB.min.x+($(document).width()-fitBB.getWidth())/2,-fitBB.min.y+($(document).height()-fitBB.getHeight())/2,callback)}else{if(hasValidBoundingBox&&this.document.getStage().getViewportType()==="fit"){this.pan(-fitBB.min.x+this.VIEWPORT_FIT_PADDING,-fitBB.min.y+this.VIEWPORT_FIT_PADDING,callback)}else{this.pan(0,0,callback)}}},pan:function(x,y,callback){this.document.getStage().pan_x=x;this.document.getStage().pan_y=y;var self=this;if(!this.__skipPanRender){_gliffy.Utils.tryCatch(function(){self.renderer.render({object:self.document.getStage(),target:self.target,panOnly:true,autoFitPadding:true,cssPan:true,renderCallback:callback})},function(e){_gliffy.handleError("com.gliffy.error.render_failed",[],e,self.errorTarget)})}},togglePan:function(activate,dragTarget){this.__pan_on=activate;this.setupPanHandler(dragTarget)},setupPanHandler:function(dragTarget){var self,target,lastpos;self=this;target=dragTarget||this.target;target.off("draginit");target.off("drag");target.off("mousedown.cursor");target.off("mouseup.cursor");if(this.__pan_on){lastpos={x:this.document.getStage().pan_x,y:this.document.getStage().pan_y};target.on("mousedown.cursor",function(){target.removeClass("gliffy-grab");target.addClass("gliffy-grabbing")});target.on("mouseup.cursor",function(){target.removeClass("gliffy-grabbing");target.addClass("gliffy-grab")});target.on("draginit",{which:1,not:":input,.gliffy-controls"},function(event){lastpos={x:event.pageX,y:event.pageY}});target.on("drag",{which:1,not:":input,.gliffy-controls"},function(event){var xDiff,yDiff;xDiff=event.pageX-lastpos.x;yDiff=event.pageY-lastpos.y;lastpos={x:event.pageX,y:event.pageY};self.document.getStage().pan_x=self.document.getStage().pan_x+xDiff;self.document.getStage().pan_y=self.document.getStage().pan_y+yDiff;_gliffy.Utils.tryCatch(function(){self.renderer.render({object:self.document.getStage(),target:self.target,panOnly:true,autoFitPadding:true,cssPan:true});$(window).trigger("gliffy.viewer.pan.drag",[self,{x:xDiff,y:yDiff}])},function(e){_gliffy.handleError("com.gliffy.error.render_failed",[],e,self.errorTarget)})});target.addClass("gliffy-grab")}else{target.removeClass("gliffy-grab gliffy-grabbing")}},getImageData:function(imgType,callback){var tmp;tmp=$("<div/>");$("body").append(tmp);if(!_gliffy.renderers[_gliffy.Renderer.StageSingleCanvas.prototype.id]){_gliffy.renderers[_gliffy.Renderer.StageSingleCanvas.prototype.id]=new _gliffy.Renderer.StageSingleCanvas()}_gliffy.renderers[_gliffy.Renderer.StageSingleCanvas.prototype.id].render({object:this.document.getStage(),target:tmp,renderCallback:function(){var $canvas,canvas,imageData;$canvas=tmp.find("canvas");canvas=$canvas.get(0);imageData=canvas.toDataURL("image/"+imgType);tmp.remove();callback(imageData)}})},hidePopupNotes:function(){_gliffy.PopupNotesMouseHandler.removeCurrentPopover();_gliffy.PopupNotesMouseHandler.hideAllNotes()},showPopupNotes:function(){_gliffy.PopupNotesMouseHandler.removeCurrentPopover();_gliffy.PopupNotesMouseHandler.showAllNotes()},hasPopupNotes:function(){return _gliffy.PopupNotesMouseHandler.hasPopupNotes()}})}());(function(){var SLIDER_RANGE_MIN=0,SLIDER_RANGE_MAX=100,MOUSE_WHEEL_LOCKOUT_TIME=250;_gliffy.EmbeddableViewer=_gliffy.Class.extend({viewer:null,viewerTarget:null,viewerTargetWidth:0,viewerTargetHeight:0,renderer:null,documentURL:null,target:null,originX:null,originY:null,renderScale:1.85,zoomMin:0.15,zoomMax:8,zoomIncrement:10,notesOn:false,iconsOn:true,panning:false,screenMousePos:null,stageMousePos:null,stageTransform:null,initPromise:null,mouseWheelLockout:false,hasResetOriginValues:false,init:function(o){var self=this,initDeferred=new $.Deferred(),options=$.extend({},{rootServiceURL:_gliffy.shapeLibrary.rootServiceURL,fontPath:null,renderer:_gliffy.Renderer.StageMultiCanvas,controlsLeft:["edit","fit","popupNotes"],controlsCenter:["zoom"],controlsRight:["return"]},o);this.renderer=options.renderer;this.url=options.url;this.target=options.target;this.controlsLeft=options.controlsLeft;this.controlsCenter=options.controlsCenter;this.controlsRight=options.controlsRight;this.controls=this.controlsLeft.concat(this.controlsCenter,this.controlsRight);this.screenMousePos={x:0,y:0};this.stageMousePos={x:0,y:0};this.initPromise=initDeferred.promise();this.viewer=new _gliffy.Viewer({rootServiceURL:options.rootServiceURL,fontPath:options.fontPath});this.target.css({position:"absolute",left:"-9999px"});$("body").append($("<div/>",{"class":"gliffy-spinner-container"}));$(window).resize(this.__windowResize);_gliffy.Spinner.showSmallSpinner($(".gliffy-spinner-container"));this.initPromise.always(function(){$(".gliffy-spinner-container").remove()});this.viewer.loadDocument(options,this.viewer.document).then(function(){try{self.__bindControls();self.__renderControls();self.viewer.render({document:self.viewer.document,target:self.viewerTarget,renderer:self.renderer,scale:self.renderScale,resetPanOnCenter:true,callback:function(){var stage=self.viewer.document.getStage();self.viewerTargetWidth=Math.min(stage.maxWidth,stage.fitBB.max.x+self.viewer.VIEWPORT_FIT_PADDING);self.viewerTargetHeight=Math.min(stage.maxHeight,stage.fitBB.max.y+self.viewer.VIEWPORT_FIT_PADDING);self.__resetOriginValuesAndFitToScreen();self.setupPan($(".gliffy-embeddable-viewer"));self.target.css({position:"static",left:0});$(".gliffy-embeddable-viewer .gliffy-button").miniTip({offset:0});$(".gliffy-embeddable-viewer").css("background-color",stage.background);$(".gliffy-embeddable-viewer").dblclick(function(e){self.__doZoomToPoint({x:e.pageX,y:e.pageY})});$(".gliffy-controls").dblclick(function(e){e.stopPropagation();e.preventDefault()});$(".gliffy-embeddable-viewer").bind("mousewheel",function(ev,delta,deltaX,deltaY){ev.preventDefault();if(!self.mouseWheelLockout){self.mouseWheelLockout=true;if(deltaY>0){self.__handleZoomInCall()}else{self.__handleZoomOutCall()}setTimeout(function(){self.mouseWheelLockout=false},MOUSE_WHEEL_LOCKOUT_TIME)}});initDeferred.resolve()}})}catch(e){initDeferred.reject(e)}},function(e){self.__bindControls();self.__renderControls();initDeferred.reject(e)});_gliffy.PopupNotesMouseHandler.setCustomMouseTrigger(true);_gliffy.LinkMouseHandler.setCustomMouseTrigger(true)},getInitPromise:function(){return this.initPromise},hideActiveNotes:function(){if(this.notesOn){_gliffy.PopupNotesMouseHandler.hideAllNotes();$(".gliffy-popover.gliffy-popup-note").remove()}_gliffy.PopupNotesMouseHandler.removeCurrentPopover()},showActiveNotes:function(){if(this.notesOn){_gliffy.PopupNotesMouseHandler.showAllNotes()}else{_gliffy.PopupNotesMouseHandler.removeCurrentPopover()}},hasPopupNotes:function(){return _gliffy.PopupNotesMouseHandler.hasPopupNotes()},setupPan:function(dragTarget){var lastpos={x:this.viewer.document.getStage().pan_x,y:this.viewer.document.getStage().pan_y},self=this,value=this.slider.value;dragTarget.off("draginit");dragTarget.off("drag");dragTarget.off("mousedown.cursor");dragTarget.off("mouseup.cursor");dragTarget.off("mousemove.cursor");dragTarget.on("mousedown.cursor",function(){dragTarget.removeClass("gliffy-grab");dragTarget.addClass("gliffy-grabbing")});dragTarget.on("mouseup.cursor",function(){dragTarget.removeClass("gliffy-grabbing");dragTarget.addClass("gliffy-grab")});dragTarget.on("draginit",{which:1,not:":input,span,.gliffy-controls"},function(event){lastpos={x:event.pageX,y:event.pageY};$("body").trigger("custom-mouse-trigger.gliffy-link-handler",[self.stageMousePos,dragTarget,self.panning]);self.panning=true;self.hideActiveNotes()});dragTarget.on("drag",{which:1,not:":input,span,.gliffy-controls"},function(event){var xDiff=event.pageX-lastpos.x,yDiff=event.pageY-lastpos.y,sliderValueAsZoomValue;lastpos={x:event.pageX,y:event.pageY};self.viewer.document.getStage().pan_x=self.viewer.document.getStage().pan_x+xDiff;self.viewer.document.getStage().pan_y=self.viewer.document.getStage().pan_y+yDiff;sliderValueAsZoomValue=self.__convertSliderValueToZoomValue(self.slider.value);self.origin_x-=xDiff*(value/(sliderValueAsZoomValue*100));self.origin_y-=yDiff*(value/(sliderValueAsZoomValue*100));self.__doZoomCenter(sliderValueAsZoomValue*100,sliderValueAsZoomValue*100)});dragTarget.on("dragend mouseup",{which:1,not:":input,span,.gliffy-controls"},function(event){self.panning=false;self.showActiveNotes()});dragTarget.on("mousemove.cursor",{which:1,not:":input,span,.gliffy-controls"},function(event){self.screenMousePos={x:event.pageX,y:event.pageY};if(self.stageTransform){self.stageMousePos=self.stageTransform.createInverse().transformPoint(self.screenMousePos.x,self.screenMousePos.y)}if(!self.panning){$("body").trigger("custom-mouse-trigger.gliffy-popup-notes",[self.stageMousePos])}$("body").trigger("custom-mouse-trigger.gliffy-link-handler",[self.stageMousePos,dragTarget,self.panning])})},__bindControls:function(){var i,name;for(i=0;i<this.controls.length;i++){name=this.__getBindFunctionName(this.controls[i]);if(this[name]){this[name](this.target)}}},__renderControls:function(){var i,name,control,container=$("<div/>",{"class":"gliffy-embeddable-viewer"}),controls=$("<div/>",{"class":"gliffy-controls"}),controlsLeft=$("<div/>",{"class":"gliffy-controls-left"}),controlsCenter=$("<div/>",{"class":"gliffy-controls-center"}),controlsRight=$("<div/>",{"class":"gliffy-controls-right"}),content=$("<div/>",{"class":"gliffy-viewer-content"}),viewerTarget=$("<div/>",{"class":"gliffy-viewer-target"});this.viewerTarget=viewerTarget;this.$controlsCenter=controlsCenter;this.target.append(container);content.append(viewerTarget);container.append(content);container.append(controls);controls.append(controlsCenter);controls.append(controlsLeft);controls.append(controlsRight);for(i=0;i<this.controls.length;i++){control=this.controls[i];name=this.__getControlFunctionName(control);if(this[name]){if(this.controlsLeft.indexOf(control)>-1){controlsLeft.append(this[name]())}else{if(this.controlsCenter.indexOf(control)>-1){controlsCenter.append(this[name]())}else{if(this.controlsRight.indexOf(control)>-1){controlsRight.append(this[name]())}}}}}},__getControlFunctionName:function(name){return"__"+name+"Control"},__getBindFunctionName:function(name){return"__"+name+"Bind"},__editControl:function(){return $('<a href="#" title="'+$.i18n._("EMBEDDABLE_VIEWER_BUTTON_EDIT")+'" class="gliffy-button gliffy-edit"><span class="gliffy-viewer-icon gliffy-viewerIcon-edit"></span></a>')},__editBind:function(target){target.on("click",".gliffy-edit",function(event){event.preventDefault()})},__popupNotesControl:function(){return $('<a href="#" title="'+$.i18n._("EMBEDDABLE_VIEWER_BUTTON_NOTES")+'" class="gliffy-button gliffy-notes"><span class="gliffy-viewer-icon gliffy-viewerIcon-notes"></span></a>')},__popupNotesBind:function(target){var self=this;target.on("click",".gliffy-notes",function(event){event.preventDefault();self.notesOn=!self.notesOn;$(this).toggleClass("gliffy-active");if(!self.notesOn){$(".gliffy-popover.gliffy-popup-note").remove()}_gliffy.PopupNotesMouseHandler[self.notesOn?"showAllNotes":"hideAllNotes"]()})},__fitControl:function(){return $('<a href="#" title="'+$.i18n._("EMBEDDABLE_VIEWER_BUTTON_FIT_TO_SCREEN")+'" class="gliffy-button gliffy-fit"><span class="gliffy-viewer-icon gliffy-viewerIcon-fit"></span></a>')},__fitBind:function(target){var self=this;target.on("click",".gliffy-fit",function(event){event.preventDefault();self.viewer.resetPan(function(){self.__resetOriginValuesAndFitToScreen();self.slider.value=SLIDER_RANGE_MAX/2;self.slider.moveHandle()})})},__resetOriginValuesAndFitToScreen:function(){var transform=new GLIFFY.AffineTransform(1/this.renderScale,0,0,1/this.renderScale,0,0),resetZoomValue,viewportWidth,viewportHeight,diagramViewportWidthRatio,diagramViewportHeightRatio,self=this;$(".gliffy-viewer-content").hide();viewportWidth=$(document).width();viewportHeight=$(document).height();$("body").find(".gliffy-stage").css(GLIFFY.Utils.transformCss(transform));this.origin_x=-this.viewer.document.getStage().pan_x;this.origin_y=-this.viewer.document.getStage().pan_y;this.center_x=$(document).width()/2;this.center_y=$(document).height()/2;this.stageTransform=this.__calculateStageTransform(this.slider?this.slider.value/100:1,1);this.viewerTarget.css({width:this.viewerTargetWidth+"px",height:this.viewerTargetHeight+"px"});resetZoomValue=SLIDER_RANGE_MAX/2;diagramViewportWidthRatio=this.viewerTargetWidth/viewportWidth;diagramViewportHeightRatio=this.viewerTargetHeight/(viewportHeight-$(".gliffy-controls").height());if(diagramViewportWidthRatio>1||diagramViewportHeightRatio>1){if(diagramViewportWidthRatio>diagramViewportHeightRatio){resetZoomValue=resetZoomValue/diagramViewportWidthRatio}else{resetZoomValue=resetZoomValue/diagramViewportHeightRatio}}setTimeout(function(){self.__handleZoomCall(resetZoomValue<self.zoomMin*100?0:resetZoomValue);$(".gliffy-viewer-content").show();if(!self.hasResetOriginValues){self.viewer.resetPan();self.hasResetOriginValues=true}},0)},__windowResize:function(){this.center_x=$(document).width()/2;this.center_y=$(document).height()/2},__calculateStageTransform:function(scale,zoom){return new GLIFFY.AffineTransform(scale,0,0,scale,this.viewer.document.getStage().pan_x,this.viewer.document.getStage().pan_y).translate(this.origin_x,this.origin_y).scale(zoom,zoom).translate(-(this.center_x/scale+this.origin_x-this.center_x/(scale*zoom)),-(this.center_y/scale+this.origin_y-this.center_y/(scale*zoom)))},__doZoomCenter:function(currentScale,lastScale){var scale,zoom,transform;_gliffy.PopupNotesMouseHandler.hideAllNotes();scale=lastScale/100;zoom=(currentScale/lastScale);transform=this.__calculateStageTransform(scale,zoom).scale(1/this.renderScale,1/this.renderScale);this.viewer.document.getStage().pan_x=transform.getValue(4);this.viewer.document.getStage().pan_y=transform.getValue(5);this.viewerTarget.css({left:this.viewer.document.getStage().pan_x+"px",top:this.viewer.document.getStage().pan_y+"px",width:(this.viewerTargetWidth*(scale*zoom))+"px",height:(this.viewerTargetHeight*(scale*zoom))+"px"});this.origin_x=(this.center_x/scale+this.origin_x-this.center_x/(scale*zoom));this.origin_y=(this.center_y/scale+this.origin_y-this.center_y/(scale*zoom));this.stageTransform=transform.clone().scale(this.renderScale,this.renderScale);$("body").find(".gliffy-stage").css(GLIFFY.Utils.transformCss(transform))},__doZoomToPoint:function(mousePosition){var xDiff=mousePosition.x-this.center_x,yDiff=mousePosition.y-this.center_y,newZoom,sliderValueToZoomValue;this.viewer.document.getStage().pan_x=this.viewer.document.getStage().pan_x-xDiff;this.viewer.document.getStage().pan_y=this.viewer.document.getStage().pan_y-yDiff;sliderValueToZoomValue=this.__convertSliderValueToZoomValue(this.slider.value);newZoom=this.__convertSliderValueToZoomValue(this.slider.value+this.zoomIncrement);this.origin_x-=xDiff*(newZoom/(sliderValueToZoomValue*100));this.origin_y-=yDiff*(newZoom/(sliderValueToZoomValue*100));this.__handleZoomInCall()},__zoomControl:function(){var self=this;this.__resetOriginValuesAndFitToScreen();this.slider=new _gliffy.Slider({target:this.$controlsCenter,min:SLIDER_RANGE_MIN,max:SLIDER_RANGE_MAX,reset_value:SLIDER_RANGE_MAX/2,value:SLIDER_RANGE_MAX/2,reset_step:4,dragStartCallback:function(){self.hideActiveNotes()},dragCallback:function(s,last){if(s.value!==last){self.__doZoomCenter(self.__convertSliderValueToZoomValue(s.value)*100,self.__convertSliderValueToZoomValue(last)*100)}},dragEndCallback:function(){self.showActiveNotes()}});this.$controlsCenter.append($('<a href="#" title="'+$.i18n._("EMBEDDABLE_VIEWER_BUTTON_ZOOM_OUT")+'" class="gliffy-button gliffy-zoom-out"><span class="gliffy-viewer-icon gliffy-viewerIcon-zoom-out"></span></a>'));this.$controlsCenter.append($('<a href="#" title="'+$.i18n._("EMBEDDABLE_VIEWER_BUTTON_ZOOM_IN")+'" class="gliffy-button gliffy-zoom-in"><span class="gliffy-viewer-icon gliffy-viewerIcon-zoom-in"></span></a>'))},__zoomBind:function(target){var self=this;target.on("click",".gliffy-zoom-in",function(event){event.preventDefault();self.__handleZoomInCall()});target.on("click",".gliffy-zoom-out",function(event){event.preventDefault();self.__handleZoomOutCall()})},__handleZoomInCall:function(){var newSliderValue=this.slider.value+this.zoomIncrement;if(this.__convertSliderValueToZoomValue(newSliderValue)>this.zoomMax){newSliderValue=SLIDER_RANGE_MAX}this.__handleZoomCall(newSliderValue)},__handleZoomOutCall:function(){var newSliderValue=this.slider.value-this.zoomIncrement,min=this.zoomMin*100;if(this.__convertSliderValueToZoomValue(newSliderValue)<this.zoomMin){newSliderValue=SLIDER_RANGE_MIN}this.__handleZoomCall(newSliderValue)},__handleZoomCall:function(newValue){var last=this.slider.value;this.slider.value=newValue;this.slider.moveHandle();this.hideActiveNotes();this.__doZoomCenter(this.__convertSliderValueToZoomValue(this.slider.value)*100,this.__convertSliderValueToZoomValue(last)*100);this.showActiveNotes()},__returnControl:function(){return $('<a href="#" title="'+$.i18n._("EMBEDDABLE_VIEWER_BUTTON_EXIT_FULL_SCREEN")+'" class="gliffy-button gliffy-return"><span class="gliffy-viewer-icon gliffy-viewerIcon-return"></span></a>')},__returnBind:function(target){target.on("click",".gliffy-return",function(event){event.preventDefault()})},__convertSliderValueToZoomValue:function(sliderValue){var zoomValue=1;if(sliderValue<SLIDER_RANGE_MAX/2){zoomValue=(sliderValue*(1-this.zoomMin))/(SLIDER_RANGE_MAX/2)+this.zoomMin}else{if(sliderValue>SLIDER_RANGE_MAX/2){zoomValue=((sliderValue-SLIDER_RANGE_MAX/2)*this.zoomMax)/(SLIDER_RANGE_MAX/2)+1}}return zoomValue}})}());(function(){_gliffy._LinkMouseHandler=_gliffy.Class.extend({_getStageCallback:null,init:function(options){var o=$.extend({},{getStageCallback:function(){return[]},target:$()},options),self=this,startedScroll;this._getStageCallback=o.getStageCallback;$("body").on("mousemove.gliffy-link-handler",function(e){var x=e.pageX,y=e.pageY,offset,zoom;if($(".gliffy-stage").length>0){offset=$(".gliffy-stage").offset();x-=offset.left;y-=offset.top}zoom=self._getStageCallback().getZoom();x/=zoom;y/=zoom;self.mouseChangeFunc({x:x,y:y})})},mouseChangeFunc:function(pos,dragTarget,panning){var node,href=null,linkNodes,domViewbox;if(!dragTarget){dragTarget=$(".gliffy-stage")}node=_gliffy.Pick.getNodeAt(this._getStageCallback().objects,pos.x,pos.y,{doNotIncludeGroup:true});if(node){linkNodes=node.findGraphic(_gliffy.Link);if(linkNodes.length>0){dragTarget.addClass("gliffy-clickable");href=linkNodes[0].getGraphic().getHref();domViewbox=node.getDomViewbox();if(domViewbox&&domViewbox.data("href")){href=domViewbox.data("href")}}}$(dragTarget).off("click.gliffy-link-handler");if(href){$(dragTarget).on("click.gliffy-link-handler",function(){$(this).off("click.gliffy-link-handler");if(!panning){window.open(href,"_blank")}})}else{dragTarget.removeClass("gliffy-clickable")}},setCustomMouseTrigger:function(){var self=this;$("body").off("mousemove.gliffy-link-handler");$("body").on("custom-mouse-trigger.gliffy-link-handler",function(ev,pt,dragTarget,panning){self.mouseChangeFunc(pt,dragTarget,panning)})}})}());(function(){_gliffy.Renderer=_gliffy.Class.extend({id:null,target:null,init:function(){throw"this is the renderer interface"},render:function(options){throw"check for renderer options later"}})})();(function(){_gliffy.Renderer.IconRenderer=_gliffy.Renderer.extend({id:"Gliffy.Renderer.IconRenderer",target:null,init:function(){_gliffy.renderers[this.id]=this},render:function(o){var options=$.extend({},{target:null,viewboxDom:null,iconClass:null,graphicType:null,oppositeGraphicType:null,renderLeftIfOppositeGraphicTypeExists:false,renderPopupPoints:false},o),node=options.target,graphic=null,iconDom,i,widthMultiplier=1,heightMultiplier=1,shapeInfo=node.getShapeInformation(),popupPoints,hasOpposingGraphicType=false,renderLeft=false;$.each(options,function(key,val){if(options[key]===undefined||options[key]===null){throw new Error("IconRenderer missing option "+key)}});if(node.supportsIcon()){if(!options.viewboxDom){return}if(node.children){for(i=0;i<node.children.length;i++){if(node.children[i].getGraphic() instanceof options.graphicType){graphic=node.children[i].getGraphic()}if(node.children[i].getGraphic() instanceof options.oppositeGraphicType){hasOpposingGraphicType=true}}}renderLeft=options.renderLeftIfOppositeGraphicTypeExists&&hasOpposingGraphicType;if(graphic){iconDom=options.viewboxDom.find("."+options.iconClass);if(iconDom.length===0){iconDom=$('<div class="'+options.iconClass+'" style="position:absolute"></div>');options.viewboxDom.append(iconDom)}if(!graphic.getRenderIcon()){iconDom.hide();return}iconDom.show();if(shapeInfo&&shapeInfo.defaults&&shapeInfo.defaults.popupNoteRatio){widthMultiplier=shapeInfo.defaults.popupNoteRatio.x;heightMultiplier=shapeInfo.defaults.popupNoteRatio.y}if(_gliffy.Debug.POPUP_NOTE_POSITION){if(_gliffy.Debug.popupWidthMultiplier!==undefined){widthMultiplier=_gliffy.Debug.popupWidthMultiplier}if(_gliffy.Debug.popupWidthMultiplier!==undefined){heightMultiplier=_gliffy.Debug.popupHeightMultiplier}}iconDom.css(_gliffy.Utils.transformCss(_gliffy.AffineTransform.getRotateInstance(-_gliffy.Utils.degreesToRadians(node.getWorldRotation()),7,7).preTranslate(node.getWidth()*widthMultiplier-9,node.getHeight()*heightMultiplier-9).translate(-(renderLeft?18:0),0)));if(options.renderPopupPoints){popupPoints=options.viewboxDom.find(".gliffy-popup-point");if(popupPoints.length===0){for(i=0;i<8;i++){popupPoints=$('<div class="gliffy-popup-point"></div>');options.viewboxDom.append(popupPoints)}popupPoints=options.viewboxDom.find(".gliffy-popup-point")}$(popupPoints[0]).css({left:node.getWidth()/2+"px",top:0+"px"}).addClass("gliffy-popup-point-n");$(popupPoints[1]).css({left:0+"px",top:node.getHeight()/2+"px"}).addClass("gliffy-popup-point-w");$(popupPoints[2]).css({left:node.getWidth()/2+"px",top:node.getHeight()+"px"}).addClass("gliffy-popup-point-s");$(popupPoints[3]).css({left:node.getWidth()+"px",top:node.getHeight()/2+"px"}).addClass("gliffy-popup-point-e");$(popupPoints[4]).css({left:0+"px",top:0+"px"}).addClass("gliffy-popup-point-nw");$(popupPoints[5]).css({left:node.getWidth()+"px",top:0+"px"}).addClass("gliffy-popup-point-ne");$(popupPoints[6]).css({left:node.getWidth()+"px",top:node.getHeight()+"px"}).addClass("gliffy-popup-point-se");$(popupPoints[7]).css({left:0+"px",top:node.getHeight()+"px"}).addClass("gliffy-popup-point-sw")}}else{options.viewboxDom.find("."+options.iconClass).remove();if(options.renderPopupPoints){options.viewboxDom.find(".gliffy-popup-point").remove()}}}if(options.renderCallback){options.renderCallback()}}})})();(function(){_gliffy.Renderer.TextDom=_gliffy.Renderer.extend({id:"Gliffy.Renderer.TextDom",target:null,__vertical_offset:0,__middle_valign_offset:0,__domElement:null,transform:null,init:function(){_gliffy.renderers[this.id]=this},render:function(o){if(!o){throw new Error("text renderer needs options")}if(!o.container){throw new Error("needs a target container")}if(!(o.object&&o.object instanceof _gliffy.Text)){throw new Error("needs a text object to render!")}var options=$.extend({},{renderCallback:null},o),text=options.object,container=options.container,domStage=options.stage,stage=text.node.stage,zIndex=options.zIndex,offsetY,transform,bounds,createTextNodes,stageZoom;if(!(text.editable.isEditable&&text.editable.getEditMode())&&(options.forceRedraw||text.node.hasRepositionCanvasFlag()||text.node.hasRedrawCanvasFlag())&&(text.node.getDomElement().css("display")!=="none")&&stage instanceof _gliffy.Stage){createTextNodes=!text.__cachedDomResult||text.node.hasRepositionCanvasFlag();if(createTextNodes){if(options.useClassDomObject){$("."+text.node._domId).remove()}else{text.node.getDomElement().remove()}text.__cachedDomResult=this.__buildDomObject(text,options.useClassDomObject);domStage.append(text.__cachedDomResult)}if(typeof text.__cachedDomResult=="string"||text.__cachedDomResult instanceof String){text.__cachedDomResult=$(text.__cachedDomResult)}text.__cachedDomResult.data("node",text.node);if(!options.zIndex){zIndex=0}this.__middle_valign_offset=(text.node.getHeight()/2)-(text.getCalculatedHeight()/2);offsetY=(text.getValign()==="middle")?this.__middle_valign_offset+this.__vertical_offset:this.__vertical_offset;stageZoom=stage.getZoom();transform=text.node.worldTransform;transform=new _gliffy.AffineTransform(1,0,0,1,0,0).scale(stageZoom,stageZoom).concatenate(transform).translate(text.style.x,text.style.y+offsetY);if(createTextNodes||text.node.hasRepositionCanvasFlag()){text.__cachedDomResult.css($.extend(_gliffy.Utils.transformCss(transform,{roundTranslate:true}),{width:this.__getObjectWidth(text),height:text.style.height,visibility:"visible",position:"absolute",zIndex:zIndex,display:"block",margin:0,padding:0}))}if(text.isComputePositioning()||options.forceRedraw){text.markDirty();text.update();if(options.useClassDomObject){$("."+text.node._domId).remove()}else{text.node.getDomElement().remove()}text.__cachedDomResult=this.__buildDomObject(text,options.useClassDomObject);text.__cachedDomResult.data("node",text.node);transform=new _gliffy.AffineTransform(1,0,0,1,0,0).scale(stageZoom,stageZoom).concatenate(text.node.worldTransform).translate(text.style.x,text.style.y+offsetY);this.transform=transform;if(o.removeTransform){transform=new _gliffy.AffineTransform()}text.__cachedDomResult.css($.extend(_gliffy.Utils.transformCss(transform,{roundTranslate:true}),{width:this.__getObjectWidth(text),height:text.style.height,visibility:"visible",position:"absolute",zIndex:zIndex,display:"block",margin:0,padding:0}));domStage.append(text.__cachedDomResult);text.positionComputed()}text.__cachedDomResult.data("transform",transform);if(stage.autoFit){bounds=_gliffy.Utils.maxBounds(transform,text.style.width,text.style.height,stage);text.node.current_bounds=bounds;if(bounds.x>stage.width||bounds.y>stage.height){stage.width=Math.max(stage.width,bounds.x);stage.height=Math.max(stage.height,bounds.y)}}text.node.resetFlags();this.__domElement=text.__cachedDomResult;if(options.cachePreRenderInfo){text.preRenderInfo={transform:this.transform,domElement:this.getDomElement()}}if(options.renderCallback){options.renderCallback()}}},getDomElement:function(){return this.__domElement},__getObjectWidth:function(object){return object.style.width+1},__buildDomObject:function(object,useClassDomObject){var textNode,class_,bgcolor="transparent",shapeInfo,themeType;class_="gliffy-text gliffy-graphic gliffy-rte-text";if(object.node.parent){if(object.node.parent.isLine()){class_+=" gliffy-text-with-line-parent";bgcolor=object.node.stage.background==="transparent"?"#ffffff":object.node.stage.background}else{if(object.node.parent.isShape()){shapeInfo=object.node.parent.getShapeInformation();themeType=(shapeInfo&&shapeInfo.defaults&&shapeInfo.defaults.themeType)?shapeInfo.defaults.themeType:null;if(themeType){class_+=" gliffy-text-with-shape-parent-"+themeType}}}}else{class_+=" gliffy-text-standalone"}if(useClassDomObject){class_+=" "+object.node._domId}if(object.node.getLayerLocked()){class_+="  gliffy-locked-layer"}textNode=$("<div/>",{id:useClassDomObject?"":object.node._domId,"class":class_}).css({width:this.__getObjectWidth(object),height:object.style.height,visibility:"hidden",overflow:"visible",display:"block",margin:0,padding:0,backgroundColor:bgcolor}).append(object.getHTML());return textNode}})}());_gliffy.Renderer.TextHtml2Canvas=_gliffy.Renderer.TextDom.extend({id:"Gliffy.Renderer.TextHtml2Canvas",target:null,init:function(){_gliffy.renderers[this.id]=this},render:function(o){var domElement,context=o.target,object=o.object,transform,values,isRenderingSVG=context.canvas.getContext===undefined,self=this,invZoom,doShapeOpt=true;if(o.preRender){this._super($.extend({},o,{forceRedraw:true,useClassDomObject:true,removeTransform:true,cachePreRenderInfo:true}))}else{try{domElement=object.preRenderInfo.domElement}catch(exception){_gliffy.Logger.error("need to call this rendererer with options.preRender = true first!")}transform=object.preRenderInfo.transform;if(transform){if(object.style.text_background_fill){domElement[0].style.backgroundColor=object.style.text_background_fill;doShapeOpt=false}context.save();if(o.ignoreZoom){invZoom=1/object.node.stage.getZoom();transform.preScale(invZoom,invZoom)}values=transform.getValues();context.transform(values[0],values[1],values[2],values[3],Math.round(values[4]),Math.round(values[5]));html2canvas(domElement[0],{async:false,canvas:context.canvas,background:"transparent",useSVGTextBaseline:isRenderingSVG,clipBackgroundColor:!isRenderingSVG,gliffyOpt:true,doShapeOpt:doShapeOpt,letterRendering:false,chinese:true,onrendered:function(canvas){context.restore();delete object.preRenderInfo}})}else{if(object.node){_gliffy.Logger.warn("cannot find transform for node ["+object.node.getId()+"]")}}if(o.renderCallback){o.renderCallback()}}}});(function(){_gliffy.Renderer.ShapeCanvas=_gliffy.Renderer.extend({id:"Gliffy.Renderer.ShapeCanvas",target:null,init:function(){_gliffy.renderers[this.id]=this},render:function(o){if(!o){throw new Error("shape renderer needs options")}if(!o.target){throw new Error("needs a target canvas context")}if(!o.object){throw new Error("no shape to render")}var ctx=o.target,object=o.object,renderCallback=o.renderCallback,transform,values,offsetX,offsetY,scale,data,shadow_scale_x,shadow_scale_y,originalFill,pan_x,pan_y,linkNodeArray;if(object.node&&object.node.stage){scale=object.node.stage.zoom;originalFill=object.style.fill;if(originalFill==="none"){object.style.fill="rgba(255,255,255,"+_gliffy.MIN_OPACITY+")"}if(object.style.single_canvas){if(o.ignoreZoom){scale=1}pan_x=(o.ignorePan)?0:object.node.stage.pan_x;pan_y=(o.ignorePan)?0:object.node.stage.pan_y;transform=new _gliffy.AffineTransform(1,0,0,1,0,0).translate(pan_x,pan_y).scale(scale,scale).concatenate(object.node.worldTransform);values=transform.getValues();object.style.matrix_a=values[0];object.style.matrix_b=values[1];object.style.matrix_c=values[2];object.style.matrix_d=values[3];object.style.matrix_e=values[4];object.style.matrix_f=values[5];offsetX=(object.style.stroke_width%2===1)?0.5:0;offsetY=(object.style.stroke_width%2===1)?0.5:0}else{offsetX=object.style.offset_x;offsetY=object.style.offset_y}data=object.style;ctx.save();linkNodeArray=object.node.findGraphic(_gliffy.Link);if(linkNodeArray.length>0){ctx.__pathHref=linkNodeArray[0].getGraphic().getHref()}ctx.translate(offsetX*scale,offsetY*scale);ctx.transform(data.matrix_a,data.matrix_b,data.matrix_c,data.matrix_d,data.matrix_e,data.matrix_f);if(object.isDropShadow()&&!(object.getFillColor()==="none"&&object.getStrokeWidth()===0)){ctx.save();if(originalFill!=="none"){shadow_scale_x=(object.style.width+object.style.stroke_width/2)/object.style.width;shadow_scale_y=(object.style.height+object.style.stroke_width/2)/object.style.height;ctx.translate(object.style.shadow_x,object.style.shadow_y);ctx.scale(shadow_scale_x,shadow_scale_y);_gliffy.shapeLibrary.drawStencil(object.getTid(),ctx,$.extend({},object.style,{fill:"#000000",opacity:0.294117647,stroke:"none",gradient:false}),_gliffy)}else{if(object.style.stroke_width>0){ctx.translate(object.style.shadow_x,object.style.shadow_y);_gliffy.shapeLibrary.drawStencil(object.getTid(),ctx,$.extend({},object.style,{opacity:0.294117647,fill:"none",gradient:false}))}}ctx.restore()}if(_gliffy.shapeLibrary.canDrawStencil(object.getTid())){_gliffy.shapeLibrary.drawStencil(object.getTid(),ctx,data);object.node.resetFlags()}else{_gliffy.Logger.warn("Could not draw stencil "+object.getTid());data.fill="#FF0000";data.stroke="#FF0000";data.stroke_width=2;_gliffy.shapeLibrary.drawStencil("com.gliffy.stencil.rectangle.unknown",ctx,data)}ctx.__pathHref=null;ctx.restore()}if(renderCallback){renderCallback()}}})}());(function(){_gliffy.Renderer.SvgCanvas=_gliffy.Renderer.extend({id:"Gliffy.Renderer.SvgCanvas",target:null,init:function(){_gliffy.renderers[this.id]=this},render:function(o){if(!o){throw new Error("svg renderer needs options")}if(!o.target){throw new Error("needs a target canvas context")}if(!o.object){throw new Error("no svg to render")}var ctx=o.target,object=o.object,renderCallback=o.renderCallback,transform,values,offsetX,offsetY,scale,data,originalFill,pan_x,pan_y,dim,svg,resource,linkNodeArray;if(object.node&&object.node.stage){scale=object.node.stage.zoom;originalFill=object.style.fill;if(originalFill==="none"){object.style.fill="rgba(255,255,255,"+_gliffy.MIN_OPACITY+")"}if(object.style.single_canvas){if(o.ignoreZoom){scale=1}pan_x=(o.ignorePan)?0:object.node.stage.pan_x;pan_y=(o.ignorePan)?0:object.node.stage.pan_y;transform=new _gliffy.AffineTransform(1,0,0,1,0,0).translate(pan_x,pan_y).scale(scale,scale).concatenate(object.node.worldTransform);values=transform.getValues();object.style.matrix_a=values[0];object.style.matrix_b=values[1];object.style.matrix_c=values[2];object.style.matrix_d=values[3];object.style.matrix_e=values[4];object.style.matrix_f=values[5]}offsetX=(object.style.single_canvas)?0:object.style.offset_x;offsetY=(object.style.single_canvas)?0:object.style.offset_y;data=object.style;ctx.save();linkNodeArray=object.node.findGraphic(_gliffy.Link);if(linkNodeArray.length>0){ctx.__pathHref=linkNodeArray[0].getGraphic().getHref()}ctx.translate(offsetX*scale,offsetY*scale);ctx.transform(data.matrix_a,data.matrix_b,data.matrix_c,data.matrix_d,data.matrix_e,data.matrix_f);resource=object.node.stage.gon.getEmbeddedResources().getResource(object.getEmbeddedResourceId());if(resource){svg=resource.getData();dim=_gliffy.shapeLibrary.svgDim[svg];ctx.scale(object.style.width/dim.width,object.style.height/dim.height);ctx.translate(-dim.x,-dim.y);if(_gliffy.shapeLibrary.canDrawStencil(svg)){_gliffy.shapeLibrary.drawStencil(svg,ctx,data);object.node.resetFlags()}}ctx.__pathHref=null;ctx.restore();object.style.fill=originalFill}if(renderCallback){renderCallback()}}})}());(function(){_gliffy.Renderer.LineCanvas=_gliffy.Renderer.extend({id:"Gliffy.Renderer.LineCanvas",target:null,init:function(){_gliffy.renderers[this.id]=this},render:function(o){if(!o){throw new Error("line renderer needs options")}if(!o.target){throw new Error("needs a target canvas context")}if(!o.object){throw new Error("no line to render")}var context=o.target,object=o.object,callback=o.renderCallback,self=this;if(object.getFillColor()&&object.getFillColor()!=="none"&&object.getFillColor()!==object.getStrokeColor()){o.renderCallback=function(){o.renderCallback=function(){if(callback){callback()}};self._renderFillLine(o)}}this._render(o)},_render:function(o){if(!o){throw new Error("line renderer needs options")}if(!o.target){throw new Error("needs a target canvas context")}if(!o.object){throw new Error("no line to render")}var style,context=o.target,line,object=o.object,data=object.style,callback=o.renderCallback,scale,c,tmpCtx,transform,values,pan_x,pan_y;if(object.node&&object.node.stage){scale=object.node.stage.zoom;line=new _gliffy.Linevg(object.getDrawCommands());if(!object.style.single_canvas){this._pushContextMatrix(context,data,scale);if(object.editable.isEditable){style=$.extend({},data,{stroke:object.node.stage.background==="transparent"?"#ffffff":object.node.stage.background,stroke_width:data.stroke_width+object.OVERLAY_EXTEND,opacity:0.008,stroke_dasharray:null,start_arrow:"none",end_arrow:"none"});line.drawPath(context,style)}if(object.getOverlay()){style=$.extend({},data,{stroke_width:data.stroke_width+object.OVERLAY_DISPLAY_EXTEND,stroke:"#97bfe0",stroke_dasharray:null,start_arrow:"none",end_arrow:"none"});line.drawPath(context,style)}line.drawPath(context,data);this._popContextMatrix(context)}else{if(o.ignoreZoom){scale=1}object.style.matrix_a=scale;object.style.matrix_b=0;object.style.matrix_c=0;object.style.matrix_d=scale;object.style.matrix_e=0;object.style.matrix_f=0;if(!object.getStartArrow()&&!object.getEndArrow()&&context instanceof window.C2S){tmpCtx=new C2S(object.style.graphic_width*scale,object.style.graphic_height*scale);c=tmpCtx.canvas}else{c=document.createElement("canvas");c.width=object.style.graphic_width*scale;c.height=object.style.graphic_height*scale;tmpCtx=_gliffy.Utils.getContext(c)}this._pushContextMatrix(tmpCtx,data,scale);line.drawPath(tmpCtx,data);this._popContextMatrix(tmpCtx);transform=new _gliffy.AffineTransform(1,0,0,1,0,0).scale(scale,scale).translate(object.style.pos_x,object.style.pos_y).translate(-object.style.offset_x,-object.style.offset_y).scale(1/scale,1/scale);values=transform.getValues();context.save();context.transform(values[0],values[1],values[2],values[3],values[4],values[5]);context.drawImage(c,0,0);context.restore()}}if(callback){callback()}},_pushContextMatrix:function(context,style,scale){context.save();context.translate(-style.pos_x*scale,-style.pos_y*scale);context.translate(style.offset_x*scale,style.offset_y*scale);context.transform(style.matrix_a,style.matrix_b,style.matrix_c,style.matrix_d,style.matrix_e,style.matrix_f)},_popContextMatrix:function(context){context.restore()},_renderFillLine:function(o){if(!o){throw new Error("line renderer needs options")}if(!o.target){throw new Error("needs a target canvas context")}if(!o.object){throw new Error("no line to render")}var context=o.target,object=o.object,callback=o.renderCallback,scale=object.node.stage.zoom,fillStyle=$.extend({},object.style),c,tmpCtx,fillLine,transform,values,offset,strokeScale=[1,2,3,17];fillStyle.stroke=object.style.fill;this.generateArrowMarkerAttributes("start",fillStyle,fillStyle.start_arrow);this.generateArrowMarkerAttributes("end",fillStyle,fillStyle.end_arrow);if(object.style.stroke_width===6&&((fillStyle.start_arrow&&strokeScale.indexOf(fillStyle.start_arrow)!==-1)||(fillStyle.end_arrow&&strokeScale.indexOf(fillStyle.end_arrow)!==-1))){fillStyle.stroke_width=object.style.stroke_width-0.3;offset=1}else{fillStyle.stroke_width=object.style.stroke_width>3?object.style.stroke_width-2:object.style.stroke_width;offset=2}fillStyle.offset_y-=2;fillStyle.path=this._calculatePath(object,fillStyle,offset);if(!object.getStartArrow()&&!object.getEndArrow()&&context instanceof window.C2S){tmpCtx=new C2S(object.style.graphic_width*scale,object.style.graphic_height*scale);c=tmpCtx.canvas}else{c=document.createElement("canvas");c.width=object.style.graphic_width*scale;c.height=object.style.graphic_height*scale;tmpCtx=_gliffy.Utils.getContext(c)}this._pushContextMatrix(tmpCtx,object.style,object.node.stage.zoom);fillLine=new _gliffy.Linevg(fillStyle.path);fillLine.drawPath(tmpCtx,fillStyle);this._popContextMatrix(tmpCtx);if(object.style.single_canvas){context.save();transform=new _gliffy.AffineTransform(1,0,0,1,0,0).scale(object.node.stage.zoom,object.node.stage.zoom).translate(object.style.pos_x,object.style.pos_y).translate(-object.style.offset_x,-object.style.offset_y).scale(1/scale,1/scale);values=transform.getValues();context.transform(values[0],values[1],values[2],values[3],values[4],values[5]);context.drawImage(c,0,0);context.restore()}else{context.drawImage(c,0,0)}if(callback){callback()}},generateArrowMarkerAttributes:function(arrowPos,style,arrowType){if(arrowType===17){switch(style.stroke_width){case 4:style["marker_"+arrowPos+"_width"]+=7;style["marker_"+arrowPos+"_height"]+=7;break;case 5:style["marker_"+arrowPos+"_width"]+=4;style["marker_"+arrowPos+"_height"]+=4;break;case 7:style["marker_"+arrowPos+"_width"]+=1;style["marker_"+arrowPos+"_height"]+=1;break;case 9:style["marker_"+arrowPos+"_width"]+=0.5;style["marker_"+arrowPos+"_height"]+=0.5;break}}else{if(arrowType<4){switch(style.stroke_width){case 4:style["marker_"+arrowPos+"_width"]+=7.6;style["marker_"+arrowPos+"_height"]+=7.6;break;case 5:style["marker_"+arrowPos+"_width"]+=5;style["marker_"+arrowPos+"_height"]+=5;break;case 7:style["marker_"+arrowPos+"_width"]+=2.9;style["marker_"+arrowPos+"_height"]+=2.9;break;case 9:style["marker_"+arrowPos+"_width"]+=2.1;style["marker_"+arrowPos+"_height"]+=2.1;break}}else{switch(style.stroke_width){case 4:style["marker_"+arrowPos+"_width"]-=6;style["marker_"+arrowPos+"_height"]-=6;break;case 5:style["marker_"+arrowPos+"_width"]-=6;style["marker_"+arrowPos+"_height"]-=6;break;case 7:style["marker_"+arrowPos+"_width"]-=8;style["marker_"+arrowPos+"_height"]-=8;break;case 9:style["marker_"+arrowPos+"_width"]-=10;style["marker_"+arrowPos+"_height"]-=10;break}}}},_calculatePath:function(object,fillStyle,offset){var distance,startDistance,endDistance,startPoint,endPoint;distance=object.getPathLength();startDistance=0;if(fillStyle.start_arrow>0){startDistance=offset}endDistance=distance.totalDistance;if(fillStyle.end_arrow>0){endDistance=distance.totalDistance-offset}startPoint=object.getPointInPathAtDistance(startDistance);endPoint=object.getPointInPathAtDistance(endDistance);return this._buildStylePath(object.getDrawCommands(),startPoint,endPoint)},_buildStylePath:function(path,start,end){var newPath=[],i=0,args;for(i=0;i<path.length;i++){newPath.push({name:path[i].name,args:path[i].args})}if(start){newPath[0].args=start.x+","+start.y}if(end){args=newPath[newPath.length-1].args.split(" ");args.pop();args.push(end.x+","+end.y);newPath[newPath.length-1].args=args.join(" ")}return newPath}})}());(function(){var imageNotAvailable="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZAAAAGQCAYAAACAvzbMAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAAAWdEVYdENyZWF0aW9uIFRpbWUAMTEvMjAvMTL51e9HAAAgAElEQVR4nO3dOXAbV7YG4L+xA1ywL6TElA6HE1KpUjnVhKPslSdV5rKjp3KmeplcL5NDK6VSpVQyVUNHU48pKRLERuw70C/gnOsGCIAg2EB3A/8X2WMOcUkC+HHuuYv2z3/+UwcREdEjeeQfXC6XleMgIiKHGA6HAP4TIC6XC3/961/RbrfRbrcRCAQQCAQsHSAREdmPruv497//DV3X/6xAAKDdbuP29hYejwfJZJIhQkREiq7rKBQKCAQCGA6HGJm3CgQC8Hg86PV6yGaz6HQ6Vo2TiIhsZDAYoFAooFarAQC63e79AEkmk3C5XBgOh8jlcmi325YMloiI7EPCQ9M0dLtdtNtt3OucBwIB7O3twev1shIhItpwUkw0Gg0AQDgcRqvVgq7r9wMEAPx+/0glcnNzw0qEiGjD6LqOfD6Per0OANjd3UU0GlX/feraXalEPB4P+v0+crkcut3u8kdMRESWGw6HyOfzaDQa0DQN0WgU8Xgcmqapr5m5+cPv9yOVSsHtdqPf7+P6+prTWUREa24wGCCXy6nKY2dnB9FodCQ8gAcCBLirRNLpNFwul/qmrESIiNZXoVBAs9mEpmmIRCKIx+MTv26u7ecSIrLE9+rqiiFCRLRmBoMBstmsmraKRCKIxWL3Kg8x9/klwWAQqVQKmqapxjqns4iI1kc+n0ez2QQARCIRRCKRmV//qAOwAoEAMpmMqkRubm5YiRAROdxgMMDNzY0Kj3g8PrHnMe7RJygGg0Ekk0nVWOc+ESIi55q02iocDs/1/13oCF4JEZfLhX6/j3w+z0qEiMhhZJ+HsWH+0LSV0cJnuIdCIdVY73a7bKwTETmITFvJDvNIJDLXtJXRky4BkUpEGuu5XI7TWUREDvCUykM8+RapYDCozs7qdrvIZrOsRIiIbEqW6kp4xGKxmUt1ZzHlGsJAIIBEIqE2G3KJLxGR/QyHQ7VJELg722rehvkkpt1jK/tEZIkvd6wTEdmH8VRdY+XxFKZehB4KhdQS316vh+vra4YIEZHF5EBcqTzC4TAikchC01ZGpgYIMLrEV87O6vV6Zj8MERHNQdd1FR7SMDceyf4UpgcIcFeJyCm+ssS33+8v46GIiGiKfr+v7nN6asN8kqUECHAXIolEApqmqa4/p7OIiFZj0ibB3d1dUx9jaQECAFtbW0in06oS4XQWEdHyyYf2VqsFTdPmPtvqsZYaIMCfjXWXy4Vut8vGOhHREknvWcJjGZWHWHqAAKPTWXJ2FisRIiJzScO81WrB5XIhHo8vtMN8XisJEADY3t5WZ2d1Oh1cXV0xRIiITCKno49XHmZPWxmtLECAu0pELmXn9bhERObQdR2FQkGFRywWe9IO83mtNECAu8a67FjvdDrIZrOsRIiIFtTv93F9fa1WW8XjcYTD4aVWHmLlAQLchYixJ8KbDYmIHm8wGKBQKKh9HstsmE9iSYAA91dn5XI5bjYkIprTcDhU19C6XC7EYrGlNswnsSxAgLvGunHH+rdv3zidRUT0ADnbqt1uA7i7DGpV01ZGlgYIcH/HOjcbEhFNp+u6us9DKo9VNMwnsTxAgD8b6263WzXWB4OB1cMiIrIVaZh3u1212sqMU3UXZYsAAe5CRJb49no9rs4iIjKQGRrjwYirbJhPYpsAAe56ItJY73Q6uLm5ga7rVg+LiMhScrZVu92Gy+VCMpm0bNrKyFYBAvwZIpqmodvt4vLykpUIEW0s2erQ6XSgaRqi0Si2t7etHhYAGwYIcDedJSEi1+NyiS8RbRpd19V9Hi6XC4lEwhaVh7BlgACjS3w7nQ6ur68ZIkS0MeRacKk84vE4dnZ2rB7WCNsGCDC6Y73X6+Hm5obTWUS09uQyKGmY2zE8AJsHCPBniBgb61ziS0Trqt/v4+rqSoVHIpGwfLXVNLYPEADY2dkZaaxfX1+zEiGitSNLde08bWXkiAABRqezut0u8vk8eyJEtDbGl+raufIQjgkQ4K4SkcZ6u93G9fU1p7OIyPHGl+ravfIQjgoQ4K4SicViI411ViJE5FTGHeZytpUTwgNwYIAAd5WINNbb7TZ3rBORI8lSXWPD3E77PB7iyAAB7kJEzs6SfSJsrBORU/T7feTz+ZGDEe2yw3xejg0QYDRE2u028vk8KxEisj1j5eF2u5FKpRxVeQhHBwgA7O7uqtVZ7XYbV1dX7IkQkW31ej3k83n0ej1VeWxtbVk9rIU4PkCA+9NZuVyOq7OIyHaMS3XdbjeSyaRjGuaTrEWAAH9WItJY56VURGQnxuOYpGHutJ7HuLUJEOB+JcIlvkRkB+NLdROJhGOnrYzWKkCAuxCJxWKqEsnlcmysE5Fler0erq6u0Ol01GVQTp62Mlq7AAGAcDg80lj/9u0bKxEiWjm5z0imreLx+FpUHmItAwS4u09EdqzL2VnsiRDRqkjDvNPpqKW661J5iLUNEOCuEpE71lutFs/OIqKV6PV6yGazIw3zdao8xFoHCHC/EuH1uES0TIPBAPl8XvU81jU8gA0IEODP1VlSibCxTkTL0O128e3bN7Xaap0a5pNsRIBomobd3V1Eo1HVWOcSXyIyk+ww7/f7a9kwn2QjAkTs7u4iEolA0zQ0m02enUVEpjAu1fV4PEin02tdeYiNChBN0xCNRtVmw1arxR3rRPQk0lsdDAaq8giFQlYPayU2KkCEsRKRnghDhIgeS1ZbSeWRSqXWftrKaCMDBAAikQgb60S0sG63q3qp67xUd5aNDRBprBsrkWw2y8Y6ET2o3+8jl8uh2+2q1VabMm1ltLEBIsLhsNonIpUIEdE0vV4P3759Q7fbVTvMnX6q7qI2PkA0TUM4HB652fD6+pqVCBHdI9NW0jBPJBIbWXmIjQ8QYdwn0mq1UCgU2FgnImUwGOD6+lpVHplMZuN6HuMYIAYyneVyudBsNnFzc4PhcGj1sIjIYt1uV52lp2kakskkgsGg1cOyHAPEQKazIpEIAKj7RFiJEG0uuQxKGubpdHqjp62MGCATGBvrsmOdiDZPt9vF5eWlCo9UKsXwMGCATKBpGiKRCKLRKACg2WxyxzrRhhlvmDM87mOAzBAOhxEOh3l2FtGG6Xa7uLq6Qq/Xg9vt5rTVFAyQGeRcG+N0Vi6XY2OdaI11Oh21gEbTNIbHDB6rB+AE4XAYg8EAlUoFjUYDuq4jmUzC7XZbPTQiMpHxeBKPx4NkMolAIGD1sGyLFcicotHoyFHwhULB6iERkYk6nY46zsjtdnOp7hwYIHOSo+AlRBqNBhvrRGui2+2qy6DkbCuGx8MYII8UiUTUPhEu8SVyPmmYd7tddRkUex7zYYA8kvFSKgBqxzorESLn6XQ6amEMd5g/HpvoCwqHwxgOhyiXy6qxnkql4HIxk4mcoNvtqmlor9fLhvkC+G73BDKdxX0iRM4iS3UHgwFcLhcSiQTDYwEMkCcwNtYBoNFocDqLyOZ6vR5yuRx6vZ66hpbTVothgJhgvBLhEl8ie+p2u/j27ZvaYb6pNwmahQFiAk3TEIvF1NlZrESI7Kfb7Y40zNPpNCuPJ2IT3UThcBj9fh/VahWNRkPNrWqaZvXQiDZau91GNpvFcDhU01bseTwdKxATydlZMp1Vq9WQz+d5dhaRheRen+FwqI5kZ3iYgwFiMpnO2tnZAQDU63UUi0WGCJEFJDzkbKtMJsPwMBEDZEni8bg6Cr5Wq7GxTrRi7XZ75GBEVh7mYw9kSWQ6CwAqlQrq9Tp0XUcikeApvkRL1ul0kM/nMRgM4Ha7GR5LwgBZslgsBgDqKHgASKfTVg6JaK11Oh1cXV1B13XuMF8yTmEtmfREjJsN2VgnWg7peei6rq6hZXgsDyuQFZAQ0XUdlUoFtVoNw+EQyWSSZ2cRmUR6HnK2VSqVgt/vt3pYa43vXisUi8VUY73RaKBYLFo9JKK1IJWH9DySySTDYwUYICskjfVwOAwAqNVq3LFO9ETjS3XT6TSnrVaEAWKBaDSK3d1dAHc9kVKpZPGIiJzJeA0tl+quHnsgFtA0DYlEAi6XC+VyGfV6HcDd3hH2RIjm02631YIU7jC3BgPEQtFoFIPBALVaDbVaTU1x8ewsotmMZ1uxYW4dBoiFpBKR3erVahUAGCJEM7RarZGzrdgwtw4DxGISIrquj4RILBbjdBbRGAkPWaqbTqfh8/msHtbG4juUTcTjcezs7EDTNFSrVS7xJRrTarXUqkVpmDM8rMUKxCakFJcAqdfragMiKxHadMaGudvtxt7eHrxer9XD2ngMEJuJx+Mj01m6riOZTFo9LCLLtFotZLNZdbZVKpVieNgEP9rajPREjJsNi8UidF23eGREq9dqtZDP56HrOlwuF9LpNBvmNsIAsSFZzru9vQ3g7iTfQqHAEKGN0mw21Q5zr9eL/f199jxshgFiY4lEAru7u2qZLxvrtCmMq63YMLcvBoiNuVwuJBIJVYnwjnXaBDJtNRwO1TW0nLayJzbRHUA2FlarVbVjPZFIWD0sItPJDnNd1+Hz+ZBMJll52BgDxAFcLtfI6iwJkVgsxh3rtDbGG+actrI/BohDGO9Yr9VqqFQq6o51IqeTTYJythV3mDsDeyAOIpWI9ESq1Spub28tHhXR0zSbTRUebreblYeDsAJxGCntAaBer+P29hbD4ZDTWeRIslRXGubcYe4sDBCHkp5Io9FApVJR/xuRU0jlIQ1z7jB3Hk5hOZTb7UY6ncbOzg6Au+msUqnEzYbkCMaGuZxtxWkr52EF4nDxeBzD4RCNRgPlchnD4ZCNdbK1RqOBXC43Unm43W6rh0ULYAXicHKKr7ESYWOd7KrZbKpjeaSKZuXhXKxA1oCEiFQit7e3GAwGvNmQbKVer6NQKGA4HMLn8yGTycDj4VuQk7ECWSPGY0+kJ0JkB81mUx1PItNWDA/n419wjcgaeuDu057xelxWImSVRqOhriTweDxIp9NcbbUmGCBrKJFIqBN8uWOdrGRsmPv9fiSTSYbHGuEU1hoa37Feq9VQLpe5xJdWqtlsqsqDO8zXEyuQNSWNddlsWCqVVGOdaNnq9bra5+H3+7lJcE2xAlljcux7KBQCcNdYl13rRMtiXKrr8Xg4bbXGGCBrzu12I5PJIBQKQdd1lEol7linpanVaupsK5/Pxx3ma44BsiGSyaQKkUqlgnK5bPWQaM00Go2RfR6ctlp/DJANIbt+t7a2oOs6yuUybm9vWYmQKWSToK7r8Hq9rDw2BJvoG0TTNNVYbzabqgqJRqMWj4ycbFLDnGdbbQZWIBtGVmdJJXJ7e8vGOi1Mpq2k8uC01WZhgGwgmc6S1VnFYpHTWfRo9XpdNcz9fj/29/cZHhuGAbLBpLEOAOVymY11mluj0VDTVjySfXMxQDaYLPFlY50eY3za6tmzZ6w8NhSb6IREIqEa6xIgsVjM6mGRDdVqNRUe0jDnQZ2bixUIqXOKtra2AACVSkWd5EskjKfqer1enqpLDBC643K5kEql1GZDaawTAaM7zP1+P/b29nifBzFA6E9ydlYgEFA9EVYiZOx58DIoMmKA0AiPx4P9/X0Eg0FVifAo+M1VrVZHVlvt7e1x2ooUBghNlEwmVYjc3t6yEtlAtVoNxWJRTVul02ku1aURDBCaSK4elRAplUrqdkNafxIeUnmwYU6TMEBoKpfLNTFEaL1Vq1V1qm4gEGDDnKZigNBMcnYWp7M2g7Hy4MGI9BAGCD3I4/Fgb29Prc4qFouczlpDUnnouo5AIID9/X1WHjQTA4TmlkqlRqazWImsD2PlEQgEkEwmucOcHsQAobl5PB5kMpl7IcJKxNnGp624VJfmxQChR9E0baQSkX0i5EyVSmWkYZ5Op1l50NwYIPRocnaWhAh3rDtTvV5Xh2fKPg/2POgxGCC0EDkK3liJcImvc1QqFeTzeVV5ZDIZrraiR2OA0MLkjnVZnVUqlVCv160eFj2gXq+jVCqphjmX6tKiGCD0JLLE1+fzQdd1FAoFNtZtStf1kaW6crYVp61oUQwQejJN09R01nA4RLFYRK1Ws3pYNKZaraqzrYLBIDKZDBvm9CQMEDKFx+NBKpVSlQins+xD13VUKhXVMOeR7GQWBgiZxu12Y29vT1Ui+XyejXUbKJfLKJVKGA6HCIVC2NvbY8+DTMEAIVO53W4kk0lWIjZRrVbVfS6BQACJRILhQaZhgJDpPB4Pnj17plZnFQoFViIrJgdfyg5zqTw4bUVmYoDQUsiO9UAggOFwiFKpxMb6CtVqNVV5BINBJBIJNszJdAwQWhq5lMrv96vNhpzOWi5pmMs+D1ltxcqDloEBQkslO9alEmFjfbmq1apqmAeDQaRSKVYetDQMEFo6OTtLKhFOZy2HhIdUHtxhTsvGAKGV8Hg82N/fH7mUiiFiDjnQUhrmMm3F8KBlY4DQyhjPzhoOhygUCmg0GlYPy/Gq1araJMjLoGiVGCC0Ul6vF+l0Gl6vVy3xZWN9MZMa5ryGllaJAUIrZ2ysDwYD5PN5TmctYDw8ksmk1UOiDcMAIUt4vV4kk0lViZRKJU5nzUl6HjJtFQwGeRkUWYIBQpbxer3Y29tTlUgul2MlModSqaQqj1AohHQ6DZeLL2VaPT7ryFIej2fk7Cw21merVCrq+uBQKIRkMsnwIMvwmUeWk0pEQoQ9kftkms9YeXCpLlmNAUK24Ha71bEnXOJ7X7lcRqVSUeHBhjnZAQOEbGPSEt9NDxE5VVcORtza2kI6nWblQbbAACFbkTvW/X6/aqxv8j6RcrmswkMqD24SJLtggJDtyPW4Uonk8/mNrESM19BubW2xYU62w2cj2ZLX68Xz589HGuubUokYL4MCoJbqctqK7IYBQraladpIYz2fz6PZbFo9rKWTaSsAbJiTrXHrKtma1+vFs2fPrB7GSkWjUUSjUauHQfQgViBERLQQBggRES2EAUJERAthgBAR0UIYIEREtBAGCBERLYQBQkREC2GAEBHRQhggRES0EAYIEREthAFCREQLYYAQEdFCGCBERLSQjTqN97/+67/UP799+xaHh4cWjmZznZyc4PPnz+rfH/O3OD8/x/v37wEAr169wvfff7+UMS7LxcUF3r17p/7diT+DvI4ODw/x9u3buf+bGcz8+y97rJuAFQhZ7uPHj7a756NYLOL8/Bzn5+emju3Lly8j//7161fTvjfRqjFAyHLFYvHeG6vVTk9P8f79e7x//x6Xl5emfd+zs7ORfy8Wi7i4uDDt+xOt0kZNYZF9ff78GUdHRzg4OLB6KEtzdnaGVqsFAHj+/LkKpq9fvzrq5/7f//1fq4dANsEKhCx1fHys/vnTp08WjmT5Tk9P1T+/efMGwWAQwP2qhMgpWIHMoVgsolgsAsDUZm+z2VSfKOPxOOLx+KMf5/z8XP3zot/DOI7nz58jFAo9+nsI48/91O81zYsXL0b6DV++fMHLly9NfYyLi4uRT/7L+Dke0mw28ccffwC4+9seHBzg6OgIX79+RbFYxNnZGY6OjlY+LjOec3Z5fOPfeRkLZFbxenAaBoiBrO44ODjA69evcX5+jo8fP6onDQAEg0G8fPlSrf64uLjAp0+fRl4IwN0T7M2bNw9OTVxcXODk5ES9uRjF43EcHR3h1atXDz5Zp43j8PAQr1+/xsHBwb2fb5Jms4kvX77gy5cv6sVo/JlevnyJFy9ezBzLY7158wY//vgjgLsVWsfHx09+cTabTXz69Glk2kjM+jk+ffqEi4uLkb/577//rsYjv8vHMlYZEhQSIPLfpwXI6emp+rpZfztRLBbx8ePHqV//1OfcPM+jWcx6zgOzn6/Hx8f4/vvvnxRKVrwenIQBYmB88z09PcVvv/1272tarRY+f/6MVquFo6MjfPjw4d4TCwAuLy/x/v17vH37duobzrTHENJcPj09Xfj7nJ+f4927d/j73/9+L1zGXVxc4Ndffx158xz/mX777Td8/foVP/zwg2mfwOLxOF69eqV+rx8/fsQ//vGPhb/fxcUF3r9/P/HvAsz+OS4uLu79noxN9Gnf8yHGRQJSYR0dHSEYDKLVas2cxvruu+/U3/f8/PzBN9fT01P1MxinCOW/PfU599DzaBaznvPA3d9i1iKHr1+/4uzs7MHvM41VrwcnYYBMIG8iwWAQL168UJ8MjZ8E5UnearVweHiI4+NjJBIJFAoFfP36Fefn52i1Wjg5OZn4ZlgsFkdeSMbvIWP48uULisUiWq0Wfv31V/zyyy/3vs/5+fnI9zk+PsbR0RFCodDIWB7qLzSbzZE33fHxnJ2dqZ/3/Pwcv/76q6lr57///ns1nfPHH3/g/Px8oWmIYrE48+f4v//7P/U4sqfg559/Vv9/eaOZNl0hfYvHjsk4rWj8RCxViITIpCokHo+PNN3Pzs5mfuo1Lg02fj+znnOLMvvxjaE8/rz//Pmz+j7v37/HL7/88qg3eKtfD07BAJmg1WohGAze++Qib2jyAm21Wjg+PsabN29GvubFixf48ccf1ZvhJMaG6vj3kO9zfHyMd+/eqTezi4uLe5+kZKoCAH744YeRNwwZy8ePHx/cb/Dx40f1Yvn73/9+7w3q8PAQr169Up/4zs/PcXp6amr5/ubNGzU98vHjR/z000+P/lRn/DkmbTQ7PDzEy5cv1c9xeXmJk5MT9XUyJWPc7Pi3v/3tSXPqxje68d+XcRrr9PR06jTWixcv1IeAWQFinH4bnwo06zm3qGU8/rTX6YsXL/D+/Xv1Qe7Tp0/3Hm8WO7wenICrsKaYNtdtfIEHg8Gpc8DGqYNJJb/xf5u2mzYUCo18n/Hpk9PTU/Vm8erVq6lvPm/evJn5BnhxcaGC7tWrV1NfBKFQaORFaPbqIXkDARbbG2Kcfjo8PJz5e3379q2qJpa9B2VS/8P47zKOP/74Y+qmRePzYNbXTas+AHOec0+xjMef1Wdc9Llql9eDE7ACmWLWk0ZIybyI169fqxfHok0+4wvyoU8+x8fHU+eujW86D62AOjg4UNMp06qrp3j9+rVqfD92b8hjfo5QKDQyfbTolNlDzs/PR6bCJv2tx5vpk/6WoVAIf/nLX9TvfNrXyZuYNKONzHjOPYXZjz/pZxz/7/I7e8zf2E6vB7tjBTLB8+fP5/q6p7wIDg4OcHh4OPUJLSXxrE/HsoM5GAw+OJbvvvvuwe9zeHg4VyAav9e0BuOiQqHQSFX3mL0hxh3d8yyJNf7ul7Ub3DhtM+3NyDjWWZ9ijYEx6evOzs7U32PSz2/Gc+4pzH78ecLA+Fyd929sp9eD3bECmWCVqykuLi5wdnamqoPHrHCRpuo8n9BnBYzxsY0HTs6jWCya/mn2xYsXqvn/mL0h8nPM+wFAGqIAlnYWl/GN/suXLw/2ov7444+pv1Pjqi2ZxjI+V42PNev39ZTnnBnMevx5nnfG18a8f2O7vR7sjAFikWaziY8fP84se2Vj1apf4HYwvjfk6Oho7hemXZZTyiodMe+ZWmdnZzOrlWnTXRIgh4eHE39XVj/nrH58Mh8DxCLj69dlqebBwYHaqXxwcICTk5OVvZji8fi9fQPz/H+WNRbj3pDff//9SXtDrLBoU/X09HRqgLx8+XJigBg3TE77G1r9nLP68R/LTq8Hu2KAWOD09HTk2JOHVklNI9MZ88y7znpByvcJBoO2uptifG/I2dnZzOriMb8P4G5PiDD7MEPj0SUA8D//8z8PVkay9Pvy8nLqVIi82crvRKaxpNcSDAYn9j/Mes4tahmPP09Pw/g18/6N7fp6sCM20S1g/GT60Atp1jLGSZve5nnMad/n8vJyrnliWS67ik+JxmWSnz59mjm+x/w+gMXeXOZl7HXMezSL8Y1/ViPZWJ2cnZ2NhNW0lYFmPecWtYzHn2dKcJG/sZ1fD3bDALGA8QXy0KewWW/8xjcc42qfccViceZ/n3cVkHyvd+/e4f379/j9999nfq0ZZOOfPPbJycnUr5339yHfS950py2vfQrj4897SKJxumTev/vZ2dnI105bzm3Wc25Ry3h8OU1gmmazObKsed6/sZ1fD3bDALGA8TiMWS+A8YMcxxmf6J8/f574plksFqee1yWOj4/VmGZ9ym82m/jw4YP6d7NPzZ3m1atXanyzPnWOf4KfNcVhfLE/9HM8doWW8eiSaVNKk8j0lHyPaeOX/Q3A3fPH+CY57c3ZrOfcopb1+L///vvUv8+nT59GTiWYl91fD3bCALGA8Q3lw4cPI2/8sgP7xx9/xNevX0deeONP5Hg8PrJn4rfffsN///d/4+TkBCcnJ/jw4QN+/PFHXF5ezlzaGgqF1Fxvq9XCu3fvcHp6qh6v2WyqG/qMZzqt6tiG8R2/00jjHfjzoL2Tk5ORN6SzszO8f/9+pPp46Of49OmT+p3O8+ZmnH567BHtxq+fteRXvk6W9ALTm+fj3/cpz7lFLevx5dBSY6VwcXGBDx8+qN/fY5+rdn892Amb6BZ48eIFvnz5gsvLS7RaLfz2228TTyh9/vw5/va3v6nzoX799VcAozfCyace2XAn5zsZSdPy3bt3U8f08uVLXFxcqKb1tDHJuFZ9cNzR0REODw8fnGf+/vvvUSwW1Q7zz58/qzOtxsXj8akru46OjtT/r1gsqn/+7rvvHpwKmWdKaZrj42MVQKenp1OPyjk6Ohr5hP3QY5n5nFvEMh7/5cuXODs7w+Xlpfq6ccFg8FFnYBm/t51fD3bBCsQib9++VdMQ44LBIF69eoWff/4Zh4eHD26Me/nyJX755RccHx+PvLk9f/4cr169wk8//TRXA/HNmzf44YcfZr5BHh8f4+3bt5bstTDe4vfQ171+/Xrm1x4fH+Onn36a+rMeHBw8atpDGI8umTWlNI1xGmvWMe9yFIuYtvfDyMzn3CLMfnw5SHHa7/jw8BA///zzwgsk7P56sAPtn//8p/zm7vgAABVESURBVO5yufDXv/7V6rFsJLmNTsrj77777t4Lotls4uvXr2g2m+omu8e6uLhQFchf/vKXB/dUnJ+f31vmOu/RDnby1J/DeMNjMBh01N3l06zqObfKx5fd7cBduB4eHpr6t1qX14NZ/vWvf2E4HDJANoXxIp9Jx5wTEc1LAoQ9EAeT61cBPHgj2qxjvomIFsEeiIPJmUGzbhyU84ek+SxHRhARPRUrEAc7Pj7GyckJWq2WOr3W2EyVuWbjSp0ffvjBquES0ZphD8ThLi4u8Ouvvz64PyEYDOIf//jHSs8/IqL1xB7Imjg4OMBPP/2kjrSQO6CBP1cNHR0dzX0eExHRvBggayAUCuHFixcbuROWiKzDJjoRES2EAUJERAthgBAR0UIYIEREtBAGCBERLYQBQkREC2GAEBHRQrgPhBwtm82i2WxC0zSEw2FEo1Fommb1sGZqNpvI5/MYDAZwu93Y39+H1+u1elhEj8YKhByp3+/j+vpahUcsFkMsFrN9eAB3Gz+TySQ0TcNgMMDNzQ263a7VwyJ6NAYIOc5wOEShUFBHtuzu7iIcDls8qscJhUJIpVJwu93odru4ublBr9ezelhEj8IAIUcZDAZq2srlciEejyMWi1k9rIVsbW0hmUzC5XKh1+shm82yEiFHYYCQY/T7feTzebTbbWiahkgkgnA47Ihpq2lCoRASiYQKkXw+j36/b/WwiObCACFH0HUduVxOVR7RaNRx01bTbG9vq+msTqeDb9++sRIhR2CAkO31+33c3NyoyiMajSISiTi68hgnlYg01vP5PEOEbI8BQram6zry+bxabRWJRLC7u2v1sJZia2sL6XQaHo8HnU4H19fXnM4iW2OAkG1Jw7zVakHTNMTjcUfs83iK8UqEq7PIzhggZEuDwQC5XE6FxzpXHuOMS3w7nQ5ubm4wGAysHhbRPQwQsh1pmLdaLbVUNxKJWD2sldra2lKVSLfbxfX1NSsRsh0GCNlKv98fmbaSymOdp62mGQ+RXC7HngjZCgOEbMU4bRWLxdZmqe6idnZ2kEql4HK52Fgn22GAkC3I2VayVDcejzt+k6BZtra2EI/HoWkaer0eG+tkGwwQstx4wzwajW5Mw3xeUolIYz2bzULXdauHRRuOAUKWkqW6Unlw2mo6Y0+k1+vh27dvrETIUgwQsky/30cul0On04GmaUgkEpy2eoAcwGhsrHOJL1mFAUKW0HVdrbaSpbrb29tWD8sR5OwsaaxfXV2xEiFLMEBo5aRh3u12VeWxqUt1FzU+nZXP5xkitHIMEFopaZgbex6sPBazvb2NZDIJt9uNdruNbDbL6SxaKQYIrYyxYe5yuZBMJtkwf6Lt7e2RSoRLfGmVGCC0EnIkuzTMo9EoKw+TyHSWy+VCu91GPp/nEl9aCQYILZ2u6+o+D5fLpVZbkXl2dnbUZsN2u42rqyvuWKelY4DQUvV6PVxfX6vKIx6PY2dnx+phraWdnR3EYjFomoZOp8MlvrR0DBBaGrkMyng8CcNjucLhMJLJpJrOYmOdlokBQkvR7/dxdXWlwkOW6tLybW9vj1QiNzc3nM6ipWCAkOlkqS6nrayzs7Mz0li/ubmxeki0hhggZCpj5SENc1Yeq6dpmgoRqUS+ffvGSoRMxQAh0xj3IbDysIft7W21OouNdTIbA4RMMRgM1D4PqTwYHvawu7vLxjotBQOEnkyW6srZVslkkuFhM+OVCBvrZAYGCD1Jv99HPp8fORhxa2vL6mHRBBIixsY6d6zTUzBAaGFSebTbbbjdbqRSKVYeNqZpGnZ3d0ca67xjnZ6CAUILMR4hLqfqsvJwBuM+kXa7jUKhwEqEFsIAoUcznqrrdrvZ83CgcDiseiLNZpOVCC2EAUKPMr5UN5FI8FRdh9rd3UUkEhmpRLg6ix6DAUJzM14GJUt1OW3lbJFIBLFYDC6XC81mEzc3NxgOh1YPixyCAUJz6fV6uLq6Uvs8OG21HjRNQzgcRiQSAQC0223kcjlOZ9FcGCD0oF6vh1wuN7LDnJXHegmHwyOVSC6Xs3pI5AAMEJqp3+8jm82i0+lwqe4a0zRNTWdJT4SNdXoIA4Sm6na7yGazrDw2yO7uLqLRKDRNQ6vVQj6fZ0+EpmKA0EQybdXtdlXlwdVWm0GmsyRE2FinaRggdE+321VnW0nDnJXH5pDG+niIcDqLxjFAaITsMO/3+2qfRygUsnpYZIFJ01lERgwQUoxLdT0eD9LpNKetNpg01mXHeqvVwtXVFSsRUhggBOBu2kouG5KGOSsPAv7csQ6AZ2fRCAYIodfrqaW6Ho8HqVSKPQ8aEY1G1Sm+smOdx54QA2TDdbtd1SDlfR40y+7uLsLhMACg2Wzy7CxigGyyfr+vlurKaitOW9Es0WhUNdYbjQby+TynszYYA2RD9Xo9fPv2jfs86FE0TUM0GlU9ETn2hJXIZmKAbCCZtpKGOZfq0mNFIhF1FLxUIrR5GCAbZjAYqE2CbrcbmUyGPQ96NLmFMhaLAQAb6xuKAbJBOp0Orq6uVOWRTCYRDAatHhY5WDgcRjgcHqlEeOzJ5mCAbAjjTYIulwvpdJrTVmSKWCymGuvNZpON9Q3CANkAUnn0+3243W6GB5lKdqzLEt9Go8HprA3BAFlzxh3mLpcLqVSK01a0FMYlvlKJ0HpjgKyxbreLq6sr9Ho9dbYVw4OWRZb4GkMkm82yElljDJA11el01D0Omqax8qCVkTvWWYmsPwbIGpJ9HlJ5ZDIZBAIBq4dFG0J6ItFoFABUiHB11vphgKyZTqeDbDarGuZcqktWGG+s12o1hsgaYoCskW63qy6DkrOtGB5kpVgsNrJPpFgsWj0kMpHH6gGQOaRhPhwO4fF4GB5kC3K3jKZpKJfLqNVq0HUd8Xgcbrfb6uHRE7ECWQOdTge5XE41zBkeZDfRaBS7u7sAgHq9jkKhYPGIyAwMEIfrdrvIZrPodrvwer3Y29tjeJDtyKGd0ljnsSfrgQHiYLJUVzYJJhIJrrYiWzNWImysOx97IA7VbrdVeHg8HiQSCVYe5AjxeBwulwuVSgWNRkMt+CDnYQXiQMbwkKW6PNuKnEKOgjdWIjw7y5kYIA7T6XSQz+dVePB4EnIqWeIL3PVE2Fh3HgaIg7TbbVxfX6PX68Hr9SKdTrPnQY4lS3zHr8dlT8Q5GCAO0W631YtLTtVleNA6iEajCIfD0HUd9Xqd94k4CAPEASQ8+v2+OtvK7/dbPSwiU0hPZHzHOkPE/hggNicNcwkPVh60jmQ6a2dnBwBQrVZRKBQYIjbHALGx8YY5w4PWXSwWw87ODjRNQ61WQ6lUsnpINAP3gdiUXEOr6zq8Xi+SySTDg9ae7AmRfSKVSgXD4VDtHSF74V/EhqTnoeu6ugyK4UGbRCoRAKxEbIwViM0YNwl6vV6kUik2zGnjyNlZUolUq1UAUCf7kj2wArERqTyMO8wZHrSppLG+vb0N4K6xztVZ9sIKxCZarZa6DIqrrYj+lEgkoGka6vW6qkQSiYTFoyKAAWILMm0ll0ExPIj+ZDxssVaroVqtqkup2Fi3Fn/7FjPuMOdSXaLpjPtEarUar8e1AVYgFpKzrXRdh8/nQyqVgs/ns3pYRLY0vsS3Xq/D5XIhFouxsW4RViAWabVauLm5ga7r6mwrhgfRw2SJr67rqFQq3LFuIQaIBVqtllpt5fV68ezZM4YH0Zxkia8cBV+r1XB7e2vxqDYTA2TFpPKQmwRTqRS8Xq/VwyJylPGzs8rlMisRCzBAVqjdbqs7oN1uN/b29rjPg+gJYrEYtra2ANztE2ElsloMkBVptVq4vr5Gv9+H1+tFJpNh5UH0RHIrp1QilUqFmw1XiAGyArJJUBrm6XSalQeRieLxOLa2tlRjnWdnrQaX8S5Zs9lUR7LLNbRsmBOZy7jEt1aroVKpQNM0RKNRLvFdIlYgS2RcbSUNc4YH0XJIiEhPpFwuo1QqcTpriViBLIlMW8nxJJlMhuFBtAJyTlaz2USlUgFwN8VF5mMFsgTNZhPZbBb9fh8+n4/TVkQrJI114+osNtaXgwFismazqdajyw5zNsyJVi+RSIw01nl2lvkYICZqNBq4ublBv9+H3+/H/v4+Kw8ii8gHOOMBjLe3t6xETMQAMYmx8pDLoBgeRNaSY0+kErm9veV0lonYRDdBs9lUR7L7/X6k02l4PPzVEtmBpmlIJpMjl1J5PB5EIhGrh+Z4rECeqNlsqsugfD4fkskkw4PIZmQ6Sxrrt7e3XOJrAr7TPYFxh7mcbeV2u60eFhFNIUt8G40GyuWy2mxIi2EFsqBGo4FsNovBYACfz8fwIHIAufUzFAoBuNtsyMb64hggCxhvmHOfB5FzSE/E2FjnKb6L4RTWI9XrdRQKBdXzyGQy7HkQOYzb7UYikYCu62rHutvtVpdU0XxYgTyCHIwo4ZFKpRgeRA5l3LGu6zqKxSKX+D4SA2ROjUZDTVt5PB5OWxGtAdknIj2RarWqzs+ihzFA5tBoNJDL5dQOc14GRbQ+3G43MpnMSE+ES3znwwB5gLHykBUcrDyI1o9UIrquo1wuo1wuWz0k22OAzFCr1dR9HnK2FSsPovUkHxCN94lwOms2BsgUjUZDNdS8Xi9SqRTDg2jNyY51qURKpRIb6zMwQCao1WpqtVUgEGDlQbRBZJ+IhEilUmElMgUDZIz0PORgxGQyyR3mRBtGGuuyOuv29hblcpmVyBgGiIFsEpRpK662Itpsxkrk9vYW1WrV6iHZCgPkP+r1OvL5vGqYZzIZVh5EG04a64FAQIVIpVJhJfIfDBCMLtVlw5yIjFwuF9LpNEKhEIbDIUqlEpf4/sfGB0i9Xh+5DIoNcyIaJ2dnSSVSLpc5nYUND5BGo6Hu85CzrThtRUSTeDwe7O3tqZ5IsVjc+KPgNzZAxqetnj17xsqDiGaSs7OCwaCqRGq1mtXDssxGBsj4DvNMJgNN06weFhE5gMfjQSaTUSEiPZFNrEQ2LkDGd5in02lWHkT0KJqmIZVKIRgMYjgcbuwS340KkEqlMtIw39vb430eRLQQWeJrrEQ2LUQ2JkBqtZo6opmXQRGRGWTHuoRIsVjcqOmsjQiQSqWipq0CgQAb5kRkGjk7y7jZcFMqkbUPEKk8hsMhgsEgkskkG+ZEZCqPx4P9/f2R6axarbb2lchaB0itVlOVh9/v5w5zIloqYyVSKBTWfonv2gZItVpVp+oGAgGebUVES+fxeJBOp+H3+1UlUq/XrR7W0qxlgEyqPBgeRLQK0lgPBAIYDofI5/Nre5/I2gWIVB7SMN/f3+dqKyJaKVnia6xE1nE6a60CxFh5BAIBNsyJyDLSWJeeSLFYXLtKZG0CZHzaam9vjw1zIrKULPGVHevrVomsRYBUKpWRhnk6nWblQUS2IHcMyXRWsVhcmxBxfIDU63V1pLLf70c6nWbPg4hsZbyxXigU1mKzoaMD5Pb2Fvl8nkt1icj2xhvr61CJODZAqtWqqjwCgQCX6hKR7Y031p1eiTguQOQSl1KpBAAIBAI8VZeIHGP87CwnVyKOCxCpPIbDIUKhEFKpFBvmROQoXq8Xe3t7jp/OckyA6LqOSqVyb9qKlQcROZGmaUin0yONdaeFiGMCRKatpPJIp9NwuRwzfCKie+TsLK/XqyqRRqNh9bDm5oh34Gq1qi5pCQQCSCQSbJgT0Vpwu91qOms4HCKXyzmmErF1gMjlLLLDPBQKsWFORGvH4/EglUrB5/Op1VlOqERsHSC1Wk1VHsFgEIlEgg1zIlpL0lg3hojdKxFbBog0zOUO82AwiEwmw8qDiNaa2+1WjfXBYIBCoWDr+0RsGSDVanXkGlou1SWiTSFnZzmhsW67AJHwkMqDO8yJaNN4PB51dtZgMLBtY902ASI7zKVhLtNWDA8i2kRerxfJZNLWlYhtAsTY8+BlUEREdyEiZ2fJ9bh2qkQsDxBZqnt7ewsACAaDvIaWiOg/3G43ksmk2idipyW+lgfI7e2tWqorZ1sREdGfvF4vMpmMms6yy+osywJEeh6VSgW6rmNrawvpdJo9DyKiCeRSKr/fj8FggHw+j2azaemYLAuQUqmkDkYMhULseRARPUCW+Lrdbui6bnmIWBIglUoF1WpVVR7JZJIHIxIRzcHr9eLZs2fw+Xxqia9V01krfdfWdR2lUkmttpJTdTltRUQ0P+PZWbI6y4pKZKUBYux5yLQVERE9ns/nQzqdhsfjsewAxpUEiCzVldVWbJgTET2drM7y+/3o9/vI5XIrDZGVBEi5XB5ZqsuGORGROXw+30hjvVgsrmw6a+kBYryGlg1zIiLzyY51qURubm5W0lhf2ju58TIoAGyYExEtkZydZeyJLLsSWVqAyLQVADbMiYhWwOfzqUupZHXWMnsipgeIzMEZG+Y8VZeIaDVks6Fxn0ir1VrKY5keIMVicWSpbiKRMPshiIhoBp/Ppz6467qOXC63lOks0wJEeh5y1PDOzg57HkREFvF4PNjf31eVyM3NDdrttqmPYUqAyLSVcbVVIpHgUl0iIgvJdJbL5YKu67i5uTF1OsuUALm9vUW1WgUAbG9vc58HEZFN+Hw+PHv2DF6v1/SeyJMCRJaKVSoVAMDW1pZKOyIisgepRDwej5rOMiNEnvROXyqV1Km629vbbJgTEdmU3+/H3t4e3G63WuL71J7IQgEiPY/xaSs2zImI7Mt4s2G/38f19fWTKpGFAsS4VHdnZ4cNcyIih/D7/Uin06qxns/nFw6RRwfIeMM8Ho+z50FE5CA+nw/7+/uqEll0n8jc7/zSML+9vQVwFx5smBMROZOc4iuN9UVWZ8397m+sPLa2thCPxx83WiIishW/349MJgOPx6Ma648JkQcDZDgcjizV5Q5zIqL1ITcb+nw+9Pt9ZLPZuVdnPRggxqW6rDyIiNaP3+8f2bE+byUyNUCk5yHTVru7u7wMiohoTUlj3efzodfrzXV21sQ0mLTPI5FIMDyIiNaYz+dTe/qGwyFyudzMEJmYCBIemqapfR5ERLT+ZMe6x+NRS3w7nc7Erx0JEGmYj+8wZ+VBRLQ5jEt8Zcf6pEpkJBnGp63YMCci2kyBQEDtWJclvuOVyEiAyE7EcDjMTYJERBtO9ol4vV70er17lchIQsRiMSQSCcRisZUPlIiI7CcQCKiCQhrrHo8HAOAB7nof//rXvywdJBER2Zfb7UYoFEK/31eH53rkPw6HQ8sGRkRE9jYcDtFoNOB2u9Hv9wEA/w9ZPyqYyhmyLwAAAABJRU5ErkJggg==";_gliffy.Renderer.ImageCanvas=_gliffy.Renderer.extend({id:"Gliffy.Renderer.ImageCanvas",target:null,init:function(){_gliffy.renderers[this.id]=this},getUrl:function(object){return object.getUrl()},render:function(o){if(!o){throw new Error("shape renderer needs options")}if(!o.target){throw new Error("needs a target canvas context")}if(!o.object){throw new Error("no shape to render")}var context=o.target,object=o.object,renderCallback=o.renderCallback,scale,transform,offsetX,self=this,offsetY,image,url=this.getUrl(object),canvas,ctx;if(object.node&&object.node.stage){scale=object.node.stage.zoom;offsetX=(object.style.single_canvas)?0:object.style.offset_x;offsetY=(object.style.single_canvas)?0:object.style.offset_y;if(url===undefined||url===null){url=imageNotAvailable}if(object.node.hasFlag("skin")){if(url===imageNotAvailable){_gliffy.Logger.error("image does not have a valid url.")}image=new Image();image.onload=function(){if(url&&(url===self.getUrl(object)||url===imageNotAvailable)){object.imgWidth=image.width;object.imgHeight=image.height;if(object.node&&object.useOriginalDimensions){object.node.setWidth(object.imgWidth);object.node.setHeight(object.imgHeight);object.node.clampTo(_gliffy.Mouse.editor.getDocumentManager().getActiveStageViewPort());object.node.update();object.useOriginalDimensions=false}context.save();if(object.style.single_canvas){transform=object.node.worldTransform.getValues();if(!o.ignorePan){context.translate(object.node.stage.pan_x,object.node.stage.pan_y)}if(!o.ignoreZoom){context.scale(scale,scale)}context.transform(transform[0],transform[1],transform[2],transform[3],transform[4],transform[5])}else{context.canvas.width=object.style.graphic_width*scale;context.canvas.height=object.style.graphic_height*scale;context.scale(scale,scale);$(context.canvas).css({width:"",height:""})}if(object.isDropShadow()===true){context.save();context.translate(object.style.shadow_x,object.style.shadow_y);context.fillStyle="rgba(0,0,0,0.294117647)";context.fillRect(0,0,object.style.width,object.style.height);context.restore()}var linkNodeArray=object.node.findGraphic(_gliffy.Link);if(linkNodeArray.length>0){context.__pathHref=linkNodeArray[0].getGraphic().getHref()}if(context instanceof C2S&&url.indexOf("data:")===-1){canvas=document.createElement("canvas");canvas.width=image.width;canvas.height=image.height;ctx=canvas.getContext("2d");ctx.drawImage(image,0,0);context.drawImage(canvas,offsetX,offsetY,object.style.width,object.style.height)}else{context.drawImage(image,offsetX,offsetY,object.style.width,object.style.height)}context.__pathHref=null;context.restore();object.node.resetFlags();if(renderCallback){renderCallback()}}};image.onerror=function(){_gliffy.Logger.error("image did not load.");_gliffy.handleError("com.gliffy.error.file_malformed",[],new Error("image did not load"));image.src=imageNotAvailable};image.src=url}else{$(context.canvas).css({width:object.style.graphic_width*scale,height:object.style.graphic_height*scale});object.node.resetFlags();if(renderCallback){renderCallback()}}}else{if(renderCallback){renderCallback()}}}});_gliffy.Renderer.ImageCanvas.imageNotAvailable=imageNotAvailable}());(function(){_gliffy.Renderer.NodeCanvas=_gliffy.Renderer.extend({id:"Gliffy.Renderer.NodeCanvas",target:null,init:function(){_gliffy.renderers[this.id]=this},render:function(o){var ctx=o.target,object=o.object,callback=o.renderCallback,renderers=o.renderers,singleCanvas=o.singleCanvas,viewbox=o.viewboxDom,loadImage=singleCanvas||o.loadImage,graphic=object.getGraphic(),ignorePan=o.ignorePan||false,ignoreZoom=o.ignoreZoom||false,nodeCallback;_gliffy.Utils.tryCatch(function(){if(!o){throw new Error("shape renderer needs options")}if(!o.target&&!o.container){throw new Error("needs a target")}if(!o.object){throw new Error("no shape to render")}if(!o.renderers){throw new Error("no renderers defined for node")}nodeCallback=function(){if(!object.isProxy()&&object.supportsIcon()){if(renderers.popupNotes){_gliffy.renderers[renderers.popupNotes.prototype.id].render({target:object,viewboxDom:viewbox})}if(renderers.link){_gliffy.renderers[renderers.link.prototype.id].render({target:object,viewboxDom:viewbox})}}if(!object.isProxy()&&object.supportsConnections()&&renderers.controls){_gliffy.renderers[renderers.controls.prototype.id].render({target:object,renderCallback:callback,viewboxDom:viewbox})}else{if(callback){callback()}}};if(graphic&&(singleCanvas||graphic.node.hasRedrawCanvasFlag()||(graphic instanceof _gliffy.Text&&graphic.node.hasFlag()))){graphic.style.single_canvas=singleCanvas;if(graphic instanceof _gliffy.Line){_gliffy.renderers[renderers.line.prototype.id].render({target:ctx,object:graphic,renderCallback:nodeCallback,ignorePan:ignorePan,ignoreZoom:ignoreZoom})}else{if(graphic instanceof _gliffy.Image){if(singleCanvas){object.setFlag("skin")}_gliffy.renderers[renderers.image.prototype.id].render({target:ctx,object:graphic,renderCallback:nodeCallback,loadImage:loadImage,ignorePan:ignorePan,ignoreZoom:ignoreZoom})}else{if(graphic instanceof _gliffy.Svg){_gliffy.renderers[renderers.svg.prototype.id].render({target:ctx,object:graphic,renderCallback:nodeCallback,ignorePan:ignorePan,ignoreZoom:ignoreZoom})}else{if(graphic instanceof _gliffy.Shape){_gliffy.renderers[renderers.shape.prototype.id].render({target:ctx,object:graphic,renderCallback:nodeCallback,ignorePan:ignorePan,ignoreZoom:ignoreZoom})}else{if(graphic instanceof _gliffy.Text){_gliffy.renderers[renderers.text.prototype.id].render({target:ctx,object:graphic,renderCallback:nodeCallback,stage:o.stage,container:o.container,zIndex:o.zIndex,ignorePan:ignorePan,ignoreZoom:ignoreZoom,preRender:o.preRender})}else{if(_gliffy.Proxy&&graphic instanceof _gliffy.Proxy){if(singleCanvas){object.setFlag("skin")}if(renderers.proxy){_gliffy.renderers[renderers.proxy.prototype.id].render({target:ctx,object:graphic,renderCallback:nodeCallback,loadImage:loadImage,ignorePan:ignorePan,ignoreZoom:ignoreZoom})}else{_gliffy.Logger.warn("Unable to render proxy node because proxy renderer does not exist.")}}else{if((_gliffy.PopupNote&&graphic instanceof _gliffy.PopupNote)||graphic instanceof _gliffy.Link){if(nodeCallback){nodeCallback()}}else{throw"draw not implemented for "+graphic.getClassName()}}}}}}}}else{nodeCallback()}},function(e){if(graphic){_gliffy.Logger.error("Node "+graphic.node.getId()+" failed to render. "+JSON.stringify(graphic.node.toObject()))}else{_gliffy.Logger.error("Node failed to render.")}throw e})}})}());(function(){_gliffy.Renderer.StageSingleCanvas=_gliffy.Renderer.extend({id:"Gliffy.Renderer.StageSingleCanvas",target:null,_mockStageInfo:null,init:function(){_gliffy.renderers[this.id]=this},render:function(o){if(!o){throw"stage renderer needs options"}if(!o.target){throw"needs a target container"}if(!(o.object&&o.object instanceof _gliffy.Stage)){throw"needs a stage object to render!"}var options=$.extend({},{renderCallback:null,textRenderer:_gliffy.Renderer.TextHtml2Canvas,shapeRenderer:_gliffy.Renderer.ShapeCanvas,svgRenderer:_gliffy.Renderer.SvgCanvas,lineRenderer:_gliffy.Renderer.LineCanvas,imageRenderer:_gliffy.Renderer.ImageCanvas,forceUpdate:false,whitespace_x_padding:20,whitespace_y_padding:20,show_progress_bar:false,ignorePan:true,ignoreZoom:false,hideHiddenNodes:true,boundingBoxFit:false,linkMap:false},o),i=0,stage=options.object,container=options.target,ctx=o.context,forceUpdate=options.forceUpdate,nodeRenderer,c,width,height,objects,renderers={text:options.textRenderer,shape:options.shapeRenderer,line:options.lineRenderer,image:options.imageRenderer,svg:options.svgRenderer},bb,scale,offsetX=0,offsetY=0,bounds,self=this,delayEvery;_gliffy.Utils.setupAnimationDelay();this._mockStageInfo=this._setupMockStage(options);html2canvasClearCache();if(!_gliffy.renderers[options.textRenderer.prototype.id]){_gliffy.renderers[options.textRenderer.prototype.id]=new options.textRenderer()}if(!_gliffy.renderers[options.shapeRenderer.prototype.id]){_gliffy.renderers[options.shapeRenderer.prototype.id]=new options.shapeRenderer()}if(!_gliffy.renderers[options.svgRenderer.prototype.id]){_gliffy.renderers[options.svgRenderer.prototype.id]=new options.svgRenderer()}if(!_gliffy.renderers[options.lineRenderer.prototype.id]){_gliffy.renderers[options.lineRenderer.prototype.id]=new options.lineRenderer()}if(!_gliffy.renderers[options.imageRenderer.prototype.id]){_gliffy.renderers[options.imageRenderer.prototype.id]=new options.imageRenderer()}if(!_gliffy.renderers[_gliffy.Renderer.NodeCanvas.prototype.id]){_gliffy.renderers[_gliffy.Renderer.NodeCanvas.prototype.id]=new _gliffy.Renderer.NodeCanvas()}nodeRenderer=_gliffy.renderers[_gliffy.Renderer.NodeCanvas.prototype.id];if(options.show_progress_bar){GliffyApp.progressBarController.show("Exporting to Image")}window.pauseSilverlightDetection=true;if(!ctx){c=$("<canvas/>");stage.update();bb=stage.calculateBoundingBox();scale=stage.zoom;if(options.ignoreZoom){scale=1}bounds=new _gliffy.BoundingBox();bounds.min.x=Math.max(0,bb.min.x-options.whitespace_x_padding)*scale;bounds.min.y=Math.max(0,bb.min.y-options.whitespace_y_padding)*scale;bounds.max.x=Math.min(bb.max.x+options.whitespace_x_padding,stage.maxWidth)*scale;bounds.max.y=Math.min(bb.max.y+options.whitespace_y_padding,stage.maxHeight)*scale;if(options.boundingBoxFit){width=bounds.getDimension().x;height=bounds.getDimension().y;offsetX=-bounds.min.x;offsetY=-bounds.min.y}else{width=bounds.max.x;height=bounds.max.y}c.get(0).width=width;c.get(0).height=height;container.append(c);ctx=_gliffy.Utils.getContext(c.get(0))}ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height);ctx.save();ctx.fillStyle=stage.background;ctx.fillRect(0,0,ctx.canvas.width,ctx.canvas.height);ctx.restore();ctx.translate(offsetX,offsetY);ctx.save();stage.update();if(options.hideHiddenNodes){objects=stage.visibleFlattenedNodes(forceUpdate)}else{objects=stage.flattenNodes(forceUpdate)}if(renderers.text===_gliffy.Renderer.TextHtml2Canvas){for(i=0;i<objects.length;i++){if(objects[i].isText()){_gliffy.workQueue.queue(this.__createWorkQueueFunction(nodeRenderer,objects,i,ctx,renderers,container,$.extend({},{preRender:true},options)))}}}delayEvery=Math.max(Math.floor(objects.length/10),10);_gliffy.workQueue.animationDelay();for(i=0;i<objects.length;i++){if(i%delayEvery===0){_gliffy.workQueue.animationDelay()}_gliffy.workQueue.queue(this.__createWorkQueueFunction(nodeRenderer,objects,i,ctx,renderers,container,options))}_gliffy.workQueue.animationDelay().queue(function(next){if(options.show_progress_bar){GliffyApp.progressBarController.getBar().animate({width:"100%"})}window.pauseSilverlightDetection=false;ctx.restore();if(options.renderCallback){options.renderCallback();if(options.linkMap){self._generateDevLinkMap(stage.gon,options.target,ctx.canvas.width,ctx.canvas.height)}}next()})},_generateDevLinkMap:function(gon,target,width,height){var interval=setInterval(function(){var map=gon.getDevLinkMap();if(map){var transparentGifSrc="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";target.prepend($('<img id="gliffy-linkmap-image" usemap="#gliffy-dev-imagemap" width="'+width+'" height="'+height+'" src="'+transparentGifSrc+'"/>').css("position","absolute"));target.prepend(map);$("#gliffy-linkmap-image").maphilight({alwaysOn:true,strokeWidth:1,strokeColor:"0000ff",fillOpacity:"0.05"});$("#gliffy-linkmap-image").parent().css("position","absolute");clearInterval(interval)}},250)},_setupMockStage:function(options){var stageWidth,stageHeight,domStage,stage=options.object,container=options.target,self=this;if(options.fixedDrawingSpace){stageWidth=stage.maxWidth*stage.zoom;stageHeight=stage.maxHeight*stage.zoom}else{stageWidth=stage.width*stage.zoom;stageHeight=stage.height*stage.zoom}domStage=container.find(".gliffy-mock-stage");if(domStage.length===0){domStage=$('<div class="gliffy-stage gliffy-mock-stage"/>');domStage.css({position:"absolute",width:stageWidth+"px",height:stageHeight+"px",top:"0px",left:"0px",zIndex:-100});if(_gliffy.Debug.EXPORT_TEXT_DISPLAY){domStage.css({zIndex:610000,backgroundColor:"white"})}container.append(domStage)}return{domStage:domStage,stageWidth:stageWidth,stageHeight:stageHeight}},__createWorkQueueFunction:function(nodeRenderer,objects,i,ctx,renderers,container,options){var self=this;var date=new Date();return function(next){_gliffy.Utils.tryCatch(function(){nodeRenderer.render({object:objects[i],stage:self._mockStageInfo.domStage,target:ctx,renderCallback:function(){if(options.show_progress_bar){GliffyApp.progressBarController.getBar().queue(function(n){$(this).width(Math.floor(((i+1)/objects.length)*100)+"%");n()})}next()},renderers:renderers,container:container,singleCanvas:true,ignorePan:options.ignorePan,ignoreZoom:options.ignoreZoom,preRender:options.preRender})},function(e){_gliffy.workQueue.clearQueue();if(options.renderCallback()){options.renderCallback()}_gliffy.handleError("com.gliffy.error.render_failed",[],e,options.target)})}}})}());(function(){var AUTOFIT_PADDING=25;_gliffy.Renderer.StageMultiCanvas=_gliffy.Renderer.extend({id:"Gliffy.Renderer.StageMultiCanvas",target:null,__bindToScroll:true,__setupScrollEvent:false,init:function(){_gliffy.renderers[this.id]=this},disableScroll:function(){this.__bindToScroll=false},enableScroll:function(){this.__bindToScroll=true},__fixWebkitIframeFlicker:function(){if($.browser.webkit&&!_gliffy.EmbeddableViewer){var chromeFix,transform,canvasStyle;chromeFix=$("#gliffy-webkit-fix");if(chromeFix.length===0){transform=new _gliffy.AffineTransform(1,0,0,1,0,0);canvasStyle=$.extend(_gliffy.Utils.transformCss(transform),{visibility:"hidden",position:"absolute",zIndex:1});chromeFix=$("<canvas />",{id:"gliffy-webkit-fix"}).css(canvasStyle).addClass("gliffy-graphic");$(".gliffy-stage").append(chromeFix);chromeFix.get(0).width=1000;chromeFix.get(0).height=1000;_gliffy.Utils.getContext(chromeFix.get(0)).fillRect(0,0,1000,1000)}}},render:function(o){if(!o){throw new Error("stage renderer needs options")}if(!o.target){throw new Error("needs a target container")}if(!(o.object&&o.object instanceof _gliffy.Stage)){throw new Error("needs a stage object to render!")}var options=$.extend({},{renderCallback:null,useTimer:false,textRenderer:_gliffy.Renderer.TextDom,shapeRenderer:_gliffy.Renderer.ShapeCanvas,lineRenderer:_gliffy.Renderer.LineCanvas,imageRenderer:_gliffy.Renderer.ImageCanvas,svgRenderer:_gliffy.Renderer.SvgCanvas,proxyRenderer:_gliffy.Renderer.ProxyRenderer||false,controlRenderer:_gliffy.Renderer.ControlRenderer||false,popupNotesRenderer:_gliffy.Renderer.PopupNotesRenderer||false,linkRenderer:_gliffy.Renderer.LinkRenderer,cssPan:false,panOnly:false,scrollForPan:_gliffy.Editor!==undefined,forceUpdate:false,queueRender:false,delayEvery:1,resizeTarget:true,pointerEvents:"auto",showGrid:_gliffy.Editor!==undefined,fixedDrawingSpace:_gliffy.Editor!==undefined,useImages:false,renderViewbox:true,renderGuides:_gliffy.Editor!==undefined,autoFitPadding:false},o),stage=options.object,container=options.target,renderers,stageInfo,canvasInfo,contexts,nodeRenderer,render_complete,flattenedNodes,j,node,object,currentStage,hiddenNodes=[],flattenedNonHiddenNodes=[],stageMulti=this;renderers=options.renderers={text:options.textRenderer,shape:options.shapeRenderer,line:options.lineRenderer,image:options.imageRenderer,controls:options.controlRenderer,popupNotes:options.popupNotesRenderer,link:options.linkRenderer,svg:options.svgRenderer,proxy:options.proxyRenderer};if(_gliffy.Editor&&!this.__setupScrollEvent){container.bind("scroll.gliffy_pan",function(){if(stageMulti.__bindToScroll){currentStage=_gliffy.Mouse.editor.getDocumentManager().getActiveStage();currentStage.pan_x=-container.scrollLeft();currentStage.pan_y=-container.scrollTop()}});this.__setupScrollEvent=true}stageInfo=this.__setupStageAndPan(options);this.__fixWebkitIframeFlicker();contexts=container.data("contexts");if(!contexts){contexts={}}this.__deleteNodes(stage.deletes,stageInfo.domStage,contexts);stage.deletes=[];render_complete=this.__afterRenderComplete(container,stage,stageInfo,contexts,options);if(options.cssPan){$(options.target).css({position:"absolute",left:stage.pan_x+"px",top:stage.pan_y+"px"});render_complete()}if(!options.panOnly){if(!_gliffy.renderers[options.textRenderer.prototype.id]){_gliffy.renderers[options.textRenderer.prototype.id]=new options.textRenderer()}if(!_gliffy.renderers[options.shapeRenderer.prototype.id]){_gliffy.renderers[options.shapeRenderer.prototype.id]=new options.shapeRenderer()}if(!_gliffy.renderers[options.svgRenderer.prototype.id]){_gliffy.renderers[options.svgRenderer.prototype.id]=new options.svgRenderer()}if(!_gliffy.renderers[options.lineRenderer.prototype.id]){_gliffy.renderers[options.lineRenderer.prototype.id]=new options.lineRenderer()}if(!_gliffy.renderers[options.imageRenderer.prototype.id]){_gliffy.renderers[options.imageRenderer.prototype.id]=new options.imageRenderer()}if(options.proxyRenderer&&!_gliffy.renderers[options.proxyRenderer.prototype.id]){_gliffy.renderers[options.proxyRenderer.prototype.id]=new options.proxyRenderer()}if(options.controlRenderer&&!_gliffy.renderers[options.controlRenderer.prototype.id]){_gliffy.renderers[options.controlRenderer.prototype.id]=new options.controlRenderer()}if(options.popupNotesRenderer&&!_gliffy.renderers[options.popupNotesRenderer.prototype.id]){_gliffy.renderers[options.popupNotesRenderer.prototype.id]=new options.popupNotesRenderer()}if(options.linkRenderer&&!_gliffy.renderers[options.linkRenderer.prototype.id]){_gliffy.renderers[options.linkRenderer.prototype.id]=new options.linkRenderer()}if(!_gliffy.renderers[_gliffy.Renderer.NodeCanvas.prototype.id]){_gliffy.renderers[_gliffy.Renderer.NodeCanvas.prototype.id]=new _gliffy.Renderer.NodeCanvas()}nodeRenderer=_gliffy.renderers[_gliffy.Renderer.NodeCanvas.prototype.id];if(!options.forceUpdate){this.__notifyNodes(stage);this.__notifyNodes(stage)}if(options.forceUpdate){stage.setBoundsDirty()}flattenedNodes=this.__flattenNodes(stage,options.forceUpdate);$.each(flattenedNodes,function(_,node){if(node.getNodeOrLayerHidden()){hiddenNodes.push("#gliffy_node_"+node.getId())}else{flattenedNonHiddenNodes.push(node)}});flattenedNodes=flattenedNonHiddenNodes;this.__deleteNodes(hiddenNodes,stageInfo.domStage,contexts);if(flattenedNodes.length===0){render_complete()}else{$(".gliffy-drawing-guide:hidden").remove();for(j=0;j<flattenedNodes.length;j++){node=flattenedNodes[j];object=node.getGraphic();canvasInfo=this.__setupNodeCanvas(node,object,contexts,stage,stageInfo,container,options);container.data("contexts",contexts);if(options.queueRender){if(j%options.delayEvery===0){_gliffy.workQueue.delay(1)}_gliffy.workQueue.queue(this.__createWorkQueueFunction(j,node,canvasInfo,options,flattenedNodes,render_complete,nodeRenderer,container,stageInfo))}else{_gliffy.Utils.tryCatch(function(){if(options.fixedDrawingSpace||canvasInfo.bounds.inViewport){nodeRenderer.render({object:node,target:canvasInfo.ctx,renderCallback:stageMulti.__createSimpleLoopCallback(canvasInfo,options,node),renderers:renderers,singleCanvas:false,container:container,stage:stageInfo.domStage,zIndex:node.getOrder(),viewboxDom:canvasInfo.viewbox,loadImage:!canvasInfo.ctx||options.forceUpdate||options.useImages})}else{stage.removeDirtyNode(node)}if(j===flattenedNodes.length-1){render_complete()}},function(e){render_complete();_gliffy.RenderLoop.stop();_gliffy.handleError("com.gliffy.error.render_failed",[],e,options.target)})}}}}else{if(options.renderCallback){options.renderCallback()}}},__createWorkQueueFunction:function(j,node,canvasInfo,options,flattenedNodes,render_complete,nodeRenderer,container,stageInfo){return function(next){_gliffy.Utils.tryCatch(function(){var callback=function(){if(node&&node.stage){node.stage.removeDirtyNode(node)}if(options.useImages&&canvasInfo.canvas&&canvasInfo.ctx){canvasInfo.canvas.attr("src",canvasInfo.ctx.canvas.toDataURL())}next();if(j===flattenedNodes.length-1){render_complete()}};if(options.fixedDrawingSpace||canvasInfo.bounds.inViewport){nodeRenderer.render({object:node,target:canvasInfo.ctx,renderCallback:callback,renderers:options.renderers,singleCanvas:false,container:container,stage:stageInfo.domStage,zIndex:node.getOrder(),viewboxDom:canvasInfo.viewbox,loadImage:!canvasInfo.ctx||options.forceUpdate||options.useImages})}else{callback()}},function(e){_gliffy.workQueue.clearQueue();render_complete();_gliffy.RenderLoop.stop();_gliffy.handleError("com.gliffy.error.render_failed",[],e,options.target)})}},__createSimpleLoopCallback:function(canvasInfo,options,node){return function(){delete node.stage.dirty[node.getId()];if(options.useImages&&canvasInfo.canvas&&canvasInfo.ctx){canvasInfo.canvas.attr("src",canvasInfo.ctx.canvas.toDataURL())}}},__setupNodeCanvas:function(node,object,contexts,stage,stageInfo,container,options){var ctx,canvas,viewbox,guides,bounds={inViewport:true},scale,transform,dirtyWidth,dirtyHeight,canvasStyle,guideData,show,viewboxStyles,chromeFix,zoom,graphicsRequiringViewbox,$guideLine,horizontalVertical,guideId,linkGraphic,self=this;if((node.isGroup()||(!object&&node.isMultipartShape()))&&options.renderViewbox){viewbox=$("#"+node._domId+"viewbox");if(viewbox.length===0){viewbox=$("<div/>",{id:node._domId+"viewbox"}).addClass("gliffy-viewbox");if(node.isGroup()){viewbox.addClass("gliffy-group")}}viewbox.css($.extend({position:"absolute",zIndex:node.getOrder()+1,width:node.getWidth(),height:node.getHeight()},_gliffy.Utils.transformCss(new _gliffy.AffineTransform(1,0,0,1,0,0).scale(stage.zoom,stage.zoom).concatenate(node.worldTransform))));if(_gliffy.Editor===undefined){viewbox.css("display","none");viewbox.css("pointerEvents","none")}stageInfo.domStage.append(viewbox);if(node.isShape()&&node.getShapeInformation().quickConnectionOverlay==="arrows-mindmap"){viewbox.addClass("gliffy-qc-overlay-arrows-viewbox");node.getDomElement().addClass("gliffy-qc-overlay-arrows-canvas")}}else{if(!(object instanceof _gliffy.Text)&&!(_gliffy.PopupNote&&object instanceof _gliffy.PopupNote)&&!(object instanceof _gliffy.Link)){ctx=contexts[node._domId];canvas=$("#"+node._domId);viewbox=(options.renderViewbox)?$("#"+node._domId+"viewbox"):null;if(options.forceUpdate||!ctx){node.setFlag("bounds");node.setFlag("skin")}if(!ctx){if(options.renderViewbox){viewbox=$("<div/>",{id:node._domId+"viewbox"}).addClass("gliffy-viewbox");linkGraphic=node.findGraphic(_gliffy.Link);if(node&&linkGraphic.length>0){viewbox.attr("data-href",linkGraphic[0].getGraphic().getHref())}}if(options.useImages){canvas=$("<img/>",{id:node._domId}).addClass("gliffy-graphic");ctx=_gliffy.Utils.getContext(document.createElement("canvas"));canvas.data("ctx",ctx)}else{canvas=$("<canvas/>",{id:node._domId}).addClass("gliffy-graphic");ctx=_gliffy.Utils.getContext(canvas.get(0))}if(options.renderViewbox){stageInfo.domStage.append(viewbox)}stageInfo.domStage.append(canvas);contexts[node._domId]=ctx;container.data(contexts);if(node.getRootParent().isShape()&&node.getRootParent().getShapeInformation().quickConnectionOverlay==="arrows-mindmap"){viewbox.addClass("gliffy-qc-overlay-arrows-viewbox");node.getDomElement().addClass("gliffy-qc-overlay-arrows-canvas")}}$("#"+node._domId).data("node",node);scale=stage.zoom;dirtyWidth=object.style.graphic_width*scale;dirtyHeight=object.style.graphic_height*scale;zoom=stage?stage.getZoom():1;if(object instanceof _gliffy.Line){transform=new _gliffy.AffineTransform(1,0,0,1,0,0).scale(zoom,zoom).translate(object.style.pos_x,object.style.pos_y).translate(-object.style.offset_x,-object.style.offset_y).scale(1/scale,1/scale)}else{transform=new _gliffy.AffineTransform(1,0,0,1,0,0).scale(zoom,zoom).concatenate(object.node.worldTransform).translate(-object.style.offset_x,-object.style.offset_y).scale(1/scale,1/scale)}if(node.hasRedrawCanvasFlag()){if(!(object instanceof _gliffy.Image||(_gliffy.Proxy&&object instanceof _gliffy.Proxy))){ctx.canvas.width=Math.min(dirtyWidth,32767);ctx.canvas.height=Math.min(dirtyHeight,32767)}}bounds=_gliffy.Utils.maxBounds(transform,dirtyWidth,dirtyHeight,stage);node._current_bounds=bounds;object.style.matrix_a=scale;object.style.matrix_b=0;object.style.matrix_c=0;object.style.matrix_d=scale;object.style.matrix_e=0;object.style.matrix_f=0;if(node.hasRepositionCanvasFlag()){canvasStyle=$.extend(_gliffy.Utils.transformCss(transform),{"pointer-events":options.pointerEvents,visibility:node.getNodeOrLayerHidden()?"hidden":"visible",position:"absolute",zIndex:node.getOrder()});this.__getNodeDomElements(node,stageInfo.domStage).css("visibility",node.getHidden()?"hidden":"visible");canvas.css(canvasStyle).data("transform",transform).data("scale",scale);if($.browser.webkit){chromeFix=$("#gliffy-chrome-fix");if(chromeFix.length===0){chromeFix=$("<canvas />",{id:"gliffy-chrome-fix"}).css(canvasStyle).css("visibility","hidden").addClass("gliffy-graphic");$(".gliffy-stage").append(chromeFix);chromeFix.get(0).width=1000;chromeFix.get(0).height=1000;chromeFix.get(0).getContext("2d").fillRect(0,0,1000,1000)}}if(options.renderViewbox){viewboxStyles={position:"absolute",zIndex:node.getOrder()+1,width:node.getWidth(),height:node.getHeight(),pointerEvents:"none"};viewbox.css($.extend(viewboxStyles,_gliffy.Utils.transformCss(new _gliffy.AffineTransform(1,0,0,1,0,0).scale(stage.zoom,stage.zoom).concatenate(object.node.worldTransform))));graphicsRequiringViewbox=[_gliffy.Link];if(_gliffy.PopupNote){graphicsRequiringViewbox.push(_gliffy.PopupNote)}if(_gliffy.Editor===undefined&&node.findNodesWithGraphics(graphicsRequiringViewbox).length===0){viewbox.css("display","none")}}}}}if(options.renderViewbox&&(object instanceof _gliffy.Shape||node.isMultipartShape())&&node.hasBoundsConnections()){viewbox.addClass("gliffy-shape-bounds-viewbox")}if(node.hasGuideFlag()&&options.renderGuides&&node.supportsDrawingGuides()){guides={};guideData=node.getDrawingGuides();_.each(guideData,function(xOrYGuides,xOrY){guides[xOrY]={};horizontalVertical=xOrY==="x"?"gliffy-drawing-guide-vertical":"gliffy-drawing-guide-horizontal";_.each(xOrYGuides,function(guide,guideReference){guideId=node._domId+"guide"+guideReference;$guideLine=$("#"+guideId);if($guideLine.length===0){$guideLine=$("<div/>",{id:guideId,"class":["gliffy-drawing-guide",horizontalVertical].join(" ")});stageInfo.domStage.append($guideLine)}guides[xOrY][guideReference]=$guideLine})});_.each(guides,function(xOrYGuides,xOrY){_.mapValues(xOrYGuides,function(guide,guideReference){show=node.shouldShowGuide(xOrY,guideReference);transform=_gliffy.AffineTransform.getScaleInstance(stage.zoom,stage.zoom);switch(xOrY){case"x":transform=transform.translate(guideData[xOrY][guideReference],-stage.pan_y/stage.zoom);break;case"y":transform=transform.translate(-stage.pan_x/stage.zoom,guideData[xOrY][guideReference]);break}guide.css({top:transform.getTranslateY()+"px",left:transform.getTranslateX()+"px",display:show||_gliffy.Debug.DISPLAY_GUIDES?"block":"none",opacity:show?"0.3":"0.1"})})})}else{$("."+node._domId+"guide").remove()}if(node.isText()){setTimeout(function(){self.__getNodeDomElements(node,stageInfo.domStage).css("visibility",node.getHidden()?"hidden":"visible")},0)}return{canvas:canvas,viewbox:viewbox,ctx:ctx,bounds:bounds}},__setupStageAndPan:function(options){var stageWidth,stageHeight,domStage,stageBackground,panTransform,stage=options.object,container=options.target,self=this;if(options.fixedDrawingSpace){stageWidth=stage.maxWidth*stage.zoom;stageHeight=stage.maxHeight*stage.zoom}else{stageWidth=stage.width*stage.zoom;stageHeight=stage.height*stage.zoom}domStage=container.find(".gliffy-stage");if(domStage.length===0){domStage=$('<div class="gliffy-stage"/>');container.append(domStage)}stageBackground=stage.background;domStage.css({backgroundColor:stageBackground,width:stageWidth,height:stageHeight});if(options.scrollForPan){if(stage._pan_dirty){container.scrollTop(-stage.pan_y).scrollLeft(-stage.pan_x);stage._pan_dirty=false}}else{panTransform=new _gliffy.AffineTransform(1,0,0,1,stage.pan_x,stage.pan_y);domStage.css(_gliffy.Utils.transformCss(panTransform,{roundTranslate:true}))}return{domStage:domStage,stageWidth:stageWidth,stageHeight:stageHeight}},__afterRenderComplete:function(container,stage,stageInfo,contexts,options){return function(){var autoFitWidth,autoFitHeight,zoom;zoom=stage?stage.getZoom():1;if(options.fixedDrawingSpace){stageInfo.domStage.css({width:stageInfo.stageWidth,height:stageInfo.stageHeight})}else{if(options.resizeTarget){autoFitWidth=(options.autoFitPadding)?stage.width+AUTOFIT_PADDING:stage.width;autoFitHeight=(options.autoFitPadding)?stage.height+AUTOFIT_PADDING:stage.height;autoFitWidth=Math.min(autoFitWidth,stage.maxWidth);autoFitHeight=Math.min(autoFitHeight,stage.maxHeight);container.css({width:autoFitWidth*zoom,height:autoFitHeight*zoom});stageInfo.domStage.css({width:autoFitWidth*zoom,height:autoFitHeight*zoom})}}if(options.renderCallback){options.renderCallback()}}},__flattenNodes:function(stage,forceUpdate){var nodes=[],i,dirtyNodes,node;if(forceUpdate){dirtyNodes=stage.objects}else{dirtyNodes=Object.keys(stage.dirty)}for(i=0;i<dirtyNodes.length;i++){node=dirtyNodes[i];if(!forceUpdate){node=stage.find(dirtyNodes[i]);if(!node){delete stage.dirty[dirtyNodes[i]]}}this.__preorder(node,nodes,forceUpdate)}stage.updateBounds();return nodes},__preorder:function(node,array,forceUpdate){var i;if(!node){return}if(node.shouldBeDrawn()||forceUpdate){if(forceUpdate){node.setFlag("bounds");if(node.getGraphic()){node.getGraphic().markDirty()}node.markDirty()}if(node.isDirty()){node.update()}if(node.getGraphic()||(node.supportsConnections()&&node.isMultipartShape())||(node.getGraphic()===null&&node.isMultipartShape()&&node.hasGuideFlag())){array.push(node)}else{node.stage.removeDirtyNode(node)}}else{node.stage.removeDirtyNode(node)}for(i=0;node.children&&i<node.children.length;i++){this.__preorder(node.children[i],array,forceUpdate)}},__preorderNotify:function(node){var c;if(!node){return}if(node.shouldBeDrawn()){if(node.isDirty()){node.update()}node.notify()}for(c=0;node.children&&c<node.children.length;c++){this.__preorderNotify(node.children[c])}},__notifyNodes:function(stage){var i,dirtyNodes,node;dirtyNodes=Object.keys(stage.dirty);for(i=0;i<dirtyNodes.length;i++){node=dirtyNodes[i];node=stage.find(dirtyNodes[i]);this.__preorderNotify(node)}},__deleteNodes:function(nodes,domStage,contexts){var removeNodeSel="",i,j;if(nodes.length>0){for(i=0;i<nodes.length;i++){removeNodeSel+=nodes[i]+","+nodes[i]+"viewbox,";for(j=0;j<6;j++){removeNodeSel+=nodes[i]+"guide"+j+(j<5?",":"")}removeNodeSel+=(i<nodes.length-1)?",":"";delete contexts[nodes[i].substr(1)]}domStage.find(removeNodeSel).remove()}},__getNodeDomElements:function(node,domStage){var nodeSelector,j;nodeSelector="#gliffy_node_"+node.getId()+",#gliffy_node_"+node.getId()+"viewbox,";for(j=0;j<6;j++){nodeSelector+="#gliffy_node_"+node.getId()+"guide"+j+(j<5?",":"")}return domStage.find(nodeSelector)}})}());(function(){_gliffy.Renderer.StageSvg=_gliffy.Renderer.extend({id:"Gliffy.Renderer.StageSvg",target:null,_mockStageInfo:null,init:function(){_gliffy.renderers[this.id]=this},render:function(o){if(!o){throw"stage renderer needs options"}if(!(o.object&&o.object instanceof _gliffy.Stage)){throw"needs a stage object to render!"}var options=$.extend({},{renderCallback:null,textRenderer:_gliffy.Renderer.TextHtml2Canvas,shapeRenderer:_gliffy.Renderer.ShapeCanvas,svgRenderer:_gliffy.Renderer.SvgCanvas,lineRenderer:_gliffy.Renderer.LineCanvas,imageRenderer:_gliffy.Renderer.ImageCanvas,forceUpdate:false,whitespace_x_padding:20,whitespace_y_padding:20,show_progress_bar:false,ignorePan:true,ignoreZoom:true,hideHiddenNodes:true,boundingBoxFit:false},o),i=0,stage=options.object,container=options.target||document.createElement("div"),ctx,forceUpdate=options.forceUpdate,nodeRenderer,width,height,objects,renderers={text:options.textRenderer,shape:options.shapeRenderer,line:options.lineRenderer,image:options.imageRenderer,svg:options.svgRenderer},bb,scale,offsetX=0,offsetY=0,bounds,self=this,delayEvery;this._mockStageInfo=this._setupMockStage(options);_gliffy.Utils.setupAnimationDelay();html2canvasClearCache();if(!_gliffy.renderers[options.textRenderer.prototype.id]){_gliffy.renderers[options.textRenderer.prototype.id]=new options.textRenderer()}if(!_gliffy.renderers[options.shapeRenderer.prototype.id]){_gliffy.renderers[options.shapeRenderer.prototype.id]=new options.shapeRenderer()}if(!_gliffy.renderers[options.svgRenderer.prototype.id]){_gliffy.renderers[options.svgRenderer.prototype.id]=new options.svgRenderer()}if(!_gliffy.renderers[options.lineRenderer.prototype.id]){_gliffy.renderers[options.lineRenderer.prototype.id]=new options.lineRenderer()}if(!_gliffy.renderers[options.imageRenderer.prototype.id]){_gliffy.renderers[options.imageRenderer.prototype.id]=new options.imageRenderer()}if(!_gliffy.renderers[_gliffy.Renderer.NodeCanvas.prototype.id]){_gliffy.renderers[_gliffy.Renderer.NodeCanvas.prototype.id]=new _gliffy.Renderer.NodeCanvas()}nodeRenderer=_gliffy.renderers[_gliffy.Renderer.NodeCanvas.prototype.id];if(options.show_progress_bar){GliffyApp.progressBarController.show("Exporting to SVG")}window.pauseSilverlightDetection=true;stage.update();bb=stage.calculateBoundingBox();scale=stage.zoom;if(options.ignoreZoom){scale=1}bounds=new _gliffy.BoundingBox();bounds.min.x=Math.max(0,bb.min.x-options.whitespace_x_padding)*scale;bounds.min.y=Math.max(0,bb.min.y-options.whitespace_y_padding)*scale;bounds.max.x=Math.min(bb.max.x+options.whitespace_x_padding,stage.maxWidth)*scale;bounds.max.y=Math.min(bb.max.y+options.whitespace_y_padding,stage.maxHeight)*scale;if(options.boundingBoxFit){width=bounds.getDimension().x;height=bounds.getDimension().y;offsetX=-bounds.min.x;offsetY=-bounds.min.y}else{width=bounds.max.x;height=bounds.max.y}ctx=new C2S({width:width,height:height});ctx.canvas.width=width;ctx.canvas.height=height;ctx.save();ctx.fillStyle=stage.background;ctx.fillRect(0,0,width,height);ctx.restore();ctx.translate(offsetX,offsetY);stage.update();if(options.hideHiddenNodes){objects=stage.visibleFlattenedNodes(forceUpdate)}else{objects=stage.flattenNodes(forceUpdate)}objects=this.__moveTextWithLinksToEnd(objects);if(renderers.text===_gliffy.Renderer.TextHtml2Canvas){for(i=0;i<objects.length;i++){if(objects[i].isText()){_gliffy.workQueue.queue(this.__createWorkQueueFunction(nodeRenderer,objects,i,ctx,renderers,container,$.extend({},{preRender:true},options)))}}}delayEvery=Math.max(Math.floor(objects.length/10),10);for(i=0;i<objects.length;i++){if(i%delayEvery===0){_gliffy.workQueue.animationDelay()}_gliffy.workQueue.queue(this.__createWorkQueueFunction(nodeRenderer,objects,i,ctx,renderers,container,options))}_gliffy.workQueue.animationDelay().queue(function(next){if(options.show_progress_bar){GliffyApp.progressBarController.getBar().animate({width:"100%"})}window.pauseSilverlightDetection=false;if(options.renderCallback){if(options.target){_gliffy.FontLoader.getEmbeddableFonts(function(style){$(ctx.getSvg()).prepend($("<style>"+style+"</style>"));$(container).append(ctx.getSvg());options.renderCallback(ctx)})}}next()})},_setupMockStage:function(options){var stageWidth,stageHeight,domStage,stage=options.object,container=options.target,self=this;if(options.fixedDrawingSpace){stageWidth=stage.maxWidth*stage.zoom;stageHeight=stage.maxHeight*stage.zoom}else{stageWidth=stage.width*stage.zoom;stageHeight=stage.height*stage.zoom}domStage=container.find(".gliffy-mock-stage");if(domStage.length===0){domStage=$('<div class="gliffy-stage gliffy-mock-stage"/>');domStage.css({position:"absolute",width:stageWidth+"px",height:stageHeight+"px",top:"0px",left:"0px",zIndex:-10000});container.append(domStage)}return{domStage:domStage,stageWidth:stageWidth,stageHeight:stageHeight}},__createWorkQueueFunction:function(nodeRenderer,objects,i,ctx,renderers,container,options){var self=this;return function(next){_gliffy.Utils.tryCatch(function(){nodeRenderer.render({object:objects[i],stage:self._mockStageInfo.domStage,target:ctx,renderCallback:function(){if(options.show_progress_bar){GliffyApp.progressBarController.getBar().queue(function(n){$(this).width(Math.floor(((i+1)/objects.length)*100)+"%");n()})}next()},renderers:renderers,container:container,singleCanvas:true,ignorePan:options.ignorePan,ignoreZoom:options.ignoreZoom,preRender:options.preRender})},function(e){_gliffy.Logger.warn("Problems exporting to svg, skipping to next node. "+e);next()})}},__moveTextWithLinksToEnd:function(objects){var textObjects=[];for(var i=0;i<objects.length;i++){if(objects[i].getGraphic() instanceof _gliffy.Text&&objects[i].getGraphic().hasLink()){textObjects.push(objects.splice(i,1)[0])}}return objects.concat(textObjects)}})}());(function(){_gliffy.Renderer.LinkRenderer=_gliffy.Renderer.IconRenderer.extend({id:"Gliffy.Renderer.LinkRenderer",init:function(){_gliffy.renderers[this.id]=this},render:function(o){o.iconClass="gliffy-viewerIcon-link";o.graphicType=_gliffy.Link;o.oppositeGraphicType=_gliffy.PopupNote?_gliffy.PopupNote:null;o.renderLeftIfOppositeGraphicTypeExists=true;o.renderPopupPoints=false;this._super(o)}})})();(function(){_gliffy.Slider=_gliffy.Class.extend({_sliderMarkup:'<div class="gliffy-slider"><div class="gliffy-initial-pos"></div><div class="gliffy-slider-handler" /></div>',_handle:null,_handle_width:null,_slider:null,_max:null,_min:null,_width:null,_reset_value:null,_reset_step:null,_reset_pos:null,target:null,value:null,init:function(o){var lastpos,self=this,options=$.extend({},{min:0,max:100,step:0,value:50,namespace:"gliffy.viewer.zoom",reset_step:2,reset_value:50,dragStartCallback:function(self){},dragEndCallback:function(self){},dragCallback:function(self,lastValue){}},o);if(!options.target){throw new Error("Slider must have a target container set")}this._max=options.max;this._min=options.min;this.value=options.reset_value;this._step=options.step;this._reset_value=options.reset_value;this._reset_step=options.reset_step;this.target=options.target;this._slider=$(this._sliderMarkup);this._handle=this._slider.find(".gliffy-slider-handler");options.target.append(this._slider);this._handle_width=this._handle.width();this._width=this._slider.width();this.moveHandle();this._reset_pos=this._slider.find(".gliffy-initial-pos");if(this._reset_step>0){this._reset_pos.css({left:this._handle.css("left")})}else{this._reset_pos.hide()}this.value=options.value;this.moveHandle();this.dragEvent="drag."+options.namespace;this.dragInitEvent="draginit."+options.namespace;this.dragEndEvent="dragend."+options.namespace;this.clickEvent="mousedown."+options.namespace;lastpos={x:this._handle.offset().left};this._handle.bind(this.dragInitEvent,{which:1},function(){lastpos={x:self._handle.offset().left};options.dragStartCallback(self)}).bind(this.dragEvent,{which:1},function(event){var lastValue=self.value,pos=lastpos;lastpos=self._updatePosition(event,lastpos);options.dragCallback(self,lastValue)}).bind(this.dragEndEvent,{which:1},function(event){lastpos=self._updatePosition(event,lastpos);options.dragEndCallback(self)}).mousedown(function(event){event.stopPropagation()});this._slider.bind(this.clickEvent,function(event){event.preventDefault();event.stopPropagation();var lastValue=self.value;lastpos=self._updatePosition(event,lastpos);options.dragStartCallback(self);options.dragCallback(self,lastValue);options.dragEndCallback(self)})},_updatePosition:function(event,lastpos){var xDiff=event.pageX-this._handle_width/2-lastpos.x,valueDiff=(this._max-this._min)*(xDiff/this._width),newValue=this.value+valueDiff;if(this._handle_width===0){this._handle_width=this._handle.width()}if(this._width===0){this._width=this._slider.width()}if(Math.abs(valueDiff)>this._step){if(newValue>(this._reset_value-this._reset_step)&&newValue<(this._reset_value+this._reset_step)){this.value=this._reset_value}else{if(newValue>this._max){this.value=this._max}else{if(newValue<this._min){this.value=this._min}else{this.value=newValue}}}this.moveHandle();return{x:this._handle.offset().left}}return lastpos},moveHandle:function(){var val=null;if(this.value>this._max||this.value===this._max){val="100%"}else{if(this.value<this._min||this.value===this._min){val=0}else{val=parseInt((this.value-this._min)/(this._max-this._min)*100,10)+"%"}}this._handle.css({left:val})},remove:function(){this._handle.unbind(this.dragInitEvent).unbind(this.dragEvent).unbind(this.dragEndEvent);this._slider.remove()}})}());(function(){_gliffy.Spinner={__contexts:{},createSpinner:function(){var opts;opts={lines:7,length:7,width:6,radius:8,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:60,shadow:false,hwaccel:true,className:"spinner",zIndex:2000000000,top:"auto",left:"auto"};return new Spinner(opts)},showSmallSpinner:function(target){var opts,spinner;opts={lines:7,length:5,width:4,radius:4,corners:1,rotate:46,color:"#000",speed:1.3,trail:34,shadow:false,hwaccel:true,className:"spinner",zIndex:2000000000,top:"auto",left:"auto"};spinner=new Spinner(opts).spin(target.get(0))},showNodeSpinner:function(node){var opts,target,spinner;opts={lines:7,length:5,width:4,radius:4,corners:1,rotate:46,color:"#000",speed:1.3,trail:34,shadow:false,hwaccel:true,className:"spinner",zIndex:2000000000,top:"auto",left:"auto"};target=$("<div/>",{"class":"gliffy-node-spinner"});target.css({width:50,height:50,marginTop:-10,marginLeft:-10});node.getDomViewbox().append(target);spinner=new Spinner(opts).spin(target.get(0))},hideNodeSpinner:function(node){node.getDomViewbox().find(".gliffy-node-spinner").remove()},isShown:function(o){var options=$.extend({},{context:"general"},o);return this.__contexts[options.context]},show:function(o){var options=$.extend({},{noAnimate:false},{context:"general"},o),$spinnerIcon=$(".gliffy-spinner-icon"),$spinnerBg=$(".gliffy-spinner-bg"),hadContexts=false;$.each(this.__contexts,function(key,val){hadContexts=true});this.__contexts[o.context]=true;if(!hadContexts){$spinnerIcon.stop();$spinnerBg.stop();$spinnerIcon.show();$spinnerBg.show();$spinnerIcon.css("opacity",1);$spinnerBg.css("opacity",0.5)}},hide:function(o){var options=$.extend({},{context:"general",force:false},o),$spinnerIcon=$(".gliffy-spinner-icon"),$spinnerBg=$(".gliffy-spinner-bg"),contextsRemain=false;delete this.__contexts[o.context];if(o.force){this.__contexts={}}$.each(this.__contexts,function(key,val){contextsRemain=true});if(!contextsRemain){$spinnerIcon.stop();$spinnerBg.stop();if(parseFloat($spinnerIcon.css("opacity"))>0.1){$spinnerIcon.animate({opacity:0},100,function(){$spinnerIcon.hide()})}else{$spinnerIcon.hide()}if(parseFloat($spinnerBg.css("opacity"))>0.1){$spinnerBg.animate({opacity:0},100,function(){$spinnerBg.hide()})}else{$spinnerBg.hide()}}},forceHide:function(){this.hide({force:true})}}}());var public_classes=["shapeLibrary","Viewer","EmbeddableViewer","Editor","Utils","IntegrationHandler","Components","Plugins","setErrorHandler","setI18nHandler","Logger","Class","AffineTransform","BrowserDetect","Popover","Dialog","Slider","Renderer","Spinner","FileHandlerRegister","DefaultFileHandler","CopyCommand","CutCommand","PasteCommand","BoundingBox","Node","FileHandlerUtils","FEATURES"],i=0;window.GLIFFY=window.GLIFFY||{};for(i=0;i<public_classes.length;i++){window.GLIFFY[public_classes[i]]=_gliffy[public_classes[i]]}_gliffy.NoDebug={SKIP_CATCH_ERRORS:false,SKIP_RENDER_LOOP:false,DISPLAY_GUIDES:false,NO_CONTEXT_MENU:false,NO_TIPS:false,NO_ERROR_DIALOG:false,FINITE_NUMBER_CHECKS:false,NO_NAVIGATE_WARNING:false,STARTUP_FILE:null,LOG_TO_CONSOLE:false,LOG_ANALYTICS:false,USE_ANALYTICS_DEBUG_JS:false,SHOW_MOUSE_COORDS:false,I18N_UNDERSCORES:false,SHOW_RTREE:false,LOCAL_SVG_EXPORT:false,POPUP_NOTE_POSITION:false,EXPORT_TEXT_DISPLAY:false,SHOW_LAYERS:false,POLL_LAYER_STATE:false};_gliffy.FullDebug={SKIP_CATCH_ERRORS:true,SKIP_RENDER_LOOP:false,DISPLAY_GUIDES:false,NO_CONTEXT_MENU:true,NO_TIPS:true,NO_ERROR_DIALOG:true,FINITE_NUMBER_CHECKS:true,NO_NAVIGATE_WARNING:true,STARTUP_FILE:null,LOG_TO_CONSOLE:true,LOG_ANALYTICS:false,USE_ANALYTICS_DEBUG_JS:false,SHOW_MOUSE_COORDS:true,I18N_UNDERSCORES:true,SHOW_RTREE:false,LOCAL_SVG_EXPORT:true,POPUP_NOTE_POSITION:false,EXPORT_TEXT_DISPLAY:false,SHOW_LAYERS:false,POLL_LAYER_STATE:false};_gliffy.Debug=_gliffy.NoDebug;if($.url().param("debug")==="true"){_gliffy.Debug=_gliffy.FullDebug}if($.url().param("debug_options")){_.each($.url().param("debug_options").split(","),function(option){_gliffy.Debug[option.toUpperCase()]=true})}(function(){_gliffy.Plugins.create({_isEditor:false,activate:function(container){var self=this,options;this._isEditor=_gliffy.Editor&&container instanceof _gliffy.Editor;if(this._isEditor){GliffyApp.popupNotesDialogController=GliffyApp.PopupNotesDialogController.create({_editor:container})}options={getStageCallback:function(){if(self._isEditor){return container.getDocumentManager().getActiveStage()}return container.document.getStage()},shouldShowPopupCallback:function(){if(self._isEditor){return(!container.overlayManager.getSelectedNode())}return true},mouse:_gliffy.Mouse||null};if($("#container-container").length>0){options.scrollContainer=$("#container-container")}_gliffy.PopupNotesMouseHandler=new _gliffy._PopupNotesMouseHandler(options)},initTemplates:function(){if(window.GliffyApp){if(Ember.View.views["gliffy-node-tools"]){Ember.View.views["gliffy-node-tools"].insertAt(0,GliffyApp.PopupNotesButtonView.create({}))}if(Ember.View.views["gliffy-popup-container"]){Ember.View.views["gliffy-popup-container"].pushObject(GliffyApp.PopupNotesDialogView.create({}))}}},getTemplateNames:function(){return["popup-notes-button.handlebars"]},getName:function(){return"PopupNotes"},showAllNoteIcons:function(){_gliffy.PopupNotesMouseHandler.showAllIcons()},hideAllNoteIcons:function(){_gliffy.PopupNotesMouseHandler.hideAllIcons()},showAllNotes:function(){_gliffy.PopupNotesMouseHandler.showAllNotes()},hideAllNotes:function(){_gliffy.PopupNotesMouseHandler.hideAllNotes()}})}());(function(){_gliffy.PopupNote=_gliffy.Graphic.extend({_text:null,_renderIcon:true,_forceShow:false,style:null,init:function(){this.style={}},getTid:function(){return"popupNote"},markDirty:function(){this._dirty=true;if(this.node){this.node.markDirty();this.node.setFlag("skin");if(this.node.parent){this.node.parent.markDirty()}}},getText:function(){return this._text},setText:function(text){this._text=text;this.markDirty()},update:function(){},applyStyle:function(style){},forceShow:function(bool){this._forceShow=bool;this.markDirty()},hideIcon:function(){this._renderIcon=false;this.markDirty()},showIcon:function(){this._renderIcon=true;this.markDirty()},getRenderIcon:function(){return this._renderIcon},shouldForceShow:function(){return this._forceShow},getClassName:function(){return"PopupNote"},__toObject:function(){this.update();return{text:this.getText()}},__fromObject:function(object){if(object.text!==undefined){this.setText(object.text)}}})})();(function(){_gliffy.Renderer.PopupNotesRenderer=_gliffy.Renderer.IconRenderer.extend({id:"Gliffy.Renderer.PopupNotesRenderer",init:function(){_gliffy.renderers[this.id]=this},render:function(o){o.graphicType=_gliffy.PopupNote;o.iconClass="gliffy-viewerIcon-popupNotes-icon";o.oppositeGraphicType=_gliffy.Link;o.renderLeftIfOppositeGraphicTypeExists=false;o.renderPopupPoints=true;this._super(o)}})})();(function(){_gliffy._PopupNotesMouseHandler=_gliffy.Class.extend({_getStageCallback:null,_shouldShowPopupCallback:null,_redrawCallback:null,_showAllMode:false,_showAllPopovers:null,_mouse:null,_mouseChangeFunc:null,init:function(options){var o=$.extend({},{getStageObjectsCallback:function(){return[]},shouldShowPopupCallback:function(){return true},redrawCallback:function(){},scrollContainer:$(window),mouse:null},options),self=this,startedScroll;this._mouse=o.mouse;this._getStageCallback=o.getStageCallback;this._shouldShowPopupCallback=o.shouldShowPopupCallback;this._redrawCallback=o.redrawCallback();this._showAllPopovers=[];this.handleMouseEvents();if(o.scrollContainer){startedScroll=false;o.scrollContainer.scroll(function(){clearTimeout($.data(this,"gliffy-popup-notes-scrollTimer"));$.data(this,"gliffy-popup-notes-scrollTimer",setTimeout(function(){self.scrollEnd();startedScroll=false},250));if(!startedScroll){self.scrollStart();startedScroll=true}})}},setCustomMouseTrigger:function(){var self=this;$("body").off("mousemove.gliffy-popup-notes");$("body").on("custom-mouse-trigger.gliffy-popup-notes",function(ev,pt){self.mouseChangeFunc(pt)})},handleMouseEvents:function(){var currentNode=null,self=this;self.mouseChangeFunc=function(pos){if(!(_gliffy.Mouse&&_gliffy.Mouse.editor.isShowingModal())){var node=null,popupNoteNode;if(self._showAllMode){return}if(self._shouldShowPopupCallback()){node=_gliffy.Pick.getNodeAt(self._getStageCallback().objects,pos.x,pos.y,true)}if(!node){if(self.currentPopover){self.currentPopover.remove()}}else{if(node!==currentNode){if(self.currentPopover){self.currentPopover.remove()}popupNoteNode=self.findClosestPopupNoteOnNode(node,pos);if(popupNoteNode&&popupNoteNode.parent){node=popupNoteNode.parent}if(popupNoteNode){self.currentPopover=self.addPopover(node,popupNoteNode)}else{node=null}}}currentNode=node}};if(this._mouse){this._mouse.onChangeIntent(self.mouseChangeFunc)}else{$("body").on("mousemove.gliffy-popup-notes",function(e){var x=e.pageX,y=e.pageY,offset,zoom;if($(".gliffy-stage").length>0){offset=$(".gliffy-stage").offset();x-=offset.left;y-=offset.top}zoom=self._getStageCallback().getZoom();x/=zoom;y/=zoom;self.mouseChangeFunc({x:x,y:y})})}$("#container").on("mousedown",function(){if(self.currentPopover){self.currentPopover.remove()}});$("#container").scroll($.debounce(250,true,function(){if(self.currentPopover){self.currentPopover.remove()}self._hideAll()}));$("#container").scroll($.debounce(250,function(){if(self._showAllMode){self.showAllNotes()}}));$("#container").on("removeCurrent.gliffy-popup-notes",function(){if(self.currentPopover){self.currentPopover.remove()}})},findClosestPopupNoteOnNode:function(node,pos){var children,popupNote,self=this;if(node.isGroup()){children=node.flattenChildren();_.eachRight(children,function(child){popupNote=_gliffy.Utils.firstInArray(child.findImmediateChildGraphic(_gliffy.PopupNote));if(!popupNote||!child.getWorldAabb().pointInside(pos.x,pos.y)){popupNote=self.findClosestPopupNoteOnNode(child,pos)}else{return false}})}else{popupNote=_gliffy.Utils.firstInArray(node.findImmediateChildGraphic(_gliffy.PopupNote))}return popupNote},removeCurrentPopover:function(){if(self.currentPopover){self.currentPopover.remove()}},_modifyAllNotes:function(options){var nodes,note,popupNotes,node,popupNote,i,j,o=$.extend({},{type:"note",show:true},options);this._showAllPopovers=[];nodes=this._getStageCallback().objects;for(i=0;i<nodes.length;i++){node=nodes[i];popupNotes=node.findGraphic(_gliffy.PopupNote);for(j=0;j<popupNotes.length;j++){popupNote=popupNotes[j].getGraphic();if(o.type==="icon"){popupNote[o.show?"showIcon":"hideIcon"]()}else{if(o.type==="note"){popupNote.forceShow(o.show);if(popupNote.node.parent){var popover=this.refresh(popupNote.node.parent,popupNote.node);if(popover){this._showAllPopovers.push(popover)}}}}}}},_hideAll:function(){for(var i=0;i<this._showAllPopovers.length;i++){this._showAllPopovers[i].remove()}},_showAllNotes:function(){$("#container").trigger("removeCurrent.gliffy-popup-notes");this._modifyAllNotes({type:"note",show:true})},_hideAllNotes:function(){this._hideAll();this._modifyAllNotes({type:"note",show:false});if(this.currentPopover){this.currentPopover.remove();this.currentPopover=null}},showAllNotes:function(){this._showAllMode=true;this._showAllNotes()},hideAllNotes:function(){this._showAllMode=false;this._hideAllNotes()},hasPopupNotes:function(){var stage=this._getStageCallback();return stage&&stage.findGraphic(_gliffy.PopupNote).length>0},scrollStart:function(){if(this._showAllMode){this._hideAllNotes()}},scrollEnd:function(){if(this._showAllMode){this._showAllNotes()}},showAllIcons:function(){this._modifyAllNotes({type:"icon",show:true})},hideAllIcons:function(){this._modifyAllNotes({type:"icon",show:false})},refresh:function(parentNode,popupNoteNode){if(popupNoteNode.getGraphic().shouldForceShow()){return this.addPopover(parentNode,popupNoteNode)}return null},addPopover:function(parentNode,popupNoteNode){var offset,containerBB,directions,popupBB,$popupNoteDomNode,popupNoteGraphic,popupNodePoints,self=this;directions=["n","s","w","e","nw","ne","se","sw"];containerBB=new _gliffy.BoundingBox(0,0,window.innerWidth,window.innerHeight);offset=$("#container").offset();if(offset){containerBB.min.x=offset.left;containerBB.min.y=offset.top}if(popupNoteNode){popupNoteGraphic=popupNoteNode.getGraphic();popupNodePoints=$(".gliffy-popup-point");popupNodePoints.show();_.each(directions,function(direction){$popupNoteDomNode=parentNode.getDomViewbox().find(".gliffy-popup-point-"+direction);$popupNoteDomNode.html(direction);self.currentPopover=new _gliffy.Popover({target:$popupNoteDomNode,content:popupNoteGraphic.getText(),placement:direction,addClass:"gliffy-popup-note"});popupBB=self.currentPopover.getBoundingBox();if(containerBB.boundingBoxInside(popupBB)){return false}else{self.currentPopover.remove();self.currentPopover=null}});popupNodePoints.hide()}return self.currentPopover}})}())}());
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}

;
;try {
/* module-key = 'com.gliffy.integration.confluence:gliffy-viewer-resources', location = 'js/gliffy-viewer-init.js' */
(function(a){a(function(){function n(e){var z=e.closest("div.gliffy-container");e.hide();z.find("img.gliffy-image").show()}var r=window.GLIFFY.confluence.baseUrl,m=r+"/rest/gliffy/1.0",p,c,x,w,j,s;var k=require("GliffySpinner");var i;var d;if(window.top!==window.self){p=window.parent.AJS.$(window.frameElement);d=a("<div></div>").height(a(document).height()).width(a(document).width());a("body").append(d.get(0));i=new k(d.get(0),{radius:50,color:"#666"});i.start()}w=r+"/download/resources/com.gliffy.integration.confluence/icons/error-500.jpg";if(window.GLIFFY&&GLIFFY.shapeLibrary){GLIFFY.shapeLibrary.setup({rootServiceURL:m,svgToStencilTransformURL:m+"/stencils/svg.json"});j=GLIFFY.Class.extend({report:function(C,B,D){var z,e,A;if(D){A=a("<img/>",{style:"width:100%",src:w});A.text(C);n(p)}throw B},feedbackDialog:function(){},getErrorReport:function(){}});s=GLIFFY.Class.extend({get:function(z,e){return window.parent.AJS.I18n.getText(z,e)}});GLIFFY.setErrorHandler(new j())}x=a("#container");if(window.top===window.self){var q=require("gliffy/url").parse(window.location.href).queryParams;var f=q.attachmentId;var o=q.pageId;var b=parseInt(q.attachmentVersion);var u=q.lastPage;var h=q.ceoid;var y=q.name;var l=["fit","popupNotes"];var g=window.GLIFFY.EmbeddableViewer.extend({__editBind:function(e){e.on("click",".gliffy-edit",function(A){A.preventDefault();if(o){var z=r+"/plugins/gliffy/editor.action?inline=false";z+="&pageId="+o;z+="&attachmentId="+f;if(b){z+="&attachmentVersion="+b}z+="&ceoid="+h;z+="&key="+encodeURIComponent(q.key);z+="&name="+encodeURIComponent(y);z+="&lastPage="+encodeURIComponent(u);require("gliffy/confluence/editor/editorLauncher").launchEditorFromViewPage({url:z,contextPath:r,attachmentId:f,attachmentVersion:b,ownerPageId:h,referencePageId:o,diagramName:y})}})},__returnBind:function(e){a(window).on("keydown",function(z){z.preventDefault();if(z.keyCode===27){window.location=r+u}});e.on("click",".gliffy-return",function(z){z.preventDefault();window.location=r+u})}});if(o){l.unshift("edit")}var v=r+"/rest/gliffy/1.0/diagrams/"+f;if(b){v+="?version="+b}c=new g({fontPath:r+"/download/resources/com.gliffy.integration.confluence/images/rtefont/",controlsLeft:l,controlsCenter:["zoom"],controlsRight:["return"],target:x,renderer:GLIFFY.Renderer.StageMultiCanvas,url:v});c.getInitPromise().then(function(){if(c.hasPopupNotes()){a(".gliffy-embeddable-viewer a.gliffy-button.gliffy-notes").css("display","inline-block")}},function(z,B){var A=a("<div/>",{"class":"gliffy-viewer-error"});A.append(a("<div/>",{"class":"gliffy-viewerIcon-general-error"}));A.append(a('<div class="gliffy-viewer-error-msg">'+window.GLIFFY.confluence.viewerErrorMsg+"</div>"));A.append(a('<div class="gliffy-viewer-error-msg">'+z+"</div>"));a(".gliffy-embeddable-viewer").append(A);a(".gliffy-embeddable-viewer").find(".gliffy-controls .gliffy-button").css("display","none");a(".gliffy-embeddable-viewer").find(".gliffy-controls .gliffy-slider").css("display","none");a(".gliffy-embeddable-viewer").find(".gliffy-controls .gliffy-button .gliffy-viewerIcon-return").parent().css("display","inline-block")});GLIFFY.initViewerAnalytics(window.GLIFFY.confluence.baseUrl,window.GLIFFY.confluence.licenseType,window.GLIFFY.confluence.quantityUsers)}else{c=new GLIFFY.Viewer({fontPath:r+"/download/resources/com.gliffy.integration.confluence/images/rtefont/"});GLIFFY.viewer=c;try{if(window.parent.AJS.$(".gliffy-container").parent().css("display")!=="none"){c.render({url:r+"/rest/gliffy/1.0/diagrams/"+p.data("id")+"?version="+p.data("version"),scale:p.data("scale"),target:x,callback:function(){var z;d.remove();a("[data-href^='#']").each(function(){var B=window.parent.location.href+a(this).attr("data-href");a(this).attr("data-href",B)});a("a").each(function(){var B=a(this).attr("href"),C;if(typeof B!==typeof undefined&&B!==false&&B.indexOf("#")===0){C=window.parent.location.href.split("#")[0];a(this).attr("href",C+B)}});if(window.parent.AJS.$(p).parent().css("display")!=="none"){var A=p.closest(".gliffy-container").find(".diagram-image-container");p.css({height:x.height(),width:x.width(),position:"relative",visibility:"visible",left:0});p.data("gliffyOriginalDimensions",{width:c.document.__gon.stage.width,height:c.document.__gon.stage.height,zoom:c.document.__gon.stage.zoom});if(A.hasClass("gliffy-no-diagram-image")){var e;p.removeClass("full-width");e=p.width();p.closest(".gliffy-container").width(e+2)}A.remove()}else{console.log("Problem in Gliffy HTML5 rendering callback. Falling back to preview image.");n(p)}}})}else{console.log("Problem rendering Gliffy HTML5 viewer. Falling back to preview image.");n(p)}}catch(t){console.log("Problem rendering Gliffy HTML5 viewer - "+t.message+". Falling back to preview image.");n(p)}p.data("gliffyViewer",c);a("body").delegate("a","click",function(z){z.preventDefault();var e=a(this).attr("href");if((e.indexOf("#")===0)){window.parent.location.hash=e}else{window.parent.location=e}})}})}(jQuery));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}

;
;try {
/* module-key = 'com.gliffy.integration.confluence:gliffy-viewer-resources', location = 'js/gliffy-viewer-analytics.js' */
(function(){window.GLIFFY=window.GLIFFY||{};GLIFFY.initViewerAnalytics=function(g,b,a){var e=window.$||AJS.$;function d(i,h){e(window).trigger(i+".gliffyAnalytics",h)}function f(){d("init",{accountType:"google",accountID:"UA-248648-8",optPageName:"viewer",debug:false});d("setCustomVariables",{product:"Confluence",license:b,numUsers:(a+" Users")});d("trackEvent",{category:"viewer",action:"showViewer"})}var c=g+"/rest/gliffy/1.0/properties/com.gliffy.integration.confluence.ANALYTICS_OFF";e.ajax({url:c,type:"GET",cache:false,success:function(h){if(h["com.gliffy.integration.confluence.ANALYTICS_OFF"]!==true){f()}},error:function(j,h,i){},dataType:"json"})}}());
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}

;
